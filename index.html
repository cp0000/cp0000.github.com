<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="css/main.css">


<link rel="stylesheet" href="lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"https:/cp0000.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="CP WRITINGS">
<meta property="og:url" content="index.html">
<meta property="og:site_name" content="CP WRITINGS">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Pei Cheng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>CP WRITINGS</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CP WRITINGS</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一只特立独行的猪</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2021/05/04/no-decency/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2021/05/04/no-decency/" class="post-title-link" itemprop="url">Have you no sense of decency?</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-05-04 15:13:26 / Modified: 17:31:31" itemprop="dateCreated datePublished" datetime="2021-05-04T15:13:26+08:00">2021-05-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近在某个播客里面听到一段关于美国麦卡锡主义是如何被打败的故事。其中1954年，当麦卡锡把魔抓伸向军队的时候，美军律师约瑟夫韦尔奇受够了来自麦卡锡参议员各种的没有实际证据的凭空指控，听证会上说了那句著名的“Have you no sense of decency, sir”，就此，麦卡锡主义的影响开始消融。这当然有演绎这句话的成分，但从中也能体会到decency是当时一些人很在意的东西，它能够引起社会上大多数人的共鸣。</p>
<p>那什么是Decency，问这个问题，是因为 decency 对我来讲是一个很陌生的词。Decency如何影响人的行为在我们的现实生活也几乎难寻踪迹。<br>Decency,中文翻译为体面，什么是体面，我们平日生活中的爱面子，讲排场是一种体面嘛？我觉得不是，爱面子，讲排场有部分原因是虚荣，而体面至少是个中性偏褒的词汇。<code>Decency</code> 在维基百科页面是转链接到 <code>respect</code> 页面，所以在英文中 <code>decency</code>，体面，表达的是一种尊重和尊敬。</p>
<p>那我们目前处在的这个社会，大家讲究decency吗？我想应该是蛮多人不讲究是否体面的，而且这种不关心，不在意日益变得严重。讲几个例子，<br>我07年上大学的时候，玩魔兽争霸3，在游戏平台和别人对战，胜负已定的情况下，失利的一方一般会礼貌性的打出gg,也就是good game，无论是虚假的，还是真心的，都要说一句对方打的不错，投子认负。而现在在玩游戏的时候，如王者荣耀，吃鸡类的游戏中，大家队友之间都要开语音互喷，更加别说给予对手尊重了。</p>
<p>在现实生活工作中，我也很难感受到 decency。一些底层工人我们可以说是经济基础决定了他们无法做到体面，我所在的互联网职场是个高薪行业，但也不存在什么decency一说。近些年国内各大厂基本上都在执行996，甚至有一个资本开设的播客就叫 captita 996l，来宣扬这种加班奋斗的行为。还有今年早些时候PDD发生的员工被辞退的事件，一个年入至少30w的人，过程中，爆出这个同学手机电脑等各种隐私被查个底朝天，这个人就像被当作犯罪分子一般对待。你说，这里面有丝毫的decency吗？我们不被公司体面的对待也就算了，彼此之间也互相轻薄，自古文人相轻，技术人员也互相轻视，当讨论技术的时候，在听懂了你的技术之后，很容易就来一句你这不就是xxx，很简单的之类的。</p>
<p>那其他行业就有体面可言么？我经验很有限，了解到的如教育行业，建筑行业，医疗行业，都难谈体面。既然整个群体都不关心是否体面，那是因为经济原因吗？我们处在初级阶段，还没到讲体面的时候？当然，体面和物质肯定有一定的联系，它肯定是在物质得到一定自由之后，人类在追求内心幸福的时候研究出来的一种形而上的东西。但我觉得体面和物质（资本）之间并不是一个线性相关的联系。我在祖辈身上看到的一些体面行为，在我们这辈身上，却难寻踪迹。</p>
<p>所以写到这里，我也没搞清楚，为啥我们变得看起来越来越不讲究体面。是因为现在生活的快节奏，我们没有精力去维持一种体面？还会整个社会日益增长的财富不均，让大多数人散失了维持体面的动力？我无从知道答案，只希望我们每个人都能够被体面的对待，have a little sense of decency。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2021/01/10/my2020/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2021/01/10/my2020/" class="post-title-link" itemprop="url">我的2020</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-10 20:38:38 / Modified: 21:13:11" itemprop="dateCreated datePublished" datetime="2021-01-10T20:38:38+08:00">2021-01-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="关于新冠疫情"><a href="#关于新冠疫情" class="headerlink" title="关于新冠疫情"></a>关于新冠疫情</h2><p>2020年，英文口语一般读twenty-twenty，可以看作是一个叠音词，那2020年，她可爱吗？很显然，twenty-twenty一点都不可爱，2020年可能是我们目前这些生活在和平年代和地区的人过的最荒诞的一年。而且这种由疫情带来的荒诞，萧条，后遗症至今仍在延续。2020年年初新冠病毒在武汉爆发，接着疫情席卷全球，时至今日，诸如美国，英国还在爆发大规模的疫情，经过一年的抗疫，这个星球至今还没有从疫情中走出来。疫情带来的影响力是持续的，虽然我们国家疫情在7，8月份基本得到了控制，但时至今日，大家生活的方方面面还是笼罩在后疫情时代。我们无法自由的出行，随时随地都要带着口罩，全球化彻底的完蛋。可以说疫情撕掉了这个世界一些发达国家的伪装，我们真实的了解了这个世界的人们原来的样子。不免感概，原来所谓的发达国家，人性都是一样的，有钱会让人变的善良，但如果自身利益受损，有钱人会果断撕掉伪装，拼命的保护着自己的利益。<br>但真相并不是每个人都想要，希望疫情能够早点过去，让世界恢复他原来的样子，哪怕是伪装的样子也好，撕破脸皮，赤身肉搏，真的是让人太绝望了。</p>
<h2 id="电影，书，体育"><a href="#电影，书，体育" class="headerlink" title="电影，书，体育"></a>电影，书，体育</h2><p>2020年，我看了一些电影，美剧，书籍看的不多。书籍推荐《史蒂夫·乔布斯传》，这本书早在2012年，我就打算去看，但那个时候没有看进去，20年读这本书，收获蛮多的，更加加深了我多乔布斯的尊敬。电影方面，今年没看到特别好的电影，都比较一般把。美剧方面收获多一些，比如《风骚律师》，《黄石》都不错。</p>
<p>体育比赛方面，2020年也没看到很精彩的比赛，主要原因还是新冠病毒，很多足球，篮球，网球的比赛，没有观众，观看起来差点意思。</p>
<h2 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h2><p>20年5月份，自己去医院做了一个ACL手术，至今也已经快8个月，我的腿还在恢复中。目前还没有恢复到韧带撕裂之前的状态，单腿还不太敢发力。不过相比手术之前，还是有很多进步的，我可以跑步，踩动感单车了，暴汗的感觉还是很不错的。</p>
<h2 id="一点感想"><a href="#一点感想" class="headerlink" title="一点感想"></a>一点感想</h2><p>生老病死，岁月蹉跎，2021疫情还在延续，这个世界或许不可能回到之前的样子，或许我们还要在疫情的笼罩下继续生活到2022。只是希望自己能够不以物喜，不以己悲，岁数长了，智慧也要涨。无论晴天雨天，冬天夏天，希望自己可以笃定思想，稳步前行。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2020/11/15/32/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2020/11/15/32/" class="post-title-link" itemprop="url">活到32</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-15 23:11:58" itemprop="dateCreated datePublished" datetime="2020-11-15T23:11:58+08:00">2020-11-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-16 17:17:37" itemprop="dateModified" datetime="2020-11-16T17:17:37+08:00">2020-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>死亡是唯一一座永远亮着的灯塔，不管你向哪里航行，最终都得转向它指引的方向。一切都会逝去，只有死神永生。 —-刘慈欣</p>
</blockquote>
<p>前段时间重读了三体这本科幻小说，惊喜于作者各种的科幻设计之外，给我留下最深印象的就是第三部的书名《死神永生》。是啊，世界万物，唯有死神永生。<br>我是一个从很小就开始思考死亡，恐惧死亡的人。至今有一段记忆仍然在我脑海中很深，在我只有七八岁的时候，冬天的夜晚，我再入睡之前时而会去想宇宙有多大，宇宙之外有什么？如果宇宙之外还有宇宙，那这个之外的宇宙有边界吗？如果有边界，那边界之外又是什么人，反复陷入一个无限的死循环中。思考宇宙的边界原因是我在想人死之后，是不是就不存在了，地球都存在上亿年，我们的生命只有几十年，短暂的就像是一颗流星，我异常恐惧于死亡，因为人死之后，这个世界在发生什么，就完全和你无关了，你不存在了。不存在这个想法会让人非常的恐惧，没有什么比不存在更让人绝望的了。<br>但就如上面引用，人存生下来，就要面对死亡。死亡是唯一一座永远亮着的灯塔，人，或者说万物，一切都会逝去。<br>而就我粗浅的观察，这种所谓的存在主义危机，每个人都有，不光你是所谓的社会成功人士，还是农名工，每个人在不同的时刻都会遇到这种存在主义危机。但这种危机真的是不好的吗？我看未必，周遭因为社会责任和义务的增长，我必须把自己的精力消耗在如何解决更实际的问题，工作上如何晋升，算好买房的钱等等各种问题，使得我已经不会再像小时候，早上走在乡间路上，看着天上的星星去思考死亡和人的不存在。但不思考不代表这些问题不存在，我们这些生活在现代社会中的人，每天都在想着如何攫取更多的社会资源，如何才不被时代所抛弃，努力拼搏，逼迫自己去咬牙坚持。但这一切真的有意义吗？殊不知最终都是要走向逝去，在更长的历史长河中，我们的这些悲欢离合，尔虞我诈，在宇宙中和一粒沙子的存在有什么本质的区别。<br>我知道如果这般思考，在世俗主义上会显得非常悲观，或者说是一种无为而治。宇宙的边界，人的存在和不存在，并不能让你此刻获取幸福，就像罗素在幸福之路中所说，我们应该把问题聚焦在可以落实的角度上，如何获取实在可感的幸福是人类能为之的事情，抛开现实，去无根的思考一些存在主义问题，会让自己陷入存在主义危机。<br>大师说的也许是对的，亦或者大师知道大家如果沿着存在主义去思考，会陷入一种无法自拔的不存在恐惧，而放弃积极的生活方式。<br>我想我会沿着实在的现实去追寻幸福，但我也希望自己可以多看看天空的云朵和星星，去思考存在主义，或许这样我们才能最终获得幸福。<br>活到32，生活压力无所多言，只希望自己不要为了忙碌而忙碌。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2020/08/30/GAN-introdcution/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2020/08/30/GAN-introdcution/" class="post-title-link" itemprop="url">生成对抗网络</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-08-30 23:57:04 / Modified: 23:58:01" itemprop="dateCreated datePublished" datetime="2020-08-30T23:57:04+08:00">2020-08-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="生成对抗网络"><a href="#生成对抗网络" class="headerlink" title="生成对抗网络"></a>生成对抗网络</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Generative adversarial networks (GANs) 生成对抗网络是机器学习领域最近非常让人兴奋地一项发明。GAN是生成模型：他根据训练数据生成相似的数据。举例来讲，GAN可以生成非常像人脸的照片，尽管生成的人脸不属于世界上任何一个真人，但是人眼真假难分。<br>下面这些图是GAN生成的。<br><img src="https://developers.google.com/machine-learning/gan/images/gan_faces.png" alt="图一：Images generated by a GAN created by NVIDIA."></p>
<p>GAN分成两个部分生成器，判别器，通过生成器来生成数据，通过判别器来判别生成器生成的数据。生成器试图去骗过判别器，而判别器试图保持不被骗。</p>
<h3 id="生成模型"><a href="#生成模型" class="headerlink" title="生成模型"></a>生成模型</h3><p>Background: What is Generative Model?</p>
<p>”生成对抗网络”中的“生成”是什么意思？“生成”描述的是一类统计模型，与判别器模型形成对比。</p>
<p>非正式的定义：</p>
<ul>
<li><strong>Generative</strong> 生成模型用来生成新的数据实例</li>
<li><strong>Disciminative</strong> 判别模型用来判别不同类型数据的真实性</li>
</ul>
<p>生成模型可以生成新的动物照片，这些照片看起来像真实的动物，而辨别模型可以分辨出一只狗和一只猫。GAN只是生成模型中的一种。</p>
<p>正式一点的定义：给定一组数据实例 X 和一组标签 Y:</p>
<ul>
<li><strong>Generative</strong> 生成模型得到联合概率 p(X,Y)， 如果没有标签，则获得 p(X).</li>
<li><strong>Discriminative</strong> 对抗模型得到条件概率 p(Y|X)</li>
</ul>
<p>生成模型包括数据自身的分布，并可以返回一个给定的样本属于这个数据分布的可能性有多大。比如，一个典型的生成模型是预测一个序列中下一个单词（通常比GAN要简单一些），它们给单词序列分配一个概率。</p>
<p>判别模型忽略给定实例是否可能出现的问题，仅返回该标签应用于该实例的可能性。 </p>
<blockquote>
<p>A discriminative model ignores the question of whether a given instance is likely, and just tells you how likely a label is to apply to the instance.</p>
</blockquote>
<p>请注意，这是一个非常笼统的定义。有许多生成模型，GAN只是生成模型的一种。</p>
<h3 id="Modeling-Probabilites"><a href="#Modeling-Probabilites" class="headerlink" title="Modeling Probabilites"></a>Modeling Probabilites</h3><p>这两种模型都不需要返回代表概率的数字。你可以通过模仿数据的分布来建立模型。</p>
<p>例如，像决策树这样的判别性分类器可以给一个实例打上标签，而不给这个标签分配一个概率。这种分类器仍然是一个模型，因为它预测的标签分布和真实数据的标签分布接近。</p>
<p>同样，生成式模型可以通过产生令人信服的 “假 “数据来对分布进行建模，这些数据看起来像是从该分布中提取的。</p>
<h3 id="Generative-Models-Are-Hard"><a href="#Generative-Models-Are-Hard" class="headerlink" title="Generative Models Are Hard"></a>Generative Models Are Hard</h3><p>与同类别的判别模型相比，生成模型处理的任务更加困难。生成模型需要能够模拟更多信息。<br>图像生成模型可能会捕获到”看起来像船的东西可能会出现在看起来像谁的东西附近”和“眼睛不太可能出现在额头上”这样的相关性。这些都是非常复杂的分布。而相比之下，判别器可能只需要寻找一些明显的模式，就能学会“帆船”或“非帆船”之间的区别。它可能会忽略生成模型在意的许多关联性。</p>
<p>判别模型试图在数据空间中划定边界，生成模型则试图模拟数据在整个空间中的位置。例如，下图显示了手写数字的判别模型和生成模型。<br><img src="https://developers.google.com/machine-learning/gan/images/generative_v_discriminative.png" alt="图二：Discriminative and generative models of handwritten digits"></p>
<p>判别器试图在数据空间中画一条先来分别手写0和1.如果它画的线正确，在不需要准确的模拟出实例在数据空间中两边的位置，就可以区分0和1.相比之下，生成模型试图生成接近数据空间中真实对应的数字来产生令人信服的1和0。它必须对整个数据空间的分布进行建模。</p>
<p>GAN提供了一个有效的方法去训练模拟真实数据分布的模型。要弄明白他是怎么工作的我们需要弄清楚GAN的基础架构。</p>
<h2 id="GAN-Anatomy"><a href="#GAN-Anatomy" class="headerlink" title="GAN Anatomy"></a>GAN Anatomy</h2><h3 id="Overview-of-GAN-Structure"><a href="#Overview-of-GAN-Structure" class="headerlink" title="Overview of GAN Structure"></a>Overview of GAN Structure</h3><p>GAN 分成两个部分：</p>
<ul>
<li>生成器负责生成数据。生成的数据会当做负样本给判别器</li>
<li>判别器学习区分生成器的假数据和真实数据。判别器对生成器生成的不可信的结果进行惩罚。</li>
</ul>
<p>当开始训练时，生成器生成出看起来明显是假的数据，判别器迅速学习到如何判断生成器的生成数据是假的<br><img src="https://developers.google.com/machine-learning/gan/images/bad_gan.svg"></p>
<p>当训练继续进行，生成器会生成出可以骗过判别器的数据：<br><img src="https://developers.google.com/machine-learning/gan/images/ok_gan.svg"></p>
<p>最终，如果生成器训练的很好，判别器会判别不出数据的真假。判别器会开始把假数据判为真，他的精度开始下降。<br><img src="https://developers.google.com/machine-learning/gan/images/good_gan.svg"></p>
<p>下图是GAN的完整结构图：<br><img src="https://developers.google.com/machine-learning/gan/images/gan_diagram.svg"></p>
<p>生成器和判别器都是神经网络。生成器的输出直接当做判别器的输入。通过反向传播，判别器的分类提供一个信号去让生成器更新它的权重。</p>
<h3 id="Discirminator"><a href="#Discirminator" class="headerlink" title="Discirminator"></a>Discirminator</h3><p><strong>The Discriminator</strong></p>
<p>GAN中的判别器一般是一个简单的分类器。它试图区分真实数据和生成器生成的数据。它可以使用任何适合的分类网络。<br><img src="https://developers.google.com/machine-learning/gan/images/gan_diagram_discriminator.svg" alt="图三， Backpropagation in discriminator training"></p>
<h4 id="Discriminator-Training-Data"><a href="#Discriminator-Training-Data" class="headerlink" title="Discriminator Training Data"></a>Discriminator Training Data</h4><p>判别器的训练数据有两个来源：</p>
<ul>
<li><strong>真数据</strong> 比如人的真实照片。判别器使用这些数据当做训练时的正样本</li>
<li><strong>假数据</strong> 由生成器生成的数据。判别器使用这些数据当做训练时的负样本</li>
</ul>
<p>在图三种，两个“样本”框代表这两个输入到判别器的数据源。在判别器训练期间，生成器不进行训练.生成器保持它的weights，生成数据样本给判别器训练。</p>
<h4 id="Traing-the-Discriminator"><a href="#Traing-the-Discriminator" class="headerlink" title="Traing the Discriminator"></a>Traing the Discriminator</h4><p>判别器连接了两个损失函数。在判别器训练期间，判别忽略生成器loss，只使用判别器loss。生成器loss在训练生成器的时候使用。</p>
<p>在判别训练期间：</p>
<ol>
<li>判别器用来判别真实数据和生成器的生成数据</li>
<li>当判别器把真判断为假，或者是把假数据判断为真，判别器 loss 会惩罚判别器</li>
<li>判别器通过判别器loss，反向传播判别网络，更新网络权重</li>
</ol>
<h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3><p><strong>The Generator</strong></p>
<p>GAN的生成器通过判别器的反馈来学习模型，使得判别器判断生成数据为真。<br>与判别器训练相比，生成器训练过程中需要联合判别器和生成器。GAN的训练包括以下几个部分：</p>
<ul>
<li>随机输入</li>
<li>生成网络将随机输入转化为数据</li>
<li>判别网络，用来分类生成数据</li>
<li>判别器输出</li>
<li>生成loss，用来惩罚未能骗过判别器的生成器<br><img src="https://developers.google.com/machine-learning/gan/images/gan_diagram_generator.svg" alt="图四， Backpropagation in generator training"></li>
</ul>
<h4 id="Random-Input"><a href="#Random-Input" class="headerlink" title="Random Input"></a>Random Input</h4><p>神经网络需要某种形式的输入.通常我们输入的数据是我们想做的事情，比如我们相对一个样本进行分类或者做一个预测。但是对于一个输出全新数据样本的网络，我们用什么作为输入呢？</p>
<p>一个最基本的GAN的输入是随机噪声。生成器把噪声转换为有意义的输出。通过引入噪声，我们可以从目标样本中的不同地方采样从而让GAN产生各种各样的数据。</p>
<p>实验表明，噪声的分布并不重要，所以我们可以选择一些容易采样的东西，比如均匀分布。为方便起见，对噪声进行采样的空间通常比输出空间的维度小。</p>
<h3 id="Using-the-Discriminator-to-Train-the-Generator"><a href="#Using-the-Discriminator-to-Train-the-Generator" class="headerlink" title="Using the Discriminator to Train the Generator"></a>Using the Discriminator to Train the Generator</h3><p>在训练一个神经网络的过程中，我们改变网络的权重以此来降低目标loss。在GAN的训练里面，生成器并不直接连接到我们的目标loss。生成器的结果输入给判别器，判别器最终产生我们想要的结果。生成器loss对那些被判别判断为假的数据进行惩罚。</p>
<p>这个额外的网络必须包含在反向传播中。反向传播过程中通过计算权重对输出的影响来调整权重往正确的方向更新 - 你改变权重，输出会发生怎样的变化。但是一个生成器权重的影响取决于它所送入的判别器权重的影响。所以，反向传播从输出开始，通过判别器回流到生成器。</p>
<p>与此同时，在训练生成器的时候我们不希望改变判别器。对于本来就比较难训练的生成器，再加一个移动的目标，无疑让问题更加的困难。<br>总结下来我们按照以下步骤训练生成器：</p>
<ol>
<li>采样随机噪声</li>
<li>生成器根据随机噪声生成数据</li>
<li>生成数据给判别器，判别器对数据进行分类</li>
<li>计算判别器分类loss</li>
<li>通过判别器，和生成器进行反推，得到梯度。</li>
<li>使用梯度来改变生成器的weights<br>这里描述是一次典型的生成器迭代，在下一节中，我们将看到如何平衡生成器和判别器的训练。</li>
</ol>
<h3 id="GAN-Training"><a href="#GAN-Training" class="headerlink" title="GAN Training"></a>GAN Training</h3><p>因为GAN包括了两个独立分开的网络，他训练算法需要解决两个复杂的问题：</p>
<ul>
<li>GAN 需要同时平衡生成器和判别器的训练</li>
<li>GAN是否收敛不好定义</li>
</ul>
<p>GAN的训练是交替进行的：</p>
<ol>
<li>判别器训练1或多个epochs</li>
<li>生成器训练1或多个epochs</li>
<li>重复步骤1和2，交替训练生成器和判别器</li>
</ol>
<p>在训练判别器的时候，我们保持生成器固定。此时，判别器训练过程中试图去分辨出数据的真假，他需要知道如何识别出生成器的缺点。对于判别器来说，识别出一个经过彻底训练的生成器的缺点，和识别出一个未经训练的，输出是随机产生的生成器缺点，两者不是同一个问题。</p>
<p>同样的，我们在训练生成器的时候保持判别器固定。否则，生成器将试图优化一个移动的目标，这有可能导致问题永远不会收敛。</p>
<p>正是这种来来回回，使得GAN能够解决原本难以解决的生成问题。我们解决一个简单的分类问题之后，然后去解决更加困难的生成问题。相反，如果你不能训练一个分类器来分辨真实数据和一个初始生成器随机生成数据之间的真假，那么你是没有办法开始训练GAN网络的。</p>
<h3 id="Convergence"><a href="#Convergence" class="headerlink" title="Convergence"></a>Convergence</h3><p>随着生成器能力的不断提高，判别器的能力会越来越差，因为判别器不再能分辨出真假。如果生成器完全收敛，那么判别器最终的准确率应该为50%，这个时候，判别器就像是扔一枚硬币来做真假预测。</p>
<p>这种进展给整个GAN的收敛带来了一个问题：随着时间的推移，判别器反馈的意义越来越小。如果GAN继续训练，过了判别器给出完全随机反馈的时间点，那么生成器就会开始在垃圾反馈上进行训练，其自身质量可能会崩溃。</p>
<p>对于一个GAN来说，收敛往往是一种短暂的状态，而不是稳定的状态。</p>
<h3 id="Loss-Functions"><a href="#Loss-Functions" class="headerlink" title="Loss Functions"></a>Loss Functions</h3><p>GAN试图重现一个概率分布。他需要使用损失函数来减小GAN生成的数据分布和真实数据分布之间的距离。<br>那如何通过损失函数来获得真实分布和GAN生成数据分部之间的差别呢？很多人在研究这个领域，并提出了很多方法。我们这里要讲两个常见的GAN损失函数，这两个损失函数都是在TF-GAN里面实现的。</p>
<ul>
<li>minimax loss: 这个损失函数在解释GAN的paper中被使用</li>
<li>Wasserstein loss: TF-GAN Estimators的默认损失函数。在论文<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1701.07875">Wasserstein GAN</a>中首次被提出来。</li>
</ul>
<p>TF-GAN 还实现了很多其他的损失函数。</p>
<h4 id="One-Loss-Function-or-Two"><a href="#One-Loss-Function-or-Two" class="headerlink" title="One Loss Function or Two?"></a>One Loss Function or Two?</h4><p>一个GAN有两个损失函数：一个是为了训练生成器，一个是为了训练判别器。那两个损失函数是如何在一起工作，进而最终去影响两个概率分布之间的距离的呢？</p>
<p>我们这里看下损失函数的方案，生成器和判别器的损失来自于测量出两个概率分布之间距离。在这个结构中，生成器只能影响测量距离中的一项内容：反映假数据的分布情况。所在生成器训练的过程中，我们放弃了另外一项:真实数据分布。<br>生成器和判别器的损失最终看起来是不同的，尽管他们是由同一个单一的公式得出的。</p>
<h4 id="Minimax-Loss"><a href="#Minimax-Loss" class="headerlink" title="Minimax Loss"></a>Minimax Loss</h4><p>在介绍GAN的论文，生成器试图最小化下面的函数，而判别器试图最大化它。</p>
<blockquote>
<p>Ex[log(D(x))] + Ez[log(1 - D(G(z)))]</p>
</blockquote>
<p>在这个公式中：</p>
<ul>
<li>D(x): 判别器对真实数据样本x的概率估计</li>
<li>Ex: 所有真实数据的期望值</li>
<li>G(z) 生成器生成的数据</li>
<li>D(G(z)): 判别器对生成数据的的概率估计</li>
<li>Ez: 生成器所有随机输入的期望值（实际上，是对所有生成的假数据G(z)的期望值）</li>
<li>这个公式是真实数据分布和生成数据分布的交叉熵损失</li>
</ul>
<p>生成器不能直接影像函数中的 log(D(x)) 项，所以，对生成器来说，最小化上述损失函数相当于最小化 log(1 - D(G(z)))。</p>
<p>在TF-GAN中，请参加 minimax_discriminator_loss 和 minimax_generator_loos 来了解这个损失函数的实现。</p>
<h4 id="Modified-Minimax-Loss"><a href="#Modified-Minimax-Loss" class="headerlink" title="Modified Minimax Loss"></a>Modified Minimax Loss</h4><p>最初的GAN论文中指出，在GAN训练的早期阶段，当判别器的工作很容易的时候，上述的最小最大化损失函数会导致GAN卡住。因此，该论文建议修改生成器的损失，是生成器尝试最大化 logD(G(z))。</p>
<h4 id="Wasserstein-Loss"><a href="#Wasserstein-Loss" class="headerlink" title="Wasserstein Loss"></a>Wasserstein Loss</h4><p>TF-GAN 默认使用 wasserstein loss</p>
<p>该损失函数是基于GAN（称为”Wasserstein GAN”或“WGAN”）的一个修改，在这个方案中，判别器实际上并不对数据实例进行分类。判别器对每一个数据实例输出一个数字。这个数字不必小于1，也不必大于0，所以我们不能用0.5作为门槛来决定一个实例的真假。判别器训练过程中试图让真实数据的输出比假数据的输出值更大。</p>
<p>因为他不能真正判别出真假，WGAN的判别器应该被称为“评论者”，而不是“判别者”。这种区别在理论上具有很重要的意义，实际上，我们可以将其视为承认损失函数的输入不一定得是概率。</p>
<p>损失函数本身是很简单的：</p>
<p><strong>Critic Loss:</strong> <code>D(x) - D(G(z))</code></p>
<p>判别器试图最大化这个函数。也就是说，他试图最大化判别器对生成器生成数据的输出和判别器对真实数据的输出之间的差别。</p>
<p><strong>Generator Loss:</strong>  <code>D(G(z))</code></p>
<p>生成器试图最大化这个函数。也就说，他试图最大化判别器对假数据的输出</p>
<p>在上述函数中：</p>
<ul>
<li>D(x) 对真实数据的评价</li>
<li>G(z) 生成器生成数据</li>
<li>D(G(z)) 对生成数据的评价</li>
<li>D输出不需要在0到1之间</li>
<li>公式来源于真实分布和生成分布之间的<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Earth_mover's_distance">地动距离</a>.</li>
</ul>
<h4 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h4><p>Wasserstein GAN（或WGAN）的理论依据要求对整个GAN的权重进行剪裁，使其保持在一个约束的范围内。</p>
<h4 id="Benefits"><a href="#Benefits" class="headerlink" title="Benefits"></a>Benefits</h4><p>Wasserstein GANs比基于minimax的GANs更不容易被卡住，并且避免了消失梯度的问题。地动仪距离还有一个优点，那就是它是一个真正的度量：在概率分布空间中对距离的度量。交叉熵不是这个意义上的度量。</p>
<h3 id="Real-World-GANs"><a href="#Real-World-GANs" class="headerlink" title="Real World GANs"></a>Real World GANs</h3><h4 id="Common-Problems"><a href="#Common-Problems" class="headerlink" title="Common Problems"></a>Common Problems</h4><p>GAN 有一些常见的问题，目前这些常见的问题都在被不同的研究者在积极的研究中。虽然这些问题都没有得到彻底解决，我们提到一些人们已经尝试过的事情。</p>
<h5 id="Vanishing-Gradients"><a href="#Vanishing-Gradients" class="headerlink" title="Vanishing Gradients"></a>Vanishing Gradients</h5><p>研究表明，如果你的判别器太好，那么生成器训练就会因为梯度消失而失败。实际上，一个最佳的判别器并不能为生成器提供足够的信息来取得进步。</p>
<h5 id="Attempts-to-Remedy"><a href="#Attempts-to-Remedy" class="headerlink" title="Attempts to Remedy"></a>Attempts to Remedy</h5><ul>
<li><strong>Wasserstein loss:</strong> 设计 Wasserstein loss 的目的是为了在你把判别器训练最佳状态的情况下，防止梯度消失。</li>
<li><strong>Modified minimax loss:</strong> 原GAN论文中提出了对最小损失的修改，以处理梯度消失的问题。</li>
</ul>
<h5 id="Mode-Collapse"><a href="#Mode-Collapse" class="headerlink" title="Mode Collapse"></a>Mode Collapse</h5><p>通常情况下，我们希望GAN网络产生各种各样的输出。例如，当每次给不同的随机输入给人脸生成器，生成器可以生成不同的人脸。</p>
<p>然而，如果一个生成器产生了一个特别可信的输出，生成器可能会学习只产生这种输出。事实上，生成器总是试图找到一个在判别器看来最可信的输出。</p>
<p>如果生成器开始一次又一次的产生相同的额输出（或一小组输出），那么判别器的最佳策略就是学会始终拒绝该输出。但如果下一代判别器卡在局部最小值，没有找到最佳策略，那么下一代生成器在迭代过程中会很容易生成输出让当前判别器判别出看似合理的结果。</p>
<p>生成器的每一次迭代都会对特定的判别器进行过度优化，而判别器永远无法学会如何摆脱陷阱。结果就是生成器轮流输出一组小的输出类型。这种形式的GAN失败称为模式崩溃。</p>
<h5 id="Attempts-to-Remedy-1"><a href="#Attempts-to-Remedy-1" class="headerlink" title="Attempts to Remedy"></a>Attempts to Remedy</h5><p>以下方法试图迫使生成器扩大其范围，防止其针对单一固定的判别器进行优化。</p>
<ul>
<li><p><strong>Wasserstein loss:</strong> Wasserstein loss 可以缓解模式崩溃的问题，让你把判别器训练到最佳状态而不用担心梯度消失。如果判别器没有卡在局部最小值，它就会学会拒绝生成器稳定的输出。所以生成器必须尝试新的东西。</p>
</li>
<li><p><strong>Unrolled GANs:</strong> Unrolled GAN 使用的生成器损失函数不仅包含了当前判别器的分类，还包含了未来判别器的输出。因此，生成器不能对单个判别器进行过度优化。</p>
</li>
</ul>
<h4 id="Failure-to-Converge"><a href="#Failure-to-Converge" class="headerlink" title="Failure to Converge"></a>Failure to Converge</h4><p>如前面GAN训练章节中中所述。GAN经常无法收敛。</p>
<h5 id="Attempts-to-Remedy-2"><a href="#Attempts-to-Remedy-2" class="headerlink" title="Attempts to Remedy"></a>Attempts to Remedy</h5><p>研究者试图使用各种形式的正则化来提高GAN收敛性，包括：</p>
<ul>
<li><strong>Adding noise to discriminator inputs:</strong> 如 <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1701.04862.pdf"> Toward Principled Methods for Training Generative Adversarial Networks.</a></li>
<li><strong>Penalizing discriminator weights</strong> 如 <a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1705.09367.pdf">https://arxiv.org/pdf/1705.09367.pdf</a></li>
</ul>
<h3 id="GAN-Variations"><a href="#GAN-Variations" class="headerlink" title="GAN Variations"></a>GAN Variations</h3><p>研究人员不断改进GAN技术以及GAN的用途。以下是GAN的一些变体，让你了解GAN的各种可能性。</p>
<h4 id="Progressive-GANs"><a href="#Progressive-GANs" class="headerlink" title="Progressive GANs"></a>Progressive GANs</h4><p>在渐进式GAN中，生成器的第一层产生分辨率很低的图像，随后各层增加细节。这种技术使GAN的训练速度比类似的非渐进式GAN更快，并产生更高分辨率的图像。</p>
<h4 id="Conditional-GANs"><a href="#Conditional-GANs" class="headerlink" title="Conditional GANs"></a>Conditional GANs</h4><p>条件 GAN 在有标签的数据集上进行训练，需要为每个生成的实例指定标签。例如，一个无条件的MNIST GAN将产生随机的数字，而一个有条件的MNIST GAN可以指定GAN应该产生哪个数字。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2020/07/19/confushion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2020/07/19/confushion/" class="post-title-link" itemprop="url">生活中的困惑</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-07-19 19:48:58 / Modified: 20:56:33" itemprop="dateCreated datePublished" datetime="2020-07-19T19:48:58+08:00">2020-07-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>现在是2020年7月19日，一个月前我搬到现在住的地方，搬完家之后，上海这一个月一直在下雨，出行不便的同时，数日不见太阳自然让人心情也不太舒畅。</p>
<p>这个周末我相对比较放松，因为手里的两个项目基本上都上线了，个人也比较满意两个项目的结果，所以能感受到自己脑袋里那根紧绷的弦稍稍松了一些。</p>
<p>最近烟抽的比较多,主要还是工作生活各方面事情比较烦杂，让人很困恼。但烟本身并不会让你的困恼减少半分，反倒会带给你生理上新的难受，如烟进入肺部之后，脑袋的晕眩，喉咙里的恶心。也许吸烟的唯一用处是转移你旧的痛苦到吸烟本身以及吸烟之后的感受上。</p>
<p>今年又过去了大半，闷热的周末，脑袋和身体从忙碌中脱身，然后立刻陷入了存在主义的困惑中。周遭发生的事情，让我更加坚信成年人是不存在自由意志的，成年人无非是个社会机器，机械的完成自己既定的KPI，好让这个社会正常的运转下去。该做什么，该说什么，纵使不公平，不甘心，但还是要审时度势，作出对自己利益最为无害的选择。</p>
<p>所以成年人的大脑和卷积神经网络是一样的无疑，大家的大脑就是一个不断加入新数据优化的卷积神经网络，不断迭代更新的同时，就是大家只要‘显卡’‘参数’配置差不多，最后模型的能力也差不多，模型的预测也是大同小异，方差极小。这就是所谓的同质化。</p>
<p>我们经常自怨自艾，中国男性如何不容易，要承受巨额的房价，要处理由于独身女子一代带来的养老压力。别人问你的爱好，你说30岁之后，我只剩下挣钱这一个爱好。我们感慨除了挣钱，干什么都无精打采，更不要提什么理想，抑或是活着是为了什么？因为我们没有时间精力去想这些事情。但我们是真的没时间吗？还是我们本身就没有什么想法，混吃等死是90%的人一种状态，我们思维上懒惰，不想去想这么痛苦的费脑子的话题，我们只想看着球赛，吃着棒冰，吹吹牛逼。</p>
<p>有那么一些瞬间，我一时不知道自己做的这些东西的意义，自己为之奋斗的东西的意义。那种感觉非常像王者荣耀这游戏一般，你赢了一把获得十秒钟的快乐，然后又神经紧张的投入下一把，然后你输了，你很失落，反复几个小时之后，你身心疲惫的关掉游戏。但你知道你明天会如此重复。</p>
<p>这就是我的困惑，如果我对工作的热情如对电子游戏这般，那很有可能是我只想要赢，我并不在乎我做的是什么，我只在乎我能不能赢这个游戏。我很怀疑多数时候多数人说自己爱自己的工作，其实就是类似这种对电子游戏的爱一样。本质上你是被社会安排了一个角色，你把自己投入到安排的游戏里面，说服自己是热爱的，这个游戏会占住你的思维，消耗你的时间，你完全不用思考我是谁，我活着的短暂的几十年该做些什么等问题，只管在这个游戏里面，打怪升级，过完一生。但如此这般的人生是幸福的？还是可悲的？</p>
<p>我能知道无知者是幸福的，因为无知所以没有烦恼。古人的难得糊涂，说的就是这个理。但无知者又是无助的，每个人都是生活的智者，我相信多数人都会在某天的某个时刻问自己，我这是在干嘛？我的时间都流逝去哪了。</p>
<p>我承认我缺乏勇气去打破正常的生活和工作，但我无法不困惑于生命的归宿。不过虽然是困惑，但有时候我很庆幸我有这种困惑。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2020/05/17/ACL-surgery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2020/05/17/ACL-surgery/" class="post-title-link" itemprop="url">ACL重建手术</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-17 14:47:50" itemprop="dateCreated datePublished" datetime="2020-05-17T14:47:50+08:00">2020-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-07-19 20:54:50" itemprop="dateModified" datetime="2020-07-19T20:54:50+08:00">2020-07-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>19年12月份一个工作日的晚上，和同事们一起在公司附近的洛克公园打篮球，过程中我不慎左膝盖韧带扭伤了。当时我是听见砰的一声，隐约感觉到不妙。休息了一段时间之后，我勉强回到了自己家，因为家住6楼，且没有电梯，还记得当时爬楼梯费了半天劲。</p>
<p>当天晚上膝盖处很痛，没怎么睡好，第二天早上发现整个膝盖区域肿了起来，且不能下地行走，无奈之外，我只好去医院就医，排了半天门诊队，医生看了2分钟不到，给我开了点止疼药和膏药，让我先回去吃药+贴膏药。我很惊讶（因为我去医院的经历非常有限，这次是第一次因为自身疾病来就医），问医生是不是可以给我做个核磁共振。一番交流后医生给我开了个单子，让我去缴费处预约核磁共振的时间。</p>
<p>在约定的时间我去医院做了核磁，两天之后拿到了结果单，结果显示左膝韧带完全撕裂，半月板也有损伤。不知所措之下，我又去医院挂了号，医生检查一番之后，说你这要做手术，我当时是觉得很突然，心里想这就要做手术？但心想医生是专业的，就乖乖去这个医生推荐的主治医生那里登记排队做手术，当时时间点是19年1月份农历新年前，医生计划是年后安排手术。</p>
<p>然后就是新冠肺炎疫情的发生，我的手术也被耽搁了。再恢复相对正常的生活已经是3月份的事情了。我在微信上和医生联系之后，医院那边可以安排手术。其实此时我是有点犹豫的，一方面手术虽然是微创，但毕竟是个手术，有点担心，另外一方面手头上的工作，生活方面肯定要提前安排好。</p>
<p>经过一番思考，本着早治早好（因为左膝韧带断了，生活确实受到了一点影响，比如不能跑步，运动），和医生约定了4月尾做这个手术。最终医生帮我安排在了5.6号手术，我略做思考之后果断同意了。</p>
<p>2020.5.4 我住进了上海市第六人民医院，第一次住院，心情还是比较焦躁；第一个晚上没怎么睡着（一方面是自己比较焦躁，一方面是病房里有人打呼）。第二天一早护士跑过来抽血，接着就是做术前检查。5号得知自己被安排在6号第五个做，心情也变得有点焦虑。因为手术前一天晚上8点之后不准吃东西，10点之后就不准喝水了。</p>
<p>6号一早7:30，旁边的小哥就被推进了手术间，另外一个小哥大概在9:30被带走。12点多的时候他们分别被带回来了，此时我还在病房里面等，当时嘴巴非常渴，等的也有点心急。在15:00的时候，有人来叫我了。<br>接着我躺在推车的床上，被护工推进了手术间。一开始做腿部的麻醉，打麻醉的时候有触电的感觉。打完麻醉，我被放到一个走廊上，等了好久（因为没有表，具体多久也就不知道了，隐约听见有人说再过一个小时是5:30，所以我大概等了有1个半小时），期间我都快睡着了。然后就被推进手术间。进了手术间，被抬到手术台，然后吸了几口不明气体之后就没有意识了。</p>
<p>醒来之后我发现自己躺在一个房间立，当然手术已经做完了。整个过程我一点意识都没有，只有吸全麻气体前一口的记忆，然后就是睁眼醒了。接着被推回病房，术后头6个小时要平躺在床上，且不能喝水吃饭。我是19：15被推回病房的，头6个小时蛮难受的，因为已经24个小时没有喝水吃东西了，就觉得嘴巴和鼻子里面非常干燥。熬过了6个小时之后，我喝了点水，吃了点东西，此时已经凌晨1点了，接下来应该是术后最难受的一段时间，膝盖处非常的酸胀难受，加上已经是下半夜，人很困，但没办法睡。好在医院大家都起得早，6点就已经有人开始叮哐起床，帮助我分散一点注意力。</p>
<p>术后第一天，大多数时间是躺在床上，做一做术后的恢复动作。术后除了第一个晚上很难受，其他时间到没啥疼痛感，只有在直立的时候，髌骨比较疼。</p>
<p>写这篇文章的是5.17，距离我手术已经12天了，目前恢复良好。ACL重建术后的康复非常重要，希望自己能够早日康复，重新运动起来。</p>
<p>关于这次ACL手术，还有一些小tips。</p>
<ul>
<li>一个感悟是现代医学很伟大。（1）整个手术基本上是无痛的。（2）我看过ACL重建的3D视频，手术需要很精细，而且这一套重建韧带能work，想法也是很有突破性。感谢现代医学。</li>
<li>医院里面的作息非常规律，22:00就有人睡觉，早上6:30就开始起床。经过一番训练，我现在晚上12点就困了，早上也是醒的很早</li>
<li>误打误撞去了6院，住院之后才得知，6院在韧带重建这一块是国内最好的，几个同房病友都是冲着6院的赵金忠主任来的（赵主任在运动医学这块貌似亚洲的扛把子），且他们都是赵主任主刀。我事先没做啥研究，主刀医生是年轻的赵松医生（因为同病房的人都觉得赵金钟主任厉害，我为此手术前还担忧了一下）。不过查了下我的主刀医生，人家也是博士后，且在NBA凯尔特人队从事过医疗工作，且自我觉得ACL这个手术应该不是那么的难，加上名师出高徒，安慰了自己一番之后，也就没想那么多了。现在术后我自我感觉也挺好。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2020/03/09/papers-reading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2020/03/09/papers-reading/" class="post-title-link" itemprop="url">Papers reading</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-09 00:09:47 / Modified: 00:14:59" itemprop="dateCreated datePublished" datetime="2020-03-09T00:09:47+08:00">2020-03-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Papers-reading"><a href="#Papers-reading" class="headerlink" title="Papers reading"></a>Papers reading</h1><h2 id="Human-body-amp-face-3d-reconstrcution"><a href="#Human-body-amp-face-3d-reconstrcution" class="headerlink" title="Human body &amp; face 3d reconstrcution"></a>Human body &amp; face 3d reconstrcution</h2><p><a target="_blank" rel="noopener" href="https://docs.qq.com/doc/DY2dPZ3FRdGxoQUhT">Neural Body Fitting: Unifying Deep Learning and Model-Based Human Pose and Shape Estimation</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.qq.com/doc/DY1VQUU5HYVRSbVZs">Learning to Reconstruct People in Clothing from a Single RGB Camera</a></p>
<h2 id="GAN"><a href="#GAN" class="headerlink" title="GAN"></a>GAN</h2><p><a target="_blank" rel="noopener" href="https://docs.qq.com/doc/DY3dRa3FRdVdLVnJN">FaceShifter: Towards High Fidelity And Occlusion Aware Face Swapping</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2020/03/08/for-kobe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2020/03/08/for-kobe/" class="post-title-link" itemprop="url">Forever Legend, Forever Mamba</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-08 22:13:39 / Modified: 23:16:33" itemprop="dateCreated datePublished" datetime="2020-03-08T22:13:39+08:00">2020-03-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我是从上高中才开始看NBA的，之前在农村，没有有线电视，高中在城里，可以看CCTV-5直播NBA比赛。那时候大家都爱看火箭队比赛，因为火箭队有姚明。每天中午大家站在食堂的电视机前，看NBA比赛变成了一种习惯。我还记得那是2005年，那一年总决赛是马刺打活塞，总决赛的第5场，霍里的关键发挥至今让人难以忘却。那几年湖人成绩都不太好，科比还惹上了官司，印象中我读高二那年季后赛湖人打太阳，科比个人发挥的很好，但球队的确实力不及太阳，被太阳淘汰出局。</p>
<p>那三年我疯狂的追NBA的一切，那是个麦迪各种突破跳投，卡特还能飞，奥尼尔还能扣的年代，那些年我最喜欢的球星是艾弗森。那时候，我给家里写字台的墙上贴了一张科比穿8号球衣的海报。</p>
<p>随着凯尔特人组建三巨头，我也上了大学，大学期间我看比赛看的很少，几乎连总决赛都没怎么看。只知道科比拿了2个总冠军，然后我就毕业了，进入社会了，NBA后面变成热火，马刺的对决，以及勇士时代。</p>
<p>比赛看的很少了，但因为科比身上那股劲，渐渐的科比变成了我心中篮球的icon。科比退役的那场球我是在公司看的，人生的最后一场NBA比赛科比打成那样，无需多言，因为大家知道，那就是科比。</p>
<p>当春节初二的早上我在睡梦中刚醒，弟弟敲我房门，说：科比死了。我整个人都蒙了。我相信每个热爱篮球，热爱体育的人都被深深的震惊住。</p>
<p>科比的意外，是这个多事的年份让我深深被触动的一件事。我们都道世事无常，但这也太过分无常了。这种无常让我对生命产生了一种虚无感，反复一切都变得没有所谓。我们都太微不足道了。</p>
<p>但科比的生前的足够绽放，也足够的尽兴。他也会像乔布斯，迈克尔杰克逊，弗雷迪，黄家驹一样，一直活在我们的记忆中。</p>
<p>Forever Legend, Forever Mamba。<br>Goodbye,Kobe.</p>
<p><img src="http://cp0000.github.io/assets/kobe/kobe.jpg" alt="kobe"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2020/01/20/my-2019/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2020/01/20/my-2019/" class="post-title-link" itemprop="url">my_2019</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-20 15:33:43" itemprop="dateCreated datePublished" datetime="2020-01-20T15:33:43+08:00">2020-01-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2020/01/04/2019-movies-list/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2020/01/04/2019-movies-list/" class="post-title-link" itemprop="url">2019年观影记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-04 20:38:42 / Modified: 21:21:54" itemprop="dateCreated datePublished" datetime="2020-01-04T20:38:42+08:00">2020-01-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/5300054/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2549558913.webp">波西米亚狂想曲 (2018)</a></p>
<p>Queen的音乐真的极具感染力，相比电影最后高度还原Freddie在”live aid”上的场景，个人还是更喜欢那个真实的live concert。评分9.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/27087724/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2551119672.webp">好莱坞往事 (2019)</a></p>
<p>昆汀的电影自有他的风格，电影前半部分的确会让没有耐心的人会放弃观看。好在最后半小时足够精彩，皮特投手对付嬉皮客有杀死比尔的影子。在观看了电影的真实背景事件之后，小李子对 Sharon说的那一句“Are you ok？”真的是让人非常非常感动。昆汀真是一个外表粗糙，内心细腻温柔的人，或许这句“Are you ok？“是昆汀相对在天堂的Sharon说的。评分9.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/1950330/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2555541430.webp">罗马 (2018)</a></p>
<p>属于新浪潮电影吧，电影展开就像白开水一样，平平淡淡，但却暗涌着人生百味，是一部关于生活的电影。评分9.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/30327842/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2578045524.webp"> 82年生的金智英 (2019)</a></p>
<p>韩国女权主义电影，讲述了现代女性在面对传统男权社会个人发展和家庭之间的冲突。电影以happy ending结尾，但现实社会冲突依然存在。评分8.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/27010768/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2561439800.webp">寄生虫 (2019)</a></p>
<p>一部有点深刻，有点悲观的电影。评分8.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/6981153/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2568902055.webp">爱尔兰人 (2019)</a></p>
<p>2019年的一部“老电影”，电影节奏舒缓，老式的黑帮片。观影后不得不感叹纵使CG技术再牛逼，德尼罗和帕西诺肢体语言的衰老感缺无法掩饰。评分8.5。</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/1293172/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p452089833.webp">末代皇帝 (1987)</a></p>
<p>讲述末代皇帝溥仪的一生的故事，全片英文配音，镜头内容非常中国。开头慈禧去世和小皇帝登记两个场景，拍的非常东方，非常皇权，很有意思。评分9.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/1293323/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1254404823.webp">大红灯笼高高挂 (1991)</a></p>
<p>一部讲述中国封建社会女性饱受束缚的故事。其中敲脚这个桥段让人映像深刻，性暗示十足，甚至我觉得导演是把这个敲脚作为一种性前戏来处理。张导演以前的电影还是很值得看的。评分8.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/27060077/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2549177902.webp">绿皮书 (2018)</a></p>
<p>讲述美国种族歧视的故事，片中为观众展示美国南方各种各样让人不可思议的针对黑人的歧视法律。再一次说明星条国不是象牙塔，大家不过都是屁股决定脑袋的生物罢了。评分8.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26952704/"><img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2539127687.webp">巴斯特·斯克鲁格斯的歌谣 (2018)</a></p>
<p>西部片，来自科恩兄弟。讲述了几个离奇的西部故事。个人比较喜欢西部片，也比较喜欢科恩兄弟作品。评分8.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26701196/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2529384763.webp">无主之作 (2018)</a></p>
<p>讲述当代艺术家Barnert如何一步一步找寻自我的故事。影片中有对当代艺术的戏谑。挺好看的故事，评分8.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26389601/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2463178431.webp">猎凶风河谷 (2017)</a></p>
<p>西部片风格，故事发生地点在美国中西部印第安保留地，情节相对简单，氛围渲染很棒，冷且压抑。评分8.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/25881247/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2263976596.webp">边境杀手 (2015)</a></p>
<p>西部片风格，故事发生在美墨边境，情节相对简单，整体一般。评分7.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/30135113/"><img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2563626309.webp">骡子 (2018)</a></p>
<p>90岁的伊斯特伍德自导自演的一部老年毒贩片，电影情节很稳重的推进，观影体验良好。评分 8.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/3026559/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2532776305.webp">登月第一人 (2018)</a></p>
<p>影片让我们有机会了解阿姆斯特朗的人物性格，和他身上的故事。让我惊讶的是登月计划过程中发生了那么多意外，牺牲了那么多的宇航员。当阿姆斯特朗乘坐的火箭升空时，个人还是会被这种宏大的事件感动。评分8.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26369884/"><img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2543305779.webp">此房是我造 (2018)</a></p>
<p>疯狂的杀人狂，疯狂的强迫症。影片比较压抑，评分7.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/27119724/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2567198874.webp">小丑 (2019)</a></p>
<p>大家都会谈的电影，影片中主角的笑声让我产生生理上的不适（这种不适和装修时电钻声差不多），整体个人觉得一般，评分7.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26920842/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2535858294.webp">副总统 (2018)</a></p>
<p>一部关于美国历史上最有权势的副总统迪克·切尼，只能说星条国也不是象牙塔，坏人哪儿都有。贝尔演技好评，评分7.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/27622447/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2530599636.webp">小偷家族 (2018)</a></p>
<p>不是我最喜欢的是枝裕和的电影，但也还不错吧。也许是因为我是抱着被治愈的目的去看是枝裕和电影。评分8.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/1937998/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2393018482.webp">阿弥陀堂讯息 (2002)</a></p>
<p>很治愈的一部日本电影，电影里的恬静小镇是个让忙碌的都市人向往的世外桃源。电影女主角医生在都市生活落下的焦虑症也许是每个你我这样的上班族或多或少都体验过的吧。</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/30334073/"><img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2551995207.webp">调音师 (2018)</a></p>
<p>印度悬疑片，非常优秀的爆米花电影。评分8.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26911450/"><img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2448817847.webp">山2 (2016)</a></p>
<p>土耳其战争电影，拍的却很美式。可以作为了解非英语系电影的素材看看，评分7.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26952153/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2516825103.webp">第三度嫌疑人 (2017)</a></p>
<p>整体一般，结尾有点勉强，是枝裕和电影里面我不太喜欢的一部电影。评分6.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26786642/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2540295055.webp">摘金奇缘 (2018)</a></p>
<p>值得无聊的时候看一看的爱情爆米花电影，评分7.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26787574/"><img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2507709428.webp">奇迹男孩 (2017)</a></p>
<p>一个温暖励志的故事，适合沮丧的时候看。评分7.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26586432/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2369390663.webp">契克 (2016)</a></p>
<p>德国电影，讲述两个小男孩一次公路旅行之中发生的故事。不错的电影，也是个了解非英语系电影的好素材。评分7.9</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26847068/"><img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2528816969.webp">狂野生活 (2018)</a></p>
<p>冲着男女主角的颜值去的，故事性一般。可看可不看，评分6.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/30167509/"><img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2566598269.webp">徒手攀岩 (2018)</a></p>
<p>一部纪录片，观看的过程中要提醒自己这都是真的，不是特技，你就会隔着屏幕都得屏住呼吸。评分 8.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/1292062/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p1309847196.webp">美国丽人 (1999)</a></p>
<p>美国中产阶级的中年危机。可能是文化原因，个人觉得电影里面描述的东西不深，整体一般。评分6.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/1890784/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p1181944920.webp">门徒 (2007)</a></p>
<p>挺好看，可能是预算有限，刘德华饰演的大毒枭总感觉出场场面不够大。评分7.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/24716039/"><img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2576088318.webp">星际探索 (2019)</a></p>
<p>有一部太空片，19年貌似太空片挺多的。整体一般吧，故事不太好。评分7.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/3097572/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2570906505.webp">双子杀手 (2019)</a></p>
<p>李安导演的爆米花电影，故事比较简单，年轻的威尔史密斯也挺帅的。评分7.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/1652592/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2544987866.webp">阿丽塔：战斗天使 (2019)</a></p>
<p>爆米花电影，可看，评分7.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26100958/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2552058346.webp">复仇者联盟4：终局之战 (2019)</a></p>
<p>爆米花电影，可看，评分7.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26213252/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2546360443.webp">惊奇队长 (2019)</a></p>
<p>爆米花电影，可看可不看，评分6.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/3168101/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2537158013.webp">毒液：致命守护者 (2018)</a></p>
<p>爆米花电影，可看可不看，评分6.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26794435/"><img src="https://img9.doubanio.com/view/photo/s_ratio_poster/public/p2563780504.webp">哪吒之魔童降世 (2019)</a></p>
<p>爆米花电影，可看可不看，评分6.5</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/1305487/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p453924541.webp">猫鼠游戏 (2002)</a></p>
<p>爆米花电影，评分7.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26266893/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2545472803.webp">流浪地球 (2019)</a></p>
<p>爆米花电影，情节过于单薄，部分场景过于尬，评分5</p>
<p>[<img src="https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2538826177.webp"></p>
<p>神奇动物：格林德沃之罪 (2018)](<a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26147417/">https://movie.douban.com/subject/26147417/</a>)</p>
<p>爆米花电影，可看可不看，评分6.0</p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/26972258/"><img src="https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2533283770.webp">江湖儿女 (2018)</a></p>
<p>一般吧，地方黑老大和自己情人的半身缘，故事套路容易被猜到。贾樟柯的电影风格明显，问题也在于他的每部电影之间相似性略高，我有时候分不清哪部是哪部，可看可不看，评分7.0。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2019/11/20/31/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2019/11/20/31/" class="post-title-link" itemprop="url">活到31</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-20 00:05:53" itemprop="dateCreated datePublished" datetime="2019-11-20T00:05:53+08:00">2019-11-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-04 20:28:08" itemprop="dateModified" datetime="2020-01-04T20:28:08+08:00">2020-01-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>你所想要的那样东西，你的欲望对象本身他在结构上必然将使你更痛苦。你对他的追求不会滋养你的生命，反而会阻碍你的生命。 - Lauren Berlan</p>
</blockquote>
<p>也许是自己没有以前那么sensitive了，也许是因为工作过于忙碌。从计划写这篇文章到现在为止，已经过去了一个半月了，每每打开文档编辑器，脑子里面一片空白，发现自己没有什么值得写的。</p>
<p>11年大学毕业前后，我分别看了Steve Jobs在斯坦福关于<code>follow your heart</code>主题的演讲，和另外一片讲年轻人该如何去寻找自己目标的文章。现如今8年过去了，文中方法我尝试过，也试图得出了一些关于自己目标的关键词。但现在看来，那些词都太抽象，不具体，以至于在写下那些关键字的第二天就忘记自己写过啥了，但这8年中，自己是一直在努力尝试着去找出自己最想做的事情，最想成为的人。只是能想清楚这件事并不容易，我至今还没想清楚。</p>
<p>而乔布斯演讲中那一句“your time is limited”却始终在我脑子里打转。时间，是每个人的原始财富。工人拿时间换工钱，学生拿时间换知识，父母拿时间养育下一代，换取基因的繁殖。我们每个人拥有着时间这一原始财富，然后在社会影响和自我意识决定下拿时间去换取自己想要的东西。</p>
<p>而现如今，我们很容易被生活带入一个循环，然后就此习惯了这种循环。每天上班，下班，打卡，开会，看电影，吃火锅，跑步，打游戏，今天重复昨天，这周重复着上周；我甚至说不出来17年，18年，19年，三年有何不同。现代社会让工作，生活，消遣占住我们所有的精力，让我们的眼睛从早上起床睁开到晚上睡觉闭上，一刻都不得闲，各式各样的垃圾信息刺激着你的脑神经。</p>
<p>工作生活在不停的重复着重复，个人的时间年轮也越滚越粗。随之而来有体力的下降，创造力的下降，还有对生活的敏感度的下降。你不在是一个敏感的人，不会为了一点小事而伤感，也不会因为一点压力而睡不着觉。你变得tough，甚至麻木，就像一台工作机器，接受一个又一个任务，然后机械的去完成它。但 your time is limited, 时间是有限的，每件事情都有他的窗口期，感情是这样，工作中的某个机会是这样，理想也是这样。20岁年薪百万和30岁年薪百万，感受肯定差异很大，不同的年纪相同的事物体验差别很大，我们能做的就是在尽可能年轻的时候去体验尽可能多的事情。</p>
<p>人到31，还在谈理想是有点尴尬，况且有时候会觉得日子不是只给自己过了。父母年纪大了，自己也该成家立业了，而工作更是不敢怠慢。</p>
<p>西方人思考人生角度是更多的考虑自己，而我们不行，即使我受了很多西方文化影响，纵然我个人很多时候是思考「我」该怎么做，但我们父辈不是，身边的人不是，我们生活的这个社会在道德要求你需要去从家庭，从父母的角度思考问题，你有你的历史任务。而作为一个年到31，还没成家的，在上海工作的一线程序员，如何在感情，事业，生活三者中得到平衡，从中获得幸福感，看起来是接下来数年我要寻找的答案。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2019/03/31/logistic-regression/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2019/03/31/logistic-regression/" class="post-title-link" itemprop="url">逻辑回归</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-03-31 14:41:59" itemprop="dateCreated datePublished" datetime="2019-03-31T14:41:59+08:00">2019-03-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-04-09 22:54:39" itemprop="dateModified" datetime="2019-04-09T22:54:39+08:00">2019-04-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>逻辑回归是二分类任务中最常用的机器学习算法之一。它的设计思路简单，易于实现，可以用作性能基准，且在很多任务中都表现良好。</p>
</blockquote>
<p>本文从以下几个方面讲述逻辑回归：</p>
<ul>
<li>什么是逻辑回归？</li>
<li>它是如何工作的。</li>
<li>逻辑回归 vs 线性回归</li>
<li>优缺点</li>
<li>何时适用</li>
<li>多分类任务（OvA, OvO）</li>
<li>其他分类算法</li>
<li>总结</li>
</ul>
<h2 id="什么是逻辑回归"><a href="#什么是逻辑回归" class="headerlink" title="什么是逻辑回归"></a>什么是逻辑回归</h2><p>和很多其他机器学习算法一样，逻辑回归也是从统计学中借鉴过来的，尽管名字里有回归两个字，但它不是一个需要预测连续结果的回归算法。与之相反，逻辑回归是二分类任务的首选方法。它输出一个0到1之间的离散尔值结果。简单来讲，它的结果不是0就是。 </p>
<p>癌症检测算法可看做是逻辑回归问题的一个简单例子，这种算法输入病理图片并且应该辨别患者患有癌症（1）或没有癌症（0）。</p>
<h2 id="它是如何工作的？"><a href="#它是如何工作的？" class="headerlink" title="它是如何工作的？"></a>它是如何工作的？</h2><p>逻辑回归通过使用其固有的逻辑函数估计概率，来衡量因变量（目标预测标签）与一个或者多个自变量（特征）之间的关系。<br>然后这些概率必须二值化才能真的进行预测。这就是逻辑函数的任务，也称为sigmoid函数。sigmoid函数是一个S形曲线，它可以将任意实数值映射到介于0和1之间的值，但不能取0或1.然后使用阈值分类器将0和1之间的值转换为0或1.<br>下图说明了逻辑回归得出预测所需的所有步骤。<br><img src="http://cp0000.github.io/assets/logistic_regression/01.jpg" alt="logistic_regreesion"></p>
<h3 id="假设函数-（Hypothesis-function）"><a href="#假设函数-（Hypothesis-function）" class="headerlink" title="假设函数 （Hypothesis function）"></a>假设函数 （Hypothesis function）</h3><p>逻辑回归的假设函数形式如下：<br><img src="http://cp0000.github.io/assets/logistic_regression/20160409203810378.jpg"></p>
<p>这个函数称为sigmoid函数，也称为逻辑函数，其函数曲线如下：<br><img src="http://cp0000.github.io/assets/logistic_regression/20160409203837285.jpg"></p>
<p>从上图可以看到sigmoid函数是一个s形的曲线，它的取值在[0,1]之间，在远离0的地方函数的值会很快接近0/1.这个性质使我们能够以概率的方式来解释。<br>一个机器学习的模型，实际上就是把决策函数限定在某一组条件下，这组限定条件就决定了模型的假设空间。当然，我们还希望这组限定条件简单而合理。而逻辑回归模型所做的假设是：<br><img src="http://cp0000.github.io/assets/logistic_regression/20160409203927593"><br>这里的g(h)是上面提到的sigmoid函数，相应的决策函数是：<br><img src="http://cp0000.github.io/assets/logistic_regression/20160409204029426"><br>选择0.5作为阈值是一个一般的做法，实际应用时特定情况可以选择不同阈值。</p>
<h3 id="决策边界（Decision-Boundary）"><a href="#决策边界（Decision-Boundary）" class="headerlink" title="决策边界（Decision Boundary）"></a>决策边界（Decision Boundary）</h3><p>决策边界，也称为决策面，是用于在N维空间，将不同类别样本分开的平面或曲面。<br><strong>线性决策边界：</strong><br><img src="http://cp0000.github.io/assets/logistic_regression/20160409204957945"><br>决策边界： -3 + x1 +x2 = 0</p>
<p><strong>非线性决策边界</strong><br><img src="http://cp0000.github.io/assets/logistic_regression/20160409205014946"><br>决策边界： -1 + x1^2 +x2^2 = 0</p>
<p><strong>决策边界</strong>其实是一个方程，在逻辑回归中，决策边界由theta’ X=0定义。<br><strong>假设函数</strong>（h=g(z)）用于计算样本属于某种类别的可能性；<strong>决策函数</strong>(h=1(g(z)&gt;0.5))用于计算样本的类别；<strong>决策边界</strong>（θ^Tx=0）是一个方程，用于标识出分类函数（模型）的分类边界。 </p>
<h3 id="代价函数（Cost-Function）"><a href="#代价函数（Cost-Function）" class="headerlink" title="代价函数（Cost Function）"></a>代价函数（Cost Function）</h3><p>逻辑回归中，采用如下的形式计算样本的代价值：</p>
<p><img src="http://cp0000.github.io/assets/logistic_regression/20160409210035918"></p>
<p>整合一下，得到逻辑回归中的代价函数：</p>
<p><img src="http://cp0000.github.io/assets/logistic_regression/20160409210057356"></p>
<h3 id="优化方法"><a href="#优化方法" class="headerlink" title="优化方法"></a>优化方法</h3><p>在逻辑回归中，使用梯度下降法对代价函数进行优化，完整形式如下：<br><img src="http://cp0000.github.io/assets/logistic_regression/20160409210420143"></p>
<p>注意：<br>逻辑回归和线性回归问题中，梯度下降算法的形式看上去一致，但实际上两者完全不同，因为假设函数是不同的，需要特别注意这一点。</p>
<p>其向量化实现（vectorized implementation）如下：<br><img src="http://cp0000.github.io/assets/logistic_regression/20160409210508019"></p>
<h2 id="逻辑回归-vs-线性回归"><a href="#逻辑回归-vs-线性回归" class="headerlink" title="逻辑回归 vs 线性回归"></a>逻辑回归 vs 线性回归</h2><p>逻辑回归得到一个离散的结果，线性回归得到一个连续的结果。预测房价的模型返回连续结果，是线性回归。癌症检测的结果是你有癌症或没有，是逻辑回归。</p>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><p>逻辑回归是一种被人们广泛使用的算法，它非常高效，不需要太大的计算量，又通俗易懂，不需要缩放输入特征，不需要任何调整，且容易调整，并且输出校准好的预测概率。与线性回归一样，当你去掉和输出变量无关的属性以及相似度高的属性时，逻辑回归效果确实会更好。因此特征处理在逻辑回归和线性回归的性能方面起着重要的作用。</p>
<p>逻辑回归的另一个优点是它非常容易实现，且训练起来很高效。<br>它的一个缺点就是我们不能用逻辑回归来解决非线性问题，因为它的决策边界是线性的。</p>
<h2 id="何时适用"><a href="#何时适用" class="headerlink" title="何时适用"></a>何时适用</h2><p>逻辑回归通过线性边界将你的输入分成两个区域，每个类别划分一个区域。因为，你的数据应当是线性可分的，如下图：</p>
<p><img src="http://cp0000.github.io/assets/logistic_regression/02.jpg" alt="01"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2019/03/02/entropy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2019/03/02/entropy/" class="post-title-link" itemprop="url">机器学习基础知识：熵，交叉熵，相对熵</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-03-02 16:02:21 / Modified: 17:54:31" itemprop="dateCreated datePublished" datetime="2019-03-02T16:02:21+08:00">2019-03-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>信息熵是随机数据源产生信息的均量。信息熵代表的是随机变量或整个系统的不确定性，熵越大，随机变量或系统的不确定性就越大。</p>
<h3 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h3><p>一枚正常硬币进行若干次抛投，这个事件的熵是1bit，因为结果不外乎两个 - 正面或反面，可以表示为0，1编码，而且两个结果彼此之间相互独立。但如果一枚硬币的两面完全相同，那抛硬币事件的熵为零，因为结果能被准确预测。</p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>信息熵的数学公式如下：</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/ad96d27b76b011b9cb7c41665e3e25edf04b3515" alt="entropy definition"></p>
<p>其中 P 为X的概率质量函数，E为期望函数，而I(x)是X的信息量。I(X)本身是个随机变数。当取自有限样本时，熵的公式可以表示为：</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/67841ec4b4f7e6ab658842ef2f53add46a2debbd" alt="entropy deinition2"></p>
<p>所以熵的本质是香农信息量 log(1/p)的期望；一个事件结果的出现概率越低，对其编码的bit长度就越长。以期望在整个随机事件的无数次重复试验中，用最少的bit去记录整个实验历史，即无法压缩的表达，代表了真正的信息量。</p>
<h3 id="交叉熵"><a href="#交叉熵" class="headerlink" title="交叉熵"></a>交叉熵</h3><p>一个系统有一个真实的概率分布，也叫真实分布，根据真实分布，我们能够找到一个最优策略，以最小的代价消除系统的不确定性，而这个代价大小就是信息熵。</p>
<p>多数情况下，我们并不知道系统的真实分布，如抛硬币例子，如果硬币两面一样，但我们不知道这一信息，以为两面不一样，两面不一样是一个非真实分布。<strong>交叉熵</strong>，是用来衡量在给定的真实分布下，使用非真实分布所指定的策略消除系统的不确定性所需要付出的努力大小。</p>
<p>交叉熵的公式为：</p>
<p><img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/0cb6da032ab424eefdca0884cd4113fe578f4293" alt="cross_entropy"></p>
<p>其中p为真实分布，q为非真实分布。交叉熵越低，意味着q越接近p。所以在机器学习分类算法中，我们总是最小化交叉熵，交叉熵越低，间接证明算法推算出的非真实分布q越接近真实分布p。</p>
<p>深度学习中交叉熵损失函数[Cross Entropy Loss]；</p>
<p><img src="https://www.zhihu.com/equation?tex=L=-%5Bylog%5C+%5Chat+y+(1-y)log%5C+(1-%5Chat+y)%5D" alt="cross entropy loss"></p>
<h3 id="相对熵（KL散度）"><a href="#相对熵（KL散度）" class="headerlink" title="相对熵（KL散度）"></a>相对熵（KL散度）</h3><p>相对熵又称KL散度，是为了衡量不同策略之间的差异，即：</p>
<p><img src="https://www.zhihu.com/equation?tex=%5Csum_%7B+x+%5Cin+X%7D+f(x)+*+%5Clog_2+%5Cfrac%7Bf(x)%7D%7Bg(x)%7D"></p>
<p>假设f(x)为真实分布p，g(x)为非真实分布q，则上述相对熵为：</p>
<p><img src="https://www.zhihu.com/equation?tex=+%5Csum_%7Bk=1%7D%5EN+p_k+%5Clog_2+%5Cfrac%7B1%7D%7Bq_k%7D+-+%5Csum_%7Bk=1%7D%5EN+p_k+%5Clog_2+%5Cfrac%7B1%7D%7Bp_k%7D+=+%5Csum_%7Bk=1%7D%5EN+p_k+%5Clog_2+%5Cfrac%7Bp_k%7D%7Bq_k%7D"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2019/01/20/2018-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2019/01/20/2018-summary/" class="post-title-link" itemprop="url">2018年度总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-01-20 20:09:46 / Modified: 21:38:59" itemprop="dateCreated datePublished" datetime="2019-01-20T20:09:46+08:00">2019-01-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://cp0000.github.io/assets/2018/2018.jpg" alt="2018"></p>
<h3 id="文娱"><a href="#文娱" class="headerlink" title="文娱"></a>文娱</h3><h4 id="电影"><a href="#电影" class="headerlink" title="电影"></a>电影</h4><h5 id="中国"><a href="#中国" class="headerlink" title="中国"></a>中国</h5><ul>
<li>一一 - ⭐️⭐️⭐️⭐️⭐️</li>
<li>红海行动 - ⭐️⭐️⭐️⭐️</li>
<li>影 - ⭐️⭐️⭐️</li>
<li>无双 - ⭐️⭐️⭐️</li>
<li>我不是药神 - ⭐️⭐️⭐️</li>
</ul>
<h5 id="好莱坞"><a href="#好莱坞" class="headerlink" title="好莱坞"></a>好莱坞</h5><ul>
<li>蜘蛛侠-平行宇宙  - ⭐️⭐️⭐️⭐️</li>
<li>杰出公民  - ⭐️⭐️⭐️⭐️</li>
<li>碟中谍6：全面瓦解  - ⭐️⭐️⭐️⭐️</li>
<li>奇迹男孩  - ⭐️⭐️⭐️</li>
<li>头号玩家  - ⭐️⭐️⭐️</li>
<li>海王  - ⭐️⭐️⭐️</li>
<li>寂静之地  - ⭐️⭐️⭐️</li>
<li>第六感生死缘  - ⭐️⭐️⭐️</li>
<li>美国丽人 - ⭐️⭐️⭐️</li>
<li>古墓丽影：源起之战 - ⭐️⭐️</li>
<li>黑豹  - ⭐️⭐️</li>
<li>复仇者联盟3  - ⭐️⭐️</li>
<li>蚁人2  - ⭐️</li>
<li>金刚-骷髅岛  - ⭐️</li>
</ul>
<h5 id="日本"><a href="#日本" class="headerlink" title="日本"></a>日本</h5><ul>
<li>无人知晓 - ⭐️⭐️⭐️</li>
</ul>
<h5 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h5><ul>
<li>看不见的客人 - ⭐️⭐️⭐️⭐️</li>
<li>斯大林之死  - ⭐️⭐️⭐️⭐️</li>
<li>一个叫欧维的男人决定去死 - ⭐️⭐️⭐️⭐️</li>
<li>恐怖直播 - ⭐️⭐️⭐️⭐️</li>
<li>艾尔酒吧 - ⭐️⭐️⭐️</li>
<li>普通女人  - ⭐️⭐️⭐️</li>
<li>燃烧  - ⭐️⭐️⭐️</li>
<li>厕所英雄 - ⭐️⭐️</li>
</ul>
<h4 id="美剧-英剧-日剧-纪录片"><a href="#美剧-英剧-日剧-纪录片" class="headerlink" title="美剧-英剧-日剧-纪录片"></a>美剧-英剧-日剧-纪录片</h4><ul>
<li>辛普森：美国制造 - ⭐️⭐️⭐️⭐️⭐️</li>
<li>Ugly Delicious - ⭐️⭐️⭐️⭐️⭐️</li>
<li>风骚律师 - 第四季 - ⭐️⭐️⭐️⭐️</li>
<li>毒枭：墨西哥 - ⭐️⭐️⭐️⭐️</li>
<li>梅尔罗斯 - ⭐️⭐️⭐️⭐️</li>
<li>硅谷第五季 - ⭐️⭐️⭐️⭐️</li>
<li>非自然死亡 - ⭐️⭐️⭐️⭐️</li>
<li>西部世界第二季  - ⭐️⭐️⭐️</li>
<li>保镖  - ⭐️⭐️⭐️</li>
<li>利器  - ⭐️⭐️⭐️</li>
<li>杀死伊芙 - ⭐️⭐️⭐️</li>
<li>了不起的麦瑟尔夫人 - ⭐️⭐️⭐️</li>
<li>9号秘事第四季 - ⭐️⭐️⭐️</li>
</ul>
<h4 id="音乐"><a href="#音乐" class="headerlink" title="音乐"></a>音乐</h4><ul>
<li>Kendrick Lamar</li>
</ul>
<h4 id="书籍"><a href="#书籍" class="headerlink" title="书籍"></a>书籍</h4><ul>
<li>那不勒斯四部曲（1）- 我的天才女友 - ⭐️⭐️⭐️⭐️⭐️</li>
<li>那不勒斯四部曲（2）- 新名字的故事 - ⭐️⭐️⭐️⭐️</li>
<li>那不勒斯四部曲（3）- 离开的，留下的 - ⭐️⭐️⭐️⭐️</li>
<li>那不勒斯四部曲（4）- 失踪的孩子 - ⭐️⭐️⭐️⭐️</li>
<li>失明症漫记 - ⭐️⭐️⭐️⭐️</li>
<li>我是个年轻人，我心情不太好- ⭐️⭐️⭐️</li>
<li>富士山禁恋- ⭐️⭐️⭐️</li>
</ul>
<h4 id="Podcast"><a href="#Podcast" class="headerlink" title="Podcast"></a>Podcast</h4><ul>
<li>灭茶苦茶</li>
<li>文化土豆</li>
<li>硅谷早知道</li>
<li>Blow Your Mind</li>
<li>The Dave Chang Show</li>
<li>996 Podcast by GGV</li>
</ul>
<h3 id="体育"><a href="#体育" class="headerlink" title="体育"></a>体育</h3><ul>
<li>2018年世界杯 1/8 决赛：法国-阿根廷</li>
<li>17-18 NBA季后赛 西部决赛 - 金州勇士-休斯顿火箭队</li>
</ul>
<h3 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h3><ul>
<li>年度编程语言 - Python</li>
<li>年度技术点 - DeepLearning</li>
<li>年度App - 微信读书，网易有钱</li>
<li>年度工具 - PyCharm Ce</li>
<li>年度硬件 - AirPods，15寸mbp</li>
<li>年度公开课 - 3blue1brow, 李宏毅机器学习课程</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2018/11/18/review-fcn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2018/11/18/review-fcn/" class="post-title-link" itemprop="url">全卷积网络-语义分割的简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-18 22:00:21" itemprop="dateCreated datePublished" datetime="2018-11-18T22:00:21+08:00">2018-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-19 11:57:58" itemprop="dateModified" datetime="2018-11-19T11:57:58+08:00">2018-11-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>这是一篇译文，原文<a target="_blank" rel="noopener" href="https://towardsdatascience.com/review-fcn-semantic-segmentation-eb8c9b50d2d1">Review: FCN (Semantic Segmentation))</a></p>
</blockquote>
<p>本文主要记录用于语义分割的全卷积网络。和分类，检测任务相比，分割是更难的一种任务。</p>
<ul>
<li>图片分类：对图像进行分类</li>
<li>物体检测：检测一张图片中存在的物体，并给出物体的区域。</li>
<li>分割：为图像中的每个像素分类。</li>
</ul>
<p>一个语义分割的例子：</p>
<iframe width="700" height="393" src="https://www.youtube.com/embed/xr_2dwZDH6U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p><img src="https://cdn-images-1.medium.com/max/1600/1*jrqv1qX2J1AGMA0g-RU7fg.png" alt="原图，Ground Truth，预测结果，融合结果"></p>
<p>该论文发表于 2015 CVPR，现在有 6000 次引用。它也是使用FCN进行语义分割的最基础的论文之一。</p>
<h2 id="本文包括"><a href="#本文包括" class="headerlink" title="本文包括"></a>本文包括</h2><ol>
<li>从图像分类到语义分割</li>
<li>利用反卷积进行上采样</li>
<li>融合输出</li>
<li>结论</li>
</ol>
<h2 id="1-从图像分类到语义分割"><a href="#1-从图像分类到语义分割" class="headerlink" title="1.从图像分类到语义分割"></a>1.从图像分类到语义分割</h2><p>传统意义上的分类任务，输入图像会缩小尺寸，并通过卷积层和全连接层，最终输出关于输入图片的标签，如下图：</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*ErOVnlmtWYFGpnpvKJImKw.png" alt="分类"></p>
<p>想象我们把上图中的全连接层替换成 1X1 卷积层：</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*11XDuwNHHRE7EB_fu_TzCg.png" alt="所有层都是卷积层
"></p>
<p>如果图像没有缩小尺寸，输出将不是单个标签。相反，输出的大小小于输入图像（由于最大池化层）</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*T-tYcj11_qySDHTRhlF9pQ.png" alt="所有层都是卷积层
"></p>
<p>如果我们对上面的输出进行上采样，那么我们逐像素输出标签贴图，如下所示：</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*LtSSJ9QP0Y9qWG9nz9sb2w.png" alt="上采样
"><br><img src="https://cdn-images-1.medium.com/max/1600/1*NXNGhfSyzQcKzoOSt-Z0Ng.png" alt="Feature Map"></p>
<h2 id="2-利用反卷积进行上采样"><a href="#2-利用反卷积进行上采样" class="headerlink" title="2.利用反卷积进行上采样"></a>2.利用反卷积进行上采样</h2><p>卷积是一个使输出尺寸变小的过程。反卷积就是一上采样，使得输出尺寸变大的过程（但不要把反卷积曲解成卷积的逆向操作），反卷积也被称为上卷积和转置卷积。当使用分数步幅时，也被称为分数步幅卷积。</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/0*NBKHZlXvqOg3R6_z.gif" alt="通过反卷积进行上采样(蓝色：输入，绿色：输出)
"></p>
<h2 id="3-融合输出"><a href="#3-融合输出" class="headerlink" title="3.融合输出"></a>3.融合输出</h2><p>经过如下图所示的conv7后，输出尺寸很小，然后进行32X 上采样，得到和输入同样大小的输出。但也会把输出标签变得很糙。这个叫 <strong>FCN-32s</strong>:</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*ajovnrcLYRuwlTrM5j-Qng.png" alt="FCN-32s"></p>
<p>这是因为在网络变深的时候能够获得深层次的特征，但如此同时空间位置信息也会丢失。这意味着浅网络可以获得更多的位置信息。如果我们把两种网络合并在一起，我们可以平衡结果。</p>
<p>为了组合，我们融合输出（通过元素添加）：</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*lUnNaKAjL-Mq10v3tIBtJg.png" alt="融合FCN-16s和FCN-8s"></p>
<p>**FCN-16s:<strong>的输出是把pool5的输出2倍上采样和pool4融合并进行16次上采样。</strong>FCN-8s:**操作如上图所示，也是类似。</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*tcYqvV0KHjK2ANBGe8GpjQ.png" alt="对比不同的FCNs结果"></p>
<p>FCN-32s由于位置信息丢失结果非常粗糙，而FCN-8s的结果最好。</p>
<p>这种融合操作实际上就像AlexNet,VGGNet和GoogleNet中使用的增强/整合技术一样，它们通过多个模型结果的叠加，使预测更准确。但在这个任务中，它是针对每个像素去做的，并且它是拿模型中不同层的结果去叠加的。</p>
<h2 id="4-结果"><a href="#4-结果" class="headerlink" title="4.结果"></a>4.结果</h2><p><img src="https://cdn-images-1.medium.com/max/2000/1*2obgSShyzzBKuds_XxPCoA.png" alt="Pascal VOC 2011 dataset (Left), NYUDv2 Dataset (Middle), SIFT Flow Dataset (Right)
"></p>
<ul>
<li>FCN-8s在Pascal VOC 2011数据集上效果最佳</li>
<li>FCN-16s在NYUDv2数据集上效果最佳</li>
<li>FCN-16s在SIFT数据集上效果最佳</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*fU9El2B2qELtKsD9FsHB-w.png" alt="结果可视化比较
"></p>
<p>第四行显示了一个失败案例：网络把船上的救生衣当作了人。</p>
<p>希望将来能够更多地阅读有关语义分割的深度学习技术。</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li>[2015 CVPR] [FCN] <a target="_blank" rel="noopener" href="https://people.eecs.berkeley.edu/~jonlong/long_shelhamer_fcn.pdf">Fully Convolutional Networks for Semantic Segmentation</a>  </li>
<li>[2017 TPAMI] [FCN] <a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/7478072">Fully Convolutional Networks for Semantic Segmentation</a>  </li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2018/11/06/review-fsrcnn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2018/11/06/review-fsrcnn/" class="post-title-link" itemprop="url">超分FSRCNN的简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 00:24:40" itemprop="dateCreated datePublished" datetime="2018-11-06T00:24:40+08:00">2018-11-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-19 11:57:22" itemprop="dateModified" datetime="2018-11-19T11:57:22+08:00">2018-11-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>这是一篇译文，原文<a target="_blank" rel="noopener" href="https://towardsdatascience.com/review-fsrcnn-super-resolution-80ca2ee14da4">Review:FSRCNN(Super Resolution)</a></p>
</blockquote>
<p>本文主要用来概述一篇实时超分辨率的实现FSRCNN，全称Fast Super-Resolution Convolutional Neural Network，FSRCNN 发表于2016年的ECCV，目前为止有近300次的引用。<br>FSRCNN有着一个相对浅的网络结构，浅网络层让我们比较好理解每一个网络层的用途。与SRCNN相比，它重建后的图像质量更高。</p>
<p>对比SRCNN，FSRCNN-s(FSRCNN小模型版本)，FSRCNN-s 有着更好的PSNR（图像质量），更快的处理时长。<br>对比 SRCNN-Ex（SRCNN优质版本）和 FSRCNN，FSRCNN的结果PSNR更好，处理速度更快。<br>所以，来看下FSRCNN是如何达到质量和速度双优的</p>
<p>下文包含如下内容：</p>
<ul>
<li>SRCNN 简述</li>
<li>FSRCNN 网络架构</li>
<li>如何利用 1x1 卷积对网络进行压缩和扩大</li>
<li>如何利用多个 3X3 卷积实现非线性映射</li>
<li>对比实验</li>
<li>结论</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/1000/1*auit3UsBTjbnzZoLDEJUUg.png" alt="Network Architecture: SRCNN (Top) and FSRCNN (Bottom)"></p>
<p>上图是 SRCNN 和 FSRCNN 的网络架构图。其中 Conv(f,n,c)表示该卷积： 卷积大小为fxf， 有n个过滤器以及c个输入通道。</p>
<h2 id="1-SRCNN简述"><a href="#1-SRCNN简述" class="headerlink" title="1. SRCNN简述"></a>1. SRCNN简述</h2><p>SRCNN 的处理过程如下：</p>
<ol>
<li>对输入图片利用双立方采样做上采样，使得其分辨率为目标分辨率</li>
<li>然后分别利用 9x9, 1x1, 5x5 的卷积来提高图片质量。其中 1x1 卷积是用来把低分辨率（LR）图像向量非线性映射为高分辨率 (HR) 图像向量.</li>
</ol>
<p>计算复杂度为：</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*OsUvb3UK7elWkaNIhDpXlA.png"></p>
<p>计算复杂度和HR图像大小成线性比例，SHR。HR图像越大，复杂度越高。</p>
<h2 id="2-FSRCNN-网络结构"><a href="#2-FSRCNN-网络结构" class="headerlink" title="2. FSRCNN 网络结构"></a>2. FSRCNN 网络结构</h2><p>FSRCNN 包含如下五个主要处理步骤：</p>
<ol>
<li>特征提取：利用一个 5x5 卷积代替 SRCNN 中的双立方差值</li>
<li>压缩：利用 1x1 卷积把特征层从 d 压缩为 s，其中 s 小于 d</li>
<li>非线性映射：多个 3x3 网络层代替单个的宽网络层</li>
<li>扩大： 1x1 卷积把特征层从 s 扩大为 d</li>
<li>反卷积： 利用 9x9 过滤器重建 HR 图像</li>
</ol>
<p>以上结构就是 FSRCNN(d,s,m). 其计算复杂度如下：</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*xvdMQu_xpVt5Rong_JANjQ.png"></p>
<p>可见复杂度和 LR 图像大小成线性比例，SLR，所以它的复杂度小于 SRCNN</p>
<p>网络中激活函数是 PReLU. PReLU意为带参数的ReLu，目的是比 ReLU 更好。（更多关于 PReLu 的内容， <a target="_blank" rel="noopener" href="https://medium.com/coinmonks/review-prelu-net-the-first-to-surpass-human-level-performance-in-ilsvrc-2015-image-f619dddd5617">请参照</a>）</p>
<p>代价函数是均方误差（MSE）：<br><img src="https://cdn-images-1.medium.com/max/800/1*CGk1oqKbj76eNuPhYKARsQ.png"></p>
<h2 id="3-如何利用-1x1-卷积对网络进行压缩和扩大"><a href="#3-如何利用-1x1-卷积对网络进行压缩和扩大" class="headerlink" title="3. 如何利用 1x1 卷积对网络进行压缩和扩大"></a>3. 如何利用 1x1 卷积对网络进行压缩和扩大</h2><p>假设我们在不使用 1x1 卷积的情况下运行 5x5 卷积，如下所示：</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*s6_8m_0EpwrzZPunRGgFCQ.png" alt="5x5 卷积"></p>
<p>计算次数 = (14x14x48)x(5x5x480) = 112.9M</p>
<p>如果使用 1x1 卷积：</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*SJDJyBGM__wRX9wJYIKv8w.png" alt="1x1 卷积"></p>
<p>1x1 卷积计算次数 = (14x14x16)x(1x1x480) = 1.5M<br>5x5 卷积计算此时 = (14x14x48)x(5x5x16) = 3.8M<br>两者总共计算次数 = 1.5M + 3.8M = 5.3M,比只使用 5x5 足足少了 112.9M 次计算。</p>
<p>论文<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1312.4400">Network-In-Netwrok</a>建议使用 1x1 卷积引入更多的非线性并改善性能，而GoogleNet建议 1x1 卷积有助于在保证效果的同时减小模型大小。(<a target="_blank" rel="noopener" href="https://medium.com/coinmonks/paper-review-of-googlenet-inception-v1-winner-of-ilsvlc-2014-image-classification-c2b3565a64e7">GoogleNet简述</a>)。</p>
<p>因此在两个卷积层之前使用 1x1 卷积来减少连接（参数）。通过减少参数，我们只需要更少的乘法和加法运算，最终加速网络。这就是 FSRCNN 比 SRCNN 快的原因。</p>
<h2 id="4-如何利用多个-3x3-卷积实现非线性映射"><a href="#4-如何利用多个-3x3-卷积实现非线性映射" class="headerlink" title="4. 如何利用多个 3x3 卷积实现非线性映射"></a>4. 如何利用多个 3x3 卷积实现非线性映射</h2><p><img src="https://cdn-images-1.medium.com/max/800/1*NMC4KrYIciGdE_FaazxF7w.png" alt="两个 3x3 滤波器可以包含一个 5x5 的滤波器区域"></p>
<p>如上图所示通过使用2层 3x3 滤波器来覆盖 5x5 滤波器的区域，让参数数量变少。</p>
<p>1层 5x5 滤波器的参数数量 = 5x5 = 25<br>2层 3x3 滤波器的参数数量 = 3x3+3x3 = 18<br>参数量减少了28%。而更少的参数意味着网络在训练的时候可以更快的收敛，并减少过拟合问题。</p>
<h2 id="5-对比实验"><a href="#5-对比实验" class="headerlink" title="5. 对比实验"></a>5. 对比实验</h2><p><img src="https://cdn-images-1.medium.com/max/1600/1*c4pkT0SQRxd6N_G8KBQHkA.png" alt="对比实验"></p>
<ul>
<li><strong>SCRCNN-Ex:</strong> SRCNN 的优质版本，拥有 57184 个参数</li>
<li><strong>Transition State 1:</strong> 使用反卷机，有 58976 个参数，获得更高的PSNR</li>
<li><strong>FSRCNN (56,12,4):</strong> 更小的滤波器，更少的滤波器，有 12464 个参数，更高的PSNR。更重要的参数更少，相对容易收敛。</li>
</ul>
<p>下表为每个组件的贡献值：</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*Gg5emNKjDs9wcbobOKIxMQ.png" alt="m,sd"></p>
<p>对比各种参数的结果，选取 m=4, d=56, s=12时，可以兼顾HR图像质量（33.16dB）和模型复杂度（12464参数）。</p>
<p>最终我们选用 <strong>FSRCNN:FSRCNN (56,12,4),FSRCNN-s:FSRCNN (32,5,1)</strong></p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ul>
<li>利用91张放大3倍的图片从头开始训练网络，然后利用利用放大2倍和4倍的100张图反卷积微调网络。</li>
<li>数据增强部分，缩放：0.9，0.8，0.7，旋转：：90，180，270</li>
</ul>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*zTzSP4Y9R_RlBZwLDtCC7Q.png" alt="所有网络在91张训练集的结果"></p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*kw9miEL54IPgKW1YTodb9w.png" alt="FSRCNN和FSRCNN在91张训练集上的结果"></p>
<p>从上述结果可以得出：FSRCNN和FSRCNN-s在放大2倍，3倍效果好。当放大4倍的效果比SCN差一点点。</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*eVcmO3zw9qO8EDstMWt5Ug.png" alt="放大3倍的效果"></p>
<p>通过论文中的浅层网络，我们可以了解每种组件的效果，例如1×1卷积和多个3×3卷积。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2018/11/04/30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2018/11/04/30/" class="post-title-link" itemprop="url">活到30</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-04 20:08:40" itemprop="dateCreated datePublished" datetime="2018-11-04T20:08:40+08:00">2018-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-04 20:18:39" itemprop="dateModified" datetime="2020-01-04T20:18:39+08:00">2020-01-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>有一天我做了一个恐怖的梦，梦见我32岁了。然后当我醒来，发现自己只有23岁，就放心了。但是后来我真的从梦里醒来，发现自己确实是32岁了。时间过得很快，20岁是人生的巅峰状态，从那以后我们就开始走下坡路了。 – 电影《before the sunset》</p>
</blockquote>
<p>少年时听长辈说某件事是10年之前发生的了，会觉得：“哇，10年啊，好久之前发生的事情啊”。如今才发现，10年之前发生的事情却仿佛就在眼前。08年的夏天，我刚上完大一，暑假没事在家里待着，每天守着电视看北京奥运会。电视里各种各样的奥运项目让人应接不暇，看着每个运动员健康矫捷美丽的身姿，我心想人应该活的如此健康快乐才是。</p>
<blockquote>
<p>你发现每个你遇到的人，都尝试把环境变得更好，赚更多钱，赢得更多尊重，得到更多的赞赏，这真令人精疲力尽。 – 电影《before the sunset》</p>
</blockquote>
<p>11年从大学毕业之后，我便入了程序员这个行当；这是一个适合平民百姓，没啥背景出身的人干的行业。在这个行业只要你技术好，为人靠谱，可以靠着这门手艺安身立命。程序员工作中，和机器打交道多过和人打交道，这样想来我算是误打误撞入了一个和我性格挺搭的行业。 七年多的程序员生涯，我有过一些那种恍然大悟，让人分泌多巴胺的快乐时刻。</p>
<p>只是我最近在思考，程序员工作的意义到底在哪里？可能我所在的行业不是那种基建性质的系统软件开发，程序员在日常生活中，大多数时候做的事情只是担当老板，产品，运营同事们需求的实现者。当中除了如何实现有自己的主见之外，要实现什么完全是听别人的指挥。这听起来是一份没有honor的行当。不过有人会说，其实产品，运营，和其他各种各样形形色色的行业，多数时刻我们都是执行任务的角色。我们受制于人，每天按部就班，小心翼翼的处理事情，保证问题不要出在自己身上。工作的意义对于多数人来讲不过是需要把牛奶和面包放在自家的桌子上，喂养老人，孩子和自己。honor不重要，肚子饿比较重要。所以对饥饿的恐惧感，无形的督促我们每天早起晚归，拼命工作挣钱。</p>
<blockquote>
<p>活在当下，我们好像生来就对所有的事情不满。一直想改善自己的状态，一个欲望达成后，下一个有自然浮现。– 电影《before the sunset》</p>
</blockquote>
<p>我对死亡最为恐惧是在七八岁的时候。那段日子，晚上关灯睡觉之后，我脑子都会想人要是死去之后，就什么都没有了。不管这世界如何精彩，天上的星星如何闪亮，宇宙如何变化，这一切都和一个死去的人没有一丁点关系。死去，意味着不存在了，你所有的思想，记忆，喜怒哀乐都不复存在了。每每想到此，我就特别的恐惧，恐惧那种不存在。这种恐惧，最近在早晨的梦里又出现了几次, 对不存在的无法接受又萦绕在脑中。不过也许人长大了，也就麻木了，洗漱之后，该上班上班，平日里嘈杂忙碌的生活会帮你忘却这种恐惧。</p>
<p>人到30，进入而立。有那么一瞬间，会觉得一切只能如此了，就按部就班的安稳地活着吧。只是希望自己在忙着挣钱，忙着处理各种各样生活工作中问题的时候，不要忘了Steve Jobs的这段话：</p>
<blockquote>
<p>“Your time is limited, so don’t waste it living someone else’s life. Don’t be trapped by dogma – which is living with the results of other people’s thinking. Don’t let the noise of other’s opinions drown out your own inner voice. And most important, have the courage to follow your heart and intuition. They somehow already know what you truly want to become. Everything else is secondary.” – Steve Jobs</p>
</blockquote>
<p><strong>Death is the destination we all share. No one has ever escaped it.</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2018/06/16/audio/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2018/06/16/audio/" class="post-title-link" itemprop="url">音频编解码以及音乐GPU实时可视化效果实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-16 10:58:22" itemprop="dateCreated datePublished" datetime="2018-06-16T10:58:22+08:00">2018-06-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-06-19 22:35:24" itemprop="dateModified" datetime="2018-06-19T22:35:24+08:00">2018-06-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在一些音乐播放器上（如上学时候用的播放器<code>千千静听</code>）会有一排 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E7%9B%B4%E6%96%B9%E5%9B%BE">直方图</a> 随着音乐节奏忽高忽低的跳动。你会好奇这个直方图的跳动是随着音乐的什么属性来做变换的，貌似有时候和音乐的节奏还挺搭的。要解释清楚这个问题，首先得了解什么声音，以及声音的原理。</p>
<h2 id="声音"><a href="#声音" class="headerlink" title="声音"></a>声音</h2><h3 id="声音的原理"><a href="#声音的原理" class="headerlink" title="声音的原理"></a>声音的原理</h3><p>根据维基百科上所述：声音是一种波动；当演奏乐器、人说话或者敲击桌面时，声音的振动会引起介质——空气分子有节奏的振动，使周围的空气产生疏密变化，形成疏密相间的纵波，这就产生了声波，这种现象会一直延续到振动消失为止。</p>
<p>声音作为波的一种，频率和振幅就成了描述波的重要属性，频率的大小与我们通常所说的音高对应，而振幅影响声音的大小。声音可以被分解为不同频率不同强度的正弦波的叠加。这种变换（或分解）的过程，称为傅立叶变换(Fourier Transform)。</p>
<blockquote>
<p>所以到这里，我们大致明白了音乐播放器上面的直方图其实是声音的频率和振幅的统计图。</p>
</blockquote>
<h3 id="声音的特性"><a href="#声音的特性" class="headerlink" title="声音的特性"></a>声音的特性</h3><ul>
<li><strong>响度（loudness）</strong>：人主观上感觉声音的大小（俗称音量），由“振幅”（amplitude）和人离声源的距离决定，振幅越大响度越大，人和声源的距离越小，响度越大。（单位：分贝dB）</li>
<li><strong>音调（pitch）</strong>：声音的高低（高音、低音），由“频率”（frequency）决定，频率越高音调越高（频率单位Hz（hertz），赫兹)，人耳听觉范围 20～20k Hz。20Hz以下称为次声波，20k Hz以上称为超声波）例如，低音端的声音或更高的声音，如细弦声。频率是每秒经过给定点的声波数量，它的测量单位为赫兹。1000Hz表示每秒经过给定点的声波有1000个周期</li>
<li><strong>音色（Timbre）</strong>：又称音品，波形决定了声音的音色。声音因不同物体材料的特性而具有不同特性，音色本身是一种抽象的东西，但波形是把这个抽象直观的表现。音色不同，波形则不同。典型的音色波形有方波，锯齿波，正弦波，脉冲波等。不同的音色，通过波形，完全可以分辨的。</li>
<li><strong>乐音</strong>：有规则的让人愉悦的声音。噪音：从物理学的角度看，由发声体作无规则振动时发出的声音；</li>
</ul>
<h2 id="音频编解码"><a href="#音频编解码" class="headerlink" title="音频编解码"></a>音频编解码</h2><p>音频的编解码器需要分成硬件，软件两个部分讨论。硬件部分，音频编码器芯片（ADC）会把接收到的声波转换成PCM数据, 由于PCM占用存储资源太大，不利于传输和存储，所以需要利用音频编解码器软件对PCM数据进行压缩，得到如 FLAC/MP3/OGG 的音频文件。当我们播放一段数字音频文件的时候，则需要先进行软解码，也就是对压缩过的音频文件（FLAC/MP3/OGG）先解码成PCM，然后传送解码后的PCM给音频解码器（DAC），解码器将数字信号转换为模拟信号。</p>
<h3 id="音频硬编码过程"><a href="#音频硬编码过程" class="headerlink" title="音频硬编码过程"></a>音频硬编码过程</h3><p>信号的数字化就是将连续的模拟信号转换成离散的数字信号， 一般需要完成采样、量化和编码三个步骤,如下图所示。</p>
<p><img src="http://cp0000.github.io/assets/audio/digital_audio_simpli.png" alt="A/D"></p>
<ul>
<li>采样是指用每隔一定时间间隔的信号样本值序列来代替原来在时间上连续的信号。</li>
<li>量化是用有限个幅度近似表示原来在时间上连续变化的幅度值，把模拟信号的连续幅度变为有限数量，有一定时间间隔的离散值。</li>
<li>编码则是按照一定的规律，把量化后的离散值用二进制数码表示。</li>
</ul>
<p>上诉数字化过程称为脉冲编码调制（Pulse Code Modulation，缩写PCM）</p>
<h3 id="PCM-的码率"><a href="#PCM-的码率" class="headerlink" title="PCM 的码率"></a>PCM 的码率</h3><ul>
<li>采样率值 × 采样大小值 × 声道数 bps = 码率</li>
<li>例如: 一个采样率为44.1KHz，采样大小为16bit，双声道的PCM编码的WAV文件，它的数据速率则为 44.1K×16×2 =1411.2 Kbps。这表示存储一秒钟采样率为44.1KHz，采样大小为16bit，双声道的PCM编码的音频信号，需要176.4KB的空间，1分钟则约为10.34M</li>
</ul>
<h3 id="MP3"><a href="#MP3" class="headerlink" title="MP3"></a>MP3</h3><p><code>MP3</code>全称是<code>MPEG-1</code>or<code>MPEG-2 Audio Layer III</code>，它被设计来大幅降低音频数据量，它舍弃PCM音讯资料中，对人类听觉不重要的资料，从而达到了压缩成较小的档案。而对于大多数用户的听觉感受来说，MP3的音质与最初的不压缩音频相比没有明显的下降。</p>
<h2 id="音频处理"><a href="#音频处理" class="headerlink" title="音频处理"></a>音频处理</h2><h3 id="音频傅立叶变换"><a href="#音频傅立叶变换" class="headerlink" title="音频傅立叶变换"></a>音频傅立叶变换</h3><p>了解了声音和音频编解码的基础知识之后，我们可以开始对音频进行相关应用处理了。那如何处理音频呢？首先用<a target="_blank" rel="noopener" href="https://www.audacityteam.org/">Audacity</a>软件打开一段音频，会看到如下图所示的波形图。你会想，这乱糟糟，看起来没啥规律可循的波形的该如何处理。</p>
<p><img src="http://cp0000.github.io/assets/audio/wave.png" alt="wave"></p>
<p>就像我们处理图片的时候，会把像素点颜色分解成<code>RGB</code>三个通道（或者YCbCr,Lab 等其他颜色空间）进行处理一样，在处理音频的时候，我们需要对音频的波形进行分解。根据声音的特性，不同物体发出的声音频率范围是不一样的，如下图是不同乐器的频率范围：</p>
<p><img src="http://cp0000.github.io/assets/audio/imgext.jpeg" alt="frequency"></p>
<p>所以我们可以把音频从时域转换到频域，然后对分解出来的各个频率进行操作。这里需要借助<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2">傅立叶变换</a>完成音频从时域到频域的转换。</p>
<p>看不懂傅立叶变换的数学公式也没有关系，只要记住下面这张图就好。</p>
<p><img src="http://cp0000.github.io/assets/audio/fft2.png" alt="fft"></p>
<p>如上图，对左边红色的音频时域声波进行傅立叶变换之后，分解成了一系列正弦波。而右边蓝色部分是针对分解的一系列正弦波的统计图，其中横轴是频率，纵轴是振幅。有了这张频谱图，我们可以很方便的处理音频了（如消除某一段频率等等）。</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>有了上面对音频做傅立叶变换后的频率数组，我们可以开始去实现一个音乐实时可视化Demo了。考虑到性能，以及跨平台，我们利用GPU搭配OpenGL编程去实现Demo。实现步骤如下图所示：</p>
<p><img src="http://cp0000.github.io/assets/audio/visualization.png" alt="visualization"></p>
<h3 id="获取PCM数据"><a href="#获取PCM数据" class="headerlink" title="获取PCM数据"></a>获取PCM数据</h3><p>在iOS上，利用<code>AVFoundation</code>中的<code>AVAudioEngine</code>获取音乐的<code>pcmbuffer</code>，然后利用<code>Accelerate framework</code>中提供的DSP信号处理api，对<code>pcmbuffer</code>进行傅立叶变换。</p>
<h4 id="加载音乐"><a href="#加载音乐" class="headerlink" title="加载音乐"></a>加载音乐</h4><pre><code>NSString          * audioPath   = [[NSBundle mainBundle] pathForResource: @&quot;bgm&quot; ofType: @&quot;.mp3&quot;];
AVAudioEngine     * engine      = [AVAudioEngine new];
AVAudioFile       * audioFile   = [[AVAudioFile alloc] initForReading: [NSURL fileURLWithPath: audioPath] error: nil];

AVAudioPCMBuffer  * audioPCMBuffer  = [[AVAudioPCMBuffer alloc] initWithPCMFormat: audioFile.processingFormat
                                                                    frameCapacity: (AVAudioFrameCount)audioFile.length];
[audioFile readIntoBuffer: audioPCMBuffer error: nil];

AVAudioPlayerNode * audioPlayerNode = [AVAudioPlayerNode new];
[engine attachNode: audioPlayerNode];

// Connect Nodes
AVAudioMixerNode *mixerNode = [engine mainMixerNode];
[engine connect: audioPlayerNode to: mixerNode format: audioFile.processingFormat];
[audioPlayerNode scheduleBuffer: audioPCMBuffer  completionHandler:^&#123;
    NSLog(@&quot;scheduleBuffer&quot;);
&#125;];

// Start engine
NSError *error;
[self.engine prepare];
[self.engine startAndReturnError: &amp;error];
if (error) &#123;
    NSLog(@&quot;error:%@&quot;, error);
&#125;
</code></pre>
<h4 id="获取-PCMBuffer"><a href="#获取-PCMBuffer" class="headerlink" title="获取 PCMBuffer"></a>获取 PCMBuffer</h4><pre><code>int bufferSize = 1024;
[mixerNode installTapOnBus: 0
                bufferSize: bufferSize
                    format: [mixerNode outputFormatForBus: 0]
                   block: ^(AVAudioPCMBuffer * _Nonnull buffer, AVAudioTime * _Nonnull when) &#123;
    float    * magnitudes  = [FFTHelper performFFT: buffer];
&#125;];
</code></pre>
<h4 id="执行-FFT"><a href="#执行-FFT" class="headerlink" title="执行 FFT"></a>执行 FFT</h4><pre><code>+ (float *)  performFFT: (AVAudioPCMBuffer *) buffer &#123;
    if (buffer == NULL) &#123;
        return NULL;
    &#125;
    int frameLength = buffer.frameLength;
    long nOver2 = frameLength / 2;
    vDSP_Length fftLength = nOver2;

    float * imag = (float *) calloc(frameLength, sizeof(float));
    DSPSplitComplex splitComplex;

    splitComplex.realp = buffer.floatChannelData[0];
    splitComplex.imagp = imag;

    int log2n  = (vDSP_Length)(floor(log2((float)frameLength)));
    int radix   = (FFTRadix)kFFTRadix2;
    FFTSetup weights = vDSP_create_fftsetup(log2n, radix);
    vDSP_fft_zip(weights, &amp;splitComplex, 1, log2n, (FFTDirection)FFT_FORWARD);
    float fftNormFactor = 1.0 / (2 * fftLength);
    vDSP_vsmul(splitComplex.realp, 1, &amp;fftNormFactor, splitComplex.realp, 1, fftLength);
    vDSP_vsmul(splitComplex.imagp, 1, &amp;fftNormFactor, splitComplex.imagp, 1, fftLength);
    
    float * magnitudes = (float *) calloc(fftLength, sizeof(float));
    //Convert the fft data to dB
    vDSP_zvmags(&amp;splitComplex, 1, magnitudes, 1, fftLength);
    
    float kAdjust0DB  = 1.5849e-13;
    //In order to avoid taking log10 of zero, an adjusting factor is added in to make the minimum value equal -128dB
    vDSP_vsadd(magnitudes, 1, &amp;kAdjust0DB, magnitudes, 1, fftLength);
    float one = 1;
    // vDSP_vdbcon: Vector convert to decibels, power, or amplitude.
    vDSP_vdbcon(magnitudes, 1, &amp;one, magnitudes, 1, fftLength, 0);

    free(imag);
    vDSP_destroy_fftsetup(weights);
    return magnitudes;
&#125;
</code></pre>
<h4 id="上传FFT数据到GPU"><a href="#上传FFT数据到GPU" class="headerlink" title="上传FFT数据到GPU"></a>上传<code>FFT</code>数据到<code>GPU</code></h4><p>拿到频谱数据之后，需要利用<code>shader</code>来实现音乐可视化的效果。当中如何把频谱数据上传到<code>GPU</code>是一个问题，因为频谱数据一个长达1k的数组，直接用<code>uniform float[]</code>来上传，性能很差。这里有一个比较tricky的做法是把频谱数据存储到一张空白图片上，然后把图片转换成<code>texture</code>，再上传<code>texture</code>到<code>GPU</code>，这样就可以优化上传频谱数组性能差的问题。</p>
<pre><code>// Passing the data to the GPU
-（void）load: (float *) data length: (int) length width: (int) width height: (int) height slot: (GLenum) slot &#123;
GLuint    texture   = 0;
GLubyte * raw       = (GLubyte *) malloc (sizeof (GLubyte) * length * 4);

for (int i = 0; i &lt; length; i++) &#123;
    GLubyte color   = GLubyte(data[i] * 255.0);
    raw[4*i+0]      = color; // R
    raw[4*i+1]      = color; // G
    raw[4*i+2]      = color; // B
    raw[4*i+3]      = color; // A
&#125;

glActiveTexture (slot)
glGenTextures (1, &amp;texture)
glBindTexture (GLenum (GL_TEXTURE_2D), texture);

glTexParameteri (GLenum (GL_TEXTURE_2D), GLenum (GL_TEXTURE_WRAP_S), GL_REPEAT);
glTexParameteri (GLenum (GL_TEXTURE_2D), GLenum (GL_TEXTURE_WRAP_T), GL_REPEAT);

glTexParameteri (GLenum (GL_TEXTURE_2D), GLenum (GL_TEXTURE_MAG_FILTER), GL_LINEAR);
glTexParameteri (GLenum (GL_TEXTURE_2D), GLenum (GL_TEXTURE_MIN_FILTER), GL_LINEAR);
glTexImage2D (GLenum (GL_TEXTURE_2D), 0, GL_RGBA, GLsizei (width), GLsizei (height), 0, GLenum (GL_RGBA), GLenum (GL_UNSIGNED_BYTE), raw);
free (raw); raw = NULL;
</code></pre>
<p>}</p>
<h4 id="可视化效果"><a href="#可视化效果" class="headerlink" title="可视化效果"></a>可视化效果</h4><p>最后在<code>shader</code>中解析texture，得到频谱数据，并绘制直方图，就可以做出音乐播放器上的直方图效果啦，如下图：</p>
<p><img src="http://cp0000.github.io/assets/audio/spectrum2.gif" alt="spectrum"></p>
<p>效果比较素，更加华丽的一些关于音乐可视化的效果可以翻翻<a target="_blank" rel="noopener" href="http://shadertoy.com/">shadertoy.com</a>，上面有很多绚丽的效果。如下图：</p>
<p><img src="http://cp0000.github.io/assets/audio/spectrum.gif" alt="shadertoy spectrum"></p>
<p>以上。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2018/01/03/goals-are-for-losers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2018/01/03/goals-are-for-losers/" class="post-title-link" itemprop="url">失败者才设定目标</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2018-01-03 19:31:06 / Modified: 21:06:57" itemprop="dateCreated datePublished" datetime="2018-01-03T19:31:06+08:00">2018-01-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Learn-OpenCV"><a href="#Learn-OpenCV" class="headerlink" title="Learn OpenCV"></a>Learn OpenCV</h2><p>因为工作需要，我订阅了 <a target="_blank" rel="noopener" href="http://www.learnopencv.com/">Learn OpenCV</a> 的邮件。<a target="_blank" rel="noopener" href="http://www.learnopencv.com/">Learn OpenCV</a> 可以简单描述成是一个教学<code>OpenCV</code>的网站，网站的作者是 <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/satyamallick/">Satya Mallick</a>,美国加州大学圣迭戈分校的博士，主要研究计算机视觉。网站上面的教程每个都是从原理和基础知识开始讲解，配合工程实现，直至最终完成Demo。每篇Blog都会配有c++和python 两个版本的source code，是个非常不错的学习OpenCV的网站。17年下半年开始，网站上也开始教学机器学习，深度学习相关的知识，同样保持了一贯浅显易懂的特点。</p>
<h2 id="Goals-are-for-losers"><a href="#Goals-are-for-losers" class="headerlink" title="Goals are for losers"></a>Goals are for losers</h2><p>最近 <a target="_blank" rel="noopener" href="http://www.learnopencv.com/">Learn OpenCV</a>  发送了一份邮件，标题叫<strong>Goals are for losers</strong>，直译成中文是<strong>目标是为失败者设定的</strong>。看起来很标题党的感觉，在我们的认知中，设定目标为了帮助我们把梦想实现，任务完成，是通往更好的自己的必经之路，怎么会是为失败者定制的了。</p>
<p>以下是对<code>Goals are for losers</code>这份邮件的翻译：</p>
<blockquote>
</blockquote>
<p>随着新年的到来，给新的一年设置目标看起来是一件很美妙的事。但如果你想完成某件事，而你只是设定了一个目标，那你大概率会失败。</p>
<blockquote>
</blockquote>
<p>假设你今年的目标是完全掌握计算机视觉中某个领域的全部知识。那得等到2018年结束的时候你才会知道你的目标是否完成了。如果你没完成目标，在2018年结束的时候，对这个结果，除了叹息接受，你无能为力。</p>
<blockquote>
</blockquote>
<p><strong>目标是一个滞后的衡量标准, 你需要一个主导衡量标准</strong></p>
<blockquote>
</blockquote>
<p>什么是主导衡量标准？主导衡量标准指的是能提前告知你每天是否接近目标。像“每天花两小时学习计算机视觉”就是一个主导衡量标准。</p>
<blockquote>
</blockquote>
<p>为了始终如一地执行主导措施，我们需要的是制定计划。我们的计划可以制定成早上5点到7点学习计算机视觉（美国人民这么拼？？？）。如果某天你没有完成计划，意味着你需要在那个周末加班把时间补起来。在制定计划的时候，我们需要明确定义在什么时间点做什么事情（计划的可执行也很重要，一个无法执行的计划也是没有意义的）。<code>每天花一点时间</code>这种计划是不会起作用的。</p>
<blockquote>
</blockquote>
<p>坚持执行计划，目标自然会达成，否则目标就是幻想。</p>
<p>我非常同意上述的观点，一定要<strong>为设定的目标制定详细的执行计划，然后按照计划一丝不苟的完成</strong>，这样目标才能达成。想来惭愧，我在17年6月份花了 ¥2000.00 参加了<code>FaceAI</code>的课程，但因为没有具体的计划，也缺少明确的目标，导致我购买的这个课程一点知识都没有学习到。</p>
<p>以上。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2017/12/03/my-2017/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2017/12/03/my-2017/" class="post-title-link" itemprop="url">我的2017</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-12-03 12:58:39" itemprop="dateCreated datePublished" datetime="2017-12-03T12:58:39+08:00">2017-12-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-01-03 13:34:40" itemprop="dateModified" datetime="2018-01-03T13:34:40+08:00">2018-01-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>2017年还剩一个月，这一年马上就要走完。年初的计划如果此时还没有开始做，想必也来不及在2017去完成了。所以在12月的开头，总结一下这一年发生的事情，想想其实也不算太早。</p>
<h2 id="Life-is-Short"><a href="#Life-is-Short" class="headerlink" title="Life is Short"></a>Life is Short</h2><p>“时间真的过得太快了“，是人们在年尾回顾一年所作所为时最常感叹的一句陈词滥调。其实，每个人都知道时间流逝，人生苦短。不过仔细想想，当我们在抱怨时间过得太快的时候，是真的在抱怨时间流逝嘛？还是在为自己这一年来碌碌无为，浑浑噩噩所苦恼？Paul Graham在他的博客里提出一个很有意思的假设： 假如我们人类的寿命是现在的10倍，那我们还会感叹人生苦短么？这个假设目前无从验证，但如果感叹人生苦短的本质是苦恼于自己的碌碌无为，那我们应该还是会感叹时间飞逝，即便我们能活800年。</p>
<p>一个可以稍微减轻<code>life is short</code>的解法是不要等待，想到了就去做。诸如明天再进行体育锻炼，下个礼拜再给父母打电话，下个月再开始学习新技术，明年再思考自己到底想做什么等等这些需要以后再去做的事情，最好能当下处理掉。我们不应该感叹于时光飞逝，自己却什么都没做；而应该满足于逝去的时间我都在做我想做，喜欢做的事情上。感叹于物理现象是没有意义的。</p>
<h2 id="出行"><a href="#出行" class="headerlink" title="出行"></a>出行</h2><p>2017年我去了美国和澳大利亚。年初的时候是没计划今年会去澳大利亚和美国。去澳大利亚是在五月份，主要目的是旅游。那次出行，我们住在墨尔本城市里面，主要是在维多利亚州活动。维多利亚州到处都是平坦辽阔的草原，上面牛羊成群，真的是一块完美的畜牧地。旅行中见到了小企鹅，树懒，美丽的澳洲风光，可就是没看到袋鼠。墨尔本这座城市也让人很喜欢，虽说澳洲是个移民国家，没什么历史，但墨尔本给人感觉是一座很有历史感的城市。它不是很大，但很美，还有一种莫名其妙的不知道从哪里来的亲切感。在城市广场附近，我远远的看到了澳网球场，作为一个德约科维奇的球迷，没能参观他最为成功的一块球场，略微有点遗憾。相比于墨尔本，黄金海岸给我的感觉是个典型的旅游海岛型城市，坐直升飞机俯览整个黄金海岸，真的很美。行程中，我不止一次的羡慕这块土地的人们，他们的地理环境比起我们中国真的好太多。</p>
<p>去美国是在8月下旬的时候，原因是公司和苹果合作参与<code>iPhone X</code>的新特性封闭开发。凭借着自己三脚猫的英语口语，过了美国海关，搭上出租车来到圣何塞的库比蒂诺和同事汇合。硅谷整体给人的观感是一个大农村，公共交通设施很差，物价很高。天气也比较干旱，一开始会不太喜欢那里的天气，但呆久了就觉得还挺好。硅谷的建筑都不高，一般都是四五层楼，不像国内的办公楼动辄二三十层。那是段很有意思的经历。</p>
<h2 id="一些推荐"><a href="#一些推荐" class="headerlink" title="一些推荐"></a>一些推荐</h2><p>###书<br>17年还是读了一些蛮有意思的书，其中人物传记比较多，有</p>
<ul>
<li>《鞋狗》</li>
<li>《硅谷钢铁侠：埃隆马斯克的冒险人生》</li>
<li>《成为乔布斯》</li>
<li>《曾国藩家书》</li>
<li>《毛泽东传》</li>
</ul>
<p>其他的书</p>
<ul>
<li>《死之枝》</li>
<li>《独裁者手册》</li>
<li>《拆掉思维里的墙-原来我还可以这样活》</li>
<li>《平凡的世界》</li>
</ul>
<h3 id="播客"><a href="#播客" class="headerlink" title="播客"></a>播客</h3><p>播客听的比较多是跟李如一先生或多或少有关系的一些博客, 推荐的有：《一天世界》，《灭茶苦茶》，《博物志》，《硬影像》，《太医来了》，《声东击西》，《迟早更新》，《简单心理》</p>
<h3 id="影视"><a href="#影视" class="headerlink" title="影视"></a>影视</h3><p>电影《赴汤蹈火》，《爱乐之城》不错；美剧《Better Call Saul》，《Mr. Robot》，《GOT》都不错。</p>
<p>以上。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2017/10/29/29/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2017/10/29/29/" class="post-title-link" itemprop="url">活到29</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2017-10-29 22:56:05 / Modified: 23:53:54" itemprop="dateCreated datePublished" datetime="2017-10-29T22:56:05+08:00">2017-10-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>“婚姻是一座围城，城外的人想进去，城里的人想出来.” – 钱钟书 《围城》</p>
</blockquote>
<p>我还没有结婚，所以也无从体验婚姻是否真如钱先生所说的那样，是一座围城。倒是这世上许许多多的事情，还真如这句话所言，城外的人想进去，城里的人想出来。前阵子看到一篇文章，讲的是在美国硅谷生活工作的35岁左右男性面临的职业危机，或者说是两难吧。要么继续呆在美国，但职业天花板明摆在那里，生活也是一眼到头。选择回国，会有更具吸引力的薪资，权利，机会，但年轻的时候拼了命来美国是否又变得没有意义；而且老婆孩子还得继续留在美国，自己异地工作，没法照顾家庭，夫妻，父子关系会否变得浅薄起来。总之就是对现状无法感到满意，着急改变。这应该是一个很典型的围城思维。就像国内的程序员会觉得能去美国硅谷的大公司，如Google,Apple,Facebook工作才算是真正成功的程序员。不但可以肉身翻墙，赚取美金，还可以享受“民主与自由”。但身处美利坚的同志们可能也有自己的烦恼，比如如上文案例所讲的，事业发展有瓶颈，机会不如在国内多，父母亲留在国内，没法照顾，等诸如此类的。</p>
<p>的确，我们成长的过程中，总是在经历着各种各样的围城事件。去大城市打拼的人觉得工作生活压力太大，留在小城市安逸舒服，反之小城市的人觉得大城市繁华，机会多，挣钱多。搞计算机的觉得其他行当的人没这么累，其他行当的人觉得这几年搞计算机的人挣得多。呆在大公司上班的人觉得自己创业的人酷，什么都自己说的算，创业的人却在抱怨投资人像祖宗一样难搞，自己每天都在透支着自己的身体，还是留在大公司打一份工，省心。总之，诸如此类，不甚枚举。每个人在某个阶段都会有围城思维，我经历过，其他人肯定也经历过。</p>
<p>程序员对解决问题这件事情有着近乎偏执的爱好，行文到这里，该是到写如何破解围城思维的时候了。但有些事情就像今年奥斯卡最佳男主角所演的《海边的曼彻斯特》这部电影中表述的故事一样，注定是没有答案，无从解决的。围城就是在那里，每个人在生命的各个阶段都得面对自己的围城，是进去，还是出来，亦或是出来后再进去，只能全凭自己的判断。运气好的，生活继续，吃饱睡足，心满意足；运气不好的，只能怪自己为何出城，老实呆着不好嘛之类的。</p>
<p>活到二十九，而立之年。今年的生日过的分外没劲，可能日子就是这样，年纪越大越觉得过生日是一种折磨。时间流逝，所谓理想，爱好都会随之消散，到最后只剩下买房，结婚生子，赡养老人等社会责任让你继续上路，不至于垮掉。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2017/10/04/opengl-lighting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2017/10/04/opengl-lighting/" class="post-title-link" itemprop="url">Learning OpenGL：光照</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-10-04 17:39:47" itemprop="dateCreated datePublished" datetime="2017-10-04T17:39:47+08:00">2017-10-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-03-02 17:54:59" itemprop="dateModified" datetime="2019-03-02T17:54:59+08:00">2019-03-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h2><p>计算机如何表达现实世界中五彩滨纷的颜色？答案是用红，绿，蓝（缩写RGB）三个分量来数字化颜色。但我们在现实生活中看到某一物体的颜色并不是这个物体真正拥有的颜色，而是它反射的（Reflected）颜色。也就是说，那些不能被物体所吸收的颜色就是我们能够感知到的物体颜色。例如，太阳光能被看见的白光其实是由许多不同的颜色组合而成的。如果我们将白光照在一个红色的衣服上，这个红色的衣服会吸收白光中除了红色以外的所有子颜色，而不被吸收的红色光被反射到我们的眼中，让这件衣服看起来是红色的。</p>
<p>颜色反射的定律被直接运用到图形领域。当我们在OpenGL中创建一个光源时，我们希望给光源一个颜色。当我们把光源的颜色与物体的颜色值相乘，所得到的就是这个物体所反射的颜色。在OpenGL中，我们将两个颜色向量作分量相乘，结果就是最终的颜色向量了：</p>
<pre><code>vec3 lightColor(1.0,1.0,1.0);
vec3 clothingColor(0.0,0.5,0.0);
vec3 result =  lightColor * clothingColor; // (0.0, 0.5, 0.0);
</code></pre>
<p>我们定义<strong>物体的颜色为物体从一个光源反射各个颜色分量的大小</strong>.我们可以使用不同的光源颜色来让物体显现出意想不到的颜色。</p>
<p>##基础光照</p>
<p>现实世界的光照极其复杂，而且受诸多因素影响，计算机有限的计算能力无法模拟。因此在OpenGL的光照使用的是简化的模型，对现实的情况进行近似模拟。这些光照模型是基于我们对光的物理特性的理解。冯氏光照模型是其中一个模型，冯氏光照模型主要由3个分量组成：环境（Ambient），漫反射（Diffuse）和镜面（Specular）光照。如下图：</p>
<p><img src="http://cp0000.github.io/assets/lighting/phong_reflection.jpg"></p>
<ul>
<li>环境光照（Ambient Lighting）:在黑暗的情况下，现实世界通常也仍有一些光亮，所以物体几乎永远不会是完全黑暗的。为了模拟这个，我们会使用一个环境光照常量，它永远会给物体一些颜色。</li>
<li>漫反射光照（Diffuse Lighting）：模拟光源对物体的方向性影响。它是冯氏光照模型中视觉上最显著的分量。物体的莫一部分越是正对着光源，它就会越亮。</li>
<li>镜面光照（Specular Lighting）：模拟有光泽物体上面出现的亮点。镜面光照的颜色相比于物体的颜色会更倾向于光的颜色。</li>
</ul>
<h3 id="环境光照"><a href="#环境光照" class="headerlink" title="环境光照"></a>环境光照</h3><p>我们使用一个很小的常量（光照）颜色，添加到物体片段的最终颜色中，如此即使场景中没有直接的光源也能看起来存在有些发散的光。</p>
<pre><code>void main()
&#123;
    float ambientStrength = 0.1;
    vec3 ambient = ambientStrength * lightColor;
    vec3 result = ambient * objectColor;
    gl_fragColor = vec4(result, 1.0);
&#125;
</code></pre>
<h3 id="漫反射光照"><a href="#漫反射光照" class="headerlink" title="漫反射光照"></a>漫反射光照</h3><p>漫反射对物体产生显著的视觉影响。漫反射光照使物体上与光线方向越接近的片段能从光源处获得更多的亮度。</p>
<p>光源发出的光线落在物体的一个片段上，我们需要计算这个光线是以什么角度接触到这个片段的。为了测量光线和片段的角度，需用到一个叫做<strong>法向量</strong>（Normal Vector）的东西，它是垂直于片段表面的一个向量。点乘返回一个标量，我们可以用它计算光线对片段颜色的影响。不同片段朝向光源的方向不同，这些片段被照亮的情况也不同。所以，计算漫反射光照需要：</p>
<ul>
<li>法向量：一个垂直于顶点表面的向量</li>
<li>定向的光线：作为光源的位置与片段的位置之间向量差的方向向量。</li>
</ul>
<h3 id="法向量"><a href="#法向量" class="headerlink" title="法向量"></a>法向量</h3><p>法向量是一个垂直于顶点表面的（单位）向量。由于顶点本身并没有表面，我们利用它周围的顶点来计算出这个顶点的表面。一个三角形的法线是一个长度为1并且垂直于这个三角形的向量。而顶点的法线，是包含该顶点的所有三角形的法线均值。</p>
<p>###漫反射光照<br>每个顶点有了法向量，但我们仍然需要光源额度位置向量和片段的位置向量。由于光源的位置是一个静态变量，故简单在片段着色器中声明为uniform：</p>
<pre><code>uniform vec3 lightPos;
</code></pre>
<p>渲染的时候，设置lightPos就可以了。<br>最后，我们还需要片段的位置。我们会在世界空间中进行所有的光照计算，因此我们需要一个在世界空间中的顶点位置。我们可以通过把顶点位置属性乘以模型矩阵来把它变换到世界坐标系。如下：</p>
<pre><code>varying vec3 fragPos;
varying vec3 normal;

void main() &#123;
    gl_Position = projection * view * model * vec4(aPos, 1.0);
    fragPos = vec3 (model * vec4(aPos, 1.0));
    normal = aNormal;
&#125;
</code></pre>
<p>在片段着色器中，我们需要计算光源和片段位置之间的方向向量。通过让两个向量相减的方式计算向量差。</p>
<pre><code>vec3 norm = normalize (normal);
vec3 lightDir = normalize (lightPos - fragPos);
</code></pre>
<p>然后我们对 norm 和 lightDir 向量进行点乘，计算光源对当前片段实际的漫发射影响。结果值再乘以光的颜色，得到漫发射分量。两个向量之间的角度越大，漫反射分量就会越小：</p>
<pre><code>float diff = max (dot(norm, lightDir), 0.0); // 如果两个向量之间的角度大于90度，点乘的结果就会变成负数，这样会导致漫反射分量变为负数，为此，我们使用max函数返回两个参数之间较大的参数，从而保证漫反射分量不会变成负数。
vec3 diffuse = diff * lightColor;

vec3 result = (ambient + diffuse) * objectColor;
gl_FragColor =  vec4(result, 1.0);
</code></pre>
<h3 id="镜面光照（Specular-Hightlight）"><a href="#镜面光照（Specular-Hightlight）" class="headerlink" title="镜面光照（Specular Hightlight）"></a>镜面光照（Specular Hightlight）</h3><p>和漫反射光照一样，镜面光照是依据光的方向向量和物体的法向量来决定的，但是它还依赖于观察方向。镜面光照是基于光的反射特性。如果我们想象物体表面像一面镜子一样，那么无论我们从哪里去看那个表面所反射的光，镜面光照都会达到最大化。如下图：</p>
<p><img src="http://cp0000.github.io/assets/lighting/specularLight.jpg"></p>
<p>我们通过反射法向量周围光的方向来计算反射向量。然后我们计算反射向量和视线方向的角度差，如果夹角越小，那么镜面光的影响就会越大。<br>观察向量是镜面光照附加的一个变量，我们可以使用观察者世界空间位置和片段的位置来计算它。之后，我们计算镜面光强度，用它乘以光源的颜色，再将它加上环境光和漫反射分量。</p>
<pre><code>uniform vec3 viewPos;
float specularStrength = 0.5;
float shininess  = 32; // 反光度，一个物体的反光度越高，反射光的能力越强，散射得越少，高光点就会越小
vec3 viewDir = normalize(viewPos - fragPos);
vec3 reflectDir = reflect(-lightDir, norm)
float spec = pow (max (dot (viewDir, reflectDir), 0.0), shininess);
vec3 specular = specularStrength * spec * lightColor;

vec3 result = (ambient + diffuse + specular) * objectColor;
gl_FragColor = vec4(result, 1.0);
</code></pre>
<p>以上就是基础光照的相关知识了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2017/08/06/shoe-dog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2017/08/06/shoe-dog/" class="post-title-link" itemprop="url">读书笔记：《鞋狗》</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-08-06 19:24:18" itemprop="dateCreated datePublished" datetime="2017-08-06T19:24:18+08:00">2017-08-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-09-03 14:23:25" itemprop="dateModified" datetime="2017-09-03T14:23:25+08:00">2017-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Reading-notes/" itemprop="url" rel="index"><span itemprop="name">Reading notes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>人生不一定会赢，而我就是不想输。 –菲尔·奈特</p>
</blockquote>
<p>11-12赛季的英超，阿森纳客场对阵切尔西。范佩西在比赛中上演帽子戏法，帮助阿森纳5-3赢得比赛。那是个阳光明媚的秋日午后，破门之后，范佩西在斯坦福球场上振臂高呼，一时间场外球迷高呼其名，为其呐喊助威，就像欢呼得胜回朝的将军一般。那一刻，我想这是足球这项运动带给职业球员最大的吸引力吧，或许也是竞技体育带给运动员们最大的吸引力。以前我觉得可能就是我一个人这么幻想过，成为一个杰出的运动员，在赢得比赛的那个刹那，场下的千万观众为你欢呼呐喊；直到最近看了NIKE的创始人菲尔·奈特的亲笔自传《Shoe Dog: A Memoir by the Creator of Nike》，在书中的前几章我找到了一直以来关于运动内涵的最好描述。</p>
<p>以下是两段摘录：</p>
<blockquote>
<p>球在半空时，双方拳击手感觉到一个回合结束的铃声即将敲响时，或是跑者靠近终点，观众集体站起来时，那些事情就处于某个我们所不清楚的地方。在决定胜负前最激动人心的半秒内，显然会产生一种愉悦感。我想要的就是那个，无论到底是什么，我就想让那种感觉充实我的人生，填满我每天的生活。</p>
</blockquote>
<blockquote>
<p>运动可以让人们感受不同的生活，参与到别人的胜利中去，甚至体验失败。运动达到高潮的时候，粉丝的精神与运动员的精神融合在一起，这种情感的集合和转移，神秘主义者称其为合一 </p>
</blockquote>
<p>对于体育的热爱是菲尔·奈特选择去销售运动鞋的初衷，自传中讲述了<code>NIKE</code>是如何一步一步从无到有，并最终上市的；从最开始代理日本鬼冢虎鞋子往美国销售，到研发NIKE鞋子，并打败当时的霸主Adidas。作者在书中没有对自己成功进行任何粉饰，而是把大量篇幅拿来讲述自己如何和银行家较量，和债主周旋，和供应商协调，以及和政府部门官僚的斗争。作者真实记录了一个企业的成长过程，像众人坦诚公司最初的发展是非常混乱，危险，没有章法的。每一天都挣扎在破产的边缘（现金流就是零售业的生死线）。作为公司的创始人，菲尔·奈特早期没有在商业上指导江山，没有各种方法论，他每天都在遇到各种各样的挑战，而他能做的就是坚持下去；当然光坚持也没用，作为创始人，奈特要做的且唯一能做的就是想尽一切办法去解决问题。过程你会发现，企业不是一个人能做起来的，奈特需要找来各种各样的人，组合起来一个战斗力十足的创始团队。团队中有人擅长开疆拓土，打开新的市场；有人擅长研发新的鞋子，树立技术堡垒；有人擅长和政府部门打交道，搞定华盛顿那帮家伙。总之一个好汉三个帮，要想做成一个企业，没有得力的帮手是不可能的。勇敢，敏锐，合作，极大的耐力，以及全身心的投入是我读完该书对菲尔·奈特的性格理解。</p>
<p>书的最后一章，是奈特关于企业，以及自己生活的一些感性描写和反思。</p>
<blockquote>
<p>我想告诉大家要按下暂停键，花时间努力思考一下要如何度过一生，想要和谁一起度过剩余的40年。我会告诉20岁左右的青年不要为了一份工作，专业甚至职业而安定下来，一定要寻求内心的冲动。即使你不知道其中的含义，也要坚持追寻。如果你追随自己内心的冲动，将会更能忍受疲惫，每一次失望都会成为你的动力，需要攀登的高峰也会变得微不足道起来。</p>
</blockquote>
<p>你会发现这段话和乔布斯那段著名的斯坦福大学的毕业演讲和其相似：</p>
<blockquote>
<p>The only way to do great work is to love what you do. If you haven’t found it yet, keep looking. </p>
</blockquote>
<p>追随内心的冲动是两位伟大企业家的共性所在。</p>
<p>以上！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2017/07/02/Kangrinboqe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2017/07/02/Kangrinboqe/" class="post-title-link" itemprop="url">冈仁波齐</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-07-02 15:08:30" itemprop="dateCreated datePublished" datetime="2017-07-02T15:08:30+08:00">2017-07-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:21:56" itemprop="dateModified" datetime="2017-10-06T22:21:56+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Movie/" itemprop="url" rel="index"><span itemprop="name">Movie</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>去看了电影《冈仁波齐》，一开始倒不是因为想了解这部电影所宣扬的藏族信仰是为何物，而是因为朴树的片尾曲《No Fear In My Heart》。想来从高一的时候接触到朴树，从听《Colorful Days》，《傲慢的上校》，《生如夏花》，到现在已然13年了。令人兴奋的是，朴树这两年回来了。</p>
<p>很难讲《冈仁波齐》一部好看的电影，她是一部很特别的电影，看完电影我会觉得还是很值得一看。整个电影给我最大的冲击瞬间是他们从村里出发朝圣去冈仁波齐的时候。看到影片中出现了拖拉机，我以为他们会坐着拖拉机一路开过去。但又觉得坐拖拉机不能算朝圣吧，那怎不能走着过去吧，那么远，而且在高原上，得走多久才能到。所以当他们卧倒开始磕头前行的时候，我被震住了，说不出话来。是啊，在这个出行飞机高铁，挣钱越快越好，什么都讲究利益的年代，你看到一行人，一路从家乡磕头2000多里去圣地，很难不被这种行为所震动。</p>
<p>大多数国人是无宗教信仰者，当然我也是。我不懂宗教，更不懂藏传佛教，可能我还是个没有信仰的人。电影中可以明显感受到宗教给藏民带来的影响，一个最直接的感受是，他们都好平静，好平静。朝圣路上，大家生活在一起，无论晴天雪天，每天磕头朝拜，孕妇生完小孩后，回到队伍继续朝圣之路；老人去世了，举行完葬礼，大家继续朝圣。好像没有什么事情能阻止他们，就好像没什么事情能打破他们的平静。孩子出生的喜悦，老人去世的悲伤，都很平静，没有我们红白喜事的那种热闹，嘈杂，笑声朗朗或哀嚎震天。</p>
<p>坦率的说，我不觉得他们的生活方式就是好的，但我很羡慕他们表现出来的那种平静和笃定，那种生活在现代社会的人，很难拥有的不慌不忙。</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=484732973&auto=1&height=66"></iframe>





      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2017/03/19/framebuffer-object-opengl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2017/03/19/framebuffer-object-opengl/" class="post-title-link" itemprop="url">Learning OpenGL：帧缓冲对象</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-19 14:20:09" itemprop="dateCreated datePublished" datetime="2017-03-19T14:20:09+08:00">2017-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:18:11" itemprop="dateModified" datetime="2017-10-06T22:18:11+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>使用OpenGL渲染时，一般情况下我们使用的是默认的帧缓冲区（一般指的是 FrameBuffer Object Id 为 0）。但如果我们想实现一些后处理操作，如边缘检测，镜面，离屏渲染等，就需要我们自己创建自定义帧缓冲区，使用自定义帧缓冲区来进行后处理操作。</p>
<h2 id="FBO"><a href="#FBO" class="headerlink" title="FBO"></a>FBO</h2><p>在OpenGL中，渲染管线中的顶点，纹理等经过一系列的处理之后，最终显示在2D屏幕设备上，渲染管线的最终目的地是帧缓冲区。OpenGL中使用到帧缓冲包括三个：颜色缓冲，深度缓冲，模版缓冲。系统自身会创建一个默认缓冲区，OpenGL允许我们手动创建自定义帧缓冲区，并将渲染结果重定向到这个缓冲区。</p>
<p>帧缓冲对象中包括两种类型的附加图像：纹理图像和RenderBuffer图像。附加纹理时，OpenGL渲染到这个纹理图像上，在着色器中可以访问这个纹理图像。附加RenderBuffer时，OpenGL执行离屏渲染（offscreen, rendering）。</p>
<p>帧缓冲对象可以附加多个缓冲区，且可灵活地在缓冲区中切换。帧缓冲对象中包含一个以上的颜色附加点，而深度和模版都只有一个附加点。如下图所示：</p>
<pre><code>&gt;注：OpenGL es 2.0 也只有一个颜色附加点
</code></pre>
<p><img src="http://www.songho.ca/opengl/files/gl_fbo01.png" alt="framebuffer object"></p>
<p>从上图可知，帧缓冲对象本身不包含任何缓冲对象，实际上是通过附加点指向实际的缓冲对象。</p>
<h3 id="创建-FBO"><a href="#创建-FBO" class="headerlink" title="创建 FBO"></a>创建 FBO</h3><p>创建和销毁FBO的步骤很简单：</p>
<pre><code>void glGenFramebuffers(GLsizei n, GLuint * ids);
void glDeleteFramebuffers(GLsizei n, const GLuint * ids);
</code></pre>
<p>将FBO绑定到目标对象：</p>
<pre><code>void glBindFramebuffer(GLenum target, GLuint id)
</code></pre>
<ul>
<li>target分为三种类型：GL_FRAMEBUFFER-缓冲区用来进行读和写操作；GL_READ_FRAMEBUUFER–缓冲区支持glReadPixels读操作；GL_DRAW_FRAMEBUFFER-缓冲区支持渲染，清除操作。</li>
<li>id 即为创建出来的帧缓冲id</li>
</ul>
<p>通过绑定GL_FRAMEBUFFER,接下来所有的读和写操作都是在当前的帧缓冲上进行。</p>
<p>OpenGL要求，一个完整的FBO需要满足以下条件：</p>
<ul>
<li><p>至少附加一个缓冲区（颜色，深度或模版）</p>
</li>
<li><p>至少有一个颜色附加</p>
</li>
<li><p>所有的附加必须完整（预分配了内存）</p>
<blockquote>
<p>if(glCheckFramebufferStatus(GL_FRAMEBUFFER) == GL_FRAMEBUFFER_COMPLETE) 来判断一个FBO是否完整</p>
</blockquote>
</li>
<li><p>每个缓冲区的采样需要一致</p>
</li>
</ul>
<p>接下里所有的渲染操作都将会渲染到当前绑定的帧缓冲中去。由于当前的帧缓冲不是默认帧缓冲，渲染指令将不会影响到屏幕上的显示内容，所以我们把渲染到非默认帧缓冲叫做离屏渲染（off-screen rendering）.为了保证所有的渲染指令最终会呈现在设备屏幕上，我们需要重新绑定激活默认帧缓冲：</p>
<pre><code>glBindFramebuffer (GL_FRAMEBUFFER, 0);
</code></pre>
<h3 id="创建纹理附加图像"><a href="#创建纹理附加图像" class="headerlink" title="创建纹理附加图像"></a>创建纹理附加图像</h3><p>创建FBO的附加纹理如同平常使用纹理一样，不同的是，这里<strong>只为纹理分配空间，而不填充实际纹理图像内容，因为当使用FBO渲染时渲染结果将会写入到我们创建的这个纹理上去</strong></p>
<pre><code>glFramebufferTexture2D(GLenum target, GLenum attachment, GLenum textarget, GLuint texture,GLint level);
</code></pre>
<ul>
<li>target: 绑定目标，一般为 GL_FRAMEBUFFER</li>
<li>attachment:附加点，可选为GL_COLOR_ATTACHMENT0,GL_DEPTH_ATTACHMENT,GL_STENCIK_ATTACHMENT</li>
<li>textTarget: 纹理的绑定目标，一般为 GL_TEXTURE_2D</li>
<li>texture：实际的纹理对象</li>
<li>level：mipmap级别，一般为0</li>
</ul>
<pre><code>GLuint texture;
glGenTextures(1, &amp;texture);
glBindTexture(GL_TEXTURE_2D, texture);
glTexImage2D(GL_TEXTURE_2D, 0, GL_RBG, 1280, 960, 0, GL_RGB, GL_UNSIGNED_BYTE, NULL); //末尾的NULL表示我们只预分配空间，而不实际加载纹理
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
</code></pre>
<p>上面创建的纹理图像，可以附加到FBO：</p>
<pre><code>glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, texture, 0);
</code></pre>
<p>FBO创建和准备工作完成额，在利用FBO作图前，我们需要介绍另一个附加图像-RenderBuffer。</p>
<h3 id="创建Renderbuffer附加图像"><a href="#创建Renderbuffer附加图像" class="headerlink" title="创建Renderbuffer附加图像"></a>创建Renderbuffer附加图像</h3><p>和纹理图像一样，一个renderbuffer对象也是一个缓冲，它可以是一堆字节，整数，像素等。renderbuffer的优点是：它以OpenGL原生渲染格式存储它的数据，因此在离屏渲染到帧缓冲的时候，这些数据相当于被优化过。</p>
<p>renderbuffer对象将所有渲染数据直接储存在它们的缓冲里，而不会进行针对特定纹理格式的任何转换，这样它们就成了一种快速可写的存储介质了。然后，renderbuffer对象通常是只写的，不能修改它们。</p>
<p>因为renderbuffer对象中的数据已经是原生格式了，在写入或者把它们的数据拷贝到其他缓冲区的时候非常快。像切换缓冲区这种操作变得异常高速。因此我们在每个渲染迭代末尾的地方，可以用renderbuffer来实现缓冲区数据的交换操作。</p>
<blockquote>
<p>要了解为什么渲染的末尾需要交换帧缓冲数据，和谁交换帧缓冲数据，需要理解什么叫双缓存。所谓双缓存机制指的是显示系统通常会引入两个缓冲区，在这种情况下，GPU会预先渲染好一帧放入一个缓冲区内，让视频控制器读取，当下一帧渲染好后，GPU会直接把视频控制器的指针指向第二个缓冲器。</p>
</blockquote>
<p>创建和销毁RenderBuffer也很简单：</p>
<pre><code>void glGenRenderbuffers(GLsizei n, GLuint * ids);
void glDeleteRenderbuffers(GLsizei n, const GLuint * ids);
</code></pre>
<p>绑定到目标对象：</p>
<pre><code>glBindRenderbuffer (GL_RENDERBUFFER,rbo);
</code></pre>
<p>需为 RBO 预分配内存空间：</p>
<pre><code>void glRenderbufferStorage (GLenum target, GLenum internalFormat, GLsizei width, GLsizei height);
</code></pre>
<p>RBO绑定到FBO</p>
<pre><code>glFramebufferRenderbuffer (GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_RENDERBUFFER, rboId);
</code></pre>
<p>在帧缓冲项目中，renderbuffer可以优化渲染，但重要的是要懂得何时使用renderbuffer对象，何时使用纹理。通常规则是：如果你永远都不需要从特定的缓冲中进行采样，renderbuffer对特定缓冲是更明智的选择。如果需要从比如颜色或深度值这样的特定缓冲采样数据的话，最好使用纹理。</p>
<h3 id="渲染到纹理"><a href="#渲染到纹理" class="headerlink" title="渲染到纹理"></a>渲染到纹理</h3><p>到此为止，我们了解了帧缓冲如何工作，是时候看看如何运用上述知识了。接下来，我们把场景渲染到一个颜色纹理上，这个纹理附加到一个我们创建的帧缓冲上，然后把纹理绘制到一个简单的铺满屏幕的四边形上。输出的图像看似和没有使用帧缓冲一样，但这次输出是打印在最上层的四边形上的。</p>
<p><strong>Step1: 创建并绑定帧缓冲</strong></p>
<pre><code>GLuint framebuffer;
glGenFramebuffers(1, &amp;framebuffer);
glBindFramebuffer(GL_FRAMEBUFFER, framebuffer);
</code></pre>
<p><strong>Step2: 创建一个纹理</strong></p>
<pre><code>// Generate texture
GLuint texColorBuffer;
glGenTextures(1, &amp;texColorBuffer);
glBindTexture(GL_TEXTURE_2D, texColorBuffer);
glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, 800, 600, 0, GL_RGB, GL_UNSIGNED_BYTE, NULL);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR );
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
glBindTexture(GL_TEXTURE_2D, 0);

// Attach it to currently bound framebuffer object
glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, texColorBuffer, 0);
</code></pre>
<p><strong>Step3 创建renderbuffer来进行深度测试</strong></p>
<p>为了让OpenGL进行深度测试，我们必须要确保向帧缓冲中添加一个深度附件。由于我们只采样颜色缓冲，并不采样深度，模版缓冲，所以我们可以创建一个渲染缓冲对象来达到这个目的。</p>
<pre><code>GLuint rbo;
glGenRenderbuffers(1, &amp;rbo);
glBindRenderbuffer(GL_RENDERBUFFER, rbo);
glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH24_STENCIL8, 800, 600);  
glBindRenderbuffer(GL_RENDERBUFFER, 0);
</code></pre>
<p>把renderbuffer对象附加到帧缓冲的深度和模版附件上：</p>
<pre><code>glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_STENCIL_ATTACHMENT, GL_RENDERBUFFER, rbo);
</code></pre>
<p>所以，为了把场景绘制到一个单独的纹理，我们必须以下面步骤来做：</p>
<ul>
<li>创建并绑定一个新的帧缓冲，并在这个帧缓冲上做相关渲染操作</li>
<li>绑定默认帧缓冲</li>
<li>绘制一个铺满屏幕的四边形，并用新的帧缓冲的颜色缓冲作为输入的纹理</li>
</ul>
<p>以下是每一帧渲染的伪代码：</p>
<pre><code>//First pass
glBindFramebuffer(GL_FRAMEBUFFER, framebuffer);
glClearColor(0.f,0.f,0.f, 1.0f);
glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT);
glEnable(GL_DEPTH_TEST);
DrawScene();

// Second pass
glBindFramebuffer(GL_FRAMEBUFFER, 0); // back to default
glClearColor(1.0f, 1.0f, 1.0f, 1.0f);
glClear(GL_COLOR_BUFFER_BIT);

screenShader.Use();  
glBindVertexArray(quadVAO);
glDisable(GL_DEPTH_TEST);
glBindTexture(GL_TEXTURE_2D, textureColorbuffer);
glDrawArrays(GL_TRIANGLES, 0, 6);
glBindVertexArray(0);
</code></pre>
<h3 id="后处理"><a href="#后处理" class="headerlink" title="后处理"></a>后处理</h3><pre><code>&gt;待续
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2017/02/26/GLSL-Dictionary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2017/02/26/GLSL-Dictionary/" class="post-title-link" itemprop="url">Learning OpenGL：GLSL Shader 手册</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-26 14:26:08" itemprop="dateCreated datePublished" datetime="2017-02-26T14:26:08+08:00">2017-02-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:20:53" itemprop="dateModified" datetime="2017-10-06T22:20:53+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h2><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>void</td>
<td>空类型</td>
</tr>
<tr>
<td>bool</td>
<td>布尔类型</td>
</tr>
<tr>
<td>int</td>
<td>带符号的整数 signed integer</td>
</tr>
<tr>
<td>float</td>
<td>带符号的浮点数 floating scalar</td>
</tr>
<tr>
<td>vec2,vec3,vec4</td>
<td>n维浮点数向量 n-component floating point vector</td>
</tr>
<tr>
<td>bvec2,bvec3,bvec4</td>
<td>n维整数向量 singed integer vector</td>
</tr>
<tr>
<td>bvec2,bvec3,bvec4</td>
<td>n维布尔向量 boolean vector</td>
</tr>
<tr>
<td>ivec2,ivec3,ivec4</td>
<td>n维整数向量 singed integer vector</td>
</tr>
<tr>
<td>mat2,mat3,mat4</td>
<td>2X2,3X3,4X4 浮点数矩阵 float matrix</td>
</tr>
<tr>
<td>sampler2D</td>
<td>2D 纹理  a 2D texture</td>
</tr>
<tr>
<td>samplerCube</td>
<td>盒纹理  cube mapped texture</td>
</tr>
</tbody></table>
<h2 id="基本结构和数组"><a href="#基本结构和数组" class="headerlink" title="基本结构和数组"></a>基本结构和数组</h2><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>结构</td>
<td>struct type-name{} 类似c语言中的结构体</td>
</tr>
<tr>
<td>数组</td>
<td>float foo3[] glsl 只支持1维数组，数组可以是结构体的成员</td>
</tr>
</tbody></table>
<p>##内置的特殊变量</p>
<p>glsl程序使用一些特殊的内置变量与硬件进行沟通。大致分成<code>input</code>,<code>output</code>两种类型，<code>input</code>类型，负责向硬件（渲染管线）发送数据，<code>output</code>类型负责向程序回传数据。</p>
<ul>
<li>在vertex shader中</li>
</ul>
<p>output 类型的内置变量：</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>说明</th>
<th>单位</th>
</tr>
</thead>
<tbody><tr>
<td>highp vec4 gl_Position;</td>
<td>gl_Position 放置顶点坐标信息</td>
<td>vec4</td>
</tr>
<tr>
<td>mediump float gl_Pointsize;</td>
<td>gl_PointSize 需要绘制点的大小（只在gl.POINTS模式下有效）</td>
<td>float</td>
</tr>
</tbody></table>
<ul>
<li>在fragment Shader中：</li>
</ul>
<p>input 类型的内置变量：</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>说明</th>
<th>单位</th>
</tr>
</thead>
<tbody><tr>
<td>mediump vec4 gl_FragCoord;</td>
<td>片元在fragmebuffer画面的相对位置</td>
<td>vec4</td>
</tr>
<tr>
<td>bool gl_FrontFacing</td>
<td>标志当前图元是不是正面图元的一部分</td>
<td>bool</td>
</tr>
<tr>
<td>mediump vec2 gl_PointCoord;</td>
<td>经过插值计算后的纹理坐标，点的范围是0.0到1.0</td>
<td>vec2</td>
</tr>
</tbody></table>
<p>output 类型的内置变量：</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>说明</th>
<th>单位</th>
</tr>
</thead>
<tbody><tr>
<td>mediump vec4 gl_FragColor;</td>
<td>设置当前片点的颜色</td>
<td>vec4</td>
</tr>
<tr>
<td>mediump vec4 gl_FragData[n];</td>
<td>设置当前片点的颜色,使用glDrawBuffers数据数组</td>
<td>vec4</td>
</tr>
</tbody></table>
<p>##内置函数库</p>
<p>###通用函数</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>T abs(T x)</td>
<td>返回x的绝对值</td>
</tr>
<tr>
<td>T sign(T x)</td>
<td>比较x与0的值，大于，等于，小于 分别返回 1.0, 0.0, -1.0</td>
</tr>
<tr>
<td>T floor(T x)</td>
<td>返回 &lt;= x 的最大整数</td>
</tr>
<tr>
<td>T ceil(T x)</td>
<td>返回 &gt;= x 的最小整数</td>
</tr>
<tr>
<td>T fract(T x)</td>
<td>返回 x 的小数部分</td>
</tr>
<tr>
<td>T mod(T x,T y) T mod(T x,float y)</td>
<td>取 x,y 的余数</td>
</tr>
<tr>
<td>T min(T x,T y) T min(T x,float y)</td>
<td>取 x,y 的最小值</td>
</tr>
<tr>
<td>T max(T x,T y) T max(T x,float y)</td>
<td>取 x,y 的最大值</td>
</tr>
<tr>
<td>T clamp(T x,T minVal, T maxVal) T clamp(T x,float minal, float maxVal)</td>
<td>min ( max (x, minVal), maxVal)，返回值限定在minVal,maxVal之间</td>
</tr>
<tr>
<td>T mix(T x,T y, T a) T mix(T x,T y, float a)</td>
<td>取 x,y 的线性混合，x(1-a)+ya</td>
</tr>
<tr>
<td>T step(T edge,T x) T step(float edge,T x)</td>
<td>if x &lt; edge返回0.0， 否则返回1.0</td>
</tr>
<tr>
<td>T smoothstep(T edge,T edge1, T x) T smoothstep(float edge0, float edge1,T x)</td>
<td>if x &lt; edge0返回 0.0，if x &gt; edge1返回1.0， 否则返回Hermite插值</td>
</tr>
</tbody></table>
<h3 id="角度-amp-三角函数"><a href="#角度-amp-三角函数" class="headerlink" title="角度&amp;三角函数"></a>角度&amp;三角函数</h3><p>下文中的类型T可以是float, vec2, vec3, vec4且可以逐分量操作.</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>T radinans(T degrees)</td>
<td>角度转弧度</td>
</tr>
<tr>
<td>T degrees(T radians)</td>
<td>弧度转角度</td>
</tr>
<tr>
<td>T sin(T angle)</td>
<td>正弦函数</td>
</tr>
<tr>
<td>T cos(T angle)</td>
<td>余弦函数</td>
</tr>
<tr>
<td>T tan(T angle)</td>
<td>正切函数</td>
</tr>
<tr>
<td>T asin(T angle)</td>
<td>反正弦函数</td>
</tr>
<tr>
<td>T acos(T angle)</td>
<td>反余弦函数</td>
</tr>
<tr>
<td>T atan(T y, T x) T atan(T y_over_x)</td>
<td>反正切函数</td>
</tr>
</tbody></table>
<h3 id="指数函数"><a href="#指数函数" class="headerlink" title="指数函数"></a>指数函数</h3><p>下文中的类型T可以是float, vec2, vec3, vec4且可以逐分量操作.</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>T pow(T x, T y)</td>
<td>返回x的y次幂</td>
</tr>
<tr>
<td>T exp(T x)</td>
<td>返回x的自然指数幂</td>
</tr>
<tr>
<td>T log(T x)</td>
<td>返回x的自然对数 ln</td>
</tr>
<tr>
<td>T exp2(T x)</td>
<td>返回2的x次幂</td>
</tr>
<tr>
<td>T log2(T x)</td>
<td>返回2位低的对数 log2</td>
</tr>
<tr>
<td>T sqrt(T x)</td>
<td>开根号 √x</td>
</tr>
<tr>
<td>T inversesqrt(T x)</td>
<td>先开根号，在取倒数，</td>
</tr>
</tbody></table>
<h3 id="几何函数"><a href="#几何函数" class="headerlink" title="几何函数"></a>几何函数</h3><p>下文中的类型T可以是float, vec2, vec3, vec4且可以逐分量操作.</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>float length(T x)</td>
<td>返回矢量x的长度</td>
</tr>
<tr>
<td>float distance(T p0,T p1)</td>
<td>返回p0, p1两点的距离</td>
</tr>
<tr>
<td>float dot(T x,T y)</td>
<td>返回x y 的点积</td>
</tr>
<tr>
<td>vec3 cross(vec3 x,vec3 y)</td>
<td>返回x y 的叉积</td>
</tr>
<tr>
<td>vec3 normalize(T y)</td>
<td>对x进行归一化，保持向量方向不变但长度变为1</td>
</tr>
<tr>
<td>vec3 faceforward(T N, T I, T Nref)</td>
<td>根据 矢量 N 与Nref 调整法向量</td>
</tr>
<tr>
<td>vec3 reflect(T I, T N)</td>
<td>返回 I - 2 * dot(N,I) * N, 结果是入射矢量 I 关于法向量N的 镜面反射矢量</td>
</tr>
<tr>
<td>vec3 normalize(T I, T N, float eta)</td>
<td>返回入射矢量I关于法向量N的折射矢量,折射率为eta</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2017/01/29/becoming-steve-jobs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2017/01/29/becoming-steve-jobs/" class="post-title-link" itemprop="url">读书笔记《成为乔布斯》</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-01-29 15:54:14" itemprop="dateCreated datePublished" datetime="2017-01-29T15:54:14+08:00">2017-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-02-15 23:34:44" itemprop="dateModified" datetime="2017-02-15T23:34:44+08:00">2017-02-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Reading-notes/" itemprop="url" rel="index"><span itemprop="name">Reading notes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在接触《成为乔布斯》这本乔布斯人生旅程传记之前，我试过两三次去读官方那本《乔布斯传》，结果都以失败告终；因为《乔布斯传》这本书的内容太过干巴巴，读起来很容易走神。而《成为乔布斯》则不一样，这书是以故事的方式讲述了乔布斯的生平事迹，读起来有趣的多。</p>
<p>其中该书最让我喜欢的地方是，书中讲述了很多我们以前不知道的小细节，小故事。如iTunes是先于iPod就出现的；在2007年第一代iPhone发布之前，乔布斯已经得知自己的癌细胞扩散了，留给他的时间只有五年左右（但我们回头看他在发布会上面的表现，不像是一个知道自己只剩四五年时间的人）。例如iPad这个产品是先于iPhone就出现在了苹果公司中，只不过那时候的iPad和最后上市的iPad是不一样的。还比如库克在乔布斯病危的时候想捐献肝脏给他这一让人感动的场景。</p>
<p>全书主要讲述的是乔布斯从早期和沃滋一起创业，研发个人电脑，到苹果电脑大卖，公司上市；从和沃滋的关系决裂，到Lisa等一系列产品的失败，再到被苹果公司驱逐。从受到Next，打算凭借Next击败评估，到收购皮克斯，并见证了皮克斯生产了动画电影史上重要篇章《玩具总动员》。后来Next被苹果收购，乔布斯回归苹果，收拾其他人留下来的烂摊子。上面的故事离我们比较远，但乔布斯回归苹果之后，也不是立马就做出了具有历史意义的iPhone。回归苹果之后的乔布斯，可以从书中得知，主要的业务还是个人电脑。但乔布斯对事物的敏感度，让他在2000年的时候觉得消费电子领域是一个很有市场的领域。随后苹果公司发布了iTunes，让用户在iTunes上面购买正版音乐。也标志着苹果公司正式进入了个人电子消费市场。后面的故事就是你我比较熟悉的了，iPod让苹果公司great again，苹果公司又成了大众喜欢并愿意花钱消费其产品的公司。然后就是2007年的iPhone一代的发布，真正一款划时代的产品。书中说到这是让乔布斯理想实现的一款产品，因为iPod，iPhone让苹果公司生产的产品不再是一小撮人玩弄的小众产品，而是被大众接受，喜爱，并购买的消费电子产品。而iPhone整个设计上面的美学，在我看来也让整个大众的审美得到了提升。回头看看在iPhone普及之后，我们的电子产品，网站界面，甚至包括家具，汽车等产品的工业设计都受到了苹果产品传达出来的美学影响。苹果的产品真的让生活变得美好了起来。</p>
<p>最后，书名叫《成为乔布斯》，意思不是教大家如何变成乔布斯，而是讲述了乔布斯是如何一步一步成长成为那个被世人奉若神明的史蒂芬。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2016/12/18/opengl-3d-matrix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2016/12/18/opengl-3d-matrix/" class="post-title-link" itemprop="url">OpenGL ES 2.0 3D基础（1）－矩阵</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-18 14:37:53" itemprop="dateCreated datePublished" datetime="2016-12-18T14:37:53+08:00">2016-12-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:24:49" itemprop="dateModified" datetime="2017-10-06T22:24:49+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>移动设备的屏幕是二维平面,要想把一个三维场景渲染在手机二维屏幕上，需要利用OpenGL中的矩阵投射，将三维空间中的点映射到二维平面上。三维矩阵的相关知识是学习OpenGL最重要的课程之一。</p>
<h2 id="线性代数"><a href="#线性代数" class="headerlink" title="线性代数"></a>线性代数</h2><p>学习OpenGL三维投射知识之前，我们得事先了解下一些基础的线性代数知识，如向量运算，矩阵运算。</p>
<h3 id="向量运算"><a href="#向量运算" class="headerlink" title="向量运算"></a>向量运算</h3><p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F">向量</a>: 指一个同时具有大小和方向的几何对象，因常常以箭头符号表示以区别于其它量而得名。</p>
<h4 id="向量加减"><a href="#向量加减" class="headerlink" title="向量加减"></a>向量加减</h4><p>向量的加（减）法定义是分量的相加（减），即将一个向量中的每一个分量加上（减去）另一个向量的对应分量：</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_01.png"></p>
<h4 id="向量相乘"><a href="#向量相乘" class="headerlink" title="向量相乘"></a>向量相乘</h4><h5 id="点乘"><a href="#点乘" class="headerlink" title="点乘"></a>点乘</h5><p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_02.png"></p>
<h4 id="叉乘"><a href="#叉乘" class="headerlink" title="叉乘"></a>叉乘</h4><p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_03.png"></p>
<h3 id="矩阵运算"><a href="#矩阵运算" class="headerlink" title="矩阵运算"></a>矩阵运算</h3><h4 id="矩阵简介"><a href="#矩阵简介" class="headerlink" title="矩阵简介"></a>矩阵简介</h4><p>数学上，一个  m x n 的矩阵是一个m行n列元素排列成的矩形阵列。以下是一个由6个数字元素构成的3行3列的矩阵：</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_04.png"></p>
<h4 id="矩阵运算规则"><a href="#矩阵运算规则" class="headerlink" title="矩阵运算规则"></a>矩阵运算规则</h4><h5 id="矩阵的加减"><a href="#矩阵的加减" class="headerlink" title="矩阵的加减"></a>矩阵的加减</h5><p>矩阵与标量之间的加减：</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_05.png"></p>
<p>矩阵与矩阵之间的加减：<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_06.png"></p>
<h5 id="矩阵乘法"><a href="#矩阵乘法" class="headerlink" title="矩阵乘法"></a>矩阵乘法</h5><ul>
<li><p>矩阵数乘<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_07.png"></p>
</li>
<li><p>矩阵相乘<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_08.png"></p>
</li>
</ul>
<h4 id="单位矩阵"><a href="#单位矩阵" class="headerlink" title="单位矩阵"></a>单位矩阵</h4><p>在OpenGL中，由于大部分的向量都是4分量 （x,y,z,w）,所以我们通常使用 4x4 的变换矩阵。当中最简单的变换矩阵是单位矩阵。单位矩阵是一个除了对角线以外都是0的NxN矩阵。</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_09.png"></p>
<p>单位矩阵通常是生成其他变换矩阵的起点。</p>
<h4 id="缩放矩阵"><a href="#缩放矩阵" class="headerlink" title="缩放矩阵"></a>缩放矩阵</h4><p>对一个向量进行缩放指的是对向量的长度进行缩放，而保持它的方向不变。</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_11.png"></p>
<h4 id="位移矩阵"><a href="#位移矩阵" class="headerlink" title="位移矩阵"></a>位移矩阵</h4><p>位移是在原始向量的基础上加上另一个向量从而获得一个在不同位置的新向量的过程，从而在位移向量基础上移动原始向量。<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_12.png"></p>
<h4 id="旋转矩阵"><a href="#旋转矩阵" class="headerlink" title="旋转矩阵"></a>旋转矩阵</h4><p>（Rx,Ry,Rz）代表任意旋转轴，θ是角度：<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_16.png"></p>
<h5 id="累积变换"><a href="#累积变换" class="headerlink" title="累积变换"></a>累积变换</h5><p>上面接受啊了如何旋转，平移和缩放向量。把这些矩阵相乘组合起来如下：</p>
<pre><code>TransformedVector = TranslationMatrix * RotationMatrix * ScaleMatrix * OriginalVector;
</code></pre>
<p>这行代码首先执行缩放，接着旋转，最后才是平移</p>
<h2 id="坐标系统"><a href="#坐标系统" class="headerlink" title="坐标系统"></a>坐标系统</h2><p>OpenGL在每次顶点着色器运行后，所有顶点都为标准化设备坐标，每个顶点（x,y,z）都应该在-1.0d到1.0之间。通常情况下，我们会根据画布（屏幕）的大小设定一个坐标范围，在顶点着色器中将这些坐标转换为标准化设备坐标。在项目中，物体坐标最终被转化为屏幕坐标之前会变换到多个坐标系统，因为在相应的过度坐标系中做特定运算会方便容易一些。对我们来讲，一般情况下需要用到5个不同的坐标系统：</p>
<ul>
<li><p>局部空间（Local Space）：物体起始坐标；如一个正方体a，原点是正方体的中心O1（0，0，0）。</p>
</li>
<li><p>世界空间（World Space）：物体在更大的空间范围的坐标；如我们构造了一个圆球来表示世界,圆心为世界坐标原点O2，把正方体放在圆球中t(x1,y1,z1)位置。那么正方体a的圆心O1在世界系统会转化为（x1,y1,z1）。物体的坐标从局部坐标变换到是世界坐标由模型矩阵（Model Matrix）负责实现。</p>
<blockquote>
<p>模型矩阵是一种变换矩阵，能对物体进行位移，缩放，旋转。</p>
</blockquote>
</li>
<li><p>观察空间（View Space）: 观察空间是将世界坐标转化为用户视野前方的坐标。一般用一个观察矩阵（View Matrix）来完成转换。</p>
</li>
<li><p>裁剪空间（Clip Space）：顶点着色器运行到最后，OpenGL期望所有的坐标落在一个特定的范围内，且任何在这个范围之外的点会被裁剪掉。为了将顶点坐标从观察变换成裁剪空间，需定义一个投影矩阵（Projection Matrix），它指定一个范围的坐标，比如每个维度上的 -100 到 100。投影矩阵会将在这个指定范围内的坐标变换为标准化设备坐标的范围（-1。0，1.0）。使用投影矩阵能将3D坐标投影到2D的标准化设备坐标系中。</p>
</li>
</ul>
<p>将观察坐标变换为裁剪坐标的投影矩阵分为两种不同的形式：正交投影矩阵（Orthographic Projection Matrix），透视投影矩阵（Perspective Projection Matrix）。</p>
<ul>
<li>屏幕空间（Screen Space）</li>
</ul>
<h3 id="正交投影（Orthographic-Projection）"><a href="#正交投影（Orthographic-Projection）" class="headerlink" title="正交投影（Orthographic Projection）"></a>正交投影（Orthographic Projection）</h3><p>正交投影矩阵定义一个立方体的平截头箱，在这个立方体之外的顶点都会被裁剪掉。</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_18.png"></p>
<p>正交投影矩阵直接将坐标映射到2D平面上。不过正交投影没有透视效果，远处箱子和近处箱子投射到平面上是一样大的，这和我们日常生活中看东西时近大远小的视觉效果是不符的。要解决这个问题，我们需要用到透视投影。</p>
<p>###透视投影（Perspective Projection）</p>
<p>透视投影定义一个大平截头体。透视投影有两种表述方式：</p>
<ul>
<li>视锥体：</li>
</ul>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_19.png"></p>
<p>glFrustum (left, right, bottom, top, zNear, zFar);</p>
<p>left,right,bottom,top定义near裁剪面大小，zNear和zFar定义从观察点到远近两个裁剪面的距离。这六个参数定义出六个裁剪面构成的视锥体。</p>
<ul>
<li>透视图：</li>
</ul>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_20.png"></p>
<p>gluPerspective(fovy, aspect, zNear, zFar);</p>
<ul>
<li>fovy: camera 在 y 方向上的视线角度（0~180)</li>
<li>aspect定义近截面的宽高比 aspect=w/h</li>
<li>zNear, zFar: 观察点到远近两个裁剪面的距离</li>
</ul>
<p> 透视体参数转换车过视锥体参数：</p>
<pre><code>    tan(fovy/2) = (h / 2)/zNear -&gt; h; 
    w =  h * aspect -&gt; w;
</code></pre>
<h3 id="矩阵组合"><a href="#矩阵组合" class="headerlink" title="矩阵组合"></a>矩阵组合</h3><p>基于前面介绍的4个变换矩阵：模型矩阵，世界矩阵，观察矩阵和投影矩阵。一个顶点坐标将会根据以下过程变换到裁剪坐标：</p>
<pre><code>Vclip=Mprojection⋅Mview⋅Mmodel⋅Vlocal
</code></pre>
<blockquote>
<p>注意矩阵运算的顺序是从右往左阅读，最终计算出来的顶点赋值给<code>gl_Position</code></p>
</blockquote>
<h2 id="3D-Demo"><a href="#3D-Demo" class="headerlink" title="3D Demo"></a>3D Demo</h2><p>至此我们了解了OpenGL 3D渲染中需要知道的矩阵知识，运用这些知识，便可进行开发OpenGL3D程序了；苹果官方提供一个很好的GL demo <a target="_blank" rel="noopener" href="https://developer.apple.com/library/content/samplecode/GLEssentials/Introduction/Intro.html">GLEssentials</a></p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_21.png"></p>
<h2 id="结束"><a href="#结束" class="headerlink" title="结束"></a>结束</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2016/12/11/2016-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2016/12/11/2016-summary/" class="post-title-link" itemprop="url">2016年度总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-11 14:56:52" itemprop="dateCreated datePublished" datetime="2016-12-11T14:56:52+08:00">2016-12-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:20:06" itemprop="dateModified" datetime="2017-10-06T22:20:06+08:00">2017-10-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="娱乐"><a href="#娱乐" class="headerlink" title="娱乐"></a>娱乐</h3><p><strong>年度电影</strong></p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/25895901/">海街日记</a><img src="https://img3.doubanio.com/view/photo/photo/public/p2283110641.jpg"  style="width: 120px;"/></p>
<p><strong>年度歌曲</strong> </p>
<p><a target="_blank" rel="noopener" href="http://music.163.com/#/song?id=29724295">热河</a></p>
<p><img src="
http://img.xiami.net/images/album/img94/7194/14157293421415729342_2.jpg"  style="width: 120px;"/></p>
<p><strong>年度美剧</strong></p>
<p><a target="_blank" rel="noopener" href="https://movie.douban.com/subject/3016187/">Game of Thrones</a></p>
<img src="https://img1.doubanio.com/view/movie_poster_cover/lpst/public/p896064368.jpg"  style="width: 120px;"/>

<p><strong>年度书籍</strong></p>
<p><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26576861/">最好的告别</a></p>
<img src="https://img3.doubanio.com/lpic/s28355811.jpg"  style="width: 120px;"/>

<p><strong>年度Podcast</strong></p>
<p><a target="_blank" rel="noopener" href="https://ipn.li/taiyilaile/">太医来了</a></p>
<img src="https://pic4.zhimg.com/8746e3b32e6afbf06eda1a4d69d2bb5b_xl.jpg"  style="width: 80px;"/>

<p><strong>年度电视节目</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.iqiyi.com/a_19rrgifngp.html">晓松奇谈</a></p>
<img src="http://pic0.qiyipic.com/common/lego/20160104/f6e30204caa345508edd843c182ad7c6.jpg"  style="width: 240px;"/>


<h3 id="体育"><a href="#体育" class="headerlink" title="体育"></a>体育</h3><p><strong>年度NBA比赛</strong></p>
<p>15-16赛季，西部决赛第七场</p>
<p>金州勇士-俄克拉何马城雷霆</p>
<p><img src="https://upload.wikimedia.org/wikipedia/zh/0/0f/Golden_State_Warriors_logo.png" style="width: 120px;"/> <img src="https://upload.wikimedia.org/wikipedia/zh/f/f6/OKC_Thunder.png" style="width: 120px;"/></p>
<p><strong>年度足球比赛</strong></p>
<p>15欧锦赛 1/4 决赛：德国-意大利</p>
<p><img src="https://upload.wikimedia.org/wikipedia/zh/thumb/e/e3/DFBEagle.svg/400px-DFBEagle.svg.png" style="width: 120px;"/>  <img src="https://upload.wikimedia.org/wikipedia/zh/thumb/9/97/FIGC_logo.svg/207px-FIGC_logo.svg.png" style="width: 120px;"/></p>
<h3 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h3><p><strong>年度编程语言</strong></p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/OpenGL">OpenGL</a></p>
<img src="https://www.opengl.org/img/opengl_logo.png" style="width: 180px;">


<p><strong>年度App</strong></p>
<p><a target="_blank" rel="noopener" href="https://itunes.apple.com/us/app/msqrd-live-filters-face-swap/id1065249424?mt=8">MSQRD</a></p>
<img src="http://is5.mzstatic.com/image/thumb/Purple71/v4/78/76/b3/7876b386-4821-5fb0-8e98-a524bd3dec14/source/630x630bf.jpg" style="width: 120px;">

<p><strong>年度开源项目</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/BradLarson/GPUImage.git">GPUImage</a></p>
<p><strong>年度工具</strong></p>
<p>macOS / iOS 备忘录</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2016/11/07/ffmpeg-command-example/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2016/11/07/ffmpeg-command-example/" class="post-title-link" itemprop="url">ffmpeg 使用例程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-11-07 21:03:47" itemprop="dateCreated datePublished" datetime="2016-11-07T21:03:47+08:00">2016-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:20:40" itemprop="dateModified" datetime="2017-10-06T22:20:40+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文介绍<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/FFmpeg">ffmpeg</a>命令行的一些使用方法；</p>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><h3 id="主要参数"><a href="#主要参数" class="headerlink" title="主要参数"></a>主要参数</h3><ul>
<li>-i——设置输入档名。</li>
<li>-f——设置输出格式。</li>
<li>-y——若输出文件已存在时则覆盖文件。</li>
<li>-fs——超过指定的文件大小时则结束转换。</li>
<li>-ss——从指定时间开始转换。</li>
<li>-t从-ss时间开始转换（如-ss 00:00:01.00 -t 00:00:10.00即从00:00:01.00开始到00:00:11.00）。</li>
<li>-title——设置标题。</li>
<li>-timestamp——设置时间戳。</li>
<li>-vsync——增减Frame使影音同步。<h3 id="视频参数"><a href="#视频参数" class="headerlink" title="视频参数"></a>视频参数</h3></li>
<li>-b:v——设置视频流量，默认为200Kbit/秒。（单位请引用下方注意事项）</li>
<li>-r——设置帧率值，默认为25。</li>
<li>-s——设置画面的宽与高。</li>
<li>-aspect——设置画面的比例。</li>
<li>-vn——不处理视频，于仅针对声音做处理时使用。</li>
<li>-vcodec( -c:v )——设置视频视频编解码器，未设置时则使用与输入文件相同之编解码器。<h3 id="声音参数"><a href="#声音参数" class="headerlink" title="声音参数"></a>声音参数</h3></li>
<li>-b:a——设置每Channel（最近的SVN版为所有Channel的总合）的流量。（单位请引用下方注意事项）</li>
<li>-ar——设置采样率。</li>
<li>-ac——设置声音的Channel数。</li>
<li>-acodec ( -c:a ) ——设置声音编解码器，未设置时与视频相同，使用与输入文件相同之编解码器。</li>
<li>-an——不处理声音，于仅针对视频做处理时使用。</li>
<li>-vol——设置音量大小，256为标准音量。（要设置成两倍音量时则输入512，依此类推。）</li>
</ul>
<p>##例子</p>
<p>不过在使用中可能需要用一些不常用的命令行去做一些视频编辑的功能，如下几个例子：</p>
<h3 id="裁剪视频"><a href="#裁剪视频" class="headerlink" title="裁剪视频"></a>裁剪视频</h3><p>比如有一个横向视频,分辨率是1280X720，如果指向保留中间的405*720部分，可以使用下面的命令：</p>
<pre><code>ffmpeg -i input.mp4  -strict -2 -vf crop=405:720:420:0  video_out.mp4
</code></pre>
<p>其中的crop=405:720:420:0 裁剪参数，具体含义是：crop=width:height:x:y.其中 width和height便是裁剪后的尺寸，x:y  表示裁剪区域的左上角坐标。</p>
<h3 id="视频转换成图片"><a href="#视频转换成图片" class="headerlink" title="视频转换成图片"></a>视频转换成图片</h3><pre><code> ffmpeg -i input.mp4 image%3d.png
</code></pre>
<p>也可以指定视频导出的图片的帧率，（1s的视频生成的图片的个数）</p>
<pre><code> ffmpeg -i input.mp4 -r 30  $filename%3d.png  
</code></pre>
<p>其中 <code>-r 30</code> 是视频帧率，如何获取当前视频的帧率，请看如下命令：</p>
<pre><code>ffprobe &quot;input.mp4&quot; -v 0 -select_streams v  -print_format flat -show_entries stream=r_frame_rate 
</code></pre>
<h3 id="剪辑视频"><a href="#剪辑视频" class="headerlink" title="剪辑视频"></a>剪辑视频</h3><p>一段长视频只需要保留其中一段，可用如下命令：</p>
<pre><code>ffmpeg -i input.mp4 -ss 00:00:21 -t 00:00:10 -acodec aac -vcodec h264 -strict -2 out.mp4
</code></pre>
<p>其中 <code>-ss 00:00:21</code> 表示开始剪辑的位置（时间点）， <code>-t 00:00:10</code> 表示剪辑的长度，即10秒钟。</p>
<h3 id="调整视频分辨率大小"><a href="#调整视频分辨率大小" class="headerlink" title="调整视频分辨率大小"></a>调整视频分辨率大小</h3><p>一段视频尺寸是1080p（即1920*1080px， 16:9），使用下面命令转换成 480p：</p>
<pre><code>ffmpeg -i input.mp4 -vf scale=853:480 -acodec aac -vcodec h264 out.mp4
</code></pre>
<ul>
<li><code>-vf scale=853:480</code> vf 参数用于指定视频滤镜，其中scale表示缩放，863*480是480p视频的在保持16:9宽高比下的分辨率</li>
<li><code>-vcodec h264</code> 指定视频使用 h264 编码。<blockquote>
<p>目前收集一般拍摄视频的格式为 mov 或 mp4,两者的音频编码都是 aac， 视频编码是 h264.</p>
</blockquote>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2016/10/26/28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2016/10/26/28/" class="post-title-link" itemprop="url">活到28</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-10-26 23:49:23" itemprop="dateCreated datePublished" datetime="2016-10-26T23:49:23+08:00">2016-10-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-10-30 13:45:59" itemprop="dateModified" datetime="2016-10-30T13:45:59+08:00">2016-10-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>信则有，不信则无</code>-这句话带有非常强烈的主观臆断色彩。我不认同这句话中携带的<code>我思故我在</code>式的思维模式，但不可否认在特定条件下，这句话会对一个人起到良好的心理按摩作用。</p>
<p>就个人而言，学习OpenGL编程是一个难度相对大的技术。也许是因为没有学习过计算机图形学，在学习OpenGL编程期间，会遇到各种不懂的名词概念：<code>着色器</code>，<code>光栅化</code>，<code>纹理</code>，<code>帧缓存</code>；OpenGL本身的状态机也不是很好理解；加上不友好的开发工具链（无法打印GPU数据，OpenGL crash堆栈信息很少）。这三点导致学习OpenGL是一门入门难度比较大，学习曲线陡峭的技术。刚开始的时候，困难的确比较多，很容易失去信心；这个时候，如果对自己说一句<code>信则有</code>，相信这东西自己是可以学出来。坚持持续不断的看教程，动手试错，最终是可以学出来的。</p>
<p>同样，在学习蛙泳的时候，在升职答辩的时候，在健身的时候，在极限运动的时候；面对深水区的恐惧，主考官的质问，肌肉的酸痛，呼吸的急促，死亡的恐惧。我们需要鼓起勇气，运用我们一直练习的学习技巧，观察别人怎么做的，思考自己哪里做的不对，不停的模仿，不断的试错重来，不怕失败，自信每次都会有所进步，最终能够扛过这座山。</p>
<p>如果说在28岁生日这一天，回顾过去一年，我有什么收获的话，</p>
<blockquote>
<p>“立志不坚，终不济事。” –（宋）朱熹</p>
</blockquote>
<p>这句话是我最大的收获。</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="http://music.163.com/outchain/player?type=2&id=16148113&auto=1&height=66"></iframe>

<blockquote>
<p>对了，如果实在找不到信心的话，就这样想：”这么多人都行，我怎么可能不行”。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2016/10/22/install-caffe-on-macosx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2016/10/22/install-caffe-on-macosx/" class="post-title-link" itemprop="url">如何在Macosx上安装caffe</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-10-22 12:55:05" itemprop="dateCreated datePublished" datetime="2016-10-22T12:55:05+08:00">2016-10-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-03-02 17:54:42" itemprop="dateModified" datetime="2019-03-02T17:54:42+08:00">2019-03-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在macosx上面安装深度学习框架<a target="_blank" rel="noopener" href="http://caffe.berkeleyvision.org/">caffe</a>是个相对比较麻烦的过程。如果根据caffe项目的install_osx文件指引去安装，会遇到一些问题。所以我决定把自己的安装过程记录下来。</p>
<p><strong>硬软件环境</strong></p>
<blockquote>
</blockquote>
<pre><code>电脑：iMac
系统：OX EI Caption 版本10.11.4
</code></pre>
<h2 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h2><p>官方推荐使用<a target="_blank" rel="noopener" href="http://brew.sh/">Homebrew</a>来管理依赖项的下载，安装。</p>
<p>##Anaconda Python<br>Anaconda是python的一个常用的科学计算发行版，自带包管理器conda。从 <a target="_blank" rel="noopener" href="https://store.continuum.io/cshop/anaconda/">https://store.continuum.io/cshop/anaconda/</a> 下载并安装Anaconda Python。安装成功之后,记得在PATH添加ananconda执行文件的路径：</p>
<pre><code>export PATH=~/anaconda/bin:$PATH
</code></pre>
<h2 id="CUDA"><a href="#CUDA" class="headerlink" title="CUDA"></a>CUDA</h2><p>从 <a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a> 下载并安装CUDA 8.0 (for OSX)<br>从 <a target="_blank" rel="noopener" href="http://www.nvidia.com/object/mac-driver-archive.html">http://www.nvidia.com/object/mac-driver-archive.html</a> 下载并安装最新的CUDA独立驱动。<br>同样我们把驱动的可执行文件路径添加到PATH环境变量中(注意下载安装的CUDA的版本号)：</p>
<pre><code>export PATH=/Developer/NVIDIA/CUDA-8.0/bin/$PATH
export DYLD_LIBRARY_PATH=/Developer/NVIDIA/CUDA-8.0/lib:$DYLD_LIBRARY_PATH
</code></pre>
<h2 id="BLAS"><a href="#BLAS" class="headerlink" title="BLAS"></a>BLAS</h2><p>网上搜索到的教程中都是使用<a target="_blank" rel="noopener" href="https://software.intel.com/en-us/intel-mkl">Intel MKL</a>，查看网站会发现intel-mkl收费很贵，所以我安装的时候选择了<a href="www.openblas.net/">OpenBLAS</a></p>
<pre><code>brew install openblas
</code></pre>
<blockquote>
<p>关于 intel-mkl 和 openblas 的优劣，没有做过比较。在校大学生可通过学校邮箱在页面 <a target="_blank" rel="noopener" href="https://software.intel.com/en-us/qualify-for-free-software/student">https://software.intel.com/en-us/qualify-for-free-software/student</a> 申请安装包。</p>
</blockquote>
<p>##cuDNN</p>
<p>从 <a target="_blank" rel="noopener" href="https://developer.nvidia.com/cudnn">https://developer.nvidia.com/cudnn</a> 页面下载并安装cuDNN库,安装过程如下：</p>
<pre><code>tar -xzvf cudnn-8.0-osx-x64-v5.1.tgz
cd cuda
sudo cp lib/* /usr/local/cuda/lib
sudo cp include/cudnn.h /usr/local/cuda/include/
</code></pre>
<p>##安装依赖项 via Homebrew</p>
<p>首先我们需要修改下homebrew安装 opencv 时需要用到的opencv.rb文件</p>
<pre><code>brew edit opencv
</code></pre>
<p>将下面两行：</p>
<pre><code>args &lt;&lt; &quot;-DPYTHON_LIBRARY=#&#123;py_lib&#125;/libpython2.7.#&#123;dylib&#125;&quot;
args &lt;&lt; &quot;-DPYTHON_INCLUDE_DIR=#&#123;py_prefix&#125;/include/python2.7&quot;
</code></pre>
<p>替换为：</p>
<pre><code>args &lt;&lt; &quot;-DPYTHON_LIBRARY=#&#123;py_prefix&#125;/lib/libpython2.7.dylib&quot;
args &lt;&lt; &quot;-DPYTHON_INCLUDE_DIR=#&#123;py_prefix&#125;/include/python2.7&quot;
</code></pre>
<p>然后开始安装依赖项：</p>
<pre><code>brew install --fresh -vd snappy leveldb gflags glog szip lmdb homebrew/science/opencv
brew install --build-from-source --with-python --fresh -vd protobuf
brew install --build-from-source --fresh -vd boost boost-python
brew install hdf5
</code></pre>
<blockquote>
<p>安装过程有点漫长，可能会出现一些错误，需要耐心的修复掉。<br>如果你把电脑升级到最新的 macOS Sierra 10.12，会由于新系统不内置QTKit导致opencv编译失败。</p>
</blockquote>
<p>##下载Caffe代码</p>
<pre><code>git clone https://github.com/BVLC/caff.git
cd caffe
cp Makefile.config.example Makefile.config
</code></pre>
<p>##Makefile.config</p>
<p>修改Makefile.config</p>
<pre><code>BLAS:=open
BLAS_INCLUDE := $(shell brew --prefix openblas)/include
BLAS_LIB := $(shell brew --prefix openblas)/lib
</code></pre>
<p>取消CUDDNN的注释</p>
<pre><code>USE_CUDNN := 1
</code></pre>
<p>检查设置Python路径</p>
<pre><code># NOTE: this is required only if you will compile the python interface.
# We need to be able to find Python.h and numpy/arrayobject.h.
# PYTHON_INCLUDE := /usr/include/python2.7 \
#         /usr/lib/python2.7/dist-packages/numpy/core/include
# Anaconda Python distribution is quite popular. Include path:
# Verify anaconda location, sometimes it&#39;s in root.
# ANACONDA_HOME := $(HOME)/anaconda
# PYTHON_INCLUDE := $(ANACONDA_HOME)/include \
        # $(ANACONDA_HOME)/include/python2.7 \
        # $(ANACONDA_HOME)/lib/python2.7/site-packages/numpy/core/include \

ANACONDA_HOME := $(HOME)/anaconda
PYTHON_INCLUDE := $(ANACONDA_HOME)/include \
$(ANACONDA_HOME)/include/python2.7 \
$(ANACONDA_HOME)/lib/python2.7/site-packages/numpy/core/include \


# Uncomment to use Python 3 (default is Python 2)
# PYTHON_LIBRARIES := boost_python3 python3.5m
# PYTHON_INCLUDE := /usr/include/python3.5m \
#                 /usr/lib/python3.5/dist-packages/numpy/core/include

# We need to be able to find libpythonX.X.so or .dylib.
# PYTHON_LIB := /usr/lib
PYTHON_LIB := $(ANACONDA_HOME)/lib

# Homebrew installs numpy in a non standard path (keg only)
PYTHON_INCLUDE += $(dir $(shell python -c &#39;import numpy.core; print(numpy.core.__file__)&#39;))/include
PYTHON_LIB += $(shell brew --prefix numpy)/lib
</code></pre>
<p>##环境变量</p>
<pre><code>export DYLD_FALLBACK_LIBRARY_PATH=/usr/local/cuda/lib:/Users/cp/anaconda/lib:/usr/local/lib:/usr/local/Cellar/:/usr/local/cuda/lib:~/anaconda/lib:/usr/local/lib:/usr/lib:$DYLD_FALLBACK_LIBRARY_PATH
</code></pre>
<p>##编译caffe<br>    make clean<br>    make all -j8<br>    make runtest</p>
<p>runtest 相对会花些时间</p>
<pre><code>make pycaffe
make distribute
</code></pre>
<p>就大功告成了</p>
<p>##References:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://caffe.berkeleyvision.org/installation.html">http://caffe.berkeleyvision.org/installation.html</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/BVLC/caffe/wiki/Installation-%28OSX%29">https://github.com/BVLC/caffe/wiki/Installation-%28OSX%29</a></li>
<li><a target="_blank" rel="noopener" href="http://hoondy.com/2015/04/03/how-to-install-caffe-on-mac-os-x-10-10-for-dummies-like-me/">http://hoondy.com/2015/04/03/how-to-install-caffe-on-mac-os-x-10-10-for-dummies-like-me/</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2016/09/25/2016-1st-half/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2016/09/25/2016-1st-half/" class="post-title-link" itemprop="url">2016上半年电影，美剧，以及书 清单</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-09-25 23:05:21" itemprop="dateCreated datePublished" datetime="2016-09-25T23:05:21+08:00">2016-09-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:19:51" itemprop="dateModified" datetime="2017-10-06T22:19:51+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Movie/" itemprop="url" rel="index"><span itemprop="name">Movie</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="电影"><a href="#电影" class="headerlink" title="电影"></a>电影</h2><h3 id="中国"><a href="#中国" class="headerlink" title="中国"></a>中国</h3><ul>
<li><p>饮食男女</p>
</li>
<li><p>喜宴</p>
</li>
<li><p>推手</p>
<blockquote>
<p>李安“父亲”三部曲；在三部电影里面，饰演男主角的郎雄，都给人一种很亲切的感觉，让人很喜爱这老头儿。最喜欢《饮食男女》中吴倩莲饰演的二姐，走在最先锋的人，却最终选择了守住传统。</p>
</blockquote>
</li>
<li><p>北京遇上西雅图之不二情书</p>
<blockquote>
<p>加分的是那对老夫妇，以及老爷子身上的文人气质</p>
</blockquote>
</li>
<li><p>寒战2</p>
<blockquote>
<p>梁sir还是那么棒</p>
</blockquote>
</li>
<li><p>使徒行者</p>
</li>
<li><p>火锅英雄</p>
</li>
<li><p>老炮儿</p>
</li>
</ul>
<h3 id="日本"><a href="#日本" class="headerlink" title="日本"></a>日本</h3><ul>
<li><p>步伐不停</p>
<blockquote>
<p>平淡的，生活化的，舍不得结束的</p>
</blockquote>
</li>
<li><p>海街日记</p>
<blockquote>
<p>依旧是平淡的，生活化的，舍不得结束的</p>
</blockquote>
</li>
<li><p>怪物之子</p>
</li>
</ul>
<h3 id="美国"><a href="#美国" class="headerlink" title="美国"></a>美国</h3><ul>
<li><p>谍影重重5</p>
<blockquote>
<p>熟悉的伯恩回来了，但感觉整个的电影的高潮部分是在希腊街头的那段追杀。</p>
</blockquote>
</li>
<li><p>火星救援</p>
<blockquote>
<p>最爱马特呆萌种土豆那一段</p>
</blockquote>
</li>
<li><p>十二怒汉</p>
<blockquote>
<p>剧情精彩，回味无穷 </p>
</blockquote>
</li>
<li><p>生为蓝调</p>
<blockquote>
<p>冲着伊桑霍克看的</p>
</blockquote>
</li>
<li><p>功夫熊猫3</p>
</li>
<li><p>疯狂动物城</p>
</li>
<li><p>蝙蝠侠大战超人：正义黎明</p>
</li>
<li><p>奇幻森林</p>
</li>
<li><p>美国队长3</p>
</li>
<li><p>泰山归来：险战丛林</p>
</li>
<li><p>九条命</p>
</li>
<li><p>X战警：天启</p>
</li>
<li><p>硬核亨利</p>
</li>
</ul>
<p>###韩国</p>
<ul>
<li>哭声<blockquote>
<p>看完堵得慌</p>
</blockquote>
</li>
</ul>
<h2 id="美剧"><a href="#美剧" class="headerlink" title="美剧"></a>美剧</h2><ul>
<li><p>毒枭第二季</p>
<blockquote>
<p>和第一季一样，还是那个魔幻的哥伦比亚</p>
</blockquote>
</li>
<li><p>权利的游戏第六季</p>
<blockquote>
<p>私生子之战，我看了三遍了</p>
</blockquote>
</li>
<li><p>绝命律师第二季</p>
<blockquote>
<p>好看，推荐</p>
</blockquote>
</li>
<li><p>黑客军团第二季</p>
<blockquote>
<p>强迫症让我看完了第二季，应该会看第三季</p>
</blockquote>
</li>
<li><p>怪奇物语</p>
<blockquote>
<p>为了拍第二季，第一季的结尾让人不适，不打算看第二季</p>
</blockquote>
</li>
</ul>
<h2 id="书"><a href="#书" class="headerlink" title="书"></a>书</h2><ul>
<li>《你是一切的答案》</li>
<li>《程序员的思维锻炼》<blockquote>
<p><a target="_blank" rel="noopener" href="http://cp0000.github.io/2016/06/11/pragmatic-thinking-and-learning/">读书笔记</a></p>
</blockquote>
</li>
</ul>
<blockquote>
<p>没写评论的，在我看来是可看可不看的</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2016/07/30/shanghai-4-years/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2016/07/30/shanghai-4-years/" class="post-title-link" itemprop="url">五年，四年</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-07-30 14:35:05" itemprop="dateCreated datePublished" datetime="2016-07-30T14:35:05+08:00">2016-07-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-08-27 01:03:52" itemprop="dateModified" datetime="2016-08-27T01:03:52+08:00">2016-08-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <img src="http://cp0000.github.io/assets/lights.jpg" alt="lights"/>

<p>2012年端午节前的一个礼拜，我买了张从南宁到上海的火车票,只身一人来到上海。</p>
<p>两个礼拜前我从广州的一家公司辞职。这家广州公司在南宁有一个更小的办公室，我11年刚毕业的时候找不到很好的工作，就先去那个小办公室上班；那时我和大学室友在公司附近一起租了一套房子，房主是戒毒所医生，一个个子小小的，为人和蔼的南宁阿姨；同年10月份，我被派去广州出差，那是我第一次去发达省份，第一次坐地铁，也第一次感受到大城市竞争的残酷性。不过那时我以为自己年底还会回南宁继续上班，所以还留了一些杂物在南宁，租的房子也没有退。</p>
<p>没想到，再次回南宁的时候，已经是决定离开这座城市了。我在南宁大概呆了一个多礼拜，见了南宁办公室的同事，并和他们一起去了趟北海玩了两天，那是我第二次去北海。在北海的两天，我和蒙哥（南宁办公室的老大）一起住的一个标准间，夜里我们七七八八聊了一些；我只记得他跟我讲了他在IBM当销售的时候是怎么搞定客户的故事，和他对未来的一些打算，似乎有挽留之意，我含糊中转移了话题。从北海回南宁后，约了几个大学同学聚餐，地点在西大后面农院路的街头。尔后退了房子，收拾好行李，临走的前一天，我一个人去西大走了走，看了看。然后搭上火车，和这个呆了四年多的城市道别了。</p>
<p>刚来上海的头两个礼拜，我借住在朋友那里；朋友住在他自己租在桂林路地铁站附近的一间小屋子里；那个小格子间是我经历过的条件最艰苦的住宿环境，小小的隔间，只有四五平方米，屋子里还臭气一阵阵。那段时间，我疯狂的投简历，只要人家约我去面试，我都要跑去试试看，一心想把自己买一个好价钱。最终，我去到上家公司上班，公司叫 yeecco。找好工作之后，我从朋友的小隔间里面搬了出来。我无意冒犯这位朋友，只是觉得人应该对自己好一点，那样的住宿环境现在想起来我都会觉得难受。</p>
<p>新租的房子在淞虹路地铁站附近，隔壁住的是一对刚毕业的情侣。有了工作和住的地方，我稍微定心了些，没有刚来的时候那么惶恐。</p>
<p>那段日子，早上我从淞虹路坐地铁到静安寺上班。半个小时拥挤的地铁中，我会看一会书；印象中看的是稻盛和夫的《活法》。这本书可能会被现在的人诟病，但对一个初来乍到，在这个都市一个帮手都没有的人来讲，不失为一本很好的精神慰藉。它让我把所有的精力都放在新工作上，让我不要多想，做好眼前事，明日事明日议。</p>
<p>新工作并不容易，公司做的项目是 <a target="_blank" rel="noopener" href="https://github.com/morningtec/StellaSDK">StellaSDK</a>，对于当时的我来讲，项目中大多数知识是我没接触过的，很多东西无从下手。那段时间，我拼命学习，工作。经常会在地铁里面，思考到某个点，恨不能马上拿电脑验证一下；又会因为某个问题没思路解决不了，导致压力太大吃不下饭。但回过头来看，那段经历对自己编程技术的提升帮助很大，让我养成了很好的学习新技术的习惯和方法，不畏惧任何不懂的技术领域。我很感激老大wenqi，那时候他对我也很好（一个会夜里开车送你回家的老大不是那么的常见），我的技术，习惯，思考方式，以及保持勤奋全都是从他身上学得，非常感激他。</p>
<p>后来，由于一些原因我离开了上家公司，来到了腾讯。如今，算算我已经毕业五年，来到上海也已经四年；看起来情况在变好，至于未来，应该会变得更好一些吧。</p>
<p>后记：</p>
<p>不知道其它人会不会有这样一种感觉，在生活中的某个阶段，你会突然意识到自己生命中的一切都只能靠你自己。我有这种感觉是在我刚毕业的时候。在那段时间里的某一刻，我突然意识到接下来的一切，钱，工作，女人，以及所有的渴望都只有靠自己。你是你唯一的依靠。</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="http://music.163.com/outchain/player?type=2&id=3986326&auto=1&height=66"></iframe>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2016/06/11/pragmatic-thinking-and-learning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2016/06/11/pragmatic-thinking-and-learning/" class="post-title-link" itemprop="url">《程序员的思维训练》读书笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-06-11 16:21:36" itemprop="dateCreated datePublished" datetime="2016-06-11T16:21:36+08:00">2016-06-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:25:23" itemprop="dateModified" datetime="2017-10-06T22:25:23+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Reading-notes/" itemprop="url" rel="index"><span itemprop="name">Reading notes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <img src="https://img1.doubanio.com/lpic/s4548399.jpg"  style="width: 120px;"/>

<h2 id="技术从业人员的五个级别"><a href="#技术从业人员的五个级别" class="headerlink" title="技术从业人员的五个级别"></a>技术从业人员的五个级别</h2><p>书中开篇介绍一项技术领域的从业人员，大体可以分成五个级别：新手，高级新手，胜任者，精通者，专家。从名次表面就很好理解这五个级别所代表的意思。有意思的地方在于现在国内的大型互联网公司内部，技术人员的职级分类也是如此：初级工程师，工程师，高级工程师，资深工程师，专家。文中列举了一些各个级别的人的一些有意思的特征，如新手非常在乎他们是否成功，新手不是特别想要学习，他们只是想要一个立竿见影的效果，如果出错，他们非常容易慌乱。高级新手能够根据过去的经验，逐步在正确的情景中采纳建议，但他们不想要全局思维。胜任者是可以独立解决问题，并开始考虑如何解决新的问题，胜任者的工作更多的是基于谨慎的计划和过去的经验，如果没有更多的经验，在解决问题时，他们难以确定关注哪些细节。精通者能够纠正以往不好的工作表现，他们会反思以前是如何做的，并修改其做法，期望下一次表现得更好，如此，自我改进就会出现。专家根据直觉工作，而不需要理由，专家的数量很少，大概占总人数的1%～5%。</p>
<p>而要想而从新手一步一步升级成为专家，自身要发生如下三个重要变化才行：</p>
<ul>
<li>从依赖规则向依赖直觉转变</li>
<li>观念的改变，问题已不再是一个相关度等同的所有单元的集合体，而是一个完整和独特的真题，其中某些单元是相关的。</li>
<li>最后，从问题的旁观者转变为问题涉及的系统本身的一部分。</li>
</ul>
<p>然后，令人沮丧的是，研究表明，大多数人的大多数技能，在他们生命的大多数时间里，从没有高于第二阶段高级新手，这里的大多数指的是70%的人。</p>
<h2 id="大脑的两种思考模式（L-amp-R）"><a href="#大脑的两种思考模式（L-amp-R）" class="headerlink" title="大脑的两种思考模式（L &amp; R）"></a>大脑的两种思考模式（L &amp; R）</h2><p>书中第二部分介绍了大脑两种思考模式，L模式－线性模式，R模式－富模式。R型对直觉。L型让你细致工作并实现目标。要想获得最佳性能，需要两种模式协同工作。</p>
<p>L型提供以下9种能力：</p>
<ul>
<li>语言能力</li>
<li>分析能力</li>
<li>符号能力</li>
<li>抽象能力</li>
<li>实践能力</li>
<li>推理能力</li>
<li>数字能力</li>
<li>逻辑能力</li>
<li>线性思维能力</li>
</ul>
<p>这些都是白领们，信息工作者和工程师们最渴望的本领。上学的时候测验也是这些能力。</p>
<p>R型提供的能力：</p>
<ul>
<li>非语言</li>
<li>非理性</li>
<li>综合</li>
<li>空间性</li>
<li>具体</li>
<li>直觉</li>
<li>分析</li>
<li>全面</li>
<li>非线性</li>
</ul>
<p>R型是非语言的，注重整体的，直觉的，跳跃的，这些特点似乎更适合艺术家。但R型的类比和整体思考方式对软件架构和设计非常有价值，好的设计就是由这些组成的。R型还负责综合，而综合是一项非常强大的学习技术。乃至于麻省理工学院媒体实验室创始人建议，真正想要了解一只青蛙，传统的解剖不是办法，更好的方式是构造一直青蛙。（联想到软件开发中，如果想真正搞透某个模块，重造轮子应该是最好的方式）。</p>
<p>接着书中谈到相对于L型，为何R型也如此重要。一家公司的产品是否能够成功，R型思维起到很重要因素。因为R型管理美学，而商品化意味着美学品味的竞争。<strong>作者强调产品的设计胜于功能，是否有吸引力很重要。</strong>好的设计，会给用户带来积极的情感，而积极的情感对学习和创造思维非常关键。处于“高兴”的状态可以扩展你的思维过程，激活更多的大脑物质（意味着用户从产品获取到快感，成就感，自然就会愿意使用产品）。</p>
<p>当然了，美学不仅仅指的是用户界面,产品的Logo，也包括代码和注释的布局，变量名的选择和桌面的整理，还有其他领域的方方面面。（此时，想起了乔布斯的那句“It’s all about the taste”）</p>
<p>##如何利用L型和R型协同工作##<br>然后书中第四章介绍了如何利用右脑，也就是如何促成R型到L型的转换。其中我觉得很有意思的是酒醉写作，酒醒修改。因为酒醉的时候，你拥有自由的创造空间，不受“常识”或者“实用”束缚，可以尽情发挥自己的创造力或随后抛掉那些荒诞的东西。</p>
<p>下面是举了几个关于 L 型和 R 型协调工作的其它几种方式：</p>
<ul>
<li>结对编程：工作时，一个人用L型，一个人用R型</li>
<li>隐喻相通：隐喻，语言和意像共同的地基，是在左右脑半球之间，在潜意识和意识之间来回游弋的途径。隐喻时一种激发创造力的强大技术。</li>
<li>并列参照系</li>
<li>幽默：幽默既不是浪费时间，也不是无害的消遣，而是反映了思维，学习和创造所必需的重要能力。他与联系有关。幽默产生于在不同的想法中制造新奇的联系。在任何情况下，幽默的能力都来自于发掘或扩展常规之外的关系，真正突破思维界限。</li>
</ul>
<p>文中还有一段关于外向和内向的人讨论。外向的人乐于与人交往并参加社会活动。内向的人则不是，他们具有领地意识，需要私人的精神和环境空间，内向的人从独立的活动中获得力量，厌倦社会活动。百分之七十五的人偏于外向型，剩下百分之二十五的人则希望单独呆着。</p>
<p>##学习</p>
<p>在当今技术和文化环境下，学习能力可能是成功的最重要因素。它决定了你是“大获全胜”还是“勉强通过”。</p>
<ul>
<li>技术本身不重要，持续学习才是最重要的。</li>
<li>学习不是强加于你的，而是需要你主动做的事情</li>
<li>仅仅掌握知识，而不去实践，没有用</li>
<li>随机的方法，没有目标和反馈，往往会导致随机的结果</li>
</ul>
<p>那如何在现实中使学习更有效率？需要使用SMART目标和实用投资计划管理目标和计划。</p>
<p>SMART 代表具体的，可度量的，可实现的，相关的和时间可控的（Specific，Measurable,Achievable,Relevant,and Time-boxed）。</p>
<ul>
<li>具体的：一个目标任务应该是具体的。也就是说，只说“我想学习swift”是不够的。应该把事情具体化，例如“我想要用Swift编写一个记账软件”</li>
<li>可度量的：如何知道你何时完成？为了努力实现目标任务，不管采用什么办法，你必须能够度量它。可度量的与具体的相辅相成。很难度量笼统抽象的事物，但是很容易度量具体和详细的事物，只要使用确切的数字即可。如果你认为无法度量自己的目标任务，那么可能它还不够具体。“写一部小说就像在黑夜里开车。你只能看到车灯照亮的部分，但是你却可以走完整个旅程”。你不必看清你去往何处。不必看清你的目的地和沿途的一切。你只需看清面前的一两米即可。</li>
<li>可实现的</li>
<li>相关的：目标需要相关，需要在你掌握之中</li>
<li>时间可控的：没有期限，目标会逐步衰退，永远被每天更紧急的事情所排挤。</li>
</ul>
<p>##管理知识投资</p>
<ul>
<li>制定具体计划：制定计划就是巨大的进步。计划要具体，要运用SMART目标理念，要为不同时间段设计不同层次的目标。记住艾森豪威尔将军对我们的建议：作计划比计划本身重要得多。</li>
<li>多样化：不要把所有的鸡蛋放在同一个篮子里，需要很好地组合语言，环境，技术，行业和非技术领域（管理，公共演讲，，人类学，音乐，艺术，等等）</li>
<li>主动投资：需要客观地按天来评估你的计划，如实地判断运行状况。</li>
<li>定期投资：需要定期投资最低限度的时间量，养成一种习惯。并非每期学习都同样富有成效，但是只要定期安排学习，长期来看一定会成功。</li>
</ul>
<p>##控制注意力</p>
<p>在我们生活的这个信息丰富的时代，过多的信息导致了知识和注意力的匮乏。置身于应接不暇的信息中，很容易失去思考的重心。要更好地管理自己的思维需要从以下三个方面做起：</p>
<ul>
<li>提高注意力：可以通过冥想来提高自己的注意力。关于如何冥想，文中提到的是，打坐，然后所有事情就是注意自己的呼吸。详细的步骤需要自身对着书中的介绍去实践。</li>
<li>管理知识：使用wiki</li>
<li>优化当前情境：多任务处理对生产力会造成重大损失，记住，无论你做什么，请不要同时都做，避免分心。</li>
</ul>
<h2 id="改变"><a href="#改变" class="headerlink" title="改变"></a>改变</h2><p>一些帮助我们管理有效改变的建议。</p>
<ul>
<li>制定计划</li>
<li>“不作为”是敌人，而“错误”不是</li>
<li>给新习惯适应的时间</li>
<li>信念是真实的</li>
<li>采取步步为营的细小步骤</li>
</ul>
<p>最后，选择开始做什么并不特别重要，重要的是主动尝试学习到的知识，做出改变。</p>
<blockquote>
<p>不管你能做什么，或者期望自己能做什么，现在就开始做。勇敢可以给人智慧，力量和神奇。现在就开始做吧。 －－歌德</p>
</blockquote>
<p>以上是我读书过程中做的一些书摘。作为一个软件从业人员，我对文中作者的很多观点都很是赞同，对这本书也有点相见恨晚的味道。读这本书的时候，最重要的环节就是尝试去做书中提到的种种实践；就像我们在研究一门新的技术的时候，重要的一环是用新技术去解决某个问题。这种学习方式是我从业以来一直惯用的方式。<br>很好的一本书，值得推荐给别人去看，不论这个人是不是程序员。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2016/03/06/iOS-reverse-engineering-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2016/03/06/iOS-reverse-engineering-03/" class="post-title-link" itemprop="url">iOS逆向工程-0x02－Hacking on B612</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-03-06 11:32:44" itemprop="dateCreated datePublished" datetime="2016-03-06T11:32:44+08:00">2016-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:21:44" itemprop="dateModified" datetime="2017-10-06T22:21:44+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前面两篇iOS逆向的文章（<a target="_blank" rel="noopener" href="http://cp0000.github.io/2015/11/21/iOS-reverse-engineering-01/">iOS逆向工程-0x00－用途以及准备工作</a>,<a target="_blank" rel="noopener" href="http://cp0000.github.io/2015/11/30/iOS-reverse-engineering-02/">iOS逆向工程-0x01－工具篇-Cycript</a>）主要是介绍iOS逆向的相关基础环境的搭建，工具的使用。有了这些知识之后，我们可以进行简单的逆向工作了。</p>
<p><a target="_blank" rel="noopener" href="https://itunes.apple.com/us/app/b612-selfie-from-the-heart/id904209370?mt=8">B612</a>是Line公司出品的一款非常棒的拍照软件。它的界面，交互，用起来非常顺手。app中的滤镜效果很赞，用户简单几步操作就可以生成一张很有质感的照片。本文我将会演示如何通过逆向来得知B612单个的滤镜的具体实现。</p>
<p>从AppStore上面下载B612的IPA文件，把文件的后缀名从 .IPA 修改成 .zip。解压zip文件之后，在Payload中有一个b612.app的文件，这里我们把.app的后缀去掉，让它变成一个文件夹，方便后面查阅。经过以上几步操作我们就拿到了 B612 app的 bundle 文件信息。</p>
<p>在使用B612的过程中，app会展列一个滤镜列表给用户进行选择（如下图）：</p>
<img src="http://cp0000.github.io/assets/b612_filter_list.png" alt="B612_filter_list" style="width: 400px;"/>


<p>使用的过程发现一个叫 China 的滤镜，China，中国？还是瓷器？叫China的滤镜会呈现出什么样子的效果，根据效果我们是否能推测出这里的China是要翻译成中国，还是瓷器咧？很有意思的样子。我们就拿这个滤镜当做目标吧。</p>
<p>一般情况下，我的常用做法是在先前解压的文件夹中搜索一下相关的信息，碰碰运气。</p>
<pre><code>find . -name &quot;*china*&quot;                 
./FilterThumb.bundle/filterthumb_china.jpg
./ObfuscateImages.bundle/lut/china.dat
</code></pre>
<p>运气不错。在ObfuscateImages.bundle发现了一个叫china.dat的文件。不过尝试用各种编辑器都没法打开，使用修改后缀名等之类的方法也没能成功打开。看来要获取这个文件的内容没有那么简单，开发者对这个文件做了相关加密工作。要想解密该文件，我们可能需要到汇编代码中寻找答案了。</p>
<blockquote>
<p>这里考虑到程序在使用这个滤镜的时候，会加载该文件，并进行相关解密工作。所以下一步是要找到解密dat文件的地方，不过在此之前，我们还有一些工作要做。</p>
</blockquote>
<h2 id="解密可执行文件-clutch-演示"><a href="#解密可执行文件-clutch-演示" class="headerlink" title="解密可执行文件 - clutch 演示"></a>解密可执行文件 - clutch 演示</h2><p>接下来我们要去可执行文件中查询相关信息了。但是从苹果商店上面下载下来的IPA里面的可执行文件是被苹果加密过的,我们解谜它。我常用的工具是 <a target="_blank" rel="noopener" href="https://github.com/KJCracks/Clutch">clutch</a>,你可以clone一份repo到本地，然后编译得到一个clutch的程序，也可以直接下载release版本。然后把Clutch scp 到你的越狱机器上面就可以使用了。</p>
<ul>
<li><p>首先我们查找一下b612的bundle</p>
<p>  iPhone:/usr root# ./Clutch -i|grep b612<br>  28)<b612 bundleID: com.linecorp.b612></p>
</li>
<li><p>然后进行dump工作</p>
<p>  iPhone:/usr root# ./Clutch -d com.linecorp.b612<br>  ….<br>  //程序输出相关log<br>  ….<br>  DONE: /private/var/mobile/Documents/Dumped/com.linecorp.b612-iOS7.0-(Clutch-2.0 RC2).ipa</p>
</li>
</ul>
<p>最后会生成一个解密了的ipa文件，我们把它scp到电脑上来，进行分析。</p>
<blockquote>
<p>还有另外一个解密苹果商店加密IPA的工具叫<a target="_blank" rel="noopener" href="https://github.com/conradev/dumpdecrypted">dumpdecrypted</a>。由于在使用Clutch解密app的时候，消耗内存比较大，导致运行时会出现解密失败的情况，这个时候可以尝试使用<a target="_blank" rel="noopener" href="https://github.com/conradev/dumpdecrypted">dumpdecrypted</a>。</p>
</blockquote>
<h2 id="分析可执行文件-class-dump-以及-IDA"><a href="#分析可执行文件-class-dump-以及-IDA" class="headerlink" title="分析可执行文件 - class-dump 以及 IDA"></a>分析可执行文件 - class-dump 以及 IDA</h2><p>要分析解密之后的文件，我们可以使用<a target="_blank" rel="noopener" href="https://github.com/nygard/class-dump">class-dump</a>来导出程序的头文件。有了头文件列表之后，我们可以利用它来了解app的架构，使用的类库，以及探索需要逆向的那一块功能所属的类名。</p>
<pre><code>class-dump-z/mac_x86/class-dump-z b612 -H -o headers
cd headers
total 10728
drwxr-xr-x  1295 cp  wheel  44030 Apr  4 12:46 .
drwxr-xr-x   455 cp  wheel  15470 Apr  4 12:46 ..
-rw-r--r--     1 cp  wheel    785 Apr  4 12:46 ACTApplication.h
-rw-r--r--     1 cp  wheel    370 Apr  4 12:46 ACTAutomatedUsageReporter.h
-rw-r--r--     1 cp  wheel    391 Apr  4 12:46 ACTAutomatedUsageReporterPrivate.h
-rw-r--r--     1 cp  wheel    264 Apr  4 12:46 ACTAutomatedUsageReporting.h
-rw-r--r--     1 cp  wheel   1830 Apr  4 12:46 ACTAutomatedUsageTracker.h
</code></pre>
<p>要找到加密 .dat 文件的相关代码，我们需要使用另外一个非常强大的工具<a target="_blank" rel="noopener" href="https://www.hex-rays.com/products/ida/index.shtml">IDA</a>。IDA可以非常整洁的输出可执行文件的汇编代码，并且相互连接起来。不过这个软件非常之贵，但是它的免费版本已经够用了。</p>
<p>把B612的可执行文件加载到IDA之后，我们在IDA中执行一个搜索，关键字是dat;幸运的是，搜索结果指向了一下的代码。虽然是汇编代码，但是不难看出两点信息，（1）dat后缀的文件是一张Image （2）程序中需要把文件的数据字节进行反向操作，达到混淆的目的。</p>
<img src="http://cp0000.github.io/assets/b612-reversebyte.png" alt="reversebyte" style="width: 500px;"/>


<p>接下来验证一下线索结果：</p>
<pre><code>- (void)viewDidLoad &#123;
    [super viewDidLoad];
    NSData * data = [[NSData alloc] initWithContentsOfFile: [[NSBundle mainBundle] pathForResource:@&quot;china&quot; ofType:@&quot;dat&quot;]];
    data = [self reverseData: data];
    UIImage * image  = [UIImage imageWithData: data];
    UIImageView * imageView = [[UIImageView alloc] initWithImage: image];
    imageView.frame = self.view.bounds;
    [self.view addSubview: imageView];
&#125;
- (NSData *)reverseData:(NSData *)data &#123;
    const char *bytes = [data bytes];
    int idx = [data length] - 1;
    char *reversedBytes = calloc(sizeof(char),[data length]);
    for (int i = 0; i &lt; [data length]; i++) &#123;
        reversedBytes[idx--] = bytes[i];
    &#125;
    NSData *reversedData = [NSData dataWithBytes:reversedBytes length:[data length]];
    free(reversedBytes);
    return reversedData;
&#125;
</code></pre>
<p>上述代码让我们获得一张china的图片：</p>
<img src="http://cp0000.github.io/assets/china.png" alt="china" style="width: 300px;"/>

<p>上述代码，请查阅<a target="_blank" rel="noopener" href="https://github.com/cp0000/HackB612">HackB612Image</a></p>
<p>OK，到此为止，我们解密了china.dat 这种类型的文件，它跟我们最终要挖掘的china滤镜是如何实现的之间肯定有着联系，但我们现在还不得知。</p>
<h2 id="关于滤镜"><a href="#关于滤镜" class="headerlink" title="关于滤镜"></a>关于滤镜</h2><p>在iOS app 中给图片加滤镜是要通过OpenGL ES 去实现的，而现在app中普遍使用的是<a target="_blank" rel="noopener" href="https://www.khronos.org/opengles/2_X/">OpenGL ES 2.0</a>。这种情况下，滤镜一般都是通过OpenGL的shader来实现的。此时，前面dump出来的header就有用了，分析headers之后，我们发现了两个相关类 GPUImageFilter以及GLProgram。又由于shader在使用之前一定要进行link，compile操作。所以我们可以通过尝试hook这两个类的相关函数，来获得滤镜的shader。</p>
<blockquote>
<p>根据头文件我们能发现B612是通过使用<a target="_blank" rel="noopener" href="https://github.com/BradLarson/GPUImage">GPUImage</a>框架来实现滤镜功能的。</p>
</blockquote>
<h2 id="Theos"><a href="#Theos" class="headerlink" title="Theos"></a>Theos</h2><p>关于如何hook app 在运行时的函数，我们需要使用工具<a target="_blank" rel="noopener" href="http://iphonedevwiki.net/index.php/Theos">Theos</a>.</p>
<ul>
<li>关于如何安装Theos，请阅读<a target="_blank" rel="noopener" href="http://iphonedevwiki.net/index.php/Theos/Setup">Theos Setup</a>。</li>
<li>Logos相关语法，请参考<a target="_blank" rel="noopener" href="http://iphonedevwiki.net/index.php/Logos">Theos Logos</a></li>
</ul>
<p>安装好Theos之后，我们为B612创建一个tweak;</p>
<pre><code>$THEOS/bin/nic.pl 
NIC 2.0 - New Instance Creator
------------------------------
  [1.] iphone/application
  [2.] iphone/library
  [3.] iphone/preference_bundle
  [4.] iphone/tool
  [5.] iphone/tweak
Choose a Template (required): 5
Project Name (required): bsix
Package Name [com.yourcompany.bsix]: com.cp.bsix
Author/Maintainer Name [cp]: 
[iphone/tweak] MobileSubstrate Bundle filter [com.apple.springboard]: com.linecorp.b612            
[iphone/tweak] List of applications to terminate upon installation (space-separated, &#39;-&#39; for none) [SpringBoard]: b612
Instantiating iphone/tweak in bsix/...
Done.
</code></pre>
<p>然后在Tweak.xm文件中编辑需要hook的函数：</p>
<pre><code>%hook GLProgram
-(id)initWithVertexShaderString:(id)vertexShaderString fragmentShaderString:(id)string
&#123;
    [Logger log: [NSString stringWithFormat:@&quot;%@ %@&quot;, NSStringFromClass([self class]), NSStringFromSelector(_cmd)]];
    NSString * msg = [NSString stringWithFormat: @&quot;vertexShaderString: %@ fragmentShaderString: %@ &quot;, vertexShaderString, string];
    [Logger log: msg];
    return %orig;
&#125;
%end
</code></pre>
<p>B612 tweak 的项目地址<a target="_blank" rel="noopener" href="https://github.com/cp0000/B612Tweak">B612Tweak</a>.成功编译之后，把生成的.deb文件scp到越狱机器上，利用dpkg安装tweak；杀掉B612进程重启app之后，tweak就可以hook相关函数了。以下在点击China滤镜的时候，tweak打印出来的log信息：</p>
<pre><code>GLProgram initWithVertexShaderString:fragmentShaderString:
vertexShaderString: 
attribute vec4 position; 
attribute vec4 inputTextureCoordinate; 
attribute vec4 inputTextureCoordinate2; 
varying vec2 textureCoordinate; 
varying vec2 textureCoordinate2; 
void main() &#123; 
    gl_Position = position; 
    textureCoordinate = inputTextureCoordinate.xy; 
    textureCoordinate2 = inputTextureCoordinate2.xy; 
&#125; 
fragmentShaderString: 
varying highp vec2 textureCoordinate; 
varying highp vec2 textureCoordinate2; 
uniform sampler2D inputImageTexture; 
uniform sampler2D inputImageTexture2; 
void main() &#123; 
    highp vec4 textureColor = texture2D(inputImageTexture, textureCoordinate); 
    highp float blueColor = textureColor.b * 63.0; 
    highp vec2 quad1; 
    quad1.y = floor(floor(blueColor) / 8.0); 
    quad1.x = floor(blueColor) - (quad1.y * 8.0); 
    highp vec2 quad2; 
    quad2.y = floor(ceil(blueColor) / 8.0); 
    quad2.x = ceil(blueColor) - (quad2.y * 8.0); 
    highp vec2 texPos1; 
    texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r); 
    texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g); 
    highp vec2 texPos2; 
    texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r); 
    texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g); 
    lowp vec4 newColor1 = texture2D(inputImageTexture2, texPos1); 
    lowp vec4 newColor2 = texture2D(inputImageTexture2, texPos2); 
    lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor)); 
    gl_FragColor = vec4(newColor.rgb, textureColor.w); 
&#125;
</code></pre>
<h2 id="关于使用OpenGL实现滤镜"><a href="#关于使用OpenGL实现滤镜" class="headerlink" title="关于使用OpenGL实现滤镜"></a>关于使用OpenGL实现滤镜</h2><p>前文提到过，根据class-dump出来的头文件，得知B612使用了<a target="_blank" rel="noopener" href="https://github.com/BradLarson/GPUImage">GPUImage</a>。理论上我们下一步研究下GPUImage项目，应该就可以实现china滤镜的效果了，但GPUImage项目还是挺庞大，挺复杂的。</p>
<blockquote>
<p>GPUImage 提供了<code>GPUImageLookupFilter</code>类来实现颜色查找类的滤镜</p>
</blockquote>
<p>这里我们直接使用OpenGL来实现China滤镜。阅读前面的shader代码，得知需要传递给shader两个texture，可以想象出一个是需要原图片，一个是china.dat转换出来的图片，经过顶点着色器和片段着色器，最终给目标图片加上滤镜。下面第一张图是原图，第二张是我用OpenGL实现的Demo效果图片，第三张是B612加china滤镜出来的结果。对比第二张和第三章，效果非常相似。利用OpenGL实现滤镜的代码，请查阅<a target="_blank" rel="noopener" href="https://github.com/cp0000/HackB612">HackB612</a></p>
<img src="http://cp0000.github.io/assets/photo.jpg" alt="原图" style="width: 250px;"/>

<p><img src="http://cp0000.github.io/assets/jingse.jpg" alt="Demo效果图" style="width: 250px;"/><img src="http://cp0000.github.io/assets/jingse_b612.jpg" alt="B612效果图" style="width: 250px;"/></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/12/31/2015-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/12/31/2015-summary/" class="post-title-link" itemprop="url">2015 年终总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-12-31 11:10:31" itemprop="dateCreated datePublished" datetime="2015-12-31T11:10:31+08:00">2015-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-01-02 11:50:08" itemprop="dateModified" datetime="2016-01-02T11:50:08+08:00">2016-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>上海的冬天不是很好过，屋里屋外都很冷。忙碌中，不觉间，这一年已经来到了12月31号，15年就快要结束了。这两年自己也算养成了在一年结束的时候写一篇年終总结的习惯，好让自己来和这一年说再见。</p>
<p>15年对自己影响最大的事情是奶奶的过世。奶奶的逝去的那一阵子，让我恍惚间有了一种了无牵挂的感觉。那段时间，我觉得自己从此无依无靠；没有了任何牵挂，也无了任何寄托。自己可以随风漂泊去任何地方了。</p>
<p>每当我遇到自己恐惧的事情，会想到奶奶；想到奶奶临终前独自面对死亡，我自己头上的这点小事，真的不算个事。从我能记事开始，和奶奶生活的这二十多年，感觉时间很平静的就流逝了，我对奶奶也没有特别的故事可以回忆。只是有时候走在路上，躺在床上，会突然很想念她老人家。</p>
<p>其他的事情需要记录的并不多；15年我常去健身房，由于我从小有点驼背，加上工作性质，长期呆在电脑前，导致现在颈背状况很差，有时候会感觉特别痛。本来希望能通过健身矫正把这个毛病改掉，然而15年收效微微，但16年还是要坚持，相信正确的方法可以帮助自己克服掉这个长期以来的毛病。</p>
<p>另外就是今年终于把自己的博客写起来了，博客这个事情，自己老早就开通了，但能保持一个月至少两篇算是15年坚持下来的习惯；博文质量还有待提高，16年自己会坚持写作的。可以说坚持写作给予我的反馈是很棒的，会有一种特别的满足感。看着自己的文字，我能确切的知道，自己不是在混日子，自己平日里是有在思考的，自己是可以用文字把自己的想法，技巧，知识记录下来的，这一点让我感到安心。</p>
<p>整理这篇总结的时候，已经是2016年了，2016年希望自己能过的更随性，更自由一些。</p>
<p>2015年过去了，我很怀念它。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/12/27/2015-2nd-movie-list/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/12/27/2015-2nd-movie-list/" class="post-title-link" itemprop="url">2015下半年电影清单</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2015-12-27 22:16:11 / Modified: 22:20:19" itemprop="dateCreated datePublished" datetime="2015-12-27T22:16:11+08:00">2015-12-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Movie/" itemprop="url" rel="index"><span itemprop="name">Movie</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>中国大陆</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/25710912/">港囧 (2015)</a></li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/26277313/">西游记之大圣归来 (2015)</a> ✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/3077412/">寻龙诀 (2015)</a> ✔</li>
</ul>
<p><strong>中国香港</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/1298898/">暗战 暗戰 (1999)</a> ✔</li>
</ul>
<p><strong>中国台湾</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/26366465/">我的少女时代 我的少女時代 (2015)</a>✔</li>
</ul>
<p><strong>欧美</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/1866473/">蚁人 Ant-Man (2015)</a> ✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/11624706/">小黄人大眼萌 Minions (2015)</a></li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/10727641/">碟中谍5：神秘国度 Mission: Impossible - Rogue Nation (2015)</a> ✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/10463953/">模仿游戏 The Imitation Game (2014)</a> ✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/10440138/">侏罗纪世界 Jurassic World (2015)</a> ✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/1293530/">角斗士 Gladiator (2000)</a>✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/1945780/">血色将至 There Will Be Blood (2007)</a>✔✔✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/3008247/">穿条纹睡衣的男孩 The Boy in the Striped Pajamas (2008)</a></li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/25773932/">爆裂鼓手 Whiplash (2014)</a> ✔✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/2044089/">杀手没有假期 In Bruges (2008)</a></li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/3592854/">疯狂的麦克斯4：狂暴之路 （Mad Max: Fury Road）</a>✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/24815950/">万物理论 The Theory of Everything (2014)</a> ✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/25766754/">年轻气盛 Youth (2015)</a> ✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/10533913/">头脑特工队 Inside Out (2015)</a></li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/11620560/">007：幽灵党 Spectre (2015)</a> ✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/6873042/">明日世界 Tomorrowland (2015)</a></li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/6846893/">超能查派 Chappie (2015)</a></li>
</ul>
<p><strong>日本</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/25814707/">小森林 冬春篇 リトル・フォレスト 冬・春 (2015)</a> ✔✔✔✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/2000741/">母亲 母べえ (2008)</a> ✔✔✔✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/26147706/">花与爱丽丝杀人事件 花とアリス殺人事件 (2015)</a> ✔✔✔</li>
</ul>
<p><strong>美剧</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/26290409/">黑客军团 第一季 Mr. Robot Season 1 (2015)</a> ✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/10748120/">真探 第一季 True Detective Season 1 (2014)</a> ✔✔✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/25837700/">真探 第二季 True Detective Season 2 (2015)</a></li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/25850640/">毒枭 第一季 Narcos Season 1 (2015)</a> ✔✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/20644938/">硅谷 第一季 Silicon Valley Season 1 (2014)</a>✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/25871679/">硅谷 第二季 Silicon Valley Season 2 (2015)</a>✔</li>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/25770124/">政局边缘 The Brink (2015)</a></li>
</ul>
<p><strong>英剧</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="http://movie.douban.com/subject/26170816/">真实的人类 第一季 Humans Season 1 (2015)</a>✔</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/11/30/iOS-reverse-engineering-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/11/30/iOS-reverse-engineering-02/" class="post-title-link" itemprop="url">iOS逆向工程-0x01－工具篇-Cycript</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-11-30 22:00:07" itemprop="dateCreated datePublished" datetime="2015-11-30T22:00:07+08:00">2015-11-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:21:33" itemprop="dateModified" datetime="2017-10-06T22:21:33+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>对于初开始学习iOS逆向工程的人来说，实现一个<code>tweak</code>可以算是入门逆向工程了。</p>
<p>当然了，可能你现在还不知道<code>tweak</code>是什么。简单来说，你可以把一个tweak当作某一个app的一个插件（类似于浏览器广告屏蔽插件）。在app运行的时候，tweak会hook住某个函数，然后在hook的函数里面，你可以插入你的代码。</p>
<blockquote>
<p>比如用户在登陆微信账号的时候，tweak可以hook住登录函数，dump出用户的账号密码</p>
</blockquote>
<p>那问题来了，我们要如何知道哪个函数是账号登录函数咧？<strong>这就涉及到我们如何去分析一个iOS app</strong></p>
<h2 id="分析-iOS-app-的两种方法"><a href="#分析-iOS-app-的两种方法" class="headerlink" title="分析 iOS app 的两种方法"></a>分析 iOS app 的两种方法</h2><ul>
<li><p>运行时分析</p>
<ul>
<li>GDB/LLDB</li>
<li>Cycript</li>
<li>Logify</li>
<li>weak_classdump</li>
<li>InspectiveC</li>
</ul>
</li>
</ul>
<ul>
<li><p>可执行代码分析</p>
<ul>
<li>dumpdecrpted</li>
<li>class_dump,class_dump_z,classdump_dyld</li>
<li>Disassemblers<ul>
<li>IDA</li>
<li>Hopper</li>
<li>otool</li>
</ul>
</li>
<li>strings</li>
<li>nm</li>
</ul>
</li>
</ul>
<p>先不要被这么多的工具多吓到，我们一样一样来。相比对汇编代码的分析，动态分析要简单，容易上手很多，对新手而言，也更加容易获取到乐趣。所以我们先从最好玩的Cycript开始。</p>
<p>###Cycript</p>
<p><a target="_blank" rel="noopener" href="http://www.cycript.org/">Cycript</a>最重要的特性是，它可以hook住 iOS／macosx 上面正在运行的进程，并通过终端使用objective_c或javascript语法去打印和修改该应用的运行时信息。我们可以把它当作一个可以debug没有源代码程序的工具。</p>
<p>以下是 Cycript 的用途：</p>
<ul>
<li>能够hook正在运行的进程，并打印相关信息，如 appdelegate,rootViewController</li>
<li>对程序中的类，可以获取到它用过的方法名称</li>
<li>可以获取到类的实例变量名称，以及打印出实例变量的值，当然也可以修改实例变量的值</li>
<li>能够执行 method swizzling， 替换某个指定的函数</li>
<li>可以在运行时调用其他方法</li>
</ul>
<h4 id="安装-cycript"><a href="#安装-cycript" class="headerlink" title="安装 cycript"></a>安装 cycript</h4><p>首先利用 Cydia 下载 <code>mobilesubstrate</code> <code>adv-mds</code>;从<a href="www.cycript.org/debs/">官网</a>上面下载最新的包，并通过 <code>scp</code> 把文件拷贝到 iOS 设备上去，利用 <code>dpkg</code> 进行安装：</p>
<pre><code>dpkg -i cycript cycript_0.9.102-1_iphoneos-arm.deb
</code></pre>
<p>安装完成之后，执行 cycript 看是否工作：</p>
<h4 id="用Cycript进行实时修改"><a href="#用Cycript进行实时修改" class="headerlink" title="用Cycript进行实时修改"></a>用Cycript进行实时修改</h4><p>本文将使用支付宝来进行测试。</p>
<ul>
<li>让支付宝钱包在前台运行，并找出它的进程id，然后用 cycript -p hook 进程</li>
</ul>
<pre><code>    chengpeide-iPhone:~ root# ps aux | grep AlipayWallet
    mobile     629   0.0  9.3   815836  47792   ??  Ss    9:45PM   0:34.79 /var/mobile/Containers/Bundle/Application/FB2E1466-0D87-4FF9-9616-BD4269D61BCF/AlipayWallet.app/AlipayWallet
    root       678   0.0  0.1   536256    412 s000  U+    9:49PM   0:00.01 grep AlipayWallet

    -rwxr-xr-x 1 root admin 906 Jan 12  2015 cycript
    chengpeide-iPhone:/cp/Cycript_0.9.502 root# cycript -p 629

    cy# var app = [UIApplication sharedApplication]
    #&quot;&lt;DFApplication: 0x14df44d0&gt;&quot;
    cy# app.delegate
    #&quot;&lt;DFClientDelegate: 0x14ed2d40&gt;&quot;
    cy# app.keyWindow.rootViewController
    #&quot;&lt;DFNavigationController: 0x15ac9a00&gt;&quot;
    cy# var nav = new Instance(0x15ac9a00)
    #&quot;&lt;DFNavigationController: 0x15ac9a00&gt;&quot;
    cy# nav.topViewController.childViewControllers
    @[#&quot;&lt;HPHomeWidgetGroup: 0x160a03d0&gt;&quot;,#&quot;&lt;O2OIndexViewController: 0x15ad6600&gt;&quot;,#&quot;&lt;APContactRecentViewController: 0x15afb600&gt;&quot;,#&quot;&lt;WWAssetsViewController: 0x160a9da0&gt;&quot;]
    cy# var assetsViewController = new Instance(0x160a9da0)
    #&quot;&lt;WWAssetsViewController: 0x160a9da0&gt;&quot;
    cy# [assetsViewController.view subviews]
    @[#&quot;&lt;UIView: 0x162d8000; frame = (0 0; 0 0); layer = &lt;CALayer: 0x162c85d0&gt;&gt;&quot;,#&quot;&lt;UITableView: 0x15433800; frame = (0 0; 320 519); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x1623d1f0&gt;; layer = &lt;CALayer: 0x162c3b10&gt;; contentOffset: &#123;0, -64&#125;; contentSize: &#123;320, 800&#125;&gt;&quot;]
    cy# var tableView = new Instance (0x15433800)
    #&quot;&lt;UITableView: 0x15433800; frame = (0 0; 320 519); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x1623d1f0&gt;; layer = &lt;CALayer: 0x162c3b10&gt;; contentOffset: &#123;0, -42&#125;; contentSize: &#123;320, 800&#125;&gt;&quot;
    cy# tableView.backgroundColor = [UIColor redColor]
    #&quot;UIDeviceRGBColorSpace 1 0 0 1&quot;

    [tableView visibleCells]
    @[#&quot;&lt;HeadInfoCell: 0x16160a40; baseClass = UITableViewCell; frame = (0 220; 320 80); autoresize = W; layer = &lt;CALayer: 0x16160e80&gt;&gt;&quot;,#&quot;&lt;DoubleInfoCell: 0x1569e800; baseClass = UITableViewCell; frame = (0 300; 320 80); autoresize = W; layer = &lt;CALayer: 0x16486e80&gt;&gt;&quot;,#&quot;&lt;DoubleInfoCell: 0x15452e00; baseClass = UITableViewCell; frame = (0 380; 320 80); autoresize = W; layer = &lt;CALayer: 0x16491a50&gt;&gt;&quot;]
    cy# var headCell = new Instance (0x16160a40)
    #&quot;&lt;HeadInfoCell: 0x16160a40; baseClass = UITableViewCell; frame = (0 220; 320 80); autoresize = W; layer = &lt;CALayer: 0x16160e80&gt;&gt;&quot;
    cy# headCell.backgroundColor = [UIColor redColor]
    #&quot;UIDeviceRGBColorSpace 1 0 0 1&quot;
    cy# headCell.contentView.backgroundColor = [UIColor redColor]
    #&quot;UIDeviceRGBColorSpace 1 0 0 1&quot;
</code></pre>
<p>我们可以看到，界面上 tableViewCell 的背景颜色变成了红色。</p>
<p><img src="http://cp0000.github.io/assets/blue.PNG" alt="shortcut2"></p>
<p>以上操作的思路大致就是， appdelegate =&gt; keyWindow =&gt; rootViewController =&gt; viewControllers =&gt; view </p>
<p>当然你也可以骗骗自己，把余额这个label的text改成巨款，过过眼瘾</p>
<pre><code>    cy# [tableView subviews]
    @[#&quot;&lt;UIRefreshControl: 0x16482c90; frame = (0 0; 320 60); hidden = YES; autoresize = W; layer = &lt;CALayer: 0x16256370&gt;&gt;&quot;,#&quot;&lt;UITableViewWrapperView: 0x1624cce0; frame = (0 0; 320 519); gestureRecognizers = &lt;NSArray: 0x16098960&gt;; layer = &lt;CALayer: 0x14e12cf0&gt;; contentOffset: &#123;0, 0&#125;; contentSize: &#123;320, 519&#125;&gt;&quot;,#&quot;&lt;UIView: 0x16216d10; frame = (0 780; 320 20); layer = &lt;CALayer: 0x162562c0&gt;&gt;&quot;,#&quot;&lt;WHAccountHeaderView: 0x16217c10; frame = (0 0; 320 180); layer = &lt;CALayer: 0x1637edd0&gt;&gt;&quot;,#&quot;&lt;UIView: 0x17635b80; frame = (0 180; 320 40); autoresize = W; layer = &lt;CALayer: 0x1620d670&gt;&gt;&quot;,#&quot;&lt;UIImageView: 0x161f4740; frame = (0 452.5; 320 2.5); alpha = 0; opaque = NO; autoresize = TM; userInteractionEnabled = NO; layer = &lt;CALayer: 0x161f47c0&gt;&gt;&quot;]
    cy# var header = new Instance(0x16217c10)
    #&quot;&lt;WHAccountHeaderView: 0x16217c10; frame = (0 0; 320 180); layer = &lt;CALayer: 0x1637edd0&gt;&gt;&quot;
    cy# [header subviews]
    @[#&quot;&lt;UIView: 0x161c6530; frame = (0 0; 320 117); layer = &lt;CALayer: 0x1638a780&gt;&gt;&quot;,#&quot;&lt;UIView: 0x16142d70; frame = (0 117.5; 106.667 62.5); layer = &lt;CALayer: 0x161f6350&gt;&gt;&quot;,#&quot;&lt;UIView: 0x16142de0; frame = (106.667 117.5; 106.667 62.5); layer = &lt;CALayer: 0x16109ed0&gt;&gt;&quot;,#&quot;&lt;UIView: 0x1610a4b0; frame = (213.333 117.5; 106.667 62.5); layer = &lt;CALayer: 0x163771b0&gt;&gt;&quot;,#&quot;&lt;UILabel: 0x161082c0; frame = (122 28; 76 41); text = &#39;0.00&#39;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x14f73520&gt;&gt;&quot;,#&quot;&lt;UIImageView: 0x1610a520; frame = (246 42; 9 13); opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x161025c0&gt;&gt;&quot;,#&quot;&lt;UIImageView: 0x161692b0; frame = (56.5 83; 13 13); opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x16169330&gt;&gt;&quot;,#&quot;&lt;UILabel: 0x16169380; frame = (74.5 83; 189 13); text = &#39;\xe7\x82\xb9\xe6\xad\xa4\xe5\xbc\x80\xe5\x90\xaf\xe8\xb4\xa6\xe6\x88\xb7\xe5\xae\x89\xe5\x85\xa8\xe9\x99\xa9\xef\xbc\x8c\xe4\xba\xab100\xe4\xb8\x87\xe4\xbf\x9d\xe9\x9a\x9c&#39;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16169230&gt;&gt;&quot;,#&quot;&lt;UILabel: 0x16169570; frame = (36.8333 154.25; 33 12); text = &#39;\xe9\x93\xb6\xe8\xa1\x8c\xe5\x8d\xa1&#39;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16169630&gt;&gt;&quot;,#&quot;&lt;UILabel: 0x16169810; frame = (48.3333 131.25; 10 17); text = &#39;2&#39;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x161698d0&gt;&gt;&quot;,#&quot;&lt;UIImageView: 0x16169ab0; frame = (42.3333 127.25; 22 22); hidden = YES; opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x16169b30&gt;&gt;&quot;,#&quot;&lt;UILabel: 0x16381200; frame = (149 154.25; 22 12); text = &#39;\xe4\xbd\x99\xe9\xa2\x9d&#39;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16381160&gt;&gt;&quot;,#&quot;&lt;UILabel: 0x16380280; frame = (144 131.25; 32 17); text = &#39;0.00&#39;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16380340&gt;&gt;&quot;,#&quot;&lt;UILabel: 0x16380520; frame = (255.667 154.25; 22 12); text = &#39;\xe5\x8d\xa1\xe5\x8c\x85&#39;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x163805e0&gt;&gt;&quot;,#&quot;&lt;UILabel: 0x1638d640; frame = (261.667 131.25; 10 17); text = &#39;0&#39;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x1638d700&gt;&gt;&quot;,#&quot;&lt;UIView: 0x16151570; frame = (0 117; 320 0.5); layer = &lt;CALayer: 0x161515e0&gt;&gt;&quot;,#&quot;&lt;UIView: 0x16151670; frame = (0 179.5; 320 0.5); layer = &lt;CALayer: 0x161516e0&gt;&gt;&quot;]
    cy# var label2= new Instance(0x161082c0)
    #&quot;&lt;UILabel: 0x161082c0; frame = (122 28; 76 41); text = &#39;0.00&#39;; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x14f73520&gt;&gt;&quot;
    cy# label2.text=@&quot;10000000000000&quot;
    @&quot;10000000000000&quot;
</code></pre>
<p><img src="http://cp0000.github.io/assets/rich.PNG" alt="shortcut2"></p>
<p>很好玩，也很有用的工具，cycript。当然cycript还有一些高级用法，后面会介绍。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/11/21/iOS-reverse-engineering-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/11/21/iOS-reverse-engineering-01/" class="post-title-link" itemprop="url">iOS逆向工程-0x00－用途以及准备工作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-11-21 10:46:07" itemprop="dateCreated datePublished" datetime="2015-11-21T10:46:07+08:00">2015-11-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:21:27" itemprop="dateModified" datetime="2017-10-06T22:21:27+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>好奇心，求知欲，是作为一个程序员很重要的属性。好奇心会促使你去了解那些未知的事物，打开新的世界。求知欲则帮助你去琢磨这些知识，探索这些事物是如何工作的。</p>
<p>作为一个iOS开发者，我在使用其他开发者的优秀app的时候，总是会去猜测作者是怎么实现这个功能的，换作是我，我会怎么去实现它。有些功能很容易猜测出来（如微信iOS app的总体结构，想一下也会知道它的结构是 tabbarController+navigationController+tableViewController）；有些功能就不容易从表面上猜测出来，如博客软件 Castro。要想知道这些软件的一些设计细节，就得用上逆向工程，来帮助我们获取到想要的信息。</p>
<p>当然了，逆向工程还有其他更重要的用途，如下：</p>
<ul>
<li>分析恶意软件</li>
<li>安全研究</li>
<li>借鉴别人的软件</li>
<li>破解使用限制</li>
</ul>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>在开始 iOS 逆向工作之前，得准备一下相关设备</p>
<h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><ul>
<li>Mac 电脑</li>
<li>一台越狱机器 (如何越狱，请访问 <strong><a target="_blank" rel="noopener" href="http://pangu.io/">pangu</a></strong>)</li>
</ul>
<h3 id="设置环境"><a href="#设置环境" class="headerlink" title="设置环境"></a>设置环境</h3><h4 id="利用Cydia安装相关开发工具，建议安装下表中的全部软件"><a href="#利用Cydia安装相关开发工具，建议安装下表中的全部软件" class="headerlink" title="利用Cydia安装相关开发工具，建议安装下表中的全部软件"></a>利用<code>Cydia</code>安装相关开发工具，建议安装下表中的全部软件</h4><table>
<thead>
<tr>
<th>tool</th>
<th>description</th>
</tr>
</thead>
<tbody><tr>
<td>ps</td>
<td>process status, cpu usage, memory usage</td>
</tr>
<tr>
<td>sysctl</td>
<td>get or set kernal state</td>
</tr>
<tr>
<td>netstat</td>
<td>show network status</td>
</tr>
<tr>
<td>route</td>
<td>manually manipulate the routing tables</td>
</tr>
<tr>
<td>renice</td>
<td>alter priority of running processes</td>
</tr>
<tr>
<td>ifconfig</td>
<td>configure network interface parameters</td>
</tr>
<tr>
<td>tcpdump</td>
<td>dump traffic on a network</td>
</tr>
<tr>
<td>lsof</td>
<td>list open files</td>
</tr>
<tr>
<td>otool</td>
<td>displays specified parts of object files or libraries.</td>
</tr>
<tr>
<td>nm</td>
<td>displays the name list (symbol table) of each object file in the argument list.</td>
</tr>
<tr>
<td>ldid</td>
<td>signature tool</td>
</tr>
<tr>
<td>gdb</td>
<td>debug tool</td>
</tr>
<tr>
<td>lldb</td>
<td>debug tool</td>
</tr>
<tr>
<td>patch</td>
<td>patch tool</td>
</tr>
<tr>
<td>SSH</td>
<td>is a program for logging into a remote machine and for executing commands on a remote machine.</td>
</tr>
</tbody></table>
<h4 id="SSH-to-iPhone"><a href="#SSH-to-iPhone" class="headerlink" title="SSH to iPhone"></a>SSH to iPhone</h4><h5 id="通过-wifi"><a href="#通过-wifi" class="headerlink" title="通过 wifi"></a>通过 wifi</h5><pre><code>ssh root@your.iphone.ip
</code></pre>
<p>iOS 系统中的<code>root</code>用户的默认密码是 <code>Alipne</code>.第一次登录的时候请使用这个密码。不过请记得修改<code>root</code>用户的密码，不然这台越狱机器就很不安全了。</p>
<p><strong>修改用户密码</strong></p>
<pre><code>iPhone:~ root# passwd
Changing password for root
New password:
Retype new password:
iPhone:~ root#
</code></pre>
<h5 id="通过-usb"><a href="#通过-usb" class="headerlink" title="通过 usb"></a>通过 usb</h5><p>在wifi不稳定的场景下，建议使用usb来ssh到iPhone上。（我自己也是主要适用usb来进行ssh）</p>
<ul>
<li><p>关于如何使用 usb ssh 到 iPhone上，详情请访问网页 <a target="_blank" rel="noopener" href="http://iphonedevwiki.net/index.php/SSH_Over_USB">SSH over USB</a>。根据网页上面的guide，需要下载：<a target="_blank" rel="noopener" href="https://code.google.com/p/iphonetunnel-usbmuxconnectbyport/downloads/detail?name=itnl_rev8.zip">itnl_rev8.zip</a></p>
</li>
<li><p>解压zip包之后，做如下操作：</p>
<ul>
<li><p>OS X terminal:</p>
<pre><code>  sudo path/to/itnl --iport 22 --lport 2222
</code></pre>
</li>
<li><p>iPhone terminal:</p>
<pre><code>  ssh -p 2222 root@localhost
</code></pre>
</li>
</ul>
</li>
</ul>
<p>然后，就成功 ssh 到 iPhone 上面。我们的准备工作到此也就做完了，接下来我们就可以开始逆向 iOS app了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/10/27/27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/10/27/27/" class="post-title-link" itemprop="url">活到二十七</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-10-27 00:05:53" itemprop="dateCreated datePublished" datetime="2015-10-27T00:05:53+08:00">2015-10-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-01-02 20:50:56" itemprop="dateModified" datetime="2016-01-02T20:50:56+08:00">2016-01-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>“Many people die at 25 and aren’t buried until 75.”(很多人25岁就死了，但是要75岁才被埋进土里)－－这是美国政治家，科学家富兰克林的名句。</p>
</blockquote>
<p>这里的死当然不是生理上的死亡，我的理解是指一个人的生活进入了静止的状态；早上8点起床，吃着相同的早餐，走着每天上下班的路去公司，开始一天忙碌的办公司生活，日复一日，循环至死。</p>
<p>今天是我二七岁的生日，想来我自己不也是如此嘛？每天的日子趋于静止，今天像是昨天的拷贝。</p>
<p>稍微观察下，生活中大家见面的时候，都会寒暄一句“最近在忙啥？”。想来这句话却很有意思，它鲜活的表现出了我们是一个好像不忙点啥，日子就没法过下去的种族。也是，我们身边的每个人每天都显得很忙；大家忙着挣钱，忙着找女人，忙着玩游戏，忙着去八卦，忙着娱乐，一刻都不得闲；但其实我觉得是人们害怕闲。因为一当闲下来，我们会不知道干嘛，进而觉得无聊，产生厌烦，最后感到孤独。</p>
<p>我也是如此，为了让自己忙起来，我写博客，不停的往Wunderlist中加todos，看amazon上面的畅销书。坦白讲，长长的 TODO list 会让我产生一种心安。</p>
<p>记得大二的时候，当时的我，一个中二青年，被乔布斯在斯坦福大学上的毕业演讲的震撼住了。其中有一段是</p>
<blockquote>
<p>Your work is going to fill a large part of your life, and the only way to be truly satisfied is to do what you believe is great work. And the only way to do great work is to love what you do. If you haven’t found it yet, keep looking. Don’t settle. As with all matters of the heart, you’ll know when you find it. </p>
</blockquote>
<p>这么些年来，我一直被这个演讲所影响。我会时常问自己，到底想要成为什么样子的人，真正想要做的事情是什么。但在27岁生日这天，我不得不承认，我还是没有找到。有段时间，在做 reverse engineering 的时候，我的确遇到了那种 “啊哈” 时刻。但当我深入进去之后，了解业界专业的安全知识之后，我知道这东西是需要天分加大量的练习，可惜我不够，天分和练习都不够。而且我也没有豁出去，重新来过的勇气。</p>
<p>或许是年纪的增长，近些日子，我会开始关注房子，汽车等诸如此类的事物。有时候我也想给自己弄个窝，不用寄人篱下，活得体面一点。这诺大的城市中，我也不想一直是那个漂泊的，东奔西跑的人。但高企的房价，不可理喻的限购政策又让我心灰意冷，不知出路在何处。</p>
<p>只希望二十八的时候，自己晚上洗完澡倒头上床，盯着天花板的时候，知道自己到底在忙些什么。</p>
<p><a target="_blank" rel="noopener" href="http://music.163.com/#/song?id=28349599">Johnny and Mary (Feat. Bryan Ferry)</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/10/25/Peek-and-pop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/10/25/Peek-and-pop/" class="post-title-link" itemprop="url">3D-Touch(2) PEEK And POP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-10-25 10:36:21" itemprop="dateCreated datePublished" datetime="2015-10-25T10:36:21+08:00">2015-10-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-10-27 20:52:05" itemprop="dateModified" datetime="2015-10-27T20:52:05+08:00">2015-10-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>如上篇文章所说，3D Touch 主要分成三个模块： Home Actions, Peek &amp; Pop, Force Properties。上篇文章中总结了 Home Actions的相关知识点以及如何接入该功能。本文将用来介绍Peek &amp; Pop 的相关知识点。</p>
<p>在给你的app接入peeking and poping 的功能之前，需要先了解该操作的三个属性， peeking, preview actions, poping。如下图所示：</p>
<p><img src="http://cp0000.github.io/assets/peekandpop.gif" alt="peek_and_pop"></p>
<p>用户在 Peeking 图片，视频，网页等内容的时候，能够在不去加载全部内容的情况下获取到更多详细的内容。</p>
<p>##PEEKING</p>
<p>当用户对某个view做peeking操作时，程序会展现给用户相对应内容的快照。Peek 操作是 3DTouch 中实现起来相对比较复杂的模块。Peek and Pop API 中有一个 <code>UIViewControllerPreviewingDelegate</code>,给指定的view需要注册这个delegate，就可以接收到系统回调过来的3D Touch事件。</p>
<pre><code>override func viewDidLoad() &#123;
    super.viewDidLoad()

    /*  
        Register for `UIViewControllerPreviewingDelegate` to enable
        &quot;Peek&quot; and &quot;Pop&quot;.
        The view controller will be automatically unregistered when it is
        deallocated.
    */
    registerForPreviewingWithDelegate(self, sourceView: view)
&#125;
</code></pre>
<p>这里有一点需要注意，我们可以在一个 view Controller 中，给多个view注册 Previewing Delegate ，但是我们不能反复去注册同一个view。</p>
<blockquote>
<p>“You can designate more than one source view for a single registered view controller, but you cannot designate a single view as a source view more than once.”</p>
</blockquote>
<p>Peek的操作过程可以分解成下面三个步骤：</p>
<p><img src="http://cp0000.github.io/assets/peek_and_pop2.png" alt="peek_and_pop_2"></p>
<p>Peek的系统回调函数会提供一个关于 source view的context，以及 touch事件的point。以sourceView为 collectionView为例，回调函数中我们需要处理以下三件事情：</p>
<ul>
<li>(1) 根据 location 找到被 peeked 的 cell，以及cell的 NSIndexPath</li>
<li>(2) 设置 previewingContext 的 sourceRect 大小</li>
<li>(3) alloc 一个 PreViewController，并设置背景图片，title之类的， 然后返回这个 PreviewController</li>
</ul>
<p><strong>UICOLLECTIONVIEW 代码片段</strong></p>
<pre><code>override func viewDidLoad() &#123;
    super.viewDidLoad()

    registerForPreviewingWithDelegate(self, sourceView: tableView)
&#125;

func previewingContext(previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint) -&gt; UIViewController? &#123;
    guard let indexPath = collectionView?.indexPathForItemAtPoint(location) else &#123; return nil &#125;
    
    guard let cell = collectionView?.cellForItemAtIndexPath(indexPath) else &#123; return nil &#125;
    
    guard let detailVC = storyboard?.instantiateViewControllerWithIdentifier(&quot;DetailViewController&quot;) as? DetailViewController else &#123; return nil &#125;
    
    let photo = photos[indexPath.row]
    detailVC.photo = photo
    
    detailVC.preferredContentSize = CGSize(width: 0.0, height: 300)
    
    previewingContext.sourceRect = cell.frame
    
    return detailVC
&#125;
</code></pre>
<h2 id="UIPREVIEWACTIONITEMS"><a href="#UIPREVIEWACTIONITEMS" class="headerlink" title="UIPREVIEWACTIONITEMS"></a>UIPREVIEWACTIONITEMS</h2><p>当用户在 PreViewing Controller 的界面，手指往上推，会从屏幕底部弹出一个类似 actionsheet 的界面，这个是 <code>UIPreviewActions</code>。那如何给指定的 preViewController 自定义这些 <code>UIPreviewActions</code>？ 方法很简单，override UIViewController 中的 preViewActionItems() 方法，在该方法中定义好 actionItems 的数组就好了：</p>
<pre><code>override func previewActionItems() -&gt; [UIPreviewActionItem] &#123;

    let likeAction = UIPreviewAction(title: &quot;Like&quot;, style: .Default) &#123; (action, viewController) -&gt; Void in
        print(&quot;You liked the photo&quot;)
    &#125;

    let deleteAction = UIPreviewAction(title: &quot;Delete&quot;, style: .Destructive) &#123; (action, viewController) -&gt; Void in
        print(&quot;You deleted the photo&quot;)
    &#125;

    let groupAction = UIPreviewActionGroup (title: &quot;Group&quot;, style: .Default, actions: [likeAction, deleteAction])
    return [likeAction, deleteAction, groupAction]

&#125;
</code></pre>
<p>另外苹果还提供了 <code>UIPreviewActionGroup</code>，顾名思义就是把几个UIPreviewActionItem操作放到一起，组成一个组。</p>
<h2 id="POPPING"><a href="#POPPING" class="headerlink" title="POPPING"></a>POPPING</h2><p>poping 操作处理起来相对简单。在回调函数中</p>
<pre><code>func previewingContext(previewingContext: UIViewControllerPreviewing, commitViewController viewControllerToCommit: UIViewController) &#123;
    //Here&#39;s where you commit (pop)
&#125;
</code></pre>
<p>我们需要根据preViewingContext来确定poping的时候需要commit的ViewController就好了。</p>
<h2 id="WEBVIEW-PEEK-AND-POP"><a href="#WEBVIEW-PEEK-AND-POP" class="headerlink" title="WEBVIEW PEEK AND POP"></a>WEBVIEW PEEK AND POP</h2><p>让 <code>UIWebView</code> 和 <code>WKWebview</code> 支持 Peek&amp;Pop就很简单了：</p>
<pre><code>webView.allowsLinkPreview = true
</code></pre>
<p>##结语</p>
<p>以上。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/09/30/iOS9-Quick-Actions-shortcut/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/09/30/iOS9-Quick-Actions-shortcut/" class="post-title-link" itemprop="url">3D-Touch(1) iOS9 Quick Actions Shortcut</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-09-30 19:24:13" itemprop="dateCreated datePublished" datetime="2015-09-30T19:24:13+08:00">2015-09-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:21:48" itemprop="dateModified" datetime="2017-10-06T22:21:48+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>新的iPhone6s, iPhone6s P 在不久之前的 WWDC 上面发布了，这个版本的iPhone最大的卖点应该是在它的屏幕拥有了 3D Touch 的功能。iOS 9 中已经包含了这一硬件功能所提供API，3D Touch API分成三个部分: Quick Actions， peek and pop,以及 Pressure Sensitivity.考虑到苹果的一贯作风，如果你的APP中集成iPhone的新特性，新的API，被苹果商店推荐的概率也会增大一点。本文将为大家介绍如何快速的添加 Quick Actions shortcut 功能。</p>
<h2 id="Home-Screen-Quick-Actions"><a href="#Home-Screen-Quick-Actions" class="headerlink" title="Home Screen Quick Actions"></a>Home Screen Quick Actions</h2><p>通过主屏幕的应用icon，可以用 3D Touch 呼出一个快捷列表，用户可通过这个列表快速定位应用功能模块。iOS9提供了两种屏幕标签，分别是静态标签和动态标签。且iOS9最多展示四个快捷键给用户，系统会优先展示静态的快捷键，当静态的快捷键不够四个，会添加动态的快捷键到列表。</p>
<h3 id="静态快捷键的添加"><a href="#静态快捷键的添加" class="headerlink" title="静态快捷键的添加"></a>静态快捷键的添加</h3><p>打开 Info.plist, 在该文件中添加如下键值：</p>
<p><img src="http://cp0000.github.io/assets/static_shortcut.jpg" alt="static_shortcut"></p>
<p>添加一个key为<code>UIApplicationShortcutItems</code>的数组，数组中添件的元素就是静态标签，每个标签我们可以配置下面的键值：</p>
<ul>
<li>UIApplicationShortcutItemType (required) : 快捷标签的唯一字符串标示</li>
<li>UIApplicationShortcutItemTitle (required): 快捷标签的标题，会显示在UI上</li>
<li>UIApplicationShortcutItemSubtitle (optional): 副标题，会显示在UI上</li>
<li>UIApplicationShortcutItemIconType (optional): 系统提供的icon，全部列表 <a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/UIKit/Reference/UIApplicationShortcutIcon_Class/index.html#//apple_ref/c/tdef/UIApplicationShortcutIconType">UIApplicationShortcutIcon_Class</a></li>
<li>UIApplicationShortcutItemIconFile (optional): 自定义icon（如果填写了该项，则系统自动ignore UIApplicationShortcutItemIconType）。图片需要时正方形的，35<em>35的倍数（试过100</em>100也是Ok的），并且单色。</li>
<li>UIApplicationShortcutItemUserInfo (optional): 传值用</li>
</ul>
<p>详情请<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/General/Reference/InfoPlistKeyReference/Articles/iPhoneOSKeys.html#//apple_ref/doc/uid/TP40009252-SW36">看这里</a></p>
<p>当在Info.plist 中添加好了需要的标签之后。运行程序便可得到以下效果：</p>
<p><img src="http://cp0000.github.io/assets/shortcut2.jpg" alt="shortcut2"></p>
<p>P.S 关于如何在模拟器中调试ShortCutMenu，请见文章最后一节<a href="#jump">模拟器上测试Shortcut</a>。</p>
<h3 id="动态标签的添加"><a href="#动态标签的添加" class="headerlink" title="动态标签的添加"></a>动态标签的添加</h3><p>所谓动态标签，就是我们可以通过代码来添加标签，相关的类有：</p>
<ul>
<li>UIApplicationShortcutItem 3DTouch标签的类</li>
<li>UIApplicationShortcutIcon 标签中图片Icon的类</li>
</ul>
<h3 id="响应标签的行为"><a href="#响应标签的行为" class="headerlink" title="响应标签的行为"></a>响应标签的行为</h3><p>当点击标签进入应用时，我们需要在代码对不同标签的做处理。在iOS 9 中，UIApplicationDelegate 新增了方法：</p>
<pre><code>- (void) application:(UIApplication *)application performActionForShortcutItem:(UIApplicationShortcutItem *)shortcutItem completionHandler:(void (^)(BOOL))completionHandler
</code></pre>
<p>当通过标签进入APP时，appdelegate中会回调到这个函数。当你处理完了标签需要做的工作之后，需要执行 <code>completionHandler</code>。</p>
<p>这里有一个地方需要特别注意一下，用户按下标签进入应用要分成两种状况：启动APP，APP从后台回到前台。你需要在 <code>application:didFinishLaunchingWithOptions:</code> 或 <code>application:willFinishLaunchingWithOptions:</code> 中的一个去检查字典 <code>launchOptions</code> 中是否包含了<code>UIApplicationLaunchOptionsShortcutItemKey</code>。如果有这个key，则表示是启动app。你需要在此时设置好APP的view层级，并且为 application:willFinishLaunchingWithOptions: 返回 false。这样就可以阻止 <code>application(_:performActionForShortcutItem:completionHandler:)</code> 被调用，避免标签处理逻辑被处理两次。</p>
<p>以下是 sample code (Objective_c)，demo 放在github上面<a target="_blank" rel="noopener" href="https://github.com/cp0000/shortcutDemo">shortcutDemo</a></p>
<p>另外苹果官方提供了 swift 的<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/samplecode/ApplicationShortcuts/Introduction/Intro.html">sample code</a></p>
<pre><code>#import &quot;AppDelegate.h&quot;

@interface AppDelegate ()
@property (nonatomic, retain) UIApplicationShortcutItem * launchedShortcutItem;

@end

@implementation AppDelegate

- (BOOL) handledShortCutItem: (UIApplicationShortcutItem *) shortcutItem
&#123;
    BOOL handled = NO;
    if (!shortcutItem.type) return NO;
    if (![shortcutItem.type isKindOfClass:[NSString class]]) return NO;

    UIAlertController * alertController = [UIAlertController alertControllerWithTitle:@&quot;Shortcut Handled&quot; message:shortcutItem.localizedTitle preferredStyle: UIAlertControllerStyleAlert];
    UIAlertAction *alertAction = [UIAlertAction actionWithTitle:@&quot;OK&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;
    &#125;];
    [alertController addAction: alertAction];

    [self.window.rootViewController presentViewController: alertController animated: YES completion:nil];

    return handled;
&#125;

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;
    // Override point for customization after application launch.
//    Dynamic Shortcuts
    UIApplicationShortcutIcon * addIcon = [UIApplicationShortcutIcon iconWithType: UIApplicationShortcutIconTypeAdd];//Icons should be square, single color,

    UIApplicationShortcutItem * addItem = [[UIApplicationShortcutItem alloc]initWithType: @&quot;add&quot; localizedTitle: @&quot;Add&quot; localizedSubtitle: nil icon: addIcon userInfo: nil];

    [UIApplication sharedApplication].shortcutItems = @[addItem];

    BOOL shouldPerformAdditionalDelegateHandling    = YES;
    if (launchOptions[UIApplicationLaunchOptionsShortcutItemKey]) &#123;
        UIApplicationShortcutItem * shortcutItem = launchOptions[UIApplicationLaunchOptionsShortcutItemKey];
        self.launchedShortcutItem   = shortcutItem;
        // This will block &quot;performActionForShortcutItem:completionHandler&quot; from being called.
        shouldPerformAdditionalDelegateHandling     = NO;
    &#125;
    return shouldPerformAdditionalDelegateHandling;
&#125;

- (void)applicationWillEnterForeground:(UIApplication *)application &#123;
&#125;

- (void)applicationDidBecomeActive:(UIApplication *)application &#123;
    if(!self.launchedShortcutItem) &#123;
        return;
    &#125;
    [self handledShortCutItem: self.launchedShortcutItem];

    self.launchedShortcutItem   = nil;
&#125;

- (void) application:(UIApplication *)application performActionForShortcutItem:(UIApplicationShortcutItem *)shortcutItem completionHandler:(void (^)(BOOL))completionHandler
&#123;
    BOOL result = [self handledShortCutItem: shortcutItem];
    completionHandler(result);
&#125;

@end
</code></pre>
<p><span id="simulator_shortcuts"></span></p>
<h3 id="模拟器上测试Shortcuts"><a href="#模拟器上测试Shortcuts" class="headerlink" title="模拟器上测试Shortcuts"></a>模拟器上测试Shortcuts</h3><p>Xcode7.0 的模拟器是没办法之间触发出 3D Touch 事件的，好在有人开发出了插件<a target="_blank" rel="noopener" href="https://github.com/DeskConnect/SBShortcutMenuSimulator">SBShortcutMenuSimulator</a>.实用也很简单，只需要follow readme 中的 usage 便可。以下摘录</p>
<pre><code>git clone https://github.com/DeskConnect/SBShortcutMenuSimulator.git
cd SBShortcutMenuSimulator
make

xcrun simctl spawn booted launchctl debug system/com.apple.SpringBoard --environment DYLD_INSERT_LIBRARIES=$PWD/SBShortcutMenuSimulator.dylib
xcrun simctl spawn booted launchctl stop com.apple.SpringBoard

echo &#39;com.apple.mobilecal&#39; | nc 127.0.0.1 8000
</code></pre>
<p>‘com.apple.mobilecal’ 替换成你需要测试的app的bundle就可以了，例如我的是 <code>chengpei.shortcutDemo</code></p>
<pre><code>echo &#39;chengpei.shortcutDemo&#39; | nc 127.0.0.1 8000
</code></pre>
<p>上面的命令全都在clone的SBShortcutMenuSimulator目录下执行。</p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>以上。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/09/03/There-will-be-blood/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/09/03/There-will-be-blood/" class="post-title-link" itemprop="url">There Will Be Blood</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-09-03 23:47:22" itemprop="dateCreated datePublished" datetime="2015-09-03T23:47:22+08:00">2015-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-09-06 12:50:03" itemprop="dateModified" datetime="2015-09-06T12:50:03+08:00">2015-09-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Movie/" itemprop="url" rel="index"><span itemprop="name">Movie</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://cp0000.github.io/assets/there_will_be_blood.jpg" alt="pic"></p>
<blockquote>
</blockquote>
<p>如果你喜欢《老无所依》，去看《血色将至》<br>如果你喜欢西部片，去看《血色将至》<br>如果你喜欢电影，去看《血色将至》  </p>
<p>电影讲述的是一个银矿勘探者如何通过自身的艰苦奋斗最终成为石油大亨的故事。在观看影片的过程中，主角丹尼尔身上的所表现出来的气质，和我们今天所传扬的创业者身上的气质有着极大相似之处。（当然这些创业者的气质我也是从书中，网络中得来）。其中有两个场景给我映像极其深刻。</p>
<ul>
<li><p>场景一：丹尼尔刚刚开发的新油井发生不幸发生意外，井喷了。丹尼尔的儿子 H.W 在井喷中意外受伤。丹尼尔把受伤的儿子抱到安全地带之后，在明知道儿子因伤至聋，极其需要爸爸的情况下，毅然丢下了儿子，跑去事故现场救灾。当身边的伙伴皱着眉头看着大火的时候，丹尼尔却笑着说：你干嘛要愁眉头，井喷证明了下面埋藏着无穷的石油，我们要发财了。此时，他已经把H.W的情况抛之脑后，心里所想全部是采油的事情。当伙伴问他H.W怎么样了，他才想起来儿子情况很不好。影片此后的镜头就是海报中的场景，丹尼尔指挥者工人用炸药把油井炸封起来。</p>
</li>
<li><p>第二个场景是，为了运输开采出来的石油。丹尼尔决心建一条油管通往大海。但油管铺设遇到了需要通过一块没有弄到租借权的土地。为了能够租下这块地，丹尼尔忍辱负重跑去教堂接受小人Eli神父洗礼。洗礼过程中Eli出于对丹尼尔的嫉妒狠狠的打了几个丹尼尔耳光（个人觉得Eli是在嫉妒丹尼尔，嫉妒他给小镇带来了繁荣，嫉妒他的石油生意）。但此时的丹尼尔并不在意被Eli侮辱，他只在意这块地终于租下来了，石油管道的铺设有谱了，自己的石油生意真的要做起来了。（这里有个细节，在还没有和土地主人谈妥之前，丹尼尔已经在那块地上面打桩测量油管路线。这一情节，也表明了丹尼尔对自己能够说明别人把地租给他的强大自信）</p>
</li>
</ul>
<p>这两个场景都表现出了，丹尼尔对石油开采的极度专注和极大热情。开采过程的任何困难，挫折对于丹尼尔来说都不是问题，井喷不怕，火灾不怕，被小人侮辱无所谓。他眼中只关心和石油相关的事情，他探索油田，建筑油井，铺设油管，一切都是为了自己的石油生意。在生意路上遇到的问题，丹尼尔唯一做的就是自信满满的去解决它。</p>
<p>如果从资本家，企业家的角度来看丹尼尔，他无意是成功创业家的典范。创业后辈们无疑可以从他的事迹中汲取到很多的经验和养分。而他对当地石油的开采，无疑也提高当地人民的生活水平。</p>
<p>但这部电影不是单单讲述一个成功企业家的创业故事，还描述了丹尼尔作为一个人与这个上世界其它人的关系和情感。</p>
<p>我想绝大多数人应该都会害怕孤独吧，开心没人分享，失落无人倾诉。丹尼尔人生就是如此，影片开篇十几分钟跟默片一般，没有一句台词，镜头中只有丹尼尔一个人胡子拉渣的孤独的在矿井中勘探。有了油井，挣了初始资本之后，丹尼尔则每次都会带着H.W去做和卖家谈买卖。美国是一个清教徒国家，大家信上帝，非常重视家庭，大部分都会买亲情的帐。当在H.W变聋之后，为了专注工作，丹尼尔又能冷酷地把儿子从自己身边送走，寄养在别处。不过每个人都渴望亲情，渴望被别人所理解，丹尼尔内心深处也是如此。冒牌弟弟Henry的到来，让他在一段时间好似找到了久违的亲情。但可惜这个Henry是冒牌的，丹尼尔发现真相之后，开枪直接打死了冒牌的Henry，尽管冒牌Henry是唯一能和丹尼尔说得上话的人。</p>
<p>野心，孤独，对权力的欲望，虚伪，憎恶，不信任，丧失人性，这是丹尼尔作为人的一面。但与此同时，他却又是成功的资本家，他成功创业的事迹又会被当今的社会所传颂。或许按中国人的智慧，这就叫是非功过三七开吧。</p>
<p>熙熙皆为利来，攘攘皆为利往。丹尼尔这样的人在当代中国应该很受崇拜吧，应该会。</p>
<p>最后，摘录片中我喜欢的一段台词，也是丹尼尔唯一一次吐露自己心声的一段对话</p>
<p><strong>亨利：</strong><br>　　……你为什么离家出走？我知道你和父亲的关系不好。<br><strong>丹尼尔：</strong><br>　　我替地质调查局工作，去了堪萨斯。<br>　　我没法留在家里，不可能。<br>　　我不喜欢解释自己的行为。<br>　　……<br><strong>丹尼尔：</strong><br>　　你是个愤怒的人吗，亨利？<br><strong>亨利：</strong><br>　　愤怒什么？<br><strong>丹尼尔：</strong><br>　　你嫉妒吗？你会嫉妒别人吗？<br><strong>亨利：</strong><br>　　我想不会。不嫉妒。<br><strong>丹尼尔：</strong><br>　　我有一颗争强好胜的心。<br>　　我不想看到别人成功。<br>　　我憎恨大多数人。<br><strong>亨利：</strong><br>　　我已经没有那种心气了……<br>　　辛苦工作却总不能成功――所有的失败让我……我就不在乎了。<br><strong>丹尼尔：</strong><br>　　我心里有，你心里就也有。<br>　　有时候我注视着人群，看不到任何值得我爱的东西。<br>　　我只想挣到足够的钱好让我远离所有的人。<br>　　……<br><strong>丹尼尔：</strong><br>　　我不想提那些事。<br>　　我看到人们最丑陋的一面，亨利。<br>　　我能得到我所要的一切，根本用不着去看那些丑陋背后还有什么。<br>　　经过这么多年，我的仇恨一点一滴越积越深。<br>　　你来这儿，给了我喘息的机会。我自己一个人坚持不下去……同这些人纠缠。   </p>
<p><strong>英文版</strong></p>
<p><strong>Plainview</strong>: Are you an angry man. Henry?<br><strong>Henry Brands</strong>: About what?<br><strong>Plainview</strong>: Are you envious? D’you get envious?<br><strong>Henry Brands</strong>: I don’t think so. No.<br><strong>Plainview</strong>: I have a competition in me. I want no one else to succeed. I hate most people.<br><strong>Henry Brands</strong>: That part of me is gone. Working and not succeeding- all my, uh… failures has left me, uh… I just don’t… care.<br><strong>Plainview</strong>: Well, if it’s in me, it’s in you. There are times when I… I look at people and I see nothing worth liking. I want to earn enough money I can get away from everyone.<br><strong>Henry Brands</strong>: What will you do about your boy?<br><strong>Plainview</strong>: I don’t know. Uhhhh, maybe it’ll change. Does your sound come back to you? I don’t know. Maybe no one knows that. A doctor might not know that.<br><strong>Henry Brands</strong>: Where’s his mother?<br><strong>Plainview</strong>: I don’t want to talk about those things. I see the worst in people, Henry. I don’t need to look past seeing them to get all I need. I’ve built up my hatreds over the years, little by little. Having you here gives me a second breath of life. I can’t keep doing this on my own… with these, umm… people.   </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/08/30/openradarstream/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/08/30/openradarstream/" class="post-title-link" itemprop="url">Openradar Stream</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-08-30 22:02:42" itemprop="dateCreated datePublished" datetime="2015-08-30T22:02:42+08:00">2015-08-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:25:04" itemprop="dateModified" datetime="2017-10-06T22:25:04+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://cp0000.github.io/assets/radardetector2.jpg" alt="Openradar Stream"></p>
<h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>随着夏天的结束，9月份的到来，又到了苹果秋季发布新iPhone的季节了。我和绝大多数苹果用户一样对新的iPhone自然保留着一份期待。不过理智告诉我这次新的iPhone的release，应该不会给大家带来很大的惊喜。我猜测 iPhone6s 应该是一款针对 iPhone6 的升级产品。就像 iOS 9 是针对 iOS 8的一次升级，苹果公司内部在这一次的迭代中，主要精力应该是会放在“还债”上，之前release了太多的feature，遗留了太多的bug，会在这一次修复掉。</p>
<h4 id="Openradar-stream-的来由"><a href="#Openradar-stream-的来由" class="headerlink" title="Openradar stream 的来由"></a>Openradar stream 的来由</h4><p>和大多数 iOS developers 一样，我也在第一时间安装了 iOS 9 beta版本。满足了尝鲜感之后，随着而来就是 beta 系统的不稳定，以及各种的bug。用 iOS 9 进行开发的过程中，我遇到了许许多多的坑，对于一些系统的bug，会花费掉我很多的时间去debug。然后，我发现了<a target="_blank" rel="noopener" href="http://www.openradar.appspot.com/">openradar</a>。一个 open database of radars for Apple bug。从openradar 上，你可以看到其他开发者提交的bug，这当然会为你省去很多的时间，帮助你避免很多的坑。</p>
<p>后来我想我是不是应该做一个自动的脚本，定时的去抓取这个网页上面的信息，然后发到微博上。关注这个微博的人就可以在自己的时间线上面看到最新的bug了。这样做的好处是，一来你了解到bug信息，下次你遇到类似的问题，会联想到之前看过的bug信息，省去大量的时间。二来，刷微博的时候，还顺便学习了新知识，就没那么大的罪恶感了～。为此，我写一个tiny project，auto radarstream。</p>
<h4 id="具体工作"><a href="#具体工作" class="headerlink" title="具体工作"></a>具体工作</h4><p>完成openradarstream，有以下事情需要去做</p>
<p><strong>前期工作</strong></p>
<ul>
<li>申请一个微博账号，并申请微博OpenApi，获取到<code>apikey</code>和<code>apisecret</code>。</li>
<li>获取到微博的 accessToken， expires</li>
</ul>
<p><strong>开发工具</strong></p>
<ul>
<li>language: python</li>
<li>database: sqlite</li>
</ul>
<p><strong>细节</strong></p>
<ul>
<li><p>设置好微博的环境，其中微博的OpenAPI,使用开源库<a target="_blank" rel="noopener" href="https://github.com/michaelliao/sinaweibopy">sinaweibopy</a></p>
</li>
<li><p>初始化数据库</p>
<pre><code>  def initDB ():
      print &#39;initDB ...&#39;
      db = sqlite3.connect(sqlite_file)
      cursor = db.cursor()
      cursor.execute(&#39;&#39;&#39;CREATE TABLE IF NOT EXISTS
                        bugs(id INTEGER PRIMARY KEY, bugid TEXT, status TEXT, originator TEXT, product TEXT, title TEXT)&#39;&#39;&#39;)
      db.commit()
</code></pre>
</li>
<li><p>获取网站信息，并做相关处理。</p>
<p>  第一步利用 urllib2 获取<a target="_blank" rel="noopener" href="http://openradar.appspot.com/">openradar</a>主页信息。<br>  第二步对获取到的信息，利用 BeautifulSoap 对<code>html</code>进行解析，得到一个buglist。<br>  第三步，由于网页上面的信息是按时间降序的，而我们是希望最新的bug，在本次最后一个发布，这样这条bug会出现在微博主页时间线的最上头。所以我们这里反转buglist。<br>  第四步，遍历buglist，发布没有发布的bug，并把发布过的bug插入数据库存档。</p>
</li>
</ul>
<p>项目在Github上面的地址：<a target="_blank" rel="noopener" href="https://github.com/cp0000/radarstream">radarstream</a>。</p>
<h4 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h4><p><strong>To track open radar posts, please follow <a target="_blank" rel="noopener" href="http://weibo.com/p/1005051666350201">@openradarstream</a></strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/08/22/UICollectionView-Has-Easy-Reording-On-iOS9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/08/22/UICollectionView-Has-Easy-Reording-On-iOS9/" class="post-title-link" itemprop="url">UICollectionViews Now Have Easy Reordering （译）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-08-22 09:52:28" itemprop="dateCreated datePublished" datetime="2015-08-22T09:52:28+08:00">2015-08-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-11-07 23:46:54" itemprop="dateModified" datetime="2015-11-07T23:46:54+08:00">2015-11-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="iOS-9-0-UICollectionView-拖拽效果实现"><a href="#iOS-9-0-UICollectionView-拖拽效果实现" class="headerlink" title="iOS 9.0 UICollectionView 拖拽效果实现"></a>iOS 9.0 UICollectionView 拖拽效果实现</h1><blockquote>
<p>原文 <a target="_blank" rel="noopener" href="http://nshint.io/blog/2015/07/16/uicollectionviews-now-have-easy-reordering/">UICollectionViews Now Have Easy Reordering</a></p>
</blockquote>
<p>在<code>UICollectionView</code> 刚出来的时候，我就对其产生了很大的兴趣。相比它的大哥 <code>UITableView</code>，它更加容易进行一些自定义的操作。我们组现在在项目中使用 <code>UICollectionView</code> 要多于 <code>UITableView</code>。伴随着 iOS 9 的 release，<code>UICollectionView</code>排序（动态拖拽）更加简单。在这之前，如果想对 <code>UICollectionView</code> 进行动态拖拽是非常困难的，要想实现动态拖拽，需要去做非常多的工作。话不多说，我们看一下新的 API。文章用到的Sample地址<a target="_blank" rel="noopener" href="https://github.com/nshintio/uicollectionview-reordering">uicollectionview-reordering</a>。</p>
<p>实现拖动排序最简单的办法是使用 <code>UICollectionViewController</code>, 在 <code>UICollectionViewController</code> 中新增了一个属性  <code>installsStandardGestureForInteractiveMovement</code>, 通过添加手势对cells进行重排。该属性是BOOL型，默认值为 YES。     我们所需要做的，只要重载下面这个方法就好了.</p>
<pre><code>override func collectionView(collectionView: UICollectionView,
    moveItemAtIndexPath sourceIndexPath: NSIndexPath,
    toIndexPath destinationIndexPath: NSIndexPath) &#123;
    // move your data order
&#125;
</code></pre>
<p>当程序中重载了<code>moveItemAtIndexPath</code>，collectionView 就认为 cell 是可以移动的。</p>
<pre><code>![reordering-01](http://nshint.io/images/uicollectionview-reordering/1.gif)
</code></pre>
<p>那如果需要给某一个 <code>UIViewController</code> 中 collection view 实现动态拖动效果，该如何实现呢？事情会变的稍微复杂一点。除了需要实现<code>UICollectionViewDataSource</code>中上面提到的代理方法，还需要重写 <code>installsStandardGestureForInteractiveMovement</code>。不过不用当心，实现起来蛮蛮容易。这里我们需要长按手势<code>UILongPressGestureRecognizer</code>，它能够完全满足拖拽需求。</p>
<pre><code>override func viewDidLoad() &#123;
    super.viewDidLoad()
    longPressGesture = UILongPressGestureRecognizer(target: self, action: &quot;handleLongGesture:&quot;)
    self.collectionView.addGestureRecognizer(longPressGesture)
&#125;

func handleLongGesture(gesture: UILongPressGestureRecognizer) &#123;

    switch(gesture.state) &#123;

    case UIGestureRecognizerState.Began:
        guard let selectedIndexPath = self.collectionView.indexPathForItemAtPoint(gesture.locationInView(self.collectionView)) else &#123;
            break
        &#125;
        collectionView.beginInteractiveMovementForItemAtIndexPath(selectedIndexPath)
    case UIGestureRecognizerState.Changed:
        collectionView.updateInteractiveMovementTargetPosition(gesture.locationInView(gesture.view!))
    case UIGestureRecognizerState.Ended:
        collectionView.endInteractiveMovement()
    default:
        collectionView.cancelInteractiveMovement()
    &#125;
&#125;
</code></pre>
<p>这段代码主要是给 collectionView 添加一个长手势识别器，并根据手势的不同状态调用collectionView的相关方法。</p>
<ul>
<li><code>beginInteractiveMovementForItemAtIndexPath(indexPath: NSIndexPath)</code>: 该方法在开始拖拽某个cell时被调用</li>
<li><code>updateInteractiveMovementTargetPosition(targetPosition:CGPoint)</code>: 根据手势更新拖拽cell的位置</li>
<li><code>endInteractiveMovement()</code>: 手势结束时调用，结束拖拽</li>
<li><code>cancelInteractiveMovement()</code>: 手势取消时调用，取消拖拽</li>
</ul>
<p>这样就实现了需要的拖拽效果：</p>
<p><img src="http://nshint.io/images/uicollectionview-reordering/2.gif" alt="reordering_collection_view"></p>
<p>这段代码出来的效果和 <code>UICollectionViewController</code> 是一致的。很厉害吧，但更厉害的是我们可以用上面的方法对自定义的 collection view layout 进行拖拽。下面我们来实现一个简单的瀑布流。</p>
<p><img src="http://nshint.io/images/uicollectionview-reordering/3.gif" alt="reordering_waterfall"></p>
<p>昂～，看起来还凑合，但在移动的时候cell的size被改变了呢，如何才能保持cell的size不变呢？ <code>UICollectionViewLayout</code>提供了相关办法可以帮助我们解决这个问题。</p>
<pre><code>func invalidationContextForInteractivelyMovingItems(targetIndexPaths: [NSIndexPath],
    withTargetPosition targetPosition: CGPoint,
    previousIndexPaths: [NSIndexPath],
    previousPosition: CGPoint) -&gt; UICollectionViewLayoutInvalidationContext

func invalidationContextForEndingInteractiveMovementOfItemsToFinalIndexPaths(indexPaths: [NSIndexPath],
    previousIndexPaths: [NSIndexPath],
    movementCancelled: Bool) -&gt; UICollectionViewLayoutInvalidationContext
</code></pre>
<ul>
<li><p>第一个函数会在 cells 拖拽过程中被调用</p>
</li>
<li><p>第二个函数会在拖拽结束时候被调用。有了这些信息，我们可以使用一点小技巧去实现cell size不被改变的功能。</p>
<p>  internal override func invalidationContextForInteractivelyMovingItems(targetIndexPaths: [NSIndexPath],</p>
<pre><code>  withTargetPosition targetPosition: CGPoint,
  previousIndexPaths: [NSIndexPath],
  previousPosition: CGPoint) -&gt; UICollectionViewLayoutInvalidationContext &#123;

  var context = super.invalidationContextForInteractivelyMovingItems(targetIndexPaths,
      withTargetPosition: targetPosition, previousIndexPaths: previousIndexPaths,
      previousPosition: previousPosition)

  self.delegate?.collectionView!(self.collectionView!, moveItemAtIndexPath: previousIndexPaths[0],
      toIndexPath: targetIndexPaths[0])

  return context
</code></pre>
<p>  }</p>
</li>
</ul>
<p>解决方法很直接。获取当前被拖拽的cell的起始indexPath和目标indexPath,然后调用UICollectionViewDataSource代理方法移动当前正在被拖拽的cell。</p>
<p>一个可以拖拽的的collectionView带来体验效果真的非常棒～</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/08/02/mdfind-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/08/02/mdfind-note/" class="post-title-link" itemprop="url">Spotlight & MDFind</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-08-02 11:31:18" itemprop="dateCreated datePublished" datetime="2015-08-02T11:31:18+08:00">2015-08-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-11-07 23:47:32" itemprop="dateModified" datetime="2015-11-07T23:47:32+08:00">2015-11-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="Indexing-服务"><a href="#Indexing-服务" class="headerlink" title="Indexing 服务"></a>Indexing 服务</h4><p>Maocx 系统的搜索服务 <code>spotlight</code> 想必大家都用过。它可以很便捷的帮我们找到想要的文件。</p>
<p>先举个例子，在 spotlight 中输入 _loadBlock， 我的电脑会出现以下结果：</p>
<p><img src="http://cp0000.github.io/assets/loadBlock.png" alt="loadBlock"></p>
<p>spotlight 帮我找到了包含 <code>_loadBlock</code> 这个字符串的文件。</p>
<p>想象下，电脑硬盘中存储着如此多的文件，<strong>spotlight 是如何如此快速的查询到包涵这个字符串的文件的？</strong></p>
<p>在查找答案之前，我们不妨自己来试着猜想一下，如果这个功能交给我们自己来做，我们会采用哪种技术方案来实现？<br>关于文件搜索，首先能想到的最简单的方法自然是遍历目录逐个文件对比，使用 <code>find</code> 的方式去查询。不过稍微想一下，如果使用这种方法在整个硬盘上找一个文件，得等多久才能找到一个文件。这肯定不是解决方案。<strong>那答案是什么？</strong></p>
<p>我们不妨先把目光放到<code>搜索</code>这两个字上。提到搜索，首先想到的应该会是Google。而关于Google搜索引擎的工作原理，最简单的解释是：通过代码在全球收集信息，建立词组的索引数据库。Google处理用户的搜索请求，可以简单的理解成在索引数据库中查找结果的过程。<br>那 Macosx 的本地文件搜索会不会也是采取这种索引数据库的方式来实现的？答案是肯定的。Macosx 实现了自己的<code>indexing</code>的索引服务。那什么是<code>indexing</code>索引服务器，简单来讲： Macosx 系统会在平时建立磁盘上所有文件和目录的索引关系，维护出一个索引表，当要查找信息时直接从索引中查询即可。这个索引就好像是一本书的目录一样，我们根据自己要找的内容翻到对应的页面。</p>
<p>当然这当中还有很多复杂的处理过程，如当机器运行时，硬盘的文件产生变化，如何重新加载索引文件。更多的细节，我也没找出相关的文档来得到答案。先留个坑在这里吧。不过我们可以从其他开源的文件查询项目中了解一下业界对于这一块的处理方式。这里推荐 <a target="_blank" rel="noopener" href="https://lucene.apache.org/">Lucene</a> 给大家研究。（Lucene是一套用于全文检索和搜素的开源项目）。</p>
<h4 id="mdfind"><a href="#mdfind" class="headerlink" title="mdfind"></a>mdfind</h4><p>用 spotlight 的图形界面查询文件是很方便.但是我平常的工作过程中，常常需要知道文件的绝对路径，而图形界面并没有显示出来。<strong>关于如何在spotlight界面显示文件的详细路径</strong>，这里有个小 tips，具体操作是：选中某个搜索结果，长按 command 键，此时，界面右下方会出现文件的详细路径。不过如果文件路径太长，界面会显示不全，而且也有很好的没法去拷贝这个路径。</p>
<p><strong>那如何解决文件路径显示不全，无法拷贝文件路径的问题呢？</strong></p>
<p>Macosx 提供了终端执行命令<code>mdfind</code>，我们可以在 terminal 中使用<code>mdfind</code>来进行索引查询。比如要查询出文件内容中包含字符串 “_loadBlock”, 在ternimal中输入以下命令即可：</p>
<pre><code>mdfind &#39;kMDItemTextContent=&quot;_loadBlock&quot;&#39; 
</code></pre>
<p>results:</p>
<pre><code>/opt/dev/appstore_cracked/StoreKit_headers/SKStorePageViewController.h
/opt/dev/appstore_cracked/StoreKit_headers/SKStoreProductViewController.h
/opt/dev/iOS-Runtime-Headers/PrivateFrameworks/iTunesStoreUI.framework/SUWebViewController.h
/opt/dev/iOS-Runtime-Headers/PrivateFrameworks/iTunesStoreUI.framework/SUStorePageViewController.h
/opt/dev/iOS-Runtime-Headers/PrivateFrameworks/iTunesStoreUI.framework/SUPreviewOverlayViewController.h
/opt/dev/iOS-Runtime-Headers/PrivateFrameworks/Preferences.framework/PSLazyImagePromise.h
/opt/dev/iOS-Runtime-Headers/Frameworks/StoreKit.framework/SKStoreProductViewController.h
/opt/dev/iOS-Runtime-Headers/Frameworks/StoreKit.framework/SKStorePageViewController.h
</code></pre>
<p>对比终端查询结果和图一中的结果，会发现有两点出入：</p>
<ul>
<li>(1) 图一中的 PrivateFrameworks, Frameworks 整个目录都没有被查出来。这里我猜测应该是Soptlight这个应用是对查询结果进行了筛选，把PrivateFrameworks, Frameworks目录下的文件从查询结果中剔除掉了。</li>
<li>(2) 图一中出现的nsBlocklistService.js，在terminal的查询结果中并没有出现。为了找出原因，我分别查看下”_loadBlock”在各个文件中的上下文，以下是节选</li>
</ul>
<p>nsBlocklistService.js</p>
<pre><code>this._loadBlocklist();
</code></pre>
<p>SKStorePageViewController</p>
<pre><code>CDUnknownBlockType _loadBlock;
</code></pre>
<p>看上去问题应该是出在<code>_loadBlock</code>前后是否能跟别的字符串上，修改查询语句</p>
<pre><code>mdfind &#39;kMDItemTextContent=&quot;_loadBlock*&quot;&#39; 
</code></pre>
<p>果然可以查询到结果</p>
<pre><code>/Project/mozilla-central/toolkit/mozapps/extensions/nsBlocklistService.js
</code></pre>
<p>关于 mdfind 的一些常用查询语法，可参考 <a target="_blank" rel="noopener" href="http://osxnotes.net/spotlight.html"><code>osxnotes</code></a>，这里列举了大量的例子。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/07/23/oc-checklist-answers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/07/23/oc-checklist-answers/" class="post-title-link" itemprop="url">Objc Interview Checklist Answers</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-07-23 21:12:55" itemprop="dateCreated datePublished" datetime="2015-07-23T21:12:55+08:00">2015-07-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:24:17" itemprop="dateModified" datetime="2017-10-06T22:24:17+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="property中有哪些属性关键字？"><a href="#property中有哪些属性关键字？" class="headerlink" title="@property中有哪些属性关键字？"></a>@property中有哪些属性关键字？</h4><p>nonatomic (thread-unsafe)<br>atomic (default, thread safe)</p>
<p>strong<br>weak<br>assign<br>copy</p>
<p>getter (custom getter method name)<br>setter (custom setter method name)</p>
<p>readwrite (default)<br>readonly</p>
<h4 id="weak属性需要在dealloc中置nil么？"><a href="#weak属性需要在dealloc中置nil么？" class="headerlink" title="weak属性需要在dealloc中置nil么？"></a>weak属性需要在dealloc中置nil么？</h4><p>不需要，runtime会在weak属性在释放的时候，自动把变量至为 nil;</p>
<h4 id="synthesize和-dynamic分别有什么作用？"><a href="#synthesize和-dynamic分别有什么作用？" class="headerlink" title="@synthesize和@dynamic分别有什么作用？"></a>@synthesize和@dynamic分别有什么作用？</h4><p>@synthesize 自动生成属性 getter 和 setter 方法.<br>LLVM Compiler 4.0之后，编译器会对@property 属性自动的添加 @synthesize ivar = _ivar,自动帮你生成 getter/setter 方法，以及自动绑定_ivar 实例变量。</p>
<p>@dynamic 是为了告诉编译器，getter/setter 方法将会在其他地方（父类，runtime）实现，这样可以消除warnnig</p>
<h4 id="ARC下，不显式指定任何属性关键字时，默认的关键字都有哪些？"><a href="#ARC下，不显式指定任何属性关键字时，默认的关键字都有哪些？" class="headerlink" title="ARC下，不显式指定任何属性关键字时，默认的关键字都有哪些？"></a>ARC下，不显式指定任何属性关键字时，默认的关键字都有哪些？</h4><p>atomic, assign, readwrite</p>
<h4 id="用-property声明的NSString（或NSArray，NSDictionary）经常使用copy关键字，为什么？如果改用strong关键字，可能造成什么问题？"><a href="#用-property声明的NSString（或NSArray，NSDictionary）经常使用copy关键字，为什么？如果改用strong关键字，可能造成什么问题？" class="headerlink" title="用@property声明的NSString（或NSArray，NSDictionary）经常使用copy关键字，为什么？如果改用strong关键字，可能造成什么问题？"></a>用@property声明的NSString（或NSArray，NSDictionary）经常使用copy关键字，为什么？如果改用strong关键字，可能造成什么问题？</h4><p><a target="_blank" rel="noopener" href="http://cp0000.github.io/2015/07/19/nsstring-property-copy-or-retain/">NSString Property:copy or retain</a></p>
<h4 id="synthesize合成实例变量的规则是什么？假如property名为foo，存在一个名为-foo的实例变量，那么还会自动合成新变量么？"><a href="#synthesize合成实例变量的规则是什么？假如property名为foo，存在一个名为-foo的实例变量，那么还会自动合成新变量么？" class="headerlink" title="@synthesize合成实例变量的规则是什么？假如property名为foo，存在一个名为_foo的实例变量，那么还会自动合成新变量么？"></a>@synthesize合成实例变量的规则是什么？假如property名为foo，存在一个名为_foo的实例变量，那么还会自动合成新变量么？</h4><p>首先 complier 会根据 @interface 中的 @property 属性自动生成一份属性名前加<code>_</code>的实例变量。LLVM Compiler 4.0 之后，会自动添加@synthesize ivar = _ivar。</p>
<p>自定义的实例变量 _foo 会和 foo 会自动合成。</p>
<pre><code>@interface ViewController ()
@property (nonatomic, assign) NSInteger foo;
@end

@implementation ViewController
&#123;
    NSInteger _foo;
&#125;

- (void)viewDidLoad &#123;
    [super viewDidLoad];
    _foo = 90;
    NSLog(@&quot;self.foo: %ld&quot;, (long)self.foo); //self.foo: 90
&#125;
</code></pre>
<p>然后还有一个现象：</p>
<pre><code>@interface ViewController ()
@property (nonatomic, assign) NSInteger foo;
@end

@implementation ViewController
&#123;
    NSInteger foo;
&#125;
</code></pre>
<p>complier 会报 warning : Autosynthesized property ‘foo’ will use synthesized instance variable ‘_foo’, not existing instance variable ‘foo’</p>
<h4 id="在有了自动合成属性实例变量之后，-synthesize还有哪些使用场景？"><a href="#在有了自动合成属性实例变量之后，-synthesize还有哪些使用场景？" class="headerlink" title="在有了自动合成属性实例变量之后，@synthesize还有哪些使用场景？"></a>在有了自动合成属性实例变量之后，@synthesize还有哪些使用场景？</h4><pre><code>@interface ViewController
@property (nonatomic, assign) NSInteger foo;
@end

@implementation ViewController
&#123;
    NSInteger _foo3;

&#125;
@synthesize foo = _foo3;
</code></pre>
<p>这样 .m 中就可以 _foo3, 开放给外部的接口 foo，可以隐藏实例变量的名称。</p>
<h4 id="objc中向一个nil对象发送消息将会发生什么？"><a href="#objc中向一个nil对象发送消息将会发生什么？" class="headerlink" title="objc中向一个nil对象发送消息将会发生什么？"></a>objc中向一个nil对象发送消息将会发生什么？</h4><ul>
<li>nil is basically a null pointer (i.e it is the number zero stored in a pointer).</li>
<li>All messages to nil are legal (they won’t cause a  crash), but they dont’t do anything.</li>
<li>All messages to nil return nil, or 0, or 0.0, or NO, depending on the return type.</li>
</ul>
<h4 id="objc中向一个对象发送消息-obj-foo-和objc-msgSend-函数之间有什么关系？"><a href="#objc中向一个对象发送消息-obj-foo-和objc-msgSend-函数之间有什么关系？" class="headerlink" title="objc中向一个对象发送消息[obj foo]和objc_msgSend()函数之间有什么关系？"></a>objc中向一个对象发送消息[obj foo]和objc_msgSend()函数之间有什么关系？</h4><p>简单来讲 compiler 会把 [receiver message] 转换成 objc_msgSend(receiver, selector, arg1, arg2, …)</p>
<h4 id="什么时候会报unrecognized-selector的异常？"><a href="#什么时候会报unrecognized-selector的异常？" class="headerlink" title="什么时候会报unrecognized selector的异常？"></a>什么时候会报unrecognized selector的异常？</h4><ul>
<li>the object’s class, the object’s superclass, the root class, all of them are not implement the called message.</li>
<li>the reveiver has been released</li>
</ul>
<h4 id="一个objc对象如何进行内存布局？（考虑有父类的情况）"><a href="#一个objc对象如何进行内存布局？（考虑有父类的情况）" class="headerlink" title="一个objc对象如何进行内存布局？（考虑有父类的情况）"></a>一个objc对象如何进行内存布局？（考虑有父类的情况）</h4><ul>
<li>所有父类的成员变量和自己的成员变量都会存放在该对象所对应的存储空间中</li>
<li>每一个对象内部都有一个isa指针，指向他的类对象，类对象中存放着本对象的 1）对象方法列表（对象能够接收的消息列表，保存在它所对应的类对象中）<br>2）成员变量的列表<br>3）属性列表</li>
</ul>
<h4 id="一个objc对象的isa的指针指向什么？有什么作用？"><a href="#一个objc对象的isa的指针指向什么？有什么作用？" class="headerlink" title="一个objc对象的isa的指针指向什么？有什么作用？"></a>一个objc对象的isa的指针指向什么？有什么作用？</h4><p>每一个对象都有一个名为 isa 的指针，指向该对象的类。每一个类描述了一系列它的实例特点，包括成员变量的列表，成员函数的列表等。<br>所有元类的 isa 指针都会指向一个根元类（root <code>metaclass</code>）.</p>
<h4 id="下面的代码输出什么？"><a href="#下面的代码输出什么？" class="headerlink" title="下面的代码输出什么？"></a>下面的代码输出什么？</h4><pre><code>@implementation Son : Father
- (id)init
&#123;
    self = [super init];
    if (self) &#123;
        NSLog(@&quot;%@&quot;, NSStringFromClass([self class]));
        NSLog(@&quot;%@&quot;, NSStringFromClass([super class]));
    &#125;
    return self;
&#125;
@end
</code></pre>
<p>都是 Son  </p>
<p>调用[self class]，会转换成 id objc_msgSend(id self, SEL op, …)， 在使用 objc_msgSend 时，第一个参数是 Son 当前的这个实例。第二个参数， 先从 Son 类中找 - (Class) class，没找到， 去父类 Father 中找，也没有，再去 Father 的父类 NSObject 中去找，在 NSObject 的类中发现这个 class 方法， 而 NSObject 的 - (Class) class 的实现就是返回 self 的类别，所以上述结果为 Son</p>
<p>objc runtime 开源代码对 - (Class) class 方法的实现</p>
<pre><code>- (Class) class &#123;
    return object_getClass (self);
&#125;
</code></pre>
<p>当调用 [super class],会转换成 objc_msgSendSuper 函数。</p>
<pre><code>id objc_msgSendSuper(struct objc_super *super, SEL op, ...)
</code></pre>
<p>其中 objc_super 的结构体为</p>
<pre><code>struct objc_super &#123;
   __unsafe_unretained id receiver;
   __unsafe_unretained Class super_class;
&#125;;
</code></pre>
<p>第一步：构造 objc_super 结构体的时候， 结构体第一个成员变量是 self， 第二个成员变量是 (id) class_getSuperclass(objc_getClass(“Son”)), 函数输出结果是为 Father。<br>第二步：去 Father 这个类里找 - (Class) class, 最后一层层在  NSObject 类中找到。最后内部使用 objc_msgSend(objc_super-&gt;receiver, @selector(class)) 去调用， 此时已经和 [self class] 调用相同了。</p>
<h4 id="runtime如何通过selector找到对应的IMP地址？（分别考虑类方法和实例方法）"><a href="#runtime如何通过selector找到对应的IMP地址？（分别考虑类方法和实例方法）" class="headerlink" title="runtime如何通过selector找到对应的IMP地址？（分别考虑类方法和实例方法）"></a>runtime如何通过selector找到对应的IMP地址？（分别考虑类方法和实例方法）</h4><p>NSObject.h</p>
<pre><code>- (IMP)methodForSelector:(SEL)aSelector
</code></pre>
<p>objc-class.m </p>
<pre><code>IMP class_getMethodImplementation(Class cls, SEL sel)
</code></pre>
<p>每一个类对象中管理者一个methodlist,方法列表中记录着方法的名称,方法实现,以及参数类型.</p>
<h4 id="使用runtime-Associate方法关联的对象，需要在主对象dealloc的时候释放么？"><a href="#使用runtime-Associate方法关联的对象，需要在主对象dealloc的时候释放么？" class="headerlink" title="使用runtime Associate方法关联的对象，需要在主对象dealloc的时候释放么？"></a>使用runtime Associate方法关联的对象，需要在主对象dealloc的时候释放么？</h4><p>无论在MRC下还是ARC下均不需要</p>
<p>对象的内存销毁时间表，分四个步骤</p>
<pre><code>1. 调用 -release ：引用计数变为零
    * 对象正在被销毁，生命周期即将结束.
    * 不能再有新的 __weak 弱引用， 否则将指向 nil.
    * 调用 [self dealloc] 
2. 父类 调用 -dealloc
    * 继承关系中最底层的父类 在调用 -dealloc
    * 如果是 MRC 代码 则会手动释放实例变量们（iVars）
    * 继承关系中每一层的父类 都在调用 -dealloc
3. NSObject 调 -dealloc
    * 只做一件事：调用 Objective-C runtime 中的 object_dispose() 方法
4. 调用 object_dispose()
    * 为 C++ 的实例变量们（iVars）调用 destructors 
    * 为 ARC 状态下的 实例变量们（iVars） 调用 -release 
    * 解除所有使用 runtime Associate方法关联的对象
    * 解除所有 __weak 引用
    * 调用 free()
</code></pre>
<h4 id="objc中的类方法和实例方法有什么本质区别和联系？"><a href="#objc中的类方法和实例方法有什么本质区别和联系？" class="headerlink" title="objc中的类方法和实例方法有什么本质区别和联系？"></a>objc中的类方法和实例方法有什么本质区别和联系？</h4><p>类方法：</p>
<ul>
<li>类方法是属于类对象的</li>
<li>类方法只能通过类对象调用</li>
<li>类方法中的self是类对象</li>
<li>类方法可以调用其他的类方法</li>
<li>类方法中不能访问成员变量</li>
<li>类方法中不定直接调用对象方法</li>
</ul>
<p>实例方法：</p>
<ul>
<li>实例方法是属于实例对象的</li>
<li>实例方法只能通过实例对象调用</li>
<li>实例方法中的self是实例对象</li>
<li>实例方法中可以访问成员变量</li>
<li>实例方法中直接调用实例方法</li>
<li>实例方法中也可以调用类方法(通过类名)</li>
</ul>
<p>####_objc_msgForward函数是做什么的，直接调用它将会发生什么？</p>
<h4 id="runtime如何实现weak变量的自动置nil？"><a href="#runtime如何实现weak变量的自动置nil？" class="headerlink" title="runtime如何实现weak变量的自动置nil？"></a>runtime如何实现weak变量的自动置nil？</h4><p>runtime 对注册的类， 会进行布局，对于 weak 对象会放入一个 hash 表中。 用 weak 指向的对象地址作为 key，当此对象的引用计数为0的时候会 dealloc.假如 weak 指向的对象内存地址是a，那么就会以a为键， 在这个 weak 表中搜索，找到所有以a为键的 weak 对象，从而设置为 nil。</p>
<h4 id="能否向编译后得到的类中增加实例变量？能否向运行时创建的类中添加实例变量？为什么？"><a href="#能否向编译后得到的类中增加实例变量？能否向运行时创建的类中添加实例变量？为什么？" class="headerlink" title="能否向编译后得到的类中增加实例变量？能否向运行时创建的类中添加实例变量？为什么？"></a>能否向编译后得到的类中增加实例变量？能否向运行时创建的类中添加实例变量？为什么？</h4><ul>
<li>不能向编译后得到的类中增加实例变量；</li>
<li>能向运行时创建的类中添加实例变量；</li>
</ul>
<p>解释下：</p>
<p>＋ 编译后的类已经注册在runtime中，类结构体中的 objc_ivar_list 实例变量的链表和 instance_size 实例变量的内存大小已经确定，同时 runtime 会调用 class_setIvarLayout 或 class_setWeakivarLayout 来处理 strong weak 引用。所以不能向存在的类中添加实例变量；</p>
<ul>
<li>运行时创建的类是可以添加实例变量，调用 class_addIvar 函数。但是得在调用 objc_allocateClassPair 之后，objc_registerClassPair 之前，原因同上。</li>
</ul>
<h4 id="runloop和线程有什么关系？"><a href="#runloop和线程有什么关系？" class="headerlink" title="runloop和线程有什么关系？"></a>runloop和线程有什么关系？</h4><p>首先 runloop 是一直运行着的循环。run loops 是线程的基础架构部分。每个线程都有与之相对应的 runloop 对象。</p>
<ul>
<li>主线的的runloop默认是开启的</li>
<li>其他线程的runloop是默认没有开启的</li>
</ul>
<h4 id="runloop的mode作用是什么？"><a href="#runloop的mode作用是什么？" class="headerlink" title="runloop的mode作用是什么？"></a>runloop的mode作用是什么？</h4><p>model 主要是用来指定时间在运行循环中的优先级的<br>苹果公开提供的 Mode 有两个：<br>kCFRunLoopDefaultMode<br>kCFRunLoopCommonModes</p>
<h4 id="以-scheduledTimerWithTimeInterval…的方式触发的timer，在滑动页面上的列表时，timer会暂定回调，为什么？如何解决？"><a href="#以-scheduledTimerWithTimeInterval…的方式触发的timer，在滑动页面上的列表时，timer会暂定回调，为什么？如何解决？" class="headerlink" title="以+ scheduledTimerWithTimeInterval…的方式触发的timer，在滑动页面上的列表时，timer会暂定回调，为什么？如何解决？"></a>以+ scheduledTimerWithTimeInterval…的方式触发的timer，在滑动页面上的列表时，timer会暂定回调，为什么？如何解决？</h4><p>Runloop 只能运行在一种model 下，如果要换mode，当前的runloop也需要停下来重启成新的。利用这个机制，Scrollview滚动过程中NSDefaultRUnllopMode(kCFRunLoopDefaultMode)的mode会切换到UITrackingRunLoopMode来保证ScrollView的流畅滑动：只能在NSDefaultRunloopMode模式下处理的事件会影响scrollview的滑动。</p>
<p>如果我们把一个NSTimer对象以NSDefaultRunLoopMode(kCFRunLoopDefaultMode)添加到主运行循环中的时候，ScrollView滚动过程中会因为mode的切换，而导致NSTimer将不再被调度。同时因为mode还是可定制的，所以：Timer 计时会被scrollview的滑动影响的问题可以通过将timer添加到NSRunLoppCommonModes(kCFRunLoopCommonModes)来解决。</p>
<pre><code>//将timer添加到NSDefaultRunLoopMode中
[NSTimer scheduledTimerWithTimeInterval:1.0
     target:self
     selector:@selector(timerTick:)
     userInfo:nil
     repeats:YES];
//然后再添加到NSRunLoopCommonModes里
NSTimer *timer = [NSTimer timerWithTimeInterval:1.0
     target:self
     selector:@selector(timerTick:)
     userInfo:nil
     repeats:YES];
[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes];
</code></pre>
<h4 id="猜想runloop内部是如何实现的？"><a href="#猜想runloop内部是如何实现的？" class="headerlink" title="猜想runloop内部是如何实现的？"></a>猜想runloop内部是如何实现的？</h4><pre><code>while (date &lt; untileDate) &#123;
    id event = listenEvent (); 
    handleEvent (v);
&#125;
</code></pre>
<h4 id="objc使用什么机制管理对象内存？"><a href="#objc使用什么机制管理对象内存？" class="headerlink" title="objc使用什么机制管理对象内存？"></a>objc使用什么机制管理对象内存？</h4><p>通过 retainCount 的机制来决定对象是否需要释放每次 runloop 的时候，都会检查对象的retainCount，如果retainCount 为 0，说明该对象没有地方需要继续使用了，可以释放掉了。</p>
<h4 id="ARC通过什么方式帮助开发者管理内存？"><a href="#ARC通过什么方式帮助开发者管理内存？" class="headerlink" title="ARC通过什么方式帮助开发者管理内存？"></a>ARC通过什么方式帮助开发者管理内存？</h4><p>编译时根据代码上下文，插入 retain/release </p>
<h4 id="不手动指定autoreleasepool的前提下，一个autorealese对象在什么时刻释放？（比如在一个vc的viewDidLoad中创建）"><a href="#不手动指定autoreleasepool的前提下，一个autorealese对象在什么时刻释放？（比如在一个vc的viewDidLoad中创建）" class="headerlink" title="不手动指定autoreleasepool的前提下，一个autorealese对象在什么时刻释放？（比如在一个vc的viewDidLoad中创建）"></a>不手动指定autoreleasepool的前提下，一个autorealese对象在什么时刻释放？（比如在一个vc的viewDidLoad中创建）</h4><p>在每次 eventloop 开始创建自动创建释放池， 在每次事件结束销毁自动释放池。<br>以 viewDidLoad 方法为例，在viewDidLoad方法开始执行之前创建自动释放池,在viewDidAppear方法执行之后销毁自动释放池。</p>
<h4 id="BAD-ACCESS在什么情况下出现？"><a href="#BAD-ACCESS在什么情况下出现？" class="headerlink" title="BAD_ACCESS在什么情况下出现？"></a>BAD_ACCESS在什么情况下出现？</h4><ul>
<li>访问了野指针</li>
<li>死循环</li>
</ul>
<h4 id="苹果是如何实现autoreleasepool的？"><a href="#苹果是如何实现autoreleasepool的？" class="headerlink" title="苹果是如何实现autoreleasepool的？"></a>苹果是如何实现autoreleasepool的？</h4><p>autoreleasepool以一个队列数组的形式实现，主要通过下列三个函数完成.</p>
<ul>
<li>objc_autoreleasepoolPush</li>
<li>objc_autoreleasepoolPop</li>
<li>objc_autorelease</li>
</ul>
<p>对autorelease分别执行push，和pop操作。销毁对象时执行release操作。</p>
<h4 id="使用block时什么情况会发生引用循环，如何解决？"><a href="#使用block时什么情况会发生引用循环，如何解决？" class="headerlink" title="使用block时什么情况会发生引用循环，如何解决？"></a>使用block时什么情况会发生引用循环，如何解决？</h4><p>一个对象对 block 进行了强引用，而在 block 内部有直接使用到该对象。</p>
<p>声明一个 weak 的对象指向该对象， 在 block 内部使用该 weak 对象。</p>
<pre><code>id weak weakSelf = self; 或者 weak __typeof(&amp;*self)weakSelf = self该方法可以设置宏
id __block weakSelf = self;
</code></pre>
<h4 id="在block内如何修改block外部变量？"><a href="#在block内如何修改block外部变量？" class="headerlink" title="在block内如何修改block外部变量？"></a>在block内如何修改block外部变量？</h4><p>默认情况下，在block中访问的外部变量时复制过去的，既：写操作不对原变量生效。但是可以通过加上__block修饰外部变量。</p>
<pre><code>__block int a = 0;
void  (^foo)(void) = ^&#123; 
    a = 1; 
&#125;
f00();
</code></pre>
<p>实现原理，简单来讲，外部变量通过指针传递，将变量传递到 block 内，所以可以修改变量值。</p>
<h4 id="使用系统的某些block-api（如UIView的block版本写动画时），是否也考虑引用循环问题？"><a href="#使用系统的某些block-api（如UIView的block版本写动画时），是否也考虑引用循环问题？" class="headerlink" title="使用系统的某些block api（如UIView的block版本写动画时），是否也考虑引用循环问题？"></a>使用系统的某些block api（如UIView的block版本写动画时），是否也考虑引用循环问题？</h4><p>NO, since self will be captured in the block which is dispatched asynchronously, self will be implicity retained, and released again when the block has been finished.</p>
<p>That means, the life-time of self will be extended  up until after the block finishes.</p>
<h4 id="GCD的队列（dispatch-queue-t）分哪两种类型？"><a href="#GCD的队列（dispatch-queue-t）分哪两种类型？" class="headerlink" title="GCD的队列（dispatch_queue_t）分哪两种类型？"></a>GCD的队列（dispatch_queue_t）分哪两种类型？</h4><ul>
<li>串行队列Serial Dispatch Queue</li>
<li>并行队列Concurrent Dispatch Queue</li>
</ul>
<h4 id="如何用GCD同步若干个异步调用？（如根据若干个url异步加载多张图片，然后在都下载完成后合成一张整图）"><a href="#如何用GCD同步若干个异步调用？（如根据若干个url异步加载多张图片，然后在都下载完成后合成一张整图）" class="headerlink" title="如何用GCD同步若干个异步调用？（如根据若干个url异步加载多张图片，然后在都下载完成后合成一张整图）"></a>如何用GCD同步若干个异步调用？（如根据若干个url异步加载多张图片，然后在都下载完成后合成一张整图）</h4><p>使用 Dispatch Group 追加block到Global Group Queue，这些block如果全部执行完毕，就会执行Main Dispatch Queue中的结束处理的block</p>
<pre><code>dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
dispatch_group_t group = dispatch_group_create();
dispatch_group_async(group, queue, ^&#123; /*加载图片1 */ &#125;);
dispatch_group_async(group, queue, ^&#123; /*加载图片2 */ &#125;);
dispatch_group_async(group, queue, ^&#123; /*加载图片3 */ &#125;); 
dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;
        // 合并图片
&#125;);
</code></pre>
<h4 id="dispatch-barrier-async的作用是什么？"><a href="#dispatch-barrier-async的作用是什么？" class="headerlink" title="dispatch_barrier_async的作用是什么？"></a>dispatch_barrier_async的作用是什么？</h4><p>在并行队列中，为了保持某些任务的顺序，需要等待一些人物完成后才能继续进行，使用 barrier 来等待之前任务完成，避免数据竞争等问题。dispatch_barrier_async 函数会等待追加到 Concurrent Dispatch Queue 并行队列中的操作全部执行完之后，然后再执行 dispatch_barrier_async 函数追加的处理，等 dispatch_barrier_async<br>追加的处理执行结束之后，Concurrent Dispatch Queue 才恢复之前的动作继续执行。</p>
<pre><code>dispatch_queue_t queue = dispatch_queue_create(&quot;test_queue&quot;, DISPATCH_QUEUE_CONCURRENT);  
dispatch_async(queue, ^&#123;  
    [NSThread sleepForTimeInterval:2];  
    NSLog(@&quot;dispatch_async1&quot;);  
&#125;);  
dispatch_async(queue, ^&#123;  
    [NSThread sleepForTimeInterval:4];  
    NSLog(@&quot;dispatch_async2&quot;);  
&#125;);  
dispatch_barrier_async(queue, ^&#123;  
    NSLog(@&quot;dispatch_barrier_async&quot;);  
    [NSThread sleepForTimeInterval:4];  

&#125;);  
dispatch_async(queue, ^&#123;  
    [NSThread sleepForTimeInterval:1];  
    NSLog(@&quot;dispatch_async3&quot;);  
&#125;); 
</code></pre>
<h4 id="苹果为什么要废弃dispatch-get-current-queue？"><a href="#苹果为什么要废弃dispatch-get-current-queue？" class="headerlink" title="苹果为什么要废弃dispatch_get_current_queue？"></a>苹果为什么要废弃dispatch_get_current_queue？</h4><p>dispatch_get_current_queue容易造成死锁</p>
<h4 id="以下代码运行结果如何？"><a href="#以下代码运行结果如何？" class="headerlink" title="以下代码运行结果如何？"></a>以下代码运行结果如何？</h4><pre><code>- (void)viewDidLoad
&#123;
    [super viewDidLoad];
    NSLog(@&quot;1&quot;);
    dispatch_sync(dispatch_get_main_queue(), ^&#123;
        NSLog(@&quot;2&quot;);
    &#125;);
    NSLog(@&quot;3&quot;);
&#125;
</code></pre>
<p>只输出：1 。发生主线程锁死。原因是主队列在等待 dispatch_sync(dispatch_get_main_queue(), ^{NSLog(@”2”);});执行。dispatch_sync 在等待著队列执行完毕，造成死锁。</p>
<h4 id="addObserver-forKeyPath-options-context-各个参数的作用分别是什么，observer中需要实现哪个方法才能获得KVO回调？"><a href="#addObserver-forKeyPath-options-context-各个参数的作用分别是什么，observer中需要实现哪个方法才能获得KVO回调？" class="headerlink" title="addObserver:forKeyPath:options:context:各个参数的作用分别是什么，observer中需要实现哪个方法才能获得KVO回调？"></a>addObserver:forKeyPath:options:context:各个参数的作用分别是什么，observer中需要实现哪个方法才能获得KVO回调？</h4><pre><code>// 添加键值观察
/*
1 观察者，负责处理监听事件的对象
2 观察的属性
3 观察的选项
4 上下文
*/
[self.person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld context:@&quot;Person Name&quot;];
</code></pre>
<p>observer中需要实现以下方法：</p>
<pre><code>// 所有的 kvo 监听到事件，都会调用此方法
/*
 1. 观察的属性
 2. 观察的对象
 3. change 属性变化字典（新／旧）
 4. 上下文，与监听的时候传递的一致
 */
- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context;
</code></pre>
<h4 id="如何手动触发一个value的KVO"><a href="#如何手动触发一个value的KVO" class="headerlink" title="如何手动触发一个value的KVO"></a>如何手动触发一个value的KVO</h4><p>所谓的“手动触发”是区别于”自动触发：<br>自动触发是指类似这种场景：在注册 KVO 之前设置一个初始值，注册之后，设置一个不一样的值，就可以触发了。想知道如何手动触发，就得搞明白自动触发 KVO 的原理：</p>
<p>键值观察通知依赖于 NSObject 的两个方法： willChangeValueForKey: 和 didChangeValueForKey:。在一个被观察属性发生改变之前，willChangeValueForKey:一定会被调用，这就会记录旧的值。而当改变发生之后，didChangeValueForKey:会被调用，继而observeValueForKey:ofObject:change:context也会被调用。如果可以手动实现这些调用，就可以实现“手动触发”了；</p>
<p>那么”手动触发“的使用场景是什么？一般我们只在希望能控制”回调的调用时机”时才会这么做。</p>
<p>具体做法如下：</p>
<p>如果这个value是表示时间的 self.now,那么代码如下：</p>
<pre><code>//@property (nonatomic, strong) NSDate *now;
- (void)viewDidLoad
&#123;
    [super viewDidLoad];
    [self willChangeValueForKey:@&quot;now&quot;]; // “手动触发self.now的KVO”，必写。
    [self didChangeValueForKey:@&quot;now&quot;]; // “手动触发self.now的KVO”，必写。
&#125;
</code></pre>
<p>但是平时我们一般不会这么干，我们都是等系统去“自动触发”。“自动触发”的实现原理：</p>
<p>比如调用 setNow: 时，系统还会以某种方式在中间插入 wilChangeValueForKey: 、 didChangeValueForKey: 和 observeValueForKeyPath:ofObject:change:context: 的调用。</p>
<h4 id="若一个类有实例变量NSString-foo，调用setValue-forKey-时，可以以foo还是-foo作为key？"><a href="#若一个类有实例变量NSString-foo，调用setValue-forKey-时，可以以foo还是-foo作为key？" class="headerlink" title="若一个类有实例变量NSString *_foo，调用setValue:forKey:时，可以以foo还是_foo作为key？"></a>若一个类有实例变量NSString *_foo，调用setValue:forKey:时，可以以foo还是_foo作为key？</h4><p>Both</p>
<p>####KVC的keyPath中的集合运算符如何使用？</p>
<ul>
<li>必须用在集合对象上或普通对象的集合属性上</li>
<li>简单集合运算符有 @avg, @count, @max, @min, @sum</li>
<li>格式 @”sum.age”或@”集合属性<a href="mailto:&#46;&#64;&#x6d;&#97;&#x78;&#46;&#x61;&#x67;&#101;">&#46;&#64;&#x6d;&#97;&#x78;&#46;&#x61;&#x67;&#101;</a>“</li>
</ul>
<h4 id="KVC和KVO的keyPath一定是属性么？"><a href="#KVC和KVO的keyPath一定是属性么？" class="headerlink" title="KVC和KVO的keyPath一定是属性么？"></a>KVC和KVO的keyPath一定是属性么？</h4><p>KVO支持实例变量</p>
<h4 id="如何关闭默认的KVO的默认实现，并进入自定义的KVO实现？"><a href="#如何关闭默认的KVO的默认实现，并进入自定义的KVO实现？" class="headerlink" title="如何关闭默认的KVO的默认实现，并进入自定义的KVO实现？"></a>如何关闭默认的KVO的默认实现，并进入自定义的KVO实现？</h4><h4 id="apple用什么方式实现对一个对象的KVO？"><a href="#apple用什么方式实现对一个对象的KVO？" class="headerlink" title="apple用什么方式实现对一个对象的KVO？"></a>apple用什么方式实现对一个对象的KVO？</h4><p>当你观察一个对象时，一个新的类会被动态创建。这个类继承自该对象的原本的类，并重写了被观察属性的setter方法。重写setter方法会负责在调用原setter方法之前和之后，通知所有观察对象：值的更改。最后通过 isa 混写 （isa-swizzling）把这个对象的 isa 指针（isa指针告诉Runtime系统这个对象的类是什么）指向这个新创建的子类，对象就神奇的变成了新创建的子类的实例。</p>
<p>详细解释：</p>
<p>键值观察者通知依赖于NSObject的两个方法： willChangeValueForKey: and didChangeValueForKey: 。在一个被观察属性发生改变之前, willChangeValueForKey: 一定会被调用，这就会记录旧的值。而当发生改变之后，didChangeValueForKey:会被调用，继而observerValueForKey:ofObject:change:context:也会被调用。可以手动实现这些调用，但很少这么做。一般我们只在希望能控制回调的调用时机时才会这么做。大部分情况下，改变通知会自动调用。</p>
<h4 id="IBOutlet连出来的视图属性为什么可以被设置成weak"><a href="#IBOutlet连出来的视图属性为什么可以被设置成weak" class="headerlink" title="IBOutlet连出来的视图属性为什么可以被设置成weak?"></a>IBOutlet连出来的视图属性为什么可以被设置成weak?</h4><p>因为既然有外链那么视图在xib或者storyboard中肯定存在，视图已经对它有一个强引用了</p>
<h4 id="IB中User-Defined-Runtime-Attributes如何使用？"><a href="#IB中User-Defined-Runtime-Attributes如何使用？" class="headerlink" title="IB中User Defined Runtime Attributes如何使用？"></a>IB中User Defined Runtime Attributes如何使用？</h4><p>它能够通过KVC的方式配置一些你在interface builder 中不能配置的属性。当你希望在IB中作尽可能多得事情，这个特性能够帮助你编写更加轻量级的viewcontroller</p>
<h4 id="如何调试BAD-ACCESS错误"><a href="#如何调试BAD-ACCESS错误" class="headerlink" title="如何调试BAD_ACCESS错误"></a>如何调试BAD_ACCESS错误</h4><ul>
<li>From the Scheme toolbar menu, choose a scheme.</li>
<li>From the same menu, choose Edit Scheme to display the scheme dialog</li>
<li>In the left column, select run</li>
<li>To specify runtime diagnostics,click the Diagnostics tab.</li>
<li>For debug BAD_ACCESS, enable the Enable Zombie Objects checkbox.</li>
<li>Click Close</li>
<li>Click the Run button or chosse Product &gt; Run</li>
</ul>
<h4 id="lldb（gdb）常用的调试命令？"><a href="#lldb（gdb）常用的调试命令？" class="headerlink" title="lldb（gdb）常用的调试命令？"></a>lldb（gdb）常用的调试命令？</h4><p><code>po</code> <code>expression</code> <code>call</code> <code>thread return &lt;RETURN EXPRESSION&gt;</code> <code>b</code> <code>thread backtrace</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/07/19/nsstring-property-copy-or-retain/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/07/19/nsstring-property-copy-or-retain/" class="post-title-link" itemprop="url">从 NSString Property:copy or retain 到 NSCopying</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-07-19 11:50:04" itemprop="dateCreated datePublished" datetime="2015-07-19T11:50:04+08:00">2015-07-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-07-20 20:55:55" itemprop="dateModified" datetime="2015-07-20T20:55:55+08:00">2015-07-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="NSString-Property-copy-or-retain"><a href="#NSString-Property-copy-or-retain" class="headerlink" title="NSString Property:copy or retain"></a>NSString Property:copy or retain</h4><p>iOS程序中，在定义对象属性的时候，我们一般会把<code>NSString</code>类型的属性的修饰符写成 <code>copy</code>， 而不是 <code>retain</code> (或者 ARC 下面的 <code>strong</code>)。</p>
<p><strong>为什么会有<code>NSString</code>要用<code>copy</code>来修饰的convention？能否用 <code>strong</code>代替?</strong></p>
<p>回答这个问题之前，我们先看段代码：</p>
<pre><code>@interface Fruit : NSObject
@property (nonatomic, copy)     NSString  * fruitNameCopy;
@property (nonatomic, strong)   NSString  * fruitNameStrong;
@end

NSMutableString * fruitName = [NSMutableString stringWithString:@&quot;apple&quot;];

Fruit * fruit = [[Fruit alloc] init];
fruit.fruitNameCopy     = fruitName;
fruit.fruitNameStrong   = fruitName;

NSLog(@&quot;fruitName: %p %@&quot;, fruitName, fruitName); // 0x7fddabd0e250  apple
NSLog(@&quot;fruitNameCopy: %p %@&quot;, fruit.fruitNameCopy,  fruit.fruitNameCopy); // 0xa0000656c7070615 apple
NSLog(@&quot;fruitNameStrong:%p  %@&quot;, fruit.fruitNameStrong, fruit.fruitNameStrong); // 0x7fddabd0e250  apple

//fruitName =@&quot;pear&quot;;
[fruitName setString: @&quot;pear&quot;];

NSLog(@&quot;fruitName: %p %@&quot;, fruitName, fruitName); // 0x7fddabd0e250  pear
NSLog(@&quot;fruitNameCopy: %p %@&quot;, fruit.fruitNameCopy,  fruit.fruitNameCopy); // 0xa0000656c7070615 apple
NSLog(@&quot;fruitNameStrong:%p  %@&quot;, fruit.fruitNameStrong, fruit.fruitNameStrong); // 0x7fddabd0e250  pear
</code></pre>
<p>该段程序运行到结尾时， fruitNameCopy 的值是 apple，fruitNameCopy 的值是 pear，且两者的内存地址也不一样。<br>程序中，当我们对一个mutable对象做<code>copy</code>操作的时候，objc runtime 会用一次<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Object_copying#Deep_copy">深拷贝</a>来处理， runtime 会重新分配一块内存地址空间，并把原mutable对象的值拷贝过来。所以打印出来的 fruitNameCopy 和 fruitNameStrong 的内存地址是不一样的。而这之后在对 fruitName 做任何的赋值操作都只能作用于 fruitNameStrong.</p>
<p><strong>那如果我们把 fruitName 改成 immutable 的会是怎样的了？</strong></p>
<pre><code>NSString * fruitName = @&quot;apple&quot;;

Fruit * fruit = [[Fruit alloc] init];
fruit.fruitNameCopy     = fruitName;
fruit.fruitNameStrong   = fruitName;

NSLog(@&quot;fruitName: %p %@&quot;, fruitName, fruitName);// 0x10e27b078 apple
NSLog(@&quot;fruitNameCopy: %p %@&quot;, fruit.fruitNameCopy,  fruit.fruitNameCopy);// 0x10e27b078 apple
NSLog(@&quot;fruitNameStrong:%p  %@&quot;, fruit.fruitNameStrong, fruit.fruitNameStrong);// 0x10e27b078 apple

fruitName =@&quot;pear&quot;;

NSLog(@&quot;fruitName: %p %@&quot;, fruitName, fruitName);// 0x10e27b0f8 pear
NSLog(@&quot;fruitNameCopy: %p %@&quot;, fruit.fruitNameCopy,  fruit.fruitNameCopy);// 0x10e27b078 apple
NSLog(@&quot;fruitNameStrong:%p  %@&quot;, fruit.fruitNameStrong, fruit.fruitNameStrong);// 0x10e27b078 apple
</code></pre>
<p>结果是 fruitName, fruitNameCopy, fruitNameStrong 三者的地址都是一样的。按理说<code>copy</code>动作是深拷贝，fruitNameCopy指向的地址 应该是新分配的内存地址才对。<br>那为什么打印出来的地址却是同一个地址了？答案是 runtime 在这里做一个性能优化，@”apple” 是一个immutable的值，没有必要做一次深拷贝，直接做一次 retain 就达到目的了。</p>
<p><strong>试试看把<code>NSString</code>替换成<code>NSArray</code></strong></p>
<p>对象 Fruit 中添加两个属性<br>    @property (nonatomic, copy)     NSArray  * placesCopy;<br>    @property (nonatomic, strong)   NSArray  * placesStrong;</p>
<p>先用 mutable 的变量试试</p>
<pre><code>NSMutableArray * places = [NSMutableArray arrayWithArray:@[@&quot;china&quot;, @&quot;japan&quot;]];
fruit.placesCopy    = places; //placesCopy: 0x7f8f18d0c4f0 (china,japan)
fruit.placesStrong  = places; //placesStrong: 0x7f8f18d51a80 (china,japan)

[places addObject:@&quot;korea&quot;];
//placesCopy: 0x7f8f18d0c4f0 (china,japan)
//placesStrong: 0x7f8f18d51a80 (china,japan, korea)
</code></pre>
<p>再用 immutable 的变量试试</p>
<pre><code>NSArray * places = @[@&quot;china&quot;, @&quot;japan&quot;];

fruit.placesCopy    = places; //placesCopy: 0x7fc4e8c6f2a0 (china,japan)
fruit.placesStrong  = places; //placesStrong: 0x7fc4e8c6f2a0 (china,japan)

places = @[@&quot;uk&quot;, @&quot;us&quot;];
//placesCopy: 0x7fc4e8c6f2a0 (china,japan)
//placesStrong: 0x7fc4e8c6f2a0 (china,japan)
</code></pre>
<p>实验结果和 <code>NSString</code> 是一致的。</p>
<h4 id="NSCopying"><a href="#NSCopying" class="headerlink" title="NSCopying"></a>NSCopying</h4><p>如果你愿意，你可以试试看其他容器类 <code>NSDictionary</code>, <code>NSSet</code>,<code>NSIndexSet</code>， 会发现结果也保持一致。我们尝试解读这些类的头文件，作进一步的探索。以下是这些类头文件的节选：</p>
<pre><code>@interface NSString : NSObject &lt;NSCopying, NSMutableCopying, NSSecureCoding&gt;
@interface NSArray&lt;__covariant ObjectType&gt; : NSObject &lt;NSCopying, NSMutableCopying, NSSecureCoding, NSFastEnumeration&gt;
@interface NSDictionary&lt;__covariant KeyType, __covariant ObjectType&gt; : NSObject &lt;NSCopying, NSMutableCopying, NSSecureCoding, NSFastEnumeration&gt;
@interface NSSet&lt;__covariant ObjectType&gt; : NSObject &lt;NSCopying, NSMutableCopying, NSSecureCoding, NSFastEnumeration&gt;
@interface NSIndexSet : NSObject &lt;NSCopying, NSMutableCopying, NSSecureCoding&gt;
@interface NSIndexPath : NSObject &lt;NSCopying, NSSecureCoding&gt;
</code></pre>
<p>会发现这些类都实现了<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/Cocoa/Reference/Foundation/Protocols/NSCopying_Protocol/index.html"><code>NSCoying</code></a>协议.在<a target="_blank" rel="noopener" href="https://developer.apple.com/library/prerelease/ios/documentation/Cocoa/Reference/Foundation/Protocols/NSCopying_Protocol/index.html"><code>NSCoying</code></a>文档中有关于实现该协议的三条准则，其中第三条是：</p>
<pre><code>Implement NSCopying by retaining the original instead of creating a new copy when the class and its contents are immutable.
</code></pre>
<p>这条准则很好的解释了上面的试验结果，让这些结果讲得通。</p>
<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p><strong>综上，当我们使用<code>copy</code>来修饰<code>NSString</code>等容器类的属性时，如果被拷贝的对象是 Mutable， 则 runtime 会做深拷贝， 如果是 Immutable， 则runtime只是做一次 <code>retain</code>。</strong></p>
<p><strong>如果在程序中我们自己定义的类也需要实现 <code>NSCopying</code> 协议时，务必也要遵照此规则：若被拷贝的原对象是 Immutable 的，则无需新建一个拷贝，只需要 retian 原对象一次；若原对象是 mutablde 的，则需做一次深拷贝，新建一个对象</strong></p>
<p><strong>如果在程序中，你需要避免一个对象的某个属性被反向更改 (prevent mutating an object’s attributes behind its back)，请把该属性标记成 <code>copy</code></strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/07/13/movie-list-been-watched-2015-1st/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/07/13/movie-list-been-watched-2015-1st/" class="post-title-link" itemprop="url">2015上半年看过的电影</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2015-07-13 22:40:09 / Modified: 22:47:41" itemprop="dateCreated datePublished" datetime="2015-07-13T22:40:09+08:00">2015-07-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Movie/" itemprop="url" rel="index"><span itemprop="name">Movie</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>中国</strong></p>
<ul>
<li>一步之遥 </li>
</ul>
<p><strong>United States</strong></p>
<ul>
<li>Chirldhood</li>
<li>Nebraska</li>
<li>August Osage County</li>
<li>American Sniper</li>
<li>Birdman</li>
<li>2001: A Space Odyssey</li>
<li>Driving Miss Daisy</li>
<li>The Maze Runner</li>
<li>Big Hero 6</li>
<li>Lost In Translation</li>
<li>Fast &amp; Furious 7</li>
</ul>
<p><strong>Japan</strong></p>
<ul>
<li>Seven Samurai</li>
<li>Little Forest Natsu Aki</li>
<li>The Little House</li>
<li>Our Mother</li>
</ul>
<p><strong>Korea</strong></p>
<ul>
<li>Snowpiercer</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/07/05/za-huo-che-de-ren/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/07/05/za-huo-che-de-ren/" class="post-title-link" itemprop="url">砸火车的人</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-07-05 14:52:27" itemprop="dateCreated datePublished" datetime="2015-07-05T14:52:27+08:00">2015-07-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:25:53" itemprop="dateModified" datetime="2017-10-06T22:25:53+08:00">2017-10-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://cp0000.github.io/assets/kite-runner.jpg" alt="kite-runner"></p>
<p>罗素在《幸福之路》一书中有一节是讨论关于<code>厌烦与兴奋</code>的。里面说到现代人对比我们的祖先更少厌烦，但却更怕厌烦。我们进行听音乐，玩电子游戏，看电影，或许都是为了消除厌烦吧。甚至有时候，我觉得读书也是消除厌烦，而不是为了获取知识。</p>
<p>我一直把自己当作一个喜欢读书的人来对待，但事实上我读过的书很少。</p>
<p>当然需要说明的是，我这里指的书籍是剔除了上学时候的教科书，工作之后的专业书籍。对我而言，这些书大都有一些不得不去读的意味，为了升学，为了升职，为了生存。要从这类书籍中要获取到乐趣是不太容易的。所以我这里读的书指的是一些“闲书”，纯粹因个人喜好而去看的书。</p>
<p>为了消除厌烦，我们总是希望能够从同样喜欢读书且品味没那么糟糕的人口中获得一些推荐的书籍，以备我们无聊的时候可以用来打发时间。记得上大学的时候，我总是喜欢推荐一本叫《追风筝的人》的书给其他人以换取其他人的推荐。书很薄，读起来很流畅，不会觉的累，故事精彩缺让人回味无穷。今天我抄袭此书的名字，取名这篇文章叫《砸火车的人》，来回忆一段同样是年少时发生的一件不光彩的事迹。</p>
<p>我一直是一个本分，胆子不大的人。小时候，可能是由于年纪原因，我也算是村庄里面孩子的头头。我们几个人早上一起上学，放学一起玩弹珠，打打扑克。映像中聚众打架，偷庄稼这种事情可能也就干过一两次。我们阵容很小，稳定的阵容只有我，弟弟，黑皮，还有几个经常一起玩，但是不是固定阵容的。黑皮那个时候跟我们玩的最好，上小学的时候我们总是在一起玩，砸火车的事情也是我们一起干的。</p>
<p>有段时间，黑皮说他跟其他人一起去村子旁边的火车道上砸过火车，很好玩。我当时一是好奇心作祟，二是自尊心要强，于是说我们也要去砸火车。<br>于是在某个无所事事的周末下午，我，弟弟，黑皮加上另外两三个人，不记得是谁了。一道去了村旁边的火车道上准备砸火车。来到火车道上，我们在旁边埋伏好，过了一伙儿，一列货车就缓缓驶了过来。等火车头经过我们的时候，黑皮立马从地上捡起石头砸向火车头，剩下的人看此情况，于是也都纷纷捡起石头砸向火车。不一会儿，火车就开走了，我们玩的很开心，有时候你很难搞清楚为啥我们对搞破坏是如此的感兴趣。然而出乎意料的事情发生了，火车在不远去停了下来，尽然倒退了。我们几个当时年纪都很小，我最大，也才上小学三年级，一下子就慌了。火车里面的人是要回来逮捕我们，怎么办。慌乱中，我们往旁边的山头上跑，在一个沟渠里面躲了起来。自然，9岁小孩的毛把戏，是逃不过这帮开火车大人的眼睛的。他们很快就把我们揪了出来。我记得当时自己全身都在发抖，很害怕。那帮家伙要把我们拎上火车，然后带走。至于去哪里，天知道。我只记得我拼命的说火车头不是我砸的，不是我砸的，我没有砸前面的火车头。事态发展的太快，然后矛头不知怎么着就指向了黑皮，我和其他几个人都说是他砸的，出卖了黑皮，为了保全自己；但那个时候火车里面的人搞错了，以为我们说的是我弟弟，便拉着我弟弟要上火车；我很害怕，不知该怎么办，但是我没敢上去阻止，只是在旁边大声说不是我弟弟，是黑皮，毫无保留的把黑皮卖掉了。然后黑皮被他们拖上了火车，就要被带走了。被火车带走，对于一个9岁的孩子来说，可能跟死亡也没啥区别吧。</p>
<p>幸好这个时候在田里面干活的农人都赶了过来，大伙儿一起劝说火车上的那帮家伙，大概是些小孩子不懂事之类的，好说歹说黑皮终于没有被带走，算是幸免于难。不过火车上的那帮家伙还是把黑皮的名字，家庭地址，学校记了下来，后面还把这件事通报到学校，黑皮被批评了一番。</p>
<p>每次回想起这件事情，我都为自己的不道义感到害臊。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/06/07/tennis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/06/07/tennis/" class="post-title-link" itemprop="url">网球以及德约科维奇</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-06-07 09:41:30" itemprop="dateCreated datePublished" datetime="2015-06-07T09:41:30+08:00">2015-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-08-30 23:09:18" itemprop="dateModified" datetime="2015-08-30T23:09:18+08:00">2015-08-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Sports/" itemprop="url" rel="index"><span itemprop="name">Sports</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://cp0000.github.io/assets/xiaode.jpg" alt="Novak Djokovic"></p>
<p>我是从何时开始看网球的？应该是08年的澳网，那年我大一，放寒假在家过年，某个下午无聊的翻看体育台，无意中被澳网的比赛吸引住了，从此便养成了看网球比赛的习惯。</p>
<p>四大满贯中澳网的赛程赶巧在中国农历新年附近，而且比赛地墨尔本和北京在经度上只相差两个时区，这样比赛时间基本上都在国内白天下午进行。对于中国观众来说观看澳网比赛还是非常方便的。这也是为何四大满贯中我最中意澳网。当然了，还有另外一个原因，澳网是德约科维奇成绩最好的大满贯赛事。</p>
<p>07,08年的时候，世界第一是瑞士天王费德勒，那个时候费天王还正值当打之年，对网坛有着非同寻常的统治力。极度优雅的反手，关键时刻稳定的Ace球，一切看起来都那么的完美，对那种刚刚开始看网球的人应该都有着无比寻常的吸引力。不过我还是最中意小德 ，因为我不是那种非常强烈的 <code>Glory Hunter</code>，我更中意那种有朝气的事务。小德在08年的时候，常年排名在世界第三，也会被戏称三德子。不过，在看他的比赛的时候，你还是能够感受他身体里面迸发出来的求胜欲，你会觉得他会变的很强的人，未来看起来应该会很有搞头的样子。就像我最钟爱的球队是阿森纳一样，从我2007年开始看阿森纳比赛之后，这7，8年，阿森纳不是英超里面最强的队伍。不过你可以感受到温格对这支队伍的发展规划，阿森纳的比赛，球场上踢出来的足球能让你感到很舒服，球员也已年轻队员为主，朝气蓬勃。</p>
<p>关于小德的比赛映像最深的是2012年他跟纳达尔那场耗时6个小时的澳网决赛。比赛中，双方表现出来的技战力，韧性，决心都是令人惊叹的。双方你来我往，每一个回合的挥拍，我都看的心欲破膛。普通人的生活，绝大多数时刻都沉浸在茶米油盐酱醋茶的琐碎里，或许能享受一份闲适，但也可能缺少那种能让人肾上腺素极度分泌的紧张时刻。这也是网球比赛，或者说体育比赛的魅力吧。他能在某一段时间，能让人忘却现实生活中的烦忧，沉浸在此刻的比赛中。顺便插一句，或许这也是为何年轻人喜爱电子竞技类游戏的原因吧。那场比赛德约最终赢得了冠军，我想那是他为自己带上天王皇冠的一场比赛。赢取比赛后，他疯狂的撕掉了自己的球衣，冲着球场外怒吼，像一头雄狮。</p>
<p>这场比赛，就我而言，是德约目前职业生涯最好的一场比赛，对于纳达尔来说，或许是最不愿追忆的比赛。纳达尔打得足够好，表现出了超强的韧性，有机会赢得冠军的，但他却输了比赛，给自己的人生留了一个很大的遗憾。但人生中，能够获得这样的一场比赛也是非常幸运的。不是每个人都有机会去在这样的舞台上为自己去打这样一场重要的比赛的。</p>
<p>昨天晚上，德约在15年的法网半决赛中五盘大战中赢了穆雷，来到了法网决赛，冲击属于他人生的全满贯。祝他好运！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/04/05/nainai/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/04/05/nainai/" class="post-title-link" itemprop="url">奶奶</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-04-05 10:35:36" itemprop="dateCreated datePublished" datetime="2015-04-05T10:35:36+08:00">2015-04-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-06-21 20:15:21" itemprop="dateModified" datetime="2015-06-21T20:15:21+08:00">2015-06-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Life/" itemprop="url" rel="index"><span itemprop="name">Life</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://cp0000.github.io/assets/yejuhua.png" alt="Wild chrysanthemum"></p>
<p>我和弟弟从小是被奶奶带大的，直到我们前后出去念大学，才从奶奶身边离开。我们跟奶奶很亲。</p>
<p>奶奶是一个典型的农村妇女，她有三个儿子，两个女儿，另外还有一对继子，继女。二姑，也就是奶奶的大女儿，在二十年前患乳腺癌去世了。二姑走的时候，奶奶很伤心。每逢清明，她总是叮嘱我们记得给二姑烧纸。而爷爷，在我还未出生的时候就已经过世了。从奶奶口中得知爷爷是个脾气非常暴躁的人。爷爷过世的时候，我爸爸20岁不到，小叔叔15不到。至于奶奶和爷爷感情如何，奶奶没跟我们说过，我也未曾问起。</p>
<p>奶奶年轻时候生活的年代极其困难，这使得她养成了非常节约的习惯。小时候，家里面条件非常困难，我爸爸是木匠，每年都要外出务工，挣养家糊口的钱。每当我们想买些乱七八糟的的东西，奶奶都会告诫我们爸爸挣钱不容易，在外面打工很辛苦，不能乱花钱。奶奶会想办法帮我们家节约开支，隔断时间会让我和弟弟记日常支出的账，这个习惯我坚持到现在。</p>
<p>上学时，奶奶每天早起，给我们做饭，让我们吃完去上学。奶奶做的菜，口味偏咸。我最爱吃她煮的鱼，和红薯粉条。冬天的周末，三个人围着煤炉，吃热气腾腾的鱼，这算是少年时最开心的光景。</p>
<p>刚上大学的时候，爸爸打电话跟我说，你第一次一个人出远门，跟奶奶又生活了那么久，奶奶在家很想你，你要多打电话给她。这之后我养成了每个周末都会打电话给奶奶的习惯。电话内容大多数时候是我询问一下她的身体情况，奶奶跟我说一下她周遭发生的家长里短，让我在外头要注意安全之类的。有时候，我忘记打了，后来补打的时候，奶奶都会很担心的说：你怎么礼拜天没打电话。以为我出了什么事情。而我每次出门上学的时候，她都会包红包给我。这些红包，我没花，保留了下来留作纪念，弟弟也是如此。我们也是在最近才得知彼此做了相同的事情。</p>
<p>工作之后，只能在逢年过节的时候回趟家，看望一下奶奶。在家里，我和弟弟最喜欢做的事情就是坐在奶奶房门前的走廊上，陪着奶奶一起晒太阳。大多时候，弟弟陪着奶奶聊天，我只是呆坐在旁边，默默的听着。</p>
<p>近些年，奶奶一直说她自己身体不行了，估计时间不多了，还说假如真的走了，也不要回来，耽误了工作。每每听到她说这些，我们孙子辈都不太高兴，跟她说不要老是说死字。弟弟说，在今年春节的时候，他跟奶奶说，奶奶90岁的时候，他30岁，那时候，他也应该成家立业了。他说奶奶当时听到他这么说的时候很开心，还把这些话说给其他人听。而我也曾经幻想过能够带着自己建立的家庭回去探望她。</p>
<p>她今年86岁，近些年的日子过的孤单且并不顺心，时常生病。我在外头时不时会担心她的健康，偶尔还会做噩梦，梦见她走了，每次都会半夜吓醒，然后庆幸还好这只是个梦。今年3月18号的午后，农历的正月二十八，奶奶终于还是离开了我们。奶奶走的时候，我在从上海回桐城的路上，得知消息后我抬头朝家的方向望了望。</p>
<p>回家做丧事的时候，有段路，只有爸爸，弟弟，我三个人。爸爸说了句：奶奶走之后，整个人空空的，感觉生活没有意思。我“嗯”了一声。</p>
<p>奶奶走了半个多月，我们都非常想念她。</p>
<p>15年清明</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2015/03/15/legend-of-a-suicide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2015/03/15/legend-of-a-suicide/" class="post-title-link" itemprop="url">读书笔记：《一个自杀者的传说》</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-03-15 15:13:30" itemprop="dateCreated datePublished" datetime="2015-03-15T15:13:30+08:00">2015-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-11-07 21:40:22" itemprop="dateModified" datetime="2016-11-07T21:40:22+08:00">2016-11-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Reading-notes/" itemprop="url" rel="index"><span itemprop="name">Reading notes</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://cp0000.github.io/assets/legend-of-a-suicide.jpg" alt="pic"></p>
<p>某一个巧合我得知了这本美国的畅销书《Legend of a suicide》,中文译作《一个自杀者的传说》，不得不肯定这本书光书名就有着很大的吸引力，让人远远就觉得该书讲述的故事应该不会太烂。</p>
<p>书中的前三个短片小说，基本上是在介绍他的父亲，母亲。从这些小故事我们大致知道，父亲是一名爱出海打鱼的牙医，经济状况应该很不错，有着自己的一家诊所。后来父亲出现婚外情，父母离婚，父亲重新结婚，后面却又再次离婚，导致精神状态非常的差。母亲这边虽然会和新的男人认识，却没有想再次步入婚姻的念头。书中所有的文字都很冷，没有哪怕一丝丝的温情在里头。</p>
<p>全书最为精彩的故事是中篇小说《苏宽岛》。父亲由于不堪现实生活中的糟糕状况，买了阿拉斯加上一座无人居住的小岛，然后邀请12的儿子罗伊一起跟他去小岛上生活一段时间。然而在儿子眼里看起来很坚强的父亲，非常缺乏野外生存的经验，加上心理状况不稳定，导致他们的生活条件日益恶劣，父子间的交流也没有想象中变的通畅起来，反而是越来越疏远。</p>
<p>从踏入岛上的第一天，他们把所有的精力都花在如何生存下去上，捕鱼，熏鱼，搭建木屋，以及筹备过冬的粮食，劳碌的日子可以避免沉默带来的尴尬。当中有一次父子两人远足，父亲直接踏进悬崖，试图自杀，罗伊费劲力气，以及极度的恐惧找到垂死的父亲，把他扛回小屋子中。事后，两人却没有对此事进行过真诚的交流。冬天来了之后，两人只能在屋子里吃着之前准备好的过冬的熏鱼，看书打发时间。但父亲此时却没法耐受住这种生活，三番四次的用无线电联系他的第二个前妻罗达，却听到罗达已经嫁人。崩溃的父亲把对着自己脑袋的枪丢给了从外面回来撞见这一幕的罗伊。然后独自一人跑了出去，却听到一声枪声从小屋传来，罗伊用枪打爆了自己的脑袋。这是全书最为令人震惊的转折，在我还在想象父亲最终会如何把自己作死，罗伊却用手枪打爆了自己的头颅。书名中的那个自杀者尽然是儿子，不是父亲。</p>
<p>岛上的孤独加上父亲糟糕的精神状态摧毁了罗伊，超出一个12岁少年能够承受的阴郁。罗伊父亲最后的结局也很悲惨，父亲费劲力气，终于把罗伊的尸体带回罗伊妈妈的身边。却被警方怀疑是他杀死了自己的儿子。他最后决定逃出美国，如是搭上一只渔船逃路，在船上，他被船长和副手扔进了大海，在孤独，冰冷的海水中死去了。</p>
<p>在想办法把儿子的尸体弄回母亲身边的路上，有一大段关于父亲内心世界的描写，作者直面人性内心，精彩异常。</p>
<p>阴冷的天气，荒无人烟的孤岛，和每一个看起来都那么孤独的灵魂。或许是由于我们有互联网，手机，电子游戏，动漫；如此这些东西可以让我们一直沉浸在一种不知所谓的忙碌中，让我们没有机会去直面那样子的孤独。这或许会让我们生活的更容易些吧。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2014/12/31/2014-movie-list/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2014/12/31/2014-movie-list/" class="post-title-link" itemprop="url">2014电影清单</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-12-31 00:00:00" itemprop="dateCreated datePublished" datetime="2014-12-31T00:00:00+08:00">2014-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:18:25" itemprop="dateModified" datetime="2017-10-06T22:18:25+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Movie/" itemprop="url" rel="index"><span itemprop="name">Movie</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>日本</strong></p>
<ul>
<li>萤火之森 Hotarubi no mori e</li>
<li>萤火虫之墓 Grave of the Firefiles</li>
<li>魔女宅急便 Kikis Delivery Service</li>
<li>穿越时空的少女 The Girl Who Leapt Through Time</li>
<li>寿司之神 Jiro Dreams Of Sushi</li>
<li>七武士 Seven Samurai</li>
<li>告白 Kokuhaku</li>
<li>如父如子 Soshite Chichi ni Naru</li>
</ul>
<p><strong>中国</strong></p>
<ul>
<li>后会无期</li>
<li>天注定</li>
</ul>
<p><strong>韩国</strong></p>
<ul>
<li>辩护人 </li>
</ul>
<p><strong>法国</strong></p>
<ul>
<li>普罗旺斯的夏天 Avis de mistral</li>
<li>两天一夜 Deux jours une nuit</li>
</ul>
<p><strong>英美</strong></p>
<ul>
<li>狙击电话亭 Phone Booth</li>
<li>猩球崛起2：黎明之战 Dawn of the Planet of the Apes</li>
<li>星际穿越 Interstellar</li>
<li>彗星來的那一夜 Coherence</li>
<li>黑镜2014圣诞特辑 BlackMinor for 2014 christmas</li>
<li>消失的爱人 Gone Girl</li>
<li>内布拉斯加 Nebraska</li>
<li>大地惊雷 True Grit</li>
<li>重新开始 Begin Again</li>
<li>美国队长2 寒冬战士 Captain America:The WinterSoldier</li>
<li>为奴十二年 12 Years A Slave</li>
<li>爱在午夜降临前 Before Midnight</li>
<li>阅后即焚 Burn After Reading</li>
<li>云图 Cloud Atlas</li>
<li>卡特教练 Coach Carter</li>
<li>撞车 Crash</li>
<li>明日边缘 Edge of Tomorrow</li>
<li>特种部队2：全面反击 G.I.Joe.Retaliation</li>
<li>哥斯拉 Godzilla</li>
<li>银河护卫队 Guardians of the Galaxy</li>
<li>醉乡民谣 Inside Llewyn Davis</li>
<li>不惧风暴 Into the Storm</li>
<li>月球 Moon</li>
<li>罪恶之城2 Sin City: A Dame to Kill For (2014)</li>
<li>海盗电台 The Boat That Rocked</li>
<li>金刚狼2 The Wolverine 2013</li>
<li>致命拜访 The Invasion 2007</li>
<li>华尔街之狼 The Wolf of Wall Street</li>
<li>少年斯派维的奇异旅行 The Young and Prodigious.T.S.Spivet</li>
<li>X战警：逆转未来 X-Men: Days of Future Past</li>
<li>偷天换日 The ItalianJob</li>
<li>变形金刚4.绝迹重生 Transformers Age of Extinction</li>
<li>布达佩斯大饭店 The Grand Budapest</li>
<li>超体 Lucy</li>
<li>超凡蜘蛛侠2 The.Amazing.Spider-Man.2</li>
<li>钢铁侠2: Iron Man 2</li>
<li>黄金三镖客 Il buono, il brutto, il cattivo</li>
<li>互联网之子 The Internet’s Own Boy: The Story of Aaron Swartz (2014)</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2014/05/21/regular-expression-beginner/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2014/05/21/regular-expression-beginner/" class="post-title-link" itemprop="url">Regular Expression</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-05-21 00:00:00" itemprop="dateCreated datePublished" datetime="2014-05-21T00:00:00+08:00">2014-05-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-06-21 20:05:50" itemprop="dateModified" datetime="2015-06-21T20:05:50+08:00">2015-06-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>#常用的元字符</p>
<table>
<thead>
<tr>
<th align="left">代码</th>
<th align="left">说明</th>
</tr>
</thead>
</table>
<ul>
<li><pre><code> | *前边的内容可以连续重复使用任意次以使整个表达式得到匹配
</code></pre>
.      | 匹配除了换行符以外的任意字符<br>\d      | 匹配一位数字(0，或1，或2，或……)<br>\w      | 匹配字母或数字或下划线或汉字<br>\s      | 匹配任意的空白符<br>\b      | 匹配单词的开始或结束<br>^      | 匹配字符串的开始<br>$      | 匹配字符串的结束</li>
</ul>
<p>#常用的限定符</p>
<table>
<thead>
<tr>
<th align="left">代码/语法</th>
<th align="left">说明</th>
</tr>
</thead>
</table>
<ul>
<li><pre><code>      | 重复零次或更多次
</code></pre>
</li>
</ul>
<ul>
<li><pre><code>      | 重复一次或更多次
</code></pre>
?           | 重复零次或一次<br>{n}       | 重复n次<br>{n,}      | 重复n次或更多次<br>{n,m}      | 重复n次到m次</li>
</ul>
<p>#其他</p>
<ul>
<li><strong>字符转义</strong></li>
</ul>
<p>如需查找*,+等元字符本身的话，需使用\来取消这些字符的特殊含义；</p>
<pre><code>\. \*
</code></pre>
<ul>
<li><strong>字符类</strong></li>
</ul>
<p>匹配没有预定义元字符的字符集合(比如元音字母a,e,i,o,u),只需在方括号里列出；如：</p>
<pre><code>[aeiou]:    匹配任何一个英文元音字母；
[.?!]:        匹配标点符号(.或?或!)
</code></pre>
<p>(?0\d{2}[) -]?\d{8}：首先是一个转义字符(,它能出现0次或1次(?),然后是一个0，后面跟着2个数字(\d{2})，然后是)或-或空格中的一个，它出现1次或不出现(?)，最后是8个数字(\d{8})</p>
<ul>
<li><strong>分枝条件</strong></li>
</ul>
<p>分枝条件指的是有几种规则，如果满足其中任意一种规则都应该当成匹配，具体方法是用|把不同的规则分隔开</p>
<ul>
<li><strong>分组</strong></li>
</ul>
<p>用小括号来指定子表达式(也叫做分组）</p>
<p>e.g. IP地址匹配:  (\d{1,3}.){3}\d{1,3}<br>解析：\d{1,3}匹配1到3位的数字，(\d{1,3}.){3}匹配三位数字加上一个英文句号(这个整体也就是这个分组)重复3次，最后再加上一个一到三位的数字(\d{1,3})</p>
<ul>
<li><strong>反义</strong></li>
</ul>
<p>常用的反义代码</p>
<table>
<thead>
<tr>
<th align="left">代码/语法</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">\W</td>
<td align="left">匹配任意不是字母，数字，下划线，汉字的字符</td>
</tr>
<tr>
<td align="left">\S</td>
<td align="left">匹配任意不是空白符的字符</td>
</tr>
<tr>
<td align="left">\D</td>
<td align="left">匹配任意非数字的字符</td>
</tr>
<tr>
<td align="left">\B</td>
<td align="left">匹配不是单词开头或结束的位置</td>
</tr>
<tr>
<td align="left">[^x]</td>
<td align="left">匹配除了x以外的任意字符</td>
</tr>
<tr>
<td align="left">[^aeiou]</td>
<td align="left">匹配除了aeiou这几个字母以外的任意字符</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>后向引用</strong></p>
<p>  …</p>
</li>
<li><p><strong>零宽断言</strong></p>
<p>  …</p>
</li>
</ul>
<ul>
<li><p><strong>负向零宽断言</strong></p>
<p>  …</p>
</li>
<li><p><strong>注释</strong></p>
<p>  …</p>
</li>
<li><p><strong>贪婪与懒惰</strong></p>
<p>  …</p>
</li>
<li><p><strong>处理选项</strong></p>
<p>  …</p>
</li>
</ul>
<ul>
<li><p><strong>平衡组/递归匹配</strong></p>
<p>  …</p>
</li>
</ul>
<p>#Example</p>
<table>
<thead>
<tr>
<th>RE</th>
<th>示意</th>
</tr>
</thead>
<tbody><tr>
<td>\bhi\b</td>
<td>查找单词hi</td>
</tr>
<tr>
<td>.*</td>
<td>任意数量的不包含换行的字符</td>
</tr>
<tr>
<td>\bhi\b.*\bLucy\b</td>
<td>先是一个单词hi,然后是任意个任意字符(但不能是换行)，最后是Lucy这个单词</td>
</tr>
<tr>
<td>0\d{2}-\d{8}</td>
<td>\d后面的{2}({8})的意思是前面\d必须连续重复匹配2次(8次)</td>
</tr>
<tr>
<td>c.d(.+)</td>
<td>查询到结果类似于c.d((c)a, string)</td>
</tr>
<tr>
<td>((2[0-4]\d</td>
<td>25[0-5]</td>
</tr>
</tbody></table>
<p>#附录：</p>
<p>更多信息，请阅读：<a target="_blank" rel="noopener" href="https://deerchao.net/tutorials/regex/regex.htm">https://deerchao.net/tutorials/regex/regex.htm</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2014/04/10/google-wildcard/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2014/04/10/google-wildcard/" class="post-title-link" itemprop="url">Google Wildcard</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-04-10 00:00:00" itemprop="dateCreated datePublished" datetime="2014-04-10T00:00:00+08:00">2014-04-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-06-21 13:51:56" itemprop="dateModified" datetime="2015-06-21T13:51:56+08:00">2015-06-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1.双引号</p>
<p>把搜索词放在双引号中，代表完全匹配搜索，也就是说搜索结果返回的页面包含双引号中出现的所有的词，连顺序也必须完全匹配。</p>
<pre><code>“seo方法图片”
</code></pre>
<p>2.减号</p>
<p>减号代表搜索不包含减号后面的词的页面。使用这个指令时减号前面必须是空格，减号后面没有空格，紧跟着需要排除的词。</p>
<pre><code>搜索 -引擎
</code></pre>
<p>3.星号</p>
<p>星号常用的通配符</p>
<pre><code>搜索*擎
</code></pre>
<p>4.inurl</p>
<p>inurl: 指令用于搜索查询词出现在url 中的页面。</p>
<pre><code>inurl:搜索引擎优化
</code></pre>
<p>5.inanchor</p>
<p>指令返回的结果是导入链接锚文字中包含搜索词的页面。</p>
<pre><code>inanchor:点击这里
</code></pre>
<p>6.intitle</p>
<p>指令返回的是页面title 中包含关键词的页面。</p>
<p>7.allintitle</p>
<p>搜索返回的是页面标题中包含多组关键词的文件。</p>
<p>8.filetype</p>
<p>用于搜索特定文件格式。</p>
<pre><code>filetype:pdf SEO
</code></pre>
<p>9.site</p>
<p>用来搜索某个域名下的所有文件。</p>
<pre><code>site:developer.apple.com gcd
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="2014/03/01/android-reverse-engineering/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="images/avatar.gif">
      <meta itemprop="name" content="Pei Cheng">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CP WRITINGS">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="2014/03/01/android-reverse-engineering/" class="post-title-link" itemprop="url">Android reverse engineering</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2014-03-01 00:00:00" itemprop="dateCreated datePublished" datetime="2014-03-01T00:00:00+08:00">2014-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2017-10-06 22:20:21" itemprop="dateModified" datetime="2017-10-06T22:20:21+08:00">2017-10-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h4><ul>
<li><p>java: android app 编程语言</p>
</li>
<li><p>class: 由 java文件通过 Sun JDK 编译而成</p>
</li>
<li><p>dex:  Dex文件的指令码是Dalvik虚拟机专有的一套指令集，专门为嵌入式系统优化过，相比标准java的.class文件，它体积小，运行效率高。</p>
<p>  ps:通过Android平台上的工具(dx)将.class文件 转换成Dex字节码（classes.dex）</p>
</li>
<li><p>odex: 在原生Android中安装apk会产生apk 和 odex 两个文件，而使用第三方的rom只有apk一个文件；odex 是同名apk经系统优化后的dex文件，原生ROM中apk和odex文件是配对的，对应的apk文件中没有了dex文件。</p>
</li>
<li><p>smali, baksmali:分别指android系统里的Java虚拟机（Dalvik）所使用的一种.dex格式文件的汇编器</p>
<p>  ps: Smali文件是dalvik虚拟机运行的dex字节码文件对应的汇编文件。</p>
</li>
<li><p>Andoid App 的运行策略：解压apk后运行class.dex</p>
</li>
</ul>
<h4 id="工具介绍"><a href="#工具介绍" class="headerlink" title="工具介绍"></a>工具介绍</h4><ul>
<li>ant: 编译，生成android 项目的工具；</li>
<li>apktool： 用来解压 apk，虽说apk实际是一个压缩包，可以用unzip直接解压，不过apktool还是做了更多的优化，如直接reverse androidmanifest.xml</li>
<li>smali-2.0.3.jar: 把smali 文件转换成 dex文件</li>
<li>baksmali-2.0.2.jar: 把dex文件转换成smali文件</li>
<li>dex2jar: dex 转换成 jar</li>
<li>signapk.jar: 用来签名apk</li>
<li>eclipse: 大多数android项目的IDE</li>
<li>adb: android debug bridge;可用来 adb logcat 打印错误日志； adb push 来更新项目存在/data/data中的文件；</li>
<li>JD-GUi:图形界面的Java源代码”.class”文件反编译工具</li>
</ul>
<h4 id="DEMO演示"><a href="#DEMO演示" class="headerlink" title="DEMO演示"></a>DEMO演示</h4><ul>
<li><p>首先我们需要一个 apk，我去到豌豆荚网页版下载一个名叫［百度］的apk；</p>
</li>
<li><p>使用 adb install baidu.apk到 手机，先把玩一下这个app的主要功能；差不多就是一个网页版的apk；</p>
</li>
<li><p>然后开始对这个apk动手脚；</p>
<pre><code>  apktool d baidu.apk /* 反编译apk */
</code></pre>
<p>会发现在当前的目录下生成一个baidu 的 folder：</p>
<pre><code>  staff  48732 Mar  1 19:26 AndroidManifest.xml
  staff    250 Mar  1 19:26 apktool.yml
  staff    408 Mar  1 19:26 assets
  staff    102 Mar  1 20:08 build
  staff    102 Mar  1 20:08 dist
  staff    102 Mar  1 19:26 lib
  staff    884 Mar  1 19:26 res
  staff    170 Mar  1 19:26 smali
</code></pre>
</li>
</ul>
<p>这是baidu  android project的目录结构，有了上面的名词解释，我们知道 代码逻辑都存在了smali这个文件夹下；不过smali有点不好阅读，所以我建议大家还是把smali 翻译成java之后在去阅读 baidu.apk 的源代码；</p>
<p>我的方法是:unzip apk得到 classes.dex，然后利用dex2jar 得到clases_dex2jar.jar;然后使用JD-GUi打开jar 文件就可以非常愉快的阅读java 代码了；</p>
<pre><code>    unzip baidu.apk -d baidu_deout;
    dex2jar.sh baidu_deout/classes.dex
</code></pre>
<p>由于是Demo，所以我展示一个简单的hack好了；打开BaseActivity.java 会发现</p>
<pre><code>if (b)
  Log.d(&quot;SearchBox&quot;, &quot;=========BaseActivity onStop mLiveActivityNum=&quot; + o);
</code></pre>
<p>很明显 b是类似 debug_mode 的开关变量，如果你之前在运行baidu.apk的时候adb logcat 一下，留心一下是没有这个log的，所以在release android.apk 的时候，debug_mode 理应被set成false了；所以我现在想做的事情就是打开debug_mode;因为debug log这种的东西有太多的惊喜；</p>
<p>接下来的事情就变得非常简单找到 set  debugmode 的位置，设置成true就好了；顺藤摸瓜；在BaseActivity.java  的开头，会发现：</p>
<pre><code>private static final boolean b = SearchBox.a;
</code></pre>
<p>而SearchBox.java 的第一行：</p>
<pre><code>public static boolean a = dk.a;
</code></pre>
<p>db.java 的第一行：</p>
<pre><code>public static boolean a = false;
</code></pre>
<p>事情不能更顺利了，所以只要把 a 的值set 成true就完成打开debugmode的小hack了；</p>
<p>还记得之前apktool 反编译的文件夹嘛？打开db.smali 文件；会发现：</p>
<pre><code>const/4 v1, 0x0
const/4 v0, 0x1
sput-boolean v1, Lcom/baidu/searchbox/dk;-&gt;a:Z
</code></pre>
<p>是的，只要修改成</p>
<pre><code>sput-boolean v0, Lcom/baidu/searchbox/dk;-&gt;a:Z
</code></pre>
<p>就好了；</p>
<p>修改完smali之后，我们需要做的是重新生成一个apk：</p>
<pre><code>apktool b baidu
</code></pre>
<p>会发现在baidu/dist/目录下生成了一个新的baidu.apk; 这时候如果你选择 </p>
<pre><code>adb installl －r baidu.apk
</code></pre>
<p>会发现提示：Failure [INSTALL_PARSE_FAILED_NO_CERTIFICATES]这是由于这个apk没有sign的原因；接下里sign apk；</p>
<pre><code> java -jar /opt/Android/signapk/signapk.jar /opt/Android/signapk/signapk-key.testkey.x509.pem /opt/Android/signapk/signapk-key.testkey.pk8 CHFR_360.apk CHFR_360-sign.apk
</code></pre>
<p>执行成功之后，惊喜的发现在 dist 新生成了 baidu-sign.apk,安装到手机，运行apk，打开adb logcat:</p>
<pre><code>D/c       (17822): statistic key: 011918
E/c       (17822): 写入行为统计:&#123;&quot;011918&quot;:[&quot;&quot;]&#125;
E/c       (17822): 写入widget用户行为统计：&#123;&quot;011918&quot;:[&quot;&quot;]&#125;
D/c       (17822): statistic key: 011918
E/c       (17822): 写入行为统计:&#123;&quot;011918&quot;:[&quot;&quot;]&#125;
E/c       (17822): 写入widget用户行为统计：&#123;&quot;011918&quot;:[&quot;&quot;]&#125;
</code></pre>
<p>如果一切正常的话，会发现类似如上的log，当然你仔细看的话，还有更详细且重要的信息，各种的小隐私都被监视…</p>
<p>Android 项目的逆向工程的文章就到这里；<br>Enjoy it!</p>
<h4 id="相关参考："><a href="#相关参考：" class="headerlink" title="相关参考："></a>相关参考：</h4><ul>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/12732882/reverse-engineering-from-an-apk-file-to-a-project">http://stackoverflow.com/questions/12732882/reverse-engineering-from-an-apk-file-to-a-project</a></li>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/13854425/how-to-avoid-reverse-engineering-of-an-apk-file">http://stackoverflow.com/questions/13854425/how-to-avoid-reverse-engineering-of-an-apk-file</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Pei Cheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pei Cheng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="lib/anime.min.js"></script>
  <script src="lib/velocity/velocity.min.js"></script>
  <script src="lib/velocity/velocity.ui.min.js"></script>

<script src="js/utils.js"></script>

<script src="js/motion.js"></script>


<script src="js/schemes/muse.js"></script>


<script src="js/next-boot.js"></script>




  















  

  

</body>
</html>
