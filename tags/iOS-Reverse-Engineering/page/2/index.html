<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tag: iOS Reverse Engineering | CP WRITINGS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="CP WRITINGS">
<meta property="og:url" content="http://cp0000.github.io/tags/iOS-Reverse-Engineering/page/2/">
<meta property="og:site_name" content="CP WRITINGS">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CP WRITINGS">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="CP WRITINGS" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">CP WRITINGS</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-home-icon" class="nav-icon" href="/"></a>
        
          <a id="nav-archives-icon" class="nav-icon" href="/archives"></a>
        
          <a id="nav-about-icon" class="nav-icon" href="/about/index.html"></a>
        
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-iOS-reverse-engineering-02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2015/11/30/iOS-reverse-engineering-02/">iOS逆向工程-0x01－工具篇-Cycript</a>
  

      </header>
    
    <time class="article-date" datetime="2015-11-30T14:00:07.000Z" itemprop="datePublished">11-30-2015</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p>对于初开始学习iOS逆向工程的人来说，实现一个<code>tweak</code>可以算是入门逆向工程了。</p>
<p>当然了，可能你现在还不知道<code>tweak</code>是什么。简单来说，你可以把一个tweak当作某一个app的一个插件（类似于浏览器广告屏蔽插件）。在app运行的时候，tweak会hook住某个函数，然后在hook的函数里面，你可以插入你的代码。</p>
<blockquote>
<p>比如用户在登陆微信账号的时候，tweak可以hook住登录函数，dump出用户的账号密码</p>
</blockquote>
<p>那问题来了，我们要如何知道哪个函数是账号登录函数咧？<strong>这就涉及到我们如何去分析一个iOS app</strong></p>
<h2 id="分析_iOS_app_的两种方法">分析 iOS app 的两种方法</h2>
<ul>
<li><p>运行时分析</p>
<ul>
<li>GDB/LLDB</li>
<li>Cycript</li>
<li>Logify</li>
<li>weak_classdump</li>
<li>InspectiveC</li>
</ul>
</li>
</ul>
<ul>
<li><p>可执行代码分析</p>
<ul>
<li>dumpdecrpted</li>
<li>class_dump,class_dump_z,classdump_dyld</li>
<li>Disassemblers<ul>
<li>IDA</li>
<li>Hopper</li>
<li>otool</li>
</ul>
</li>
<li>strings</li>
<li>nm</li>
</ul>
</li>
</ul>
<p>先不要被这么多的工具多吓到，我们一样一样来。相比对汇编代码的分析，动态分析要简单，容易上手很多，对新手而言，也更加容易获取到乐趣。所以我们先从最好玩的Cycript开始。</p>
<h3 id="Cycript">Cycript</h3>
<p><a href="http://www.cycript.org/" target="_blank" rel="external">Cycript</a>最重要的特性是，它可以hook住 iOS／macosx 上面正在运行的进程，并通过终端使用objective_c或javascript语法去打印和修改该应用的运行时信息。我们可以把它当作一个可以debug没有源代码程序的工具。</p>
<p>以下是 Cycript 的用途：</p>
<ul>
<li>能够hook正在运行的进程，并打印相关信息，如 appdelegate,rootViewController</li>
<li>对程序中的类，可以获取到它用过的方法名称</li>
<li>可以获取到类的实例变量名称，以及打印出实例变量的值，当然也可以修改实例变量的值</li>
<li>能够执行 method swizzling， 替换某个指定的函数</li>
<li>可以在运行时调用其他方法</li>
</ul>
<h4 id="安装_cycript">安装 cycript</h4>
<p>首先利用 Cydia 下载 <code>mobilesubstrate</code> <code>adv-mds</code>;从<a href="www.cycript.org/debs/">官网</a>上面下载最新的包，并通过 <code>scp</code> 把文件拷贝到 iOS 设备上去，利用 <code>dpkg</code> 进行安装：</p>
<pre><code>dpkg -<span class="keyword">i</span> cycript cycript_0.<span class="number">9.102</span>-<span class="number">1</span>_iphoneos-arm.<span class="keyword">deb</span>
</code></pre><p>安装完成之后，执行 cycript 看是否工作：</p>
<h4 id="用Cycript进行实时修改">用Cycript进行实时修改</h4>
<p>本文将使用支付宝来进行测试。</p>
<ul>
<li>让支付宝钱包在前台运行，并找出它的进程id，然后用 cycript -p hook 进程</li>
</ul>
<pre><code>    chengpeide-iPhone:~ root<span class="preprocessor"># ps aux | grep AlipayWallet</span>
    mobile     <span class="number">629</span>   <span class="number">0.0</span>  <span class="number">9.3</span>   <span class="number">815836</span>  <span class="number">47792</span>   ??  Ss    <span class="number">9</span>:<span class="number">45</span>PM   <span class="number">0</span>:<span class="number">34.79</span> /var/mobile/Containers/Bundle/Application/FB2E1466-<span class="number">0</span>D87-<span class="number">4</span>FF9-<span class="number">9616</span>-BD4269D61BCF/AlipayWallet<span class="variable">.app</span>/AlipayWallet
    root       <span class="number">678</span>   <span class="number">0.0</span>  <span class="number">0.1</span>   <span class="number">536256</span>    <span class="number">412</span> s000  U+    <span class="number">9</span>:<span class="number">49</span>PM   <span class="number">0</span>:<span class="number">00.01</span> grep AlipayWallet

    -rwxr-xr-x <span class="number">1</span> root admin <span class="number">906</span> Jan <span class="number">12</span>  <span class="number">2015</span> cycript
    chengpeide-iPhone:/cp/Cycript_0<span class="number">.9</span><span class="number">.502</span> root<span class="preprocessor"># cycript -p 629</span>

    cy<span class="preprocessor"># var app = [UIApplication sharedApplication]</span>
    <span class="preprocessor">#<span class="title">"&lt;DFApplication: 0x14df44d0&gt;"</span></span>
    cy<span class="preprocessor"># app.delegate</span>
    <span class="preprocessor">#<span class="title">"&lt;DFClientDelegate: 0x14ed2d40&gt;"</span></span>
    cy<span class="preprocessor"># app.keyWindow.rootViewController</span>
    <span class="preprocessor">#<span class="title">"&lt;DFNavigationController: 0x15ac9a00&gt;"</span></span>
    cy<span class="preprocessor"># var nav = new Instance(0x15ac9a00)</span>
    <span class="preprocessor">#<span class="title">"&lt;DFNavigationController: 0x15ac9a00&gt;"</span></span>
    cy<span class="preprocessor"># nav.topViewController.childViewControllers</span>
    @[<span class="preprocessor">#<span class="title">"&lt;HPHomeWidgetGroup: 0x160a03d0&gt;"</span>,#<span class="title">"&lt;O2OIndexViewController: 0x15ad6600&gt;"</span>,#<span class="title">"&lt;APContactRecentViewController: 0x15afb600&gt;"</span>,#<span class="title">"&lt;WWAssetsViewController: 0x160a9da0&gt;"</span>]</span>
    cy<span class="preprocessor"># var assetsViewController = new Instance(0x160a9da0)</span>
    <span class="preprocessor">#<span class="title">"&lt;WWAssetsViewController: 0x160a9da0&gt;"</span></span>
    cy<span class="preprocessor"># [assetsViewController.view subviews]</span>
    @[<span class="preprocessor">#<span class="title">"&lt;UIView: 0x162d8000; frame = (0 0; 0 0); layer = &lt;CALayer: 0x162c85d0&gt;&gt;"</span>,#<span class="title">"&lt;UITableView: 0x15433800; frame = (0 0; 320 519); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x1623d1f0&gt;; layer = &lt;CALayer: 0x162c3b10&gt;; contentOffset: {0, -64}; contentSize: {320, 800}&gt;"</span>]</span>
    cy<span class="preprocessor"># var tableView = new Instance (0x15433800)</span>
    <span class="preprocessor">#<span class="title">"&lt;UITableView: 0x15433800; frame = (0 0; 320 519); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x1623d1f0&gt;; layer = &lt;CALayer: 0x162c3b10&gt;; contentOffset: {0, -42}; contentSize: {320, 800}&gt;"</span></span>
    cy<span class="preprocessor"># tableView.backgroundColor = [UIColor redColor]</span>
    <span class="preprocessor">#<span class="title">"UIDeviceRGBColorSpace 1 0 0 1"</span></span>

    [tableView visibleCells]
    @[<span class="preprocessor">#<span class="title">"&lt;HeadInfoCell: 0x16160a40; baseClass = UITableViewCell; frame = (0 220; 320 80); autoresize = W; layer = &lt;CALayer: 0x16160e80&gt;&gt;"</span>,#<span class="title">"&lt;DoubleInfoCell: 0x1569e800; baseClass = UITableViewCell; frame = (0 300; 320 80); autoresize = W; layer = &lt;CALayer: 0x16486e80&gt;&gt;"</span>,#<span class="title">"&lt;DoubleInfoCell: 0x15452e00; baseClass = UITableViewCell; frame = (0 380; 320 80); autoresize = W; layer = &lt;CALayer: 0x16491a50&gt;&gt;"</span>]</span>
    cy<span class="preprocessor"># var headCell = new Instance (0x16160a40)</span>
    <span class="preprocessor">#<span class="title">"&lt;HeadInfoCell: 0x16160a40; baseClass = UITableViewCell; frame = (0 220; 320 80); autoresize = W; layer = &lt;CALayer: 0x16160e80&gt;&gt;"</span></span>
    cy<span class="preprocessor"># headCell.backgroundColor = [UIColor redColor]</span>
    <span class="preprocessor">#<span class="title">"UIDeviceRGBColorSpace 1 0 0 1"</span></span>
    cy<span class="preprocessor"># headCell.contentView.backgroundColor = [UIColor redColor]</span>
    <span class="preprocessor">#<span class="title">"UIDeviceRGBColorSpace 1 0 0 1"</span></span>
</code></pre><p>我们可以看到，界面上 tableViewCell 的背景颜色变成了红色。</p>
<p><img src="http://cp0000.github.io/assets/blue.PNG" alt="shortcut2"></p>
<p>以上操作的思路大致就是， appdelegate =&gt; keyWindow =&gt; rootViewController =&gt; viewControllers =&gt; view </p>
<p>当然你也可以骗骗自己，把余额这个label的text改成巨款，过过眼瘾</p>
<pre><code>    cy<span class="special">#</span> <span class="special">[</span>tableView subviews<span class="special">]</span>
    @<span class="special">[</span><span class="special">#</span>"&lt;UIRefreshControl: 0x16482c90; frame = (0 0; 320 60); hidden = YES; autoresize = W; layer = &lt;CALayer: 0x16256370&gt;&gt;",<span class="special">#</span>"&lt;UITableViewWrapperView: 0x1624cce0; frame = (0 0; 320 519); gestureRecognizers = &lt;NSArray: 0x16098960&gt;; layer = &lt;CALayer: 0x14e12cf0&gt;; contentOffset: <span class="special">{</span>0, 0<span class="special">}</span>; contentSize: <span class="special">{</span>320, 519<span class="special">}</span>&gt;",<span class="special">#</span>"&lt;UIView: 0x16216d10; frame = (0 780; 320 20); layer = &lt;CALayer: 0x162562c0&gt;&gt;",<span class="special">#</span>"&lt;WHAccountHeaderView: 0x16217c10; frame = (0 0; 320 180); layer = &lt;CALayer: 0x1637edd0&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x17635b80; frame = (0 180; 320 40); autoresize = W; layer = &lt;CALayer: 0x1620d670&gt;&gt;",<span class="special">#</span>"&lt;UIImageView: 0x161f4740; frame = (0 452.5; 320 2.5); alpha = 0; opaque = NO; autoresize = TM; userInteractionEnabled = NO; layer = &lt;CALayer: 0x161f47c0&gt;&gt;"<span class="special">]</span>
    cy<span class="special">#</span> var header = new Instance(0x16217c10)
    <span class="special">#</span>"&lt;WHAccountHeaderView: 0x16217c10; frame = (0 0; 320 180); layer = &lt;CALayer: 0x1637edd0&gt;&gt;"
    cy<span class="special">#</span> <span class="special">[</span>header subviews<span class="special">]</span>
    @<span class="special">[</span><span class="special">#</span>"&lt;UIView: 0x161c6530; frame = (0 0; 320 117); layer = &lt;CALayer: 0x1638a780&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x16142d70; frame = (0 117.5; 106.667 62.5); layer = &lt;CALayer: 0x161f6350&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x16142de0; frame = (106.667 117.5; 106.667 62.5); layer = &lt;CALayer: 0x16109ed0&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x1610a4b0; frame = (213.333 117.5; 106.667 62.5); layer = &lt;CALayer: 0x163771b0&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x161082c0; frame = (122 28; 76 41); text = '0.00'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x14f73520&gt;&gt;",<span class="special">#</span>"&lt;UIImageView: 0x1610a520; frame = (246 42; 9 13); opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x161025c0&gt;&gt;",<span class="special">#</span>"&lt;UIImageView: 0x161692b0; frame = (56.5 83; 13 13); opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x16169330&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16169380; frame = (74.5 83; 189 13); text = '<span class="command">\xe</span>7<span class="command">\x</span>82<span class="command">\xb</span>9<span class="command">\xe</span>6<span class="command">\xad</span><span class="command">\xa</span>4<span class="command">\xe</span>5<span class="command">\xbc</span><span class="command">\x</span>80<span class="command">\xe</span>5<span class="command">\x</span>90<span class="command">\xaf</span><span class="command">\xe</span>8<span class="command">\xb</span>4<span class="command">\xa</span>6<span class="command">\xe</span>6<span class="command">\x</span>88<span class="command">\xb</span>7<span class="command">\xe</span>5<span class="command">\xae</span><span class="command">\x</span>89<span class="command">\xe</span>5<span class="command">\x</span>85<span class="command">\xa</span>8<span class="command">\xe</span>9<span class="command">\x</span>99<span class="command">\xa</span>9<span class="command">\xef</span><span class="command">\xbc</span><span class="command">\x</span>8c<span class="command">\xe</span>4<span class="command">\xba</span><span class="command">\xab</span>100<span class="command">\xe</span>4<span class="command">\xb</span>8<span class="command">\x</span>87<span class="command">\xe</span>4<span class="command">\xbf</span><span class="command">\x</span>9d<span class="command">\xe</span>9<span class="command">\x</span>9a<span class="command">\x</span>9c'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16169230&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16169570; frame = (36.8333 154.25; 33 12); text = '<span class="command">\xe</span>9<span class="command">\x</span>93<span class="command">\xb</span>6<span class="command">\xe</span>8<span class="command">\xa</span>1<span class="command">\x</span>8c<span class="command">\xe</span>5<span class="command">\x</span>8d<span class="command">\xa</span>1'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16169630&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16169810; frame = (48.3333 131.25; 10 17); text = '2'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x161698d0&gt;&gt;",<span class="special">#</span>"&lt;UIImageView: 0x16169ab0; frame = (42.3333 127.25; 22 22); hidden = YES; opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x16169b30&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16381200; frame = (149 154.25; 22 12); text = '<span class="command">\xe</span>4<span class="command">\xbd</span><span class="command">\x</span>99<span class="command">\xe</span>9<span class="command">\xa</span>2<span class="command">\x</span>9d'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16381160&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16380280; frame = (144 131.25; 32 17); text = '0.00'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16380340&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16380520; frame = (255.667 154.25; 22 12); text = '<span class="command">\xe</span>5<span class="command">\x</span>8d<span class="command">\xa</span>1<span class="command">\xe</span>5<span class="command">\x</span>8c<span class="command">\x</span>85'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x163805e0&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x1638d640; frame = (261.667 131.25; 10 17); text = '0'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x1638d700&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x16151570; frame = (0 117; 320 0.5); layer = &lt;CALayer: 0x161515e0&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x16151670; frame = (0 179.5; 320 0.5); layer = &lt;CALayer: 0x161516e0&gt;&gt;"<span class="special">]</span>
    cy<span class="special">#</span> var label2= new Instance(0x161082c0)
    <span class="special">#</span>"&lt;UILabel: 0x161082c0; frame = (122 28; 76 41); text = '0.00'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x14f73520&gt;&gt;"
    cy<span class="special">#</span> label2.text=@"10000000000000"
    @"10000000000000"
</code></pre><p><img src="http://cp0000.github.io/assets/rich.PNG" alt="shortcut2"></p>
<p>很好玩，也很有用的工具，cycript。当然cycript还有一些高级用法，后面会介绍。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2015/11/30/iOS-reverse-engineering-02/" data-id="cp3rbgq26xer2lgz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS-Reverse-Engineering/">iOS Reverse Engineering</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/tags/iOS-Reverse-Engineering/">&laquo; Prev</a><a class="page-number" href="/tags/iOS-Reverse-Engineering/">1</a><span class="page-number current">2</span><a class="page-number" href="/tags/iOS-Reverse-Engineering/page/3/">3</a><a class="extend next" rel="next" href="/tags/iOS-Reverse-Engineering/page/3/">Next &raquo;</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Pei Cheng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63703524-1', 'auto');
  ga('send', 'pageview');

</script>
  </div>
</body>
</html>