<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives | CP WRITINGS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="CP WRITINGS">
<meta property="og:url" content="http://cp0000.github.io/archives/page/2/">
<meta property="og:site_name" content="CP WRITINGS">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CP WRITINGS">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="CP WRITINGS" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">CP WRITINGS</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-home-icon" class="nav-icon" href="/"></a>
        
          <a id="nav-archives-icon" class="nav-icon" href="/archives"></a>
        
          <a id="nav-about-icon" class="nav-icon" href="/about/index.html"></a>
        
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-install-caffe-on-macosx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/10/22/install-caffe-on-macosx/">如何在Macosx上安装caffe</a>
  

      </header>
    
    <time class="article-date" datetime="2016-10-22T04:55:05.000Z" itemprop="datePublished">10-22-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p>在macosx上面安装深度学习框架<a href="http://caffe.berkeleyvision.org/" target="_blank" rel="external">caffe</a>是个相对比较麻烦的过程。如果根据caffe项目的install_osx文件指引去安装，会遇到一些问题。所以我决定把自己的安装过程记录下来。</p>
<p><strong>硬软件环境</strong><br>&gt;<br>    电脑：iMac<br>    系统：OX EI Caption 版本10.11.4</p>
<h2 id="Homebrew">Homebrew</h2>
<p>官方推荐使用<a href="http://brew.sh" target="_blank" rel="external">Homebrew</a>来管理依赖项的下载，安装。</p>
<h2 id="Anaconda_Python">Anaconda Python</h2>
<p>Anaconda是python的一个常用的科学计算发行版，自带包管理器conda。从 <a href="https://store.continuum.io/cshop/anaconda/" target="_blank" rel="external">https://store.continuum.io/cshop/anaconda/</a> 下载并安装Anaconda Python。安装成功之后,记得在PATH添加ananconda执行文件的路径：</p>
<pre><code><span class="keyword">export</span> PATH=~/anaconda/bin:<span class="variable">$PATH</span>
</code></pre><h2 id="CUDA">CUDA</h2>
<p>从 <a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="external">https://developer.nvidia.com/cuda-downloads</a> 下载并安装CUDA 8.0 (for OSX)<br>从 <a href="http://www.nvidia.com/object/mac-driver-archive.html" target="_blank" rel="external">http://www.nvidia.com/object/mac-driver-archive.html</a> 下载并安装最新的CUDA独立驱动。<br>同样我们把驱动的可执行文件路径添加到PATH环境变量中(注意下载安装的CUDA的版本号)：</p>
<pre><code><span class="keyword">export</span> PATH=/Developer/NVIDIA/CUDA-<span class="number">8.0</span>/bin/<span class="variable">$PATH</span>
<span class="keyword">export</span> DYLD_LIBRARY_PATH=/Developer/NVIDIA/CUDA-<span class="number">8.0</span>/lib:<span class="variable">$DYLD_LIBRARY_PATH</span>
</code></pre><h2 id="BLAS">BLAS</h2>
<p>网上搜索到的教程中都是使用<a href="https://software.intel.com/en-us/intel-mkl" target="_blank" rel="external">Intel MKL</a>，查看网站会发现intel-mkl收费很贵，所以我安装的时候选择了<a href="www.openblas.net/">OpenBLAS</a></p>
<pre><code>brew <span class="operator"><span class="keyword">install</span> openblas</span>
</code></pre><blockquote>
<p>关于 intel-mkl 和 openblas 的优劣，没有做过比较。在校大学生可通过学校邮箱在页面 <a href="https://software.intel.com/en-us/qualify-for-free-software/student" target="_blank" rel="external">https://software.intel.com/en-us/qualify-for-free-software/student</a> 申请安装包。</p>
</blockquote>
<h2 id="cuDNN">cuDNN</h2>
<p>从 <a href="https://developer.nvidia.com/cudnn" target="_blank" rel="external">https://developer.nvidia.com/cudnn</a> 页面下载并安装cuDNN库,安装过程如下：</p>
<pre><code>tar -xzvf cudnn-<span class="number">8.0</span>-osx-x64-v5.<span class="number">1</span>.tgz
cd cuda
sudo cp lib/* <span class="regexp">/usr/local</span><span class="regexp">/cuda/lib</span>
sudo cp <span class="keyword">include</span>/cudnn.h /usr/local/cuda/<span class="keyword">include</span>/
</code></pre><h2 id="安装依赖项_via_Homebrew">安装依赖项 via Homebrew</h2>
<p>首先我们需要修改下homebrew安装 opencv 时需要用到的opencv.rb文件</p>
<pre><code>brew <span class="keyword">edit</span> opencv
</code></pre><p>将下面两行：</p>
<pre><code>args &lt;&lt; "-DPYTHON_LIBRARY=#{<span class="ruby">py_lib}</span>/libpython2.7.#{<span class="ruby">dylib}</span>"
args &lt;&lt; "-DPYTHON_INCLUDE_DIR=#{<span class="ruby">py_prefix}</span>/include/python2.7"
</code></pre><p>替换为：</p>
<pre><code><span class="keyword">args</span> &lt;&lt; <span class="string">"-DPYTHON_LIBRARY=#{py_prefix}/lib/libpython2.7.dylib"</span>
<span class="keyword">args</span> &lt;&lt; <span class="string">"-DPYTHON_INCLUDE_DIR=#{py_prefix}/include/python2.7"</span>
</code></pre><p>然后开始安装依赖项：</p>
<pre><code>brew <span class="operator"><span class="keyword">install</span> <span class="comment">--fresh -vd snappy leveldb gflags glog szip lmdb homebrew/science/opencv</span>
brew <span class="keyword">install</span> <span class="comment">--build-from-source --with-python --fresh -vd protobuf</span>
brew <span class="keyword">install</span> <span class="comment">--build-from-source --fresh -vd boost boost-python</span>
brew <span class="keyword">install</span> hdf5</span>
</code></pre><blockquote>
<p>安装过程有点漫长，可能会出现一些错误，需要耐心的修复掉。<br>如果你把电脑升级到最新的 macOS Sierra 10.12，会由于新系统不内置QTKit导致opencv编译失败。</p>
</blockquote>
<h2 id="下载Caffe代码">下载Caffe代码</h2>
<pre><code>git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/BVLC/caff.git
<span class="keyword">cd</span> caffe
<span class="keyword">cp</span> Makefile.config.example Makefile.config
</code></pre><h2 id="Makefile-config">Makefile.config</h2>
<p>修改Makefile.config</p>
<pre><code>BLAS:=<span class="built_in">open</span>
BLAS_INCLUDE := $(<span class="built_in">shell</span> brew <span class="comment">--prefix openblas)/include</span>
BLAS_LIB := $(<span class="built_in">shell</span> brew <span class="comment">--prefix openblas)/lib</span>
</code></pre><p>取消CUDDNN的注释</p>
<pre><code><span class="attribute">USE_CUDNN :</span>=<span class="string"> 1</span>
</code></pre><p>检查设置Python路径</p>
<pre><code><span class="comment"># NOTE: this is required only if you will compile the python interface.</span>
<span class="comment"># We need to be able to find Python.h and numpy/arrayobject.h.</span>
<span class="comment"># PYTHON_INCLUDE := /usr/include/python2.7 \</span>
<span class="comment">#         /usr/lib/python2.7/dist-packages/numpy/core/include</span>
<span class="comment"># Anaconda Python distribution is quite popular. Include path:</span>
<span class="comment"># Verify anaconda location, sometimes it's in root.</span>
<span class="comment"># ANACONDA_HOME := $(HOME)/anaconda</span>
<span class="comment"># PYTHON_INCLUDE := $(ANACONDA_HOME)/include \</span>
        <span class="comment"># $(ANACONDA_HOME)/include/python2.7 \</span>
        <span class="comment"># $(ANACONDA_HOME)/lib/python2.7/site-packages/numpy/core/include \</span>

<span class="constant">ANACONDA_HOME </span><span class="symbol">:</span>= <span class="variable">$(</span><span class="constant">HOME)</span>/anaconda
<span class="constant">PYTHON_INCLUDE </span><span class="symbol">:</span>= <span class="variable">$(</span><span class="constant">ANACONDA_HOME)</span>/<span class="keyword">include</span> \
<span class="variable">$(</span><span class="constant">ANACONDA_HOME)</span>/<span class="keyword">include</span>/python2.<span class="number">7</span> \
<span class="variable">$(</span><span class="constant">ANACONDA_HOME)</span>/lib/python2.<span class="number">7</span>/site-packages/numpy/core/<span class="keyword">include</span> \


<span class="comment"># Uncomment to use Python 3 (default is Python 2)</span>
<span class="comment"># PYTHON_LIBRARIES := boost_python3 python3.5m</span>
<span class="comment"># PYTHON_INCLUDE := /usr/include/python3.5m \</span>
<span class="comment">#                 /usr/lib/python3.5/dist-packages/numpy/core/include</span>

<span class="comment"># We need to be able to find libpythonX.X.so or .dylib.</span>
<span class="comment"># PYTHON_LIB := /usr/lib</span>
<span class="constant">PYTHON_LIB </span><span class="symbol">:</span>= <span class="variable">$(</span><span class="constant">ANACONDA_HOME)</span>/lib

<span class="comment"># Homebrew installs numpy in a non standard path (keg only)</span>
<span class="constant">PYTHON_INCLUDE </span>+= <span class="variable">$(</span>dir <span class="variable">$(</span>shell python -c <span class="string">'import numpy.core; print(numpy.core.__file__)'</span>))/<span class="keyword">include</span>
<span class="constant">PYTHON_LIB </span>+= <span class="variable">$(</span>shell brew --prefix numpy)/lib
</code></pre><h2 id="环境变量">环境变量</h2>
<pre><code>export <span class="constant">DYLD_FALLBACK_LIBRARY_PATH</span>=<span class="regexp">/usr/local</span><span class="regexp">/cuda/lib</span><span class="symbol">:/Users/cp/anaconda/lib</span><span class="symbol">:/usr/local/lib</span><span class="symbol">:/usr/local/Cellar/</span><span class="symbol">:/usr/local/cuda/lib</span><span class="symbol">:~/anaconda/lib</span><span class="symbol">:/usr/local/lib</span><span class="symbol">:/usr/lib</span><span class="symbol">:</span><span class="variable">$DYLD_FALLBACK_LIBRARY_PATH</span>
</code></pre><h2 id="编译caffe">编译caffe</h2>
<pre><code><span class="keyword">make</span> clean
<span class="keyword">make</span> <span class="keyword">all</span> -j8
<span class="keyword">make</span> runtest
</code></pre><p>runtest 相对会花些时间</p>
<pre><code><span class="keyword">make</span> pycaffe
<span class="keyword">make</span> distribute
</code></pre><p>就大功告成了</p>
<h2 id="References:">References:</h2>
<ul>
<li><a href="http://caffe.berkeleyvision.org/installation.html" target="_blank" rel="external">http://caffe.berkeleyvision.org/installation.html</a></li>
<li><a href="https://github.com/BVLC/caffe/wiki/Installation-%28OSX%29" target="_blank" rel="external">https://github.com/BVLC/caffe/wiki/Installation-%28OSX%29</a></li>
<li><a href="http://hoondy.com/2015/04/03/how-to-install-caffe-on-mac-os-x-10-10-for-dummies-like-me/" target="_blank" rel="external">http://hoondy.com/2015/04/03/how-to-install-caffe-on-mac-os-x-10-10-for-dummies-like-me/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2016/10/22/install-caffe-on-macosx/" data-id="8leqzyo0mnxfx3nt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-1st-half" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/09/25/2016-1st-half/">2016上半年电影，美剧，以及书 清单</a>
  

      </header>
    
    <time class="article-date" datetime="2016-09-25T15:05:21.000Z" itemprop="datePublished">09-25-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Movie/">Movie</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="电影">电影</h2>
<h3 id="中国">中国</h3>
<ul>
<li>饮食男女</li>
<li>喜宴</li>
<li><p>推手</p>
<blockquote>
<p>李安“父亲”三部曲；在三部电影里面，饰演男主角的郎雄，都给人一种很亲切的感觉，让人很喜爱这老头儿。最喜欢《饮食男女》中吴倩莲饰演的二姐，走在最先锋的人，却最终选择了守住传统。</p>
</blockquote>
</li>
<li><p>北京遇上西雅图之不二情书</p>
<blockquote>
<p>加分的是那对老夫妇，以及老爷子身上的文人气质</p>
</blockquote>
</li>
<li><p>寒战2</p>
<blockquote>
<p>梁sir还是那么棒</p>
</blockquote>
</li>
<li>使徒行者</li>
<li>火锅英雄</li>
<li>老炮儿</li>
</ul>
<h3 id="日本">日本</h3>
<ul>
<li><p>步伐不停</p>
<blockquote>
<p>平淡的，生活化的，舍不得结束的</p>
</blockquote>
</li>
<li><p>海街日记</p>
<blockquote>
<p>依旧是平淡的，生活化的，舍不得结束的</p>
</blockquote>
</li>
<li><p>怪物之子</p>
</li>
</ul>
<h3 id="美国">美国</h3>
<ul>
<li><p>谍影重重5</p>
<blockquote>
<p>熟悉的伯恩回来了，但感觉整个的电影的高潮部分是在希腊街头的那段追杀。</p>
</blockquote>
</li>
<li><p>火星救援</p>
<blockquote>
<p>最爱马特呆萌种土豆那一段</p>
</blockquote>
</li>
<li>十二怒汉<blockquote>
<p>剧情精彩，回味无穷 </p>
</blockquote>
</li>
<li>生为蓝调<blockquote>
<p>冲着伊桑霍克看的</p>
</blockquote>
</li>
<li>功夫熊猫3</li>
<li>疯狂动物城</li>
<li>蝙蝠侠大战超人：正义黎明</li>
<li>奇幻森林</li>
<li>美国队长3</li>
<li>泰山归来：险战丛林</li>
<li>九条命</li>
<li>X战警：天启</li>
<li>硬核亨利</li>
</ul>
<h3 id="韩国">韩国</h3>
<ul>
<li>哭声<blockquote>
<p>看完堵得慌</p>
</blockquote>
</li>
</ul>
<h2 id="美剧">美剧</h2>
<ul>
<li><p>毒枭第二季</p>
<blockquote>
<p>和第一季一样，还是那个魔幻的哥伦比亚</p>
</blockquote>
</li>
<li><p>权利的游戏第六季</p>
<blockquote>
<p>私生子之战，我看了三遍了</p>
</blockquote>
</li>
<li><p>绝命律师第二季</p>
<blockquote>
<p>好看，推荐</p>
</blockquote>
</li>
<li><p>黑客军团第二季</p>
<blockquote>
<p>强迫症让我看完了第二季，应该会看第三季</p>
</blockquote>
</li>
<li><p>怪奇物语</p>
<blockquote>
<p>为了拍第二季，第一季的结尾让人不适，不打算看第二季</p>
</blockquote>
</li>
</ul>
<h2 id="书">书</h2>
<ul>
<li>《你是一切的答案》</li>
<li>《程序员的思维锻炼》<blockquote>
<p><a href="http://cp0000.github.io/2016/06/11/pragmatic-thinking-and-learning/" target="_blank" rel="external">读书笔记</a></p>
</blockquote>
</li>
</ul>
<blockquote>
<p>没写评论的，在我看来是可看可不看的</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2016/09/25/2016-1st-half/" data-id="2n11xujfp7jbn74a" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-shanghai-4-years" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/07/30/shanghai-4-years/">五年，四年</a>
  

      </header>
    
    <time class="article-date" datetime="2016-07-30T06:35:05.000Z" itemprop="datePublished">07-30-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Life/">Life</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://cp0000.github.io/assets/lights.jpg" alt="lights"></p>
<p>2012年端午节前的一个礼拜，我买了张从南宁到上海的火车票,只身一人来到上海。</p>
<p>两个礼拜前我从广州的一家公司辞职。这家广州公司在南宁有一个更小的办公室，我11年刚毕业的时候找不到很好的工作，就先去那个小办公室上班；那时我和大学室友在公司附近一起租了一套房子，房主是戒毒所医生，一个个子小小的，为人和蔼的南宁阿姨；同年10月份，我被派去广州出差，那是我第一次去发达省份，第一次坐地铁，也第一次感受到大城市竞争的残酷性。不过那时我以为自己年底还会回南宁继续上班，所以还留了一些杂物在南宁，租的房子也没有退。</p>
<p>没想到，再次回南宁的时候，已经是决定离开这座城市了。我在南宁大概呆了一个多礼拜，见了南宁办公室的同事，并和他们一起去了趟北海玩了两天，那是我第二次去北海。在北海的两天，我和蒙哥（南宁办公室的老大）一起住的一个标准间，夜里我们七七八八聊了一些；我只记得他跟我讲了他在IBM当销售的时候是怎么搞定客户的故事，和他对未来的一些打算，似乎有挽留之意，我含糊中转移了话题。从北海回南宁后，约了几个大学同学聚餐，地点在西大后面农院路的街头。尔后退了房子，收拾好行李，临走的前一天，我一个人去西大走了走，看了看。然后搭上火车，和这个呆了四年多的城市道别了。</p>
<p>刚来上海的头两个礼拜，我借住在朋友那里；朋友住在他自己租在桂林路地铁站附近的一间小屋子里；那个小格子间是我经历过的条件最艰苦的住宿环境，小小的隔间，只有四五平方米，屋子里还臭气一阵阵。那段时间，我疯狂的投简历，只要人家约我去面试，我都要跑去试试看，一心想把自己买一个好价钱。最终，我去到上家公司上班，公司叫 yeecco。找好工作之后，我从朋友的小隔间里面搬了出来。我无意冒犯这位朋友，只是觉得人应该对自己好一点，那样的住宿环境现在想起来我都会觉得难受。</p>
<p>新租的房子在淞虹路地铁站附近，隔壁住的是一对刚毕业的情侣。有了工作和住的地方，我稍微定心了些，没有刚来的时候那么惶恐。</p>
<p>那段日子，早上我从淞虹路坐地铁到静安寺上班。半个小时拥挤的地铁中，我会看一会书；印象中看的是稻盛和夫的《活法》。这本书可能会被现在的人诟病，但对一个初来乍到，在这个都市一个帮手都没有的人来讲，不失为一本很好的精神慰藉。它让我把所有的精力都放在新工作上，让我不要多想，做好眼前事，明日事明日议。</p>
<p>新工作并不容易，公司做的项目是 <a href="https://github.com/morningtec/StellaSDK" target="_blank" rel="external">StellaSDK</a>，对于当时的我来讲，项目中大多数知识是我没接触过的，很多东西无从下手。那段时间，我拼命学习，工作。经常会在地铁里面，思考到某个点，恨不能马上拿电脑验证一下；又会因为某个问题没思路解决不了，导致压力太大吃不下饭。但回过头来看，那段经历对自己编程技术的提升帮助很大，让我养成了很好的学习新技术的习惯和方法，不畏惧任何不懂的技术领域。我很感激老大wenqi，那时候他对我也很好（一个会夜里开车送你回家的老大不是那么的常见），我的技术，习惯，思考方式，以及保持勤奋全都是从他身上学得，非常感激他。</p>
<p>后来，由于一些原因我离开了上家公司，来到了腾讯。如今，算算我已经毕业五年，来到上海也已经四年；看起来情况在变好，至于未来，应该会变得更好一些吧。</p>
<p>后记：</p>
<p>不知道其它人会不会有这样一种感觉，在生活中的某个阶段，你会突然意识到自己生命中的一切都只能靠你自己。我有这种感觉是在我刚毕业的时候。在那段时间里的某一刻，我突然意识到接下来的一切，钱，工作，女人，以及所有的渴望都只有靠自己。你是你唯一的依靠。</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=3986326&auto=1&height=66"></iframe>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2016/07/30/shanghai-4-years/" data-id="cup0xfgbt047my6c" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-pragmatic-thinking-and-learning" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/06/11/pragmatic-thinking-and-learning/">《程序员的思维训练》读书笔记</a>
  

      </header>
    
    <time class="article-date" datetime="2016-06-11T08:21:36.000Z" itemprop="datePublished">06-11-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Reading-notes/">Reading notes</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img1.doubanio.com/lpic/s4548399.jpg" style="width: 120px;"></p>
<h2 id="技术从业人员的五个级别">技术从业人员的五个级别</h2>
<p>书中开篇介绍一项技术领域的从业人员，大体可以分成五个级别：新手，高级新手，胜任者，精通者，专家。从名次表面就很好理解这五个级别所代表的意思。有意思的地方在于现在国内的大型互联网公司内部，技术人员的职级分类也是如此：初级工程师，工程师，高级工程师，资深工程师，专家。文中列举了一些各个级别的人的一些有意思的特征，如新手非常在乎他们是否成功，新手不是特别想要学习，他们只是想要一个立竿见影的效果，如果出错，他们非常容易慌乱。高级新手能够根据过去的经验，逐步在正确的情景中采纳建议，但他们不想要全局思维。胜任者是可以独立解决问题，并开始考虑如何解决新的问题，胜任者的工作更多的是基于谨慎的计划和过去的经验，如果没有更多的经验，在解决问题时，他们难以确定关注哪些细节。精通者能够纠正以往不好的工作表现，他们会反思以前是如何做的，并修改其做法，期望下一次表现得更好，如此，自我改进就会出现。专家根据直觉工作，而不需要理由，专家的数量很少，大概占总人数的1%～5%。</p>
<p>而要想而从新手一步一步升级成为专家，自身要发生如下三个重要变化才行：</p>
<ul>
<li>从依赖规则向依赖直觉转变</li>
<li>观念的改变，问题已不再是一个相关度等同的所有单元的集合体，而是一个完整和独特的真题，其中某些单元是相关的。</li>
<li>最后，从问题的旁观者转变为问题涉及的系统本身的一部分。</li>
</ul>
<p>然后，令人沮丧的是，研究表明，大多数人的大多数技能，在他们生命的大多数时间里，从没有高于第二阶段高级新手，这里的大多数指的是70%的人。</p>
<h2 id="大脑的两种思考模式（L_&amp;_R）">大脑的两种思考模式（L &amp; R）</h2>
<p>书中第二部分介绍了大脑两种思考模式，L模式－线性模式，R模式－富模式。R型对直觉。L型让你细致工作并实现目标。要想获得最佳性能，需要两种模式协同工作。</p>
<p>L型提供以下9种能力：</p>
<ul>
<li>语言能力</li>
<li>分析能力</li>
<li>符号能力</li>
<li>抽象能力</li>
<li>实践能力</li>
<li>推理能力</li>
<li>数字能力</li>
<li>逻辑能力</li>
<li>线性思维能力</li>
</ul>
<p>这些都是白领们，信息工作者和工程师们最渴望的本领。上学的时候测验也是这些能力。</p>
<p>R型提供的能力：</p>
<ul>
<li>非语言</li>
<li>非理性</li>
<li>综合</li>
<li>空间性</li>
<li>具体</li>
<li>直觉</li>
<li>分析</li>
<li>全面</li>
<li>非线性</li>
</ul>
<p>R型是非语言的，注重整体的，直觉的，跳跃的，这些特点似乎更适合艺术家。但R型的类比和整体思考方式对软件架构和设计非常有价值，好的设计就是由这些组成的。R型还负责综合，而综合是一项非常强大的学习技术。乃至于麻省理工学院媒体实验室创始人建议，真正想要了解一只青蛙，传统的解剖不是办法，更好的方式是构造一直青蛙。（联想到软件开发中，如果想真正搞透某个模块，重造轮子应该是最好的方式）。</p>
<p>接着书中谈到相对于L型，为何R型也如此重要。一家公司的产品是否能够成功，R型思维起到很重要因素。因为R型管理美学，而商品化意味着美学品味的竞争。<strong>作者强调产品的设计胜于功能，是否有吸引力很重要。</strong>好的设计，会给用户带来积极的情感，而积极的情感对学习和创造思维非常关键。处于“高兴”的状态可以扩展你的思维过程，激活更多的大脑物质（意味着用户从产品获取到快感，成就感，自然就会愿意使用产品）。</p>
<p>当然了，美学不仅仅指的是用户界面,产品的Logo，也包括代码和注释的布局，变量名的选择和桌面的整理，还有其他领域的方方面面。（此时，想起了乔布斯的那句“It’s all about the taste”）</p>
<h2 id="如何利用L型和R型协同工作">如何利用L型和R型协同工作</h2>
<p>然后书中第四章介绍了如何利用右脑，也就是如何促成R型到L型的转换。其中我觉得很有意思的是酒醉写作，酒醒修改。因为酒醉的时候，你拥有自由的创造空间，不受“常识”或者“实用”束缚，可以尽情发挥自己的创造力或随后抛掉那些荒诞的东西。</p>
<p>下面是举了几个关于 L 型和 R 型协调工作的其它几种方式：</p>
<ul>
<li>结对编程：工作时，一个人用L型，一个人用R型</li>
<li>隐喻相通：隐喻，语言和意像共同的地基，是在左右脑半球之间，在潜意识和意识之间来回游弋的途径。隐喻时一种激发创造力的强大技术。</li>
<li>并列参照系</li>
<li>幽默：幽默既不是浪费时间，也不是无害的消遣，而是反映了思维，学习和创造所必需的重要能力。他与联系有关。幽默产生于在不同的想法中制造新奇的联系。在任何情况下，幽默的能力都来自于发掘或扩展常规之外的关系，真正突破思维界限。</li>
</ul>
<p>文中还有一段关于外向和内向的人讨论。外向的人乐于与人交往并参加社会活动。内向的人则不是，他们具有领地意识，需要私人的精神和环境空间，内向的人从独立的活动中获得力量，厌倦社会活动。百分之七十五的人偏于外向型，剩下百分之二十五的人则希望单独呆着。</p>
<h2 id="学习">学习</h2>
<p>在当今技术和文化环境下，学习能力可能是成功的最重要因素。它决定了你是“大获全胜”还是“勉强通过”。</p>
<ul>
<li>技术本身不重要，持续学习才是最重要的。</li>
<li>学习不是强加于你的，而是需要你主动做的事情</li>
<li>仅仅掌握知识，而不去实践，没有用</li>
<li>随机的方法，没有目标和反馈，往往会导致随机的结果</li>
</ul>
<p>那如何在现实中使学习更有效率？需要使用SMART目标和实用投资计划管理目标和计划。</p>
<p>SMART 代表具体的，可度量的，可实现的，相关的和时间可控的（Specific，Measurable,Achievable,Relevant,and Time-boxed）。</p>
<ul>
<li>具体的：一个目标任务应该是具体的。也就是说，只说“我想学习swift”是不够的。应该把事情具体化，例如“我想要用Swift编写一个记账软件”</li>
<li>可度量的：如何知道你何时完成？为了努力实现目标任务，不管采用什么办法，你必须能够度量它。可度量的与具体的相辅相成。很难度量笼统抽象的事物，但是很容易度量具体和详细的事物，只要使用确切的数字即可。如果你认为无法度量自己的目标任务，那么可能它还不够具体。“写一部小说就像在黑夜里开车。你只能看到车灯照亮的部分，但是你却可以走完整个旅程”。你不必看清你去往何处。不必看清你的目的地和沿途的一切。你只需看清面前的一两米即可。</li>
<li>可实现的</li>
<li>相关的：目标需要相关，需要在你掌握之中</li>
<li>时间可控的：没有期限，目标会逐步衰退，永远被每天更紧急的事情所排挤。</li>
</ul>
<h2 id="管理知识投资">管理知识投资</h2>
<ul>
<li>制定具体计划：制定计划就是巨大的进步。计划要具体，要运用SMART目标理念，要为不同时间段设计不同层次的目标。记住艾森豪威尔将军对我们的建议：作计划比计划本身重要得多。</li>
<li>多样化：不要把所有的鸡蛋放在同一个篮子里，需要很好地组合语言，环境，技术，行业和非技术领域（管理，公共演讲，，人类学，音乐，艺术，等等）</li>
<li>主动投资：需要客观地按天来评估你的计划，如实地判断运行状况。</li>
<li>定期投资：需要定期投资最低限度的时间量，养成一种习惯。并非每期学习都同样富有成效，但是只要定期安排学习，长期来看一定会成功。</li>
</ul>
<h2 id="控制注意力">控制注意力</h2>
<p>在我们生活的这个信息丰富的时代，过多的信息导致了知识和注意力的匮乏。置身于应接不暇的信息中，很容易失去思考的重心。要更好地管理自己的思维需要从以下三个方面做起：</p>
<ul>
<li>提高注意力：可以通过冥想来提高自己的注意力。关于如何冥想，文中提到的是，打坐，然后所有事情就是注意自己的呼吸。详细的步骤需要自身对着书中的介绍去实践。</li>
<li>管理知识：使用wiki</li>
<li>优化当前情境：多任务处理对生产力会造成重大损失，记住，无论你做什么，请不要同时都做，避免分心。</li>
</ul>
<h2 id="改变">改变</h2>
<p>一些帮助我们管理有效改变的建议。</p>
<ul>
<li>制定计划</li>
<li>“不作为”是敌人，而“错误”不是</li>
<li>给新习惯适应的时间</li>
<li>信念是真实的</li>
<li>采取步步为营的细小步骤</li>
</ul>
<p>最后，选择开始做什么并不特别重要，重要的是主动尝试学习到的知识，做出改变。</p>
<blockquote>
<p>不管你能做什么，或者期望自己能做什么，现在就开始做。勇敢可以给人智慧，力量和神奇。现在就开始做吧。 －－歌德</p>
</blockquote>
<p>以上是我读书过程中做的一些书摘。作为一个软件从业人员，我对文中作者的很多观点都很是赞同，对这本书也有点相见恨晚的味道。读这本书的时候，最重要的环节就是尝试去做书中提到的种种实践；就像我们在研究一门新的技术的时候，重要的一环是用新技术去解决某个问题。这种学习方式是我从业以来一直惯用的方式。<br>很好的一本书，值得推荐给别人去看，不论这个人是不是程序员。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2016/06/11/pragmatic-thinking-and-learning/" data-id="1a2br1qsxv3le4kt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-reverse-engineering-03" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/03/06/iOS-reverse-engineering-03/">iOS逆向工程-0x02－Hacking on B612</a>
  

      </header>
    
    <time class="article-date" datetime="2016-03-06T03:32:44.000Z" itemprop="datePublished">03-06-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p>前面两篇iOS逆向的文章（<a href="http://cp0000.github.io/2015/11/21/iOS-reverse-engineering-01/" target="_blank" rel="external">iOS逆向工程-0x00－用途以及准备工作</a>,<a href="http://cp0000.github.io/2015/11/30/iOS-reverse-engineering-02/" target="_blank" rel="external">iOS逆向工程-0x01－工具篇-Cycript</a>）主要是介绍iOS逆向的相关基础环境的搭建，工具的使用。有了这些知识之后，我们可以进行简单的逆向工作了。</p>
<p><a href="https://itunes.apple.com/us/app/b612-selfie-from-the-heart/id904209370?mt=8" target="_blank" rel="external">B612</a>是Line公司出品的一款非常棒的拍照软件。它的界面，交互，用起来非常顺手。app中的滤镜效果很赞，用户简单几步操作就可以生成一张很有质感的照片。本文我将会演示如何通过逆向来得知B612单个的滤镜的具体实现。</p>
<p>从AppStore上面下载B612的IPA文件，把文件的后缀名从 .IPA 修改成 .zip。解压zip文件之后，在Payload中有一个b612.app的文件，这里我们把.app的后缀去掉，让它变成一个文件夹，方便后面查阅。经过以上几步操作我们就拿到了 B612 app的 bundle 文件信息。</p>
<p>在使用B612的过程中，app会展列一个滤镜列表给用户进行选择（如下图）：</p>
<p><img src="http://cp0000.github.io/assets/b612_filter_list.png" alt="B612_filter_list" style="width: 400px;"></p>
<p>使用的过程发现一个叫 China 的滤镜，China，中国？还是瓷器？叫China的滤镜会呈现出什么样子的效果，根据效果我们是否能推测出这里的China是要翻译成中国，还是瓷器咧？很有意思的样子。我们就拿这个滤镜当做目标吧。</p>
<p>一般情况下，我的常用做法是在先前解压的文件夹中搜索一下相关的信息，碰碰运气。</p>
<pre><code><span class="keyword">find</span> . -name <span class="string">"*china*"</span>                 
.<span class="regexp">/FilterThumb.bundle/</span>filterthumb_china.jpg
.<span class="regexp">/ObfuscateImages.bundle/</span>lut<span class="regexp">/china.dat</span>
</code></pre><p>运气不错。在ObfuscateImages.bundle发现了一个叫china.dat的文件。不过尝试用各种编辑器都没法打开，使用修改后缀名等之类的方法也没能成功打开。看来要获取这个文件的内容没有那么简单，开发者对这个文件做了相关加密工作。要想解密该文件，我们可能需要到汇编代码中寻找答案了。</p>
<blockquote>
<p>这里考虑到程序在使用这个滤镜的时候，会加载该文件，并进行相关解密工作。所以下一步是要找到解密dat文件的地方，不过在此之前，我们还有一些工作要做。</p>
</blockquote>
<h2 id="解密可执行文件_-_clutch_演示">解密可执行文件 - clutch 演示</h2>
<p>接下来我们要去可执行文件中查询相关信息了。但是从苹果商店上面下载下来的IPA里面的可执行文件是被苹果加密过的,我们解谜它。我常用的工具是 <a href="https://github.com/KJCracks/Clutch" target="_blank" rel="external">clutch</a>,你可以clone一份repo到本地，然后编译得到一个clutch的程序，也可以直接下载release版本。然后把Clutch scp 到你的越狱机器上面就可以使用了。</p>
<ul>
<li><p>首先我们查找一下b612的bundle</p>
<p>  iPhone:/usr root# ./Clutch -i|grep b612<br>  28)<b612 bundleid:="" com.linecorp.b612=""></b612></p>
</li>
<li><p>然后进行dump工作</p>
<p>  iPhone:/usr root# ./Clutch -d com.linecorp.b612<br>  ….<br>  //程序输出相关log<br>  ….<br>  DONE: /private/var/mobile/Documents/Dumped/com.linecorp.b612-iOS7.0-(Clutch-2.0 RC2).ipa</p>
</li>
</ul>
<p>最后会生成一个解密了的ipa文件，我们把它scp到电脑上来，进行分析。</p>
<blockquote>
<p>还有另外一个解密苹果商店加密IPA的工具叫<a href="https://github.com/conradev/dumpdecrypted" target="_blank" rel="external">dumpdecrypted</a>。由于在使用Clutch解密app的时候，消耗内存比较大，导致运行时会出现解密失败的情况，这个时候可以尝试使用<a href="https://github.com/conradev/dumpdecrypted" target="_blank" rel="external">dumpdecrypted</a>。</p>
</blockquote>
<h2 id="分析可执行文件_-_class-dump_以及_IDA">分析可执行文件 - class-dump 以及 IDA</h2>
<p>要分析解密之后的文件，我们可以使用<a href="https://github.com/nygard/class-dump" target="_blank" rel="external">class-dump</a>来导出程序的头文件。有了头文件列表之后，我们可以利用它来了解app的架构，使用的类库，以及探索需要逆向的那一块功能所属的类名。</p>
<pre><code><span class="comment">class</span><span class="literal">-</span><span class="comment">dump</span><span class="literal">-</span><span class="comment">z/mac_x86/class</span><span class="literal">-</span><span class="comment">dump</span><span class="literal">-</span><span class="comment">z</span> <span class="comment">b612</span> <span class="literal">-</span><span class="comment">H</span> <span class="literal">-</span><span class="comment">o</span> <span class="comment">headers</span>
<span class="comment">cd</span> <span class="comment">headers</span>
<span class="comment">total</span> <span class="comment">10728</span>
<span class="comment">drwxr</span><span class="literal">-</span><span class="comment">xr</span><span class="literal">-</span><span class="comment">x</span>  <span class="comment">1295</span> <span class="comment">cp</span>  <span class="comment">wheel</span>  <span class="comment">44030</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="string">.</span>
<span class="comment">drwxr</span><span class="literal">-</span><span class="comment">xr</span><span class="literal">-</span><span class="comment">x</span>   <span class="comment">455</span> <span class="comment">cp</span>  <span class="comment">wheel</span>  <span class="comment">15470</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="string">.</span><span class="string">.</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>    <span class="comment">785</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTApplication</span><span class="string">.</span><span class="comment">h</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>    <span class="comment">370</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTAutomatedUsageReporter</span><span class="string">.</span><span class="comment">h</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>    <span class="comment">391</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTAutomatedUsageReporterPrivate</span><span class="string">.</span><span class="comment">h</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>    <span class="comment">264</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTAutomatedUsageReporting</span><span class="string">.</span><span class="comment">h</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>   <span class="comment">1830</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTAutomatedUsageTracker</span><span class="string">.</span><span class="comment">h</span>
</code></pre><p>要找到加密 .dat 文件的相关代码，我们需要使用另外一个非常强大的工具<a href="https://www.hex-rays.com/products/ida/index.shtml" target="_blank" rel="external">IDA</a>。IDA可以非常整洁的输出可执行文件的汇编代码，并且相互连接起来。不过这个软件非常之贵，但是它的免费版本已经够用了。</p>
<p>把B612的可执行文件加载到IDA之后，我们在IDA中执行一个搜索，关键字是dat;幸运的是，搜索结果指向了一下的代码。虽然是汇编代码，但是不难看出两点信息，（1）dat后缀的文件是一张Image （2）程序中需要把文件的数据字节进行反向操作，达到混淆的目的。</p>
<p><img src="http://cp0000.github.io/assets/b612-reversebyte.png" alt="reversebyte" style="width: 500px;"></p>
<p>接下来验证一下线索结果：</p>
<pre><code>- (<span class="keyword">void</span>)viewDidLoad {
    [<span class="keyword">super</span> viewDidLoad];
    NSData * data = [[NSData alloc] initWithContentsOfFile: [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"china"</span> ofType:<span class="string">@"dat"</span>]];
    data = [<span class="keyword">self</span> reverseData: data];
    <span class="built_in">UIImage</span> * image  = [<span class="built_in">UIImage</span> imageWithData: data];
    <span class="built_in">UIImageView</span> * imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage: image];
    imageView<span class="variable">.frame</span> = <span class="keyword">self</span><span class="variable">.view</span><span class="variable">.bounds</span>;
    [<span class="keyword">self</span><span class="variable">.view</span> addSubview: imageView];
}
- (NSData *)reverseData:(NSData *)data {
    <span class="keyword">const</span> <span class="keyword">char</span> *bytes = [data bytes];
    <span class="keyword">int</span> idx = [data length] - <span class="number">1</span>;
    <span class="keyword">char</span> *reversedBytes = calloc(<span class="keyword">sizeof</span>(<span class="keyword">char</span>),[data length]);
    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; [data length]; i++) {
        reversedBytes[idx--] = bytes[i];
    }
    NSData *reversedData = [NSData dataWithBytes:reversedBytes length:[data length]];
    free(reversedBytes);
    <span class="keyword">return</span> reversedData;
}
</code></pre><p>上述代码让我们获得一张china的图片：</p>
<p><img src="http://cp0000.github.io/assets/china.png" alt="china" style="width: 300px;"></p>
<p>上述代码，请查阅<a href="https://github.com/cp0000/HackB612" target="_blank" rel="external">HackB612Image</a></p>
<p>OK，到此为止，我们解密了china.dat 这种类型的文件，它跟我们最终要挖掘的china滤镜是如何实现的之间肯定有着联系，但我们现在还不得知。</p>
<h2 id="关于滤镜">关于滤镜</h2>
<p>在iOS app 中给图片加滤镜是要通过OpenGL ES 去实现的，而现在app中普遍使用的是<a href="https://www.khronos.org/opengles/2_X/" target="_blank" rel="external">OpenGL ES 2.0</a>。这种情况下，滤镜一般都是通过OpenGL的shader来实现的。此时，前面dump出来的header就有用了，分析headers之后，我们发现了两个相关类 GPUImageFilter以及GLProgram。又由于shader在使用之前一定要进行link，compile操作。所以我们可以通过尝试hook这两个类的相关函数，来获得滤镜的shader。</p>
<blockquote>
<p>根据头文件我们能发现B612是通过使用<a href="https://github.com/BradLarson/GPUImage" target="_blank" rel="external">GPUImage</a>框架来实现滤镜功能的。</p>
</blockquote>
<h2 id="Theos">Theos</h2>
<p>关于如何hook app 在运行时的函数，我们需要使用工具<a href="http://iphonedevwiki.net/index.php/Theos" target="_blank" rel="external">Theos</a>.</p>
<ul>
<li>关于如何安装Theos，请阅读<a href="http://iphonedevwiki.net/index.php/Theos/Setup" target="_blank" rel="external">Theos Setup</a>。</li>
<li>Logos相关语法，请参考<a href="http://iphonedevwiki.net/index.php/Logos" target="_blank" rel="external">Theos Logos</a></li>
</ul>
<p>安装好Theos之后，我们为B612创建一个tweak;</p>
<pre><code>$THEOS/bin/nic.pl 
NIC <span class="number">2.0</span> - New Instance Creator
------------------------------
  [<span class="number">1.</span>] iphone/application
  [<span class="number">2.</span>] iphone/<span class="keyword">library</span>
  [<span class="number">3.</span>] iphone/preference_bundle
  [<span class="number">4.</span>] iphone/tool
  [<span class="number">5.</span>] iphone/tweak
Choose a Template (required): <span class="number">5</span>
Project Name (required): bsix
Package Name [com.yourcompany.bsix]: com.cp.bsix
Author/Maintainer Name [cp]: 
[iphone/tweak] MobileSubstrate Bundle filter [com.apple.springboard]: com.linecorp.b612            
[iphone/tweak] List of applications to terminate upon installation (space-separated, <span class="string">'-'</span> <span class="keyword">for</span> none) [SpringBoard]: b612
Instantiating iphone/tweak <span class="keyword">in</span> bsix/<span class="keyword">...</span>
Done.
</code></pre><p>然后在Tweak.xm文件中编辑需要hook的函数：</p>
<pre><code>%hook GLProgram
-(<span class="property">id</span>)initWithVertexShaderString:(<span class="property">id</span>)vertexShaderString fragmentShaderString:(<span class="property">id</span>)<span class="type">string</span>
{
    [Logger <span class="command">log</span>: [NSString stringWithFormat:@<span class="string">"%@ %@"</span>, NSStringFromClass([self <span class="type">class</span>]), NSStringFromSelector(_cmd)]];
    NSString * msg = [NSString stringWithFormat: @<span class="string">"vertexShaderString: %@ fragmentShaderString: %@ "</span>, vertexShaderString, <span class="type">string</span>];
    [Logger <span class="command">log</span>: msg];
<span class="command">    return</span> %orig;
}
%<span class="keyword">end</span>
</code></pre><p>B612 tweak 的项目地址<a href="https://github.com/cp0000/B612Tweak" target="_blank" rel="external">B612Tweak</a>.成功编译之后，把生成的.deb文件scp到越狱机器上，利用dpkg安装tweak；杀掉B612进程重启app之后，tweak就可以hook相关函数了。以下在点击China滤镜的时候，tweak打印出来的log信息：</p>
<pre><code>GLProgram initWithVertexShaderString:fragmentShaderString:
vertexShaderString: 
<span class="keyword">attribute</span> <span class="keyword">vec4</span> position; 
<span class="keyword">attribute</span> <span class="keyword">vec4</span> inputTextureCoordinate; 
<span class="keyword">attribute</span> <span class="keyword">vec4</span> inputTextureCoordinate2; 
<span class="keyword">varying</span> <span class="keyword">vec2</span> textureCoordinate; 
<span class="keyword">varying</span> <span class="keyword">vec2</span> textureCoordinate2; 
<span class="keyword">void</span> main() { 
    <span class="built_in">gl_Position</span> = position; 
    textureCoordinate = inputTextureCoordinate.xy; 
    textureCoordinate2 = inputTextureCoordinate2.xy; 
} 
fragmentShaderString: 
<span class="keyword">varying</span> <span class="keyword">highp</span> <span class="keyword">vec2</span> textureCoordinate; 
<span class="keyword">varying</span> <span class="keyword">highp</span> <span class="keyword">vec2</span> textureCoordinate2; 
<span class="keyword">uniform</span> <span class="keyword">sampler2D</span> inputImageTexture; 
<span class="keyword">uniform</span> <span class="keyword">sampler2D</span> inputImageTexture2; 
<span class="keyword">void</span> main() { 
    <span class="keyword">highp</span> <span class="keyword">vec4</span> textureColor = <span class="built_in">texture2D</span>(inputImageTexture, textureCoordinate); 
    <span class="keyword">highp</span> <span class="keyword">float</span> blueColor = textureColor.b * <span class="number">63.0</span>; 
    <span class="keyword">highp</span> <span class="keyword">vec2</span> quad1; 
    quad1.y = <span class="built_in">floor</span>(<span class="built_in">floor</span>(blueColor) / <span class="number">8.0</span>); 
    quad1.x = <span class="built_in">floor</span>(blueColor) - (quad1.y * <span class="number">8.0</span>); 
    <span class="keyword">highp</span> <span class="keyword">vec2</span> quad2; 
    quad2.y = <span class="built_in">floor</span>(<span class="built_in">ceil</span>(blueColor) / <span class="number">8.0</span>); 
    quad2.x = <span class="built_in">ceil</span>(blueColor) - (quad2.y * <span class="number">8.0</span>); 
    <span class="keyword">highp</span> <span class="keyword">vec2</span> texPos1; 
    texPos1.x = (quad1.x * <span class="number">0.125</span>) + <span class="number">0.5</span>/<span class="number">512.0</span> + ((<span class="number">0.125</span> - <span class="number">1.0</span>/<span class="number">512.0</span>) * textureColor.r); 
    texPos1.y = (quad1.y * <span class="number">0.125</span>) + <span class="number">0.5</span>/<span class="number">512.0</span> + ((<span class="number">0.125</span> - <span class="number">1.0</span>/<span class="number">512.0</span>) * textureColor.g); 
    <span class="keyword">highp</span> <span class="keyword">vec2</span> texPos2; 
    texPos2.x = (quad2.x * <span class="number">0.125</span>) + <span class="number">0.5</span>/<span class="number">512.0</span> + ((<span class="number">0.125</span> - <span class="number">1.0</span>/<span class="number">512.0</span>) * textureColor.r); 
    texPos2.y = (quad2.y * <span class="number">0.125</span>) + <span class="number">0.5</span>/<span class="number">512.0</span> + ((<span class="number">0.125</span> - <span class="number">1.0</span>/<span class="number">512.0</span>) * textureColor.g); 
    <span class="keyword">lowp</span> <span class="keyword">vec4</span> newColor1 = <span class="built_in">texture2D</span>(inputImageTexture2, texPos1); 
    <span class="keyword">lowp</span> <span class="keyword">vec4</span> newColor2 = <span class="built_in">texture2D</span>(inputImageTexture2, texPos2); 
    <span class="keyword">lowp</span> <span class="keyword">vec4</span> newColor = <span class="built_in">mix</span>(newColor1, newColor2, <span class="built_in">fract</span>(blueColor)); 
    <span class="built_in">gl_FragColor</span> = <span class="keyword">vec4</span>(newColor.rgb, textureColor.w); 
}
</code></pre><h2 id="关于使用OpenGL实现滤镜">关于使用OpenGL实现滤镜</h2>
<p>前文提到过，根据class-dump出来的头文件，得知B612使用了<a href="https://github.com/BradLarson/GPUImage" target="_blank" rel="external">GPUImage</a>。理论上我们下一步研究下GPUImage项目，应该就可以实现china滤镜的效果了，但GPUImage项目还是挺庞大，挺复杂的。</p>
<blockquote>
<p>GPUImage 提供了<code>GPUImageLookupFilter</code>类来实现颜色查找类的滤镜</p>
</blockquote>
<p>这里我们直接使用OpenGL来实现China滤镜。阅读前面的shader代码，得知需要传递给shader两个texture，可以想象出一个是需要原图片，一个是china.dat转换出来的图片，经过顶点着色器和片段着色器，最终给目标图片加上滤镜。下面第一张图是原图，第二张是我用OpenGL实现的Demo效果图片，第三张是B612加china滤镜出来的结果。对比第二张和第三章，效果非常相似。利用OpenGL实现滤镜的代码，请查阅<a href="https://github.com/cp0000/HackB612" target="_blank" rel="external">HackB612</a></p>
<p><img src="http://cp0000.github.io/assets/photo.jpg" alt="原图" style="width: 250px;"></p>
<p><img src="http://cp0000.github.io/assets/jingse.jpg" alt="Demo效果图" style="width: 250px;"><img src="http://cp0000.github.io/assets/jingse_b612.jpg" alt="B612效果图" style="width: 250px;"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2016/03/06/iOS-reverse-engineering-03/" data-id="92rsjdf56ircwclh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS-Reverse-Engineering/">iOS Reverse Engineering</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2015-summary" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2015/12/31/2015-summary/">2015 年终总结</a>
  

      </header>
    
    <time class="article-date" datetime="2015-12-31T03:10:31.000Z" itemprop="datePublished">12-31-2015</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Life/">Life</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p>上海的冬天不是很好过，屋里屋外都很冷。忙碌中，不觉间，这一年已经来到了12月31号，15年就快要结束了。这两年自己也算养成了在一年结束的时候写一篇年終总结的习惯，好让自己来和这一年说再见。</p>
<p>15年对自己影响最大的事情是奶奶的过世。奶奶的逝去的那一阵子，让我恍惚间有了一种了无牵挂的感觉。那段时间，我觉得自己从此无依无靠；没有了任何牵挂，也无了任何寄托。自己可以随风漂泊去任何地方了。</p>
<p>每当我遇到自己恐惧的事情，会想到奶奶；想到奶奶临终前独自面对死亡，我自己头上的这点小事，真的不算个事。从我能记事开始，和奶奶生活的这二十多年，感觉时间很平静的就流逝了，我对奶奶也没有特别的故事可以回忆。只是有时候走在路上，躺在床上，会突然很想念她老人家。</p>
<p>其他的事情需要记录的并不多；15年我常去健身房，由于我从小有点驼背，加上工作性质，长期呆在电脑前，导致现在颈背状况很差，有时候会感觉特别痛。本来希望能通过健身矫正把这个毛病改掉，然而15年收效微微，但16年还是要坚持，相信正确的方法可以帮助自己克服掉这个长期以来的毛病。</p>
<p>另外就是今年终于把自己的博客写起来了，博客这个事情，自己老早就开通了，但能保持一个月至少两篇算是15年坚持下来的习惯；博文质量还有待提高，16年自己会坚持写作的。可以说坚持写作给予我的反馈是很棒的，会有一种特别的满足感。看着自己的文字，我能确切的知道，自己不是在混日子，自己平日里是有在思考的，自己是可以用文字把自己的想法，技巧，知识记录下来的，这一点让我感到安心。</p>
<p>整理这篇总结的时候，已经是2016年了，2016年希望自己能过的更随性，更自由一些。</p>
<p>2015年过去了，我很怀念它。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2015/12/31/2015-summary/" data-id="0odzkjwln70qwoab" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2015-2nd-movie-list" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2015/12/27/2015-2nd-movie-list/">2015下半年电影清单</a>
  

      </header>
    
    <time class="article-date" datetime="2015-12-27T14:16:11.000Z" itemprop="datePublished">12-27-2015</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Movie/">Movie</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>中国大陆</strong></p>
<ul>
<li><a href="http://movie.douban.com/subject/25710912/" target="_blank" rel="external">港囧 (2015)</a></li>
<li><a href="http://movie.douban.com/subject/26277313/" target="_blank" rel="external">西游记之大圣归来 (2015)</a> ✔</li>
<li><a href="http://movie.douban.com/subject/3077412/" target="_blank" rel="external">寻龙诀 (2015)</a> ✔</li>
</ul>
<p><strong>中国香港</strong></p>
<ul>
<li><a href="http://movie.douban.com/subject/1298898/" target="_blank" rel="external">暗战 暗戰 (1999)</a> ✔</li>
</ul>
<p><strong>中国台湾</strong></p>
<ul>
<li><a href="http://movie.douban.com/subject/26366465/" target="_blank" rel="external">我的少女时代 我的少女時代 (2015)</a>✔</li>
</ul>
<p><strong>欧美</strong></p>
<ul>
<li><a href="http://movie.douban.com/subject/1866473/" target="_blank" rel="external">蚁人 Ant-Man (2015)</a> ✔</li>
<li><a href="http://movie.douban.com/subject/11624706/" target="_blank" rel="external">小黄人大眼萌 Minions (2015)</a></li>
<li><a href="http://movie.douban.com/subject/10727641/" target="_blank" rel="external">碟中谍5：神秘国度 Mission: Impossible - Rogue Nation (2015)</a> ✔</li>
<li><a href="http://movie.douban.com/subject/10463953/" target="_blank" rel="external">模仿游戏 The Imitation Game (2014)</a> ✔</li>
<li><a href="http://movie.douban.com/subject/10440138/" target="_blank" rel="external">侏罗纪世界 Jurassic World (2015)</a> ✔</li>
<li><a href="http://movie.douban.com/subject/1293530/" target="_blank" rel="external">角斗士 Gladiator (2000)</a>✔</li>
<li><a href="http://movie.douban.com/subject/1945780/" target="_blank" rel="external">血色将至 There Will Be Blood (2007)</a>✔✔✔</li>
<li><a href="http://movie.douban.com/subject/3008247/" target="_blank" rel="external">穿条纹睡衣的男孩 The Boy in the Striped Pajamas (2008)</a></li>
<li><a href="http://movie.douban.com/subject/25773932/" target="_blank" rel="external">爆裂鼓手 Whiplash (2014)</a> ✔✔</li>
<li><a href="http://movie.douban.com/subject/2044089/" target="_blank" rel="external">杀手没有假期 In Bruges (2008)</a></li>
<li><a href="http://movie.douban.com/subject/3592854/" target="_blank" rel="external">疯狂的麦克斯4：狂暴之路 （Mad Max: Fury Road）</a>✔</li>
<li><a href="http://movie.douban.com/subject/24815950/" target="_blank" rel="external">万物理论 The Theory of Everything (2014)</a> ✔</li>
<li><a href="http://movie.douban.com/subject/25766754/" target="_blank" rel="external">年轻气盛 Youth (2015)</a> ✔</li>
<li><a href="http://movie.douban.com/subject/10533913/" target="_blank" rel="external">头脑特工队 Inside Out (2015)</a></li>
<li><a href="http://movie.douban.com/subject/11620560/" target="_blank" rel="external">007：幽灵党 Spectre (2015)</a> ✔</li>
<li><a href="http://movie.douban.com/subject/6873042/" target="_blank" rel="external">明日世界 Tomorrowland (2015)</a></li>
<li><a href="http://movie.douban.com/subject/6846893/" target="_blank" rel="external">超能查派 Chappie (2015)</a></li>
</ul>
<p><strong>日本</strong></p>
<ul>
<li><a href="http://movie.douban.com/subject/25814707/" target="_blank" rel="external">小森林 冬春篇 リトル・フォレスト 冬・春 (2015)</a> ✔✔✔✔</li>
<li><a href="http://movie.douban.com/subject/2000741/" target="_blank" rel="external">母亲 母べえ (2008)</a> ✔✔✔✔</li>
<li><a href="http://movie.douban.com/subject/26147706/" target="_blank" rel="external">花与爱丽丝杀人事件 花とアリス殺人事件 (2015)</a> ✔✔✔</li>
</ul>
<p><strong>美剧</strong></p>
<ul>
<li><a href="http://movie.douban.com/subject/26290409/" target="_blank" rel="external">黑客军团 第一季 Mr. Robot Season 1 (2015)</a> ✔</li>
<li><a href="http://movie.douban.com/subject/10748120/" target="_blank" rel="external">真探 第一季 True Detective Season 1 (2014)</a> ✔✔✔</li>
<li><a href="http://movie.douban.com/subject/25837700/" target="_blank" rel="external">真探 第二季 True Detective Season 2 (2015)</a></li>
<li><a href="http://movie.douban.com/subject/25850640/" target="_blank" rel="external">毒枭 第一季 Narcos Season 1 (2015)</a> ✔✔</li>
<li><a href="http://movie.douban.com/subject/20644938/" target="_blank" rel="external">硅谷 第一季 Silicon Valley Season 1 (2014)</a>✔</li>
<li><a href="http://movie.douban.com/subject/25871679/" target="_blank" rel="external">硅谷 第二季 Silicon Valley Season 2 (2015)</a>✔</li>
<li><a href="http://movie.douban.com/subject/25770124/" target="_blank" rel="external">政局边缘 The Brink (2015)</a></li>
</ul>
<p><strong>英剧</strong></p>
<ul>
<li><a href="http://movie.douban.com/subject/26170816/" target="_blank" rel="external">真实的人类 第一季 Humans Season 1 (2015)</a>✔</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2015/12/27/2015-2nd-movie-list/" data-id="oyszm52yqwedqf6m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-reverse-engineering-02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2015/11/30/iOS-reverse-engineering-02/">iOS逆向工程-0x01－工具篇-Cycript</a>
  

      </header>
    
    <time class="article-date" datetime="2015-11-30T14:00:07.000Z" itemprop="datePublished">11-30-2015</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p>对于初开始学习iOS逆向工程的人来说，实现一个<code>tweak</code>可以算是入门逆向工程了。</p>
<p>当然了，可能你现在还不知道<code>tweak</code>是什么。简单来说，你可以把一个tweak当作某一个app的一个插件（类似于浏览器广告屏蔽插件）。在app运行的时候，tweak会hook住某个函数，然后在hook的函数里面，你可以插入你的代码。</p>
<blockquote>
<p>比如用户在登陆微信账号的时候，tweak可以hook住登录函数，dump出用户的账号密码</p>
</blockquote>
<p>那问题来了，我们要如何知道哪个函数是账号登录函数咧？<strong>这就涉及到我们如何去分析一个iOS app</strong></p>
<h2 id="分析_iOS_app_的两种方法">分析 iOS app 的两种方法</h2>
<ul>
<li><p>运行时分析</p>
<ul>
<li>GDB/LLDB</li>
<li>Cycript</li>
<li>Logify</li>
<li>weak_classdump</li>
<li>InspectiveC</li>
</ul>
</li>
</ul>
<ul>
<li><p>可执行代码分析</p>
<ul>
<li>dumpdecrpted</li>
<li>class_dump,class_dump_z,classdump_dyld</li>
<li>Disassemblers<ul>
<li>IDA</li>
<li>Hopper</li>
<li>otool</li>
</ul>
</li>
<li>strings</li>
<li>nm</li>
</ul>
</li>
</ul>
<p>先不要被这么多的工具多吓到，我们一样一样来。相比对汇编代码的分析，动态分析要简单，容易上手很多，对新手而言，也更加容易获取到乐趣。所以我们先从最好玩的Cycript开始。</p>
<h3 id="Cycript">Cycript</h3>
<p><a href="http://www.cycript.org/" target="_blank" rel="external">Cycript</a>最重要的特性是，它可以hook住 iOS／macosx 上面正在运行的进程，并通过终端使用objective_c或javascript语法去打印和修改该应用的运行时信息。我们可以把它当作一个可以debug没有源代码程序的工具。</p>
<p>以下是 Cycript 的用途：</p>
<ul>
<li>能够hook正在运行的进程，并打印相关信息，如 appdelegate,rootViewController</li>
<li>对程序中的类，可以获取到它用过的方法名称</li>
<li>可以获取到类的实例变量名称，以及打印出实例变量的值，当然也可以修改实例变量的值</li>
<li>能够执行 method swizzling， 替换某个指定的函数</li>
<li>可以在运行时调用其他方法</li>
</ul>
<h4 id="安装_cycript">安装 cycript</h4>
<p>首先利用 Cydia 下载 <code>mobilesubstrate</code> <code>adv-mds</code>;从<a href="www.cycript.org/debs/">官网</a>上面下载最新的包，并通过 <code>scp</code> 把文件拷贝到 iOS 设备上去，利用 <code>dpkg</code> 进行安装：</p>
<pre><code>dpkg -<span class="keyword">i</span> cycript cycript_0.<span class="number">9.102</span>-<span class="number">1</span>_iphoneos-arm.<span class="keyword">deb</span>
</code></pre><p>安装完成之后，执行 cycript 看是否工作：</p>
<h4 id="用Cycript进行实时修改">用Cycript进行实时修改</h4>
<p>本文将使用支付宝来进行测试。</p>
<ul>
<li>让支付宝钱包在前台运行，并找出它的进程id，然后用 cycript -p hook 进程</li>
</ul>
<pre><code>    chengpeide-iPhone:~ root<span class="preprocessor"># ps aux | grep AlipayWallet</span>
    mobile     <span class="number">629</span>   <span class="number">0.0</span>  <span class="number">9.3</span>   <span class="number">815836</span>  <span class="number">47792</span>   ??  Ss    <span class="number">9</span>:<span class="number">45</span>PM   <span class="number">0</span>:<span class="number">34.79</span> /var/mobile/Containers/Bundle/Application/FB2E1466-<span class="number">0</span>D87-<span class="number">4</span>FF9-<span class="number">9616</span>-BD4269D61BCF/AlipayWallet<span class="variable">.app</span>/AlipayWallet
    root       <span class="number">678</span>   <span class="number">0.0</span>  <span class="number">0.1</span>   <span class="number">536256</span>    <span class="number">412</span> s000  U+    <span class="number">9</span>:<span class="number">49</span>PM   <span class="number">0</span>:<span class="number">00.01</span> grep AlipayWallet

    -rwxr-xr-x <span class="number">1</span> root admin <span class="number">906</span> Jan <span class="number">12</span>  <span class="number">2015</span> cycript
    chengpeide-iPhone:/cp/Cycript_0<span class="number">.9</span><span class="number">.502</span> root<span class="preprocessor"># cycript -p 629</span>

    cy<span class="preprocessor"># var app = [UIApplication sharedApplication]</span>
    <span class="preprocessor">#<span class="title">"&lt;DFApplication: 0x14df44d0&gt;"</span></span>
    cy<span class="preprocessor"># app.delegate</span>
    <span class="preprocessor">#<span class="title">"&lt;DFClientDelegate: 0x14ed2d40&gt;"</span></span>
    cy<span class="preprocessor"># app.keyWindow.rootViewController</span>
    <span class="preprocessor">#<span class="title">"&lt;DFNavigationController: 0x15ac9a00&gt;"</span></span>
    cy<span class="preprocessor"># var nav = new Instance(0x15ac9a00)</span>
    <span class="preprocessor">#<span class="title">"&lt;DFNavigationController: 0x15ac9a00&gt;"</span></span>
    cy<span class="preprocessor"># nav.topViewController.childViewControllers</span>
    @[<span class="preprocessor">#<span class="title">"&lt;HPHomeWidgetGroup: 0x160a03d0&gt;"</span>,#<span class="title">"&lt;O2OIndexViewController: 0x15ad6600&gt;"</span>,#<span class="title">"&lt;APContactRecentViewController: 0x15afb600&gt;"</span>,#<span class="title">"&lt;WWAssetsViewController: 0x160a9da0&gt;"</span>]</span>
    cy<span class="preprocessor"># var assetsViewController = new Instance(0x160a9da0)</span>
    <span class="preprocessor">#<span class="title">"&lt;WWAssetsViewController: 0x160a9da0&gt;"</span></span>
    cy<span class="preprocessor"># [assetsViewController.view subviews]</span>
    @[<span class="preprocessor">#<span class="title">"&lt;UIView: 0x162d8000; frame = (0 0; 0 0); layer = &lt;CALayer: 0x162c85d0&gt;&gt;"</span>,#<span class="title">"&lt;UITableView: 0x15433800; frame = (0 0; 320 519); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x1623d1f0&gt;; layer = &lt;CALayer: 0x162c3b10&gt;; contentOffset: {0, -64}; contentSize: {320, 800}&gt;"</span>]</span>
    cy<span class="preprocessor"># var tableView = new Instance (0x15433800)</span>
    <span class="preprocessor">#<span class="title">"&lt;UITableView: 0x15433800; frame = (0 0; 320 519); clipsToBounds = YES; gestureRecognizers = &lt;NSArray: 0x1623d1f0&gt;; layer = &lt;CALayer: 0x162c3b10&gt;; contentOffset: {0, -42}; contentSize: {320, 800}&gt;"</span></span>
    cy<span class="preprocessor"># tableView.backgroundColor = [UIColor redColor]</span>
    <span class="preprocessor">#<span class="title">"UIDeviceRGBColorSpace 1 0 0 1"</span></span>

    [tableView visibleCells]
    @[<span class="preprocessor">#<span class="title">"&lt;HeadInfoCell: 0x16160a40; baseClass = UITableViewCell; frame = (0 220; 320 80); autoresize = W; layer = &lt;CALayer: 0x16160e80&gt;&gt;"</span>,#<span class="title">"&lt;DoubleInfoCell: 0x1569e800; baseClass = UITableViewCell; frame = (0 300; 320 80); autoresize = W; layer = &lt;CALayer: 0x16486e80&gt;&gt;"</span>,#<span class="title">"&lt;DoubleInfoCell: 0x15452e00; baseClass = UITableViewCell; frame = (0 380; 320 80); autoresize = W; layer = &lt;CALayer: 0x16491a50&gt;&gt;"</span>]</span>
    cy<span class="preprocessor"># var headCell = new Instance (0x16160a40)</span>
    <span class="preprocessor">#<span class="title">"&lt;HeadInfoCell: 0x16160a40; baseClass = UITableViewCell; frame = (0 220; 320 80); autoresize = W; layer = &lt;CALayer: 0x16160e80&gt;&gt;"</span></span>
    cy<span class="preprocessor"># headCell.backgroundColor = [UIColor redColor]</span>
    <span class="preprocessor">#<span class="title">"UIDeviceRGBColorSpace 1 0 0 1"</span></span>
    cy<span class="preprocessor"># headCell.contentView.backgroundColor = [UIColor redColor]</span>
    <span class="preprocessor">#<span class="title">"UIDeviceRGBColorSpace 1 0 0 1"</span></span>
</code></pre><p>我们可以看到，界面上 tableViewCell 的背景颜色变成了红色。</p>
<p><img src="http://cp0000.github.io/assets/blue.PNG" alt="shortcut2"></p>
<p>以上操作的思路大致就是， appdelegate =&gt; keyWindow =&gt; rootViewController =&gt; viewControllers =&gt; view </p>
<p>当然你也可以骗骗自己，把余额这个label的text改成巨款，过过眼瘾</p>
<pre><code>    cy<span class="special">#</span> <span class="special">[</span>tableView subviews<span class="special">]</span>
    @<span class="special">[</span><span class="special">#</span>"&lt;UIRefreshControl: 0x16482c90; frame = (0 0; 320 60); hidden = YES; autoresize = W; layer = &lt;CALayer: 0x16256370&gt;&gt;",<span class="special">#</span>"&lt;UITableViewWrapperView: 0x1624cce0; frame = (0 0; 320 519); gestureRecognizers = &lt;NSArray: 0x16098960&gt;; layer = &lt;CALayer: 0x14e12cf0&gt;; contentOffset: <span class="special">{</span>0, 0<span class="special">}</span>; contentSize: <span class="special">{</span>320, 519<span class="special">}</span>&gt;",<span class="special">#</span>"&lt;UIView: 0x16216d10; frame = (0 780; 320 20); layer = &lt;CALayer: 0x162562c0&gt;&gt;",<span class="special">#</span>"&lt;WHAccountHeaderView: 0x16217c10; frame = (0 0; 320 180); layer = &lt;CALayer: 0x1637edd0&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x17635b80; frame = (0 180; 320 40); autoresize = W; layer = &lt;CALayer: 0x1620d670&gt;&gt;",<span class="special">#</span>"&lt;UIImageView: 0x161f4740; frame = (0 452.5; 320 2.5); alpha = 0; opaque = NO; autoresize = TM; userInteractionEnabled = NO; layer = &lt;CALayer: 0x161f47c0&gt;&gt;"<span class="special">]</span>
    cy<span class="special">#</span> var header = new Instance(0x16217c10)
    <span class="special">#</span>"&lt;WHAccountHeaderView: 0x16217c10; frame = (0 0; 320 180); layer = &lt;CALayer: 0x1637edd0&gt;&gt;"
    cy<span class="special">#</span> <span class="special">[</span>header subviews<span class="special">]</span>
    @<span class="special">[</span><span class="special">#</span>"&lt;UIView: 0x161c6530; frame = (0 0; 320 117); layer = &lt;CALayer: 0x1638a780&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x16142d70; frame = (0 117.5; 106.667 62.5); layer = &lt;CALayer: 0x161f6350&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x16142de0; frame = (106.667 117.5; 106.667 62.5); layer = &lt;CALayer: 0x16109ed0&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x1610a4b0; frame = (213.333 117.5; 106.667 62.5); layer = &lt;CALayer: 0x163771b0&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x161082c0; frame = (122 28; 76 41); text = '0.00'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x14f73520&gt;&gt;",<span class="special">#</span>"&lt;UIImageView: 0x1610a520; frame = (246 42; 9 13); opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x161025c0&gt;&gt;",<span class="special">#</span>"&lt;UIImageView: 0x161692b0; frame = (56.5 83; 13 13); opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x16169330&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16169380; frame = (74.5 83; 189 13); text = '<span class="command">\xe</span>7<span class="command">\x</span>82<span class="command">\xb</span>9<span class="command">\xe</span>6<span class="command">\xad</span><span class="command">\xa</span>4<span class="command">\xe</span>5<span class="command">\xbc</span><span class="command">\x</span>80<span class="command">\xe</span>5<span class="command">\x</span>90<span class="command">\xaf</span><span class="command">\xe</span>8<span class="command">\xb</span>4<span class="command">\xa</span>6<span class="command">\xe</span>6<span class="command">\x</span>88<span class="command">\xb</span>7<span class="command">\xe</span>5<span class="command">\xae</span><span class="command">\x</span>89<span class="command">\xe</span>5<span class="command">\x</span>85<span class="command">\xa</span>8<span class="command">\xe</span>9<span class="command">\x</span>99<span class="command">\xa</span>9<span class="command">\xef</span><span class="command">\xbc</span><span class="command">\x</span>8c<span class="command">\xe</span>4<span class="command">\xba</span><span class="command">\xab</span>100<span class="command">\xe</span>4<span class="command">\xb</span>8<span class="command">\x</span>87<span class="command">\xe</span>4<span class="command">\xbf</span><span class="command">\x</span>9d<span class="command">\xe</span>9<span class="command">\x</span>9a<span class="command">\x</span>9c'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16169230&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16169570; frame = (36.8333 154.25; 33 12); text = '<span class="command">\xe</span>9<span class="command">\x</span>93<span class="command">\xb</span>6<span class="command">\xe</span>8<span class="command">\xa</span>1<span class="command">\x</span>8c<span class="command">\xe</span>5<span class="command">\x</span>8d<span class="command">\xa</span>1'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16169630&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16169810; frame = (48.3333 131.25; 10 17); text = '2'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x161698d0&gt;&gt;",<span class="special">#</span>"&lt;UIImageView: 0x16169ab0; frame = (42.3333 127.25; 22 22); hidden = YES; opaque = NO; userInteractionEnabled = NO; layer = &lt;CALayer: 0x16169b30&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16381200; frame = (149 154.25; 22 12); text = '<span class="command">\xe</span>4<span class="command">\xbd</span><span class="command">\x</span>99<span class="command">\xe</span>9<span class="command">\xa</span>2<span class="command">\x</span>9d'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16381160&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16380280; frame = (144 131.25; 32 17); text = '0.00'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x16380340&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x16380520; frame = (255.667 154.25; 22 12); text = '<span class="command">\xe</span>5<span class="command">\x</span>8d<span class="command">\xa</span>1<span class="command">\xe</span>5<span class="command">\x</span>8c<span class="command">\x</span>85'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x163805e0&gt;&gt;",<span class="special">#</span>"&lt;UILabel: 0x1638d640; frame = (261.667 131.25; 10 17); text = '0'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x1638d700&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x16151570; frame = (0 117; 320 0.5); layer = &lt;CALayer: 0x161515e0&gt;&gt;",<span class="special">#</span>"&lt;UIView: 0x16151670; frame = (0 179.5; 320 0.5); layer = &lt;CALayer: 0x161516e0&gt;&gt;"<span class="special">]</span>
    cy<span class="special">#</span> var label2= new Instance(0x161082c0)
    <span class="special">#</span>"&lt;UILabel: 0x161082c0; frame = (122 28; 76 41); text = '0.00'; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x14f73520&gt;&gt;"
    cy<span class="special">#</span> label2.text=@"10000000000000"
    @"10000000000000"
</code></pre><p><img src="http://cp0000.github.io/assets/rich.PNG" alt="shortcut2"></p>
<p>很好玩，也很有用的工具，cycript。当然cycript还有一些高级用法，后面会介绍。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2015/11/30/iOS-reverse-engineering-02/" data-id="mfk34w0p2zmqbm9z" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS-Reverse-Engineering/">iOS Reverse Engineering</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-reverse-engineering-01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2015/11/21/iOS-reverse-engineering-01/">iOS逆向工程-0x00－用途以及准备工作</a>
  

      </header>
    
    <time class="article-date" datetime="2015-11-21T02:46:07.000Z" itemprop="datePublished">11-21-2015</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言">前言</h2>
<p>好奇心，求知欲，是作为一个程序员很重要的属性。好奇心会促使你去了解那些未知的事物，打开新的世界。求知欲则帮助你去琢磨这些知识，探索这些事物是如何工作的。</p>
<p>作为一个iOS开发者，我在使用其他开发者的优秀app的时候，总是会去猜测作者是怎么实现这个功能的，换作是我，我会怎么去实现它。有些功能很容易猜测出来（如微信iOS app的总体结构，想一下也会知道它的结构是 tabbarController+navigationController+tableViewController）；有些功能就不容易从表面上猜测出来，如博客软件 Castro。要想知道这些软件的一些设计细节，就得用上逆向工程，来帮助我们获取到想要的信息。</p>
<p>当然了，逆向工程还有其他更重要的用途，如下：</p>
<ul>
<li>分析恶意软件</li>
<li>安全研究</li>
<li>借鉴别人的软件</li>
<li>破解使用限制</li>
</ul>
<h2 id="准备工作">准备工作</h2>
<p>在开始 iOS 逆向工作之前，得准备一下相关设备</p>
<h3 id="硬件">硬件</h3>
<ul>
<li>Mac 电脑</li>
<li>一台越狱机器 (如何越狱，请访问 <strong><a href="http://pangu.io/" target="_blank" rel="external">pangu</a></strong>)</li>
</ul>
<h3 id="设置环境">设置环境</h3>
<h4 id="利用Cydia安装相关开发工具，建议安装下表中的全部软件">利用<code>Cydia</code>安装相关开发工具，建议安装下表中的全部软件</h4>
<table>
<thead>
<tr>
<th>tool</th>
<th>description </th>
</tr>
</thead>
<tbody>
<tr>
<td>ps</td>
<td>process status, cpu usage, memory usage</td>
</tr>
<tr>
<td>sysctl</td>
<td>get or set kernal state</td>
</tr>
<tr>
<td>netstat</td>
<td>show network status</td>
</tr>
<tr>
<td>route</td>
<td>manually manipulate the routing tables</td>
</tr>
<tr>
<td>renice</td>
<td>alter priority of running processes</td>
</tr>
<tr>
<td>ifconfig</td>
<td>configure network interface parameters</td>
</tr>
<tr>
<td>tcpdump</td>
<td>dump traffic on a network</td>
</tr>
<tr>
<td>lsof</td>
<td>list open files</td>
</tr>
<tr>
<td>otool</td>
<td>displays specified parts of object files or libraries.</td>
</tr>
<tr>
<td>nm</td>
<td>displays the name list (symbol table) of each object file in the argument list.</td>
</tr>
<tr>
<td>ldid</td>
<td>signature tool</td>
</tr>
<tr>
<td>gdb</td>
<td>debug tool</td>
</tr>
<tr>
<td>lldb</td>
<td>debug tool</td>
</tr>
<tr>
<td>patch</td>
<td>patch tool</td>
</tr>
<tr>
<td>SSH</td>
<td>is a program for logging into a remote machine and for executing commands on a remote machine.</td>
</tr>
</tbody>
</table>
<h4 id="SSH_to_iPhone">SSH to iPhone</h4>
<h5 id="通过_wifi">通过 wifi</h5>
<pre><code><span class="title">ssh</span> root<span class="variable">@your</span>.iphone.ip
</code></pre><p>iOS 系统中的<code>root</code>用户的默认密码是 <code>Alipne</code>.第一次登录的时候请使用这个密码。不过请记得修改<code>root</code>用户的密码，不然这台越狱机器就很不安全了。</p>
<p><strong>修改用户密码</strong></p>
<pre><code>iPhone:~ root<span class="comment"># passwd</span>
Changing password <span class="keyword">for</span> root
<span class="keyword">New</span> password:
Retype <span class="keyword">new</span> password:
iPhone:~ root<span class="comment">#</span>
</code></pre><h5 id="通过_usb">通过 usb</h5>
<p>在wifi不稳定的场景下，建议使用usb来ssh到iPhone上。（我自己也是主要适用usb来进行ssh）</p>
<ul>
<li><p>关于如何使用 usb ssh 到 iPhone上，详情请访问网页 <a href="http://iphonedevwiki.net/index.php/SSH_Over_USB" target="_blank" rel="external">SSH over USB</a>。根据网页上面的guide，需要下载：<a href="https://code.google.com/p/iphonetunnel-usbmuxconnectbyport/downloads/detail?name=itnl_rev8.zip" target="_blank" rel="external">itnl_rev8.zip</a></p>
</li>
<li><p>解压zip包之后，做如下操作：</p>
<ul>
<li><p>OS X terminal:</p>
<pre><code>  <span class="comment">sudo</span> <span class="comment">path/to/itnl</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">iport</span> <span class="comment">22</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">lport</span> <span class="comment">2222</span>
</code></pre></li>
<li><p>iPhone terminal:</p>
<pre><code>  <span class="title">ssh</span> -p <span class="number">2222</span> root<span class="variable">@localhost</span>
</code></pre></li>
</ul>
</li>
</ul>
<p>然后，就成功 ssh 到 iPhone 上面。我们的准备工作到此也就做完了，接下来我们就可以开始逆向 iOS app了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2015/11/21/iOS-reverse-engineering-01/" data-id="fig6peyi8ubm4z8n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS-Reverse-Engineering/">iOS Reverse Engineering</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-27" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2015/10/27/27/">活到二十七</a>
  

      </header>
    
    <time class="article-date" datetime="2015-10-26T16:05:53.000Z" itemprop="datePublished">10-27-2015</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Life/">Life</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>“Many people die at 25 and aren’t buried until 75.”(很多人25岁就死了，但是要75岁才被埋进土里)－－这是美国政治家，科学家富兰克林的名句。</p>
</blockquote>
<p>这里的死当然不是生理上的死亡，我的理解是指一个人的生活进入了静止的状态；早上8点起床，吃着相同的早餐，走着每天上下班的路去公司，开始一天忙碌的办公司生活，日复一日，循环至死。</p>
<p>今天是我二七岁的生日，想来我自己不也是如此嘛？每天的日子趋于静止，今天像是昨天的拷贝。</p>
<p>稍微观察下，生活中大家见面的时候，都会寒暄一句“最近在忙啥？”。想来这句话却很有意思，它鲜活的表现出了我们是一个好像不忙点啥，日子就没法过下去的种族。也是，我们身边的每个人每天都显得很忙；大家忙着挣钱，忙着找女人，忙着玩游戏，忙着去八卦，忙着娱乐，一刻都不得闲；但其实我觉得是人们害怕闲。因为一当闲下来，我们会不知道干嘛，进而觉得无聊，产生厌烦，最后感到孤独。</p>
<p>我也是如此，为了让自己忙起来，我写博客，不停的往Wunderlist中加todos，看amazon上面的畅销书。坦白讲，长长的 TODO list 会让我产生一种心安。</p>
<p>记得大二的时候，当时的我，一个中二青年，被乔布斯在斯坦福大学上的毕业演讲的震撼住了。其中有一段是</p>
<blockquote>
<p>Your work is going to fill a large part of your life, and the only way to be truly satisfied is to do what you believe is great work. And the only way to do great work is to love what you do. If you haven’t found it yet, keep looking. Don’t settle. As with all matters of the heart, you’ll know when you find it. </p>
</blockquote>
<p>这么些年来，我一直被这个演讲所影响。我会时常问自己，到底想要成为什么样子的人，真正想要做的事情是什么。但在27岁生日这天，我不得不承认，我还是没有找到。有段时间，在做 reverse engineering 的时候，我的确遇到了那种 “啊哈” 时刻。但当我深入进去之后，了解业界专业的安全知识之后，我知道这东西是需要天分加大量的练习，可惜我不够，天分和练习都不够。而且我也没有豁出去，重新来过的勇气。</p>
<p>或许是年纪的增长，近些日子，我会开始关注房子，汽车等诸如此类的事物。有时候我也想给自己弄个窝，不用寄人篱下，活得体面一点。这诺大的城市中，我也不想一直是那个漂泊的，东奔西跑的人。但高企的房价，不可理喻的限购政策又让我心灰意冷，不知出路在何处。</p>
<p>只希望二十八的时候，自己晚上洗完澡倒头上床，盯着天花板的时候，知道自己到底在忙些什么。</p>
<p><a href="http://music.163.com/#/song?id=28349599" target="_blank" rel="external">Johnny and Mary (Feat. Bryan Ferry)</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://cp0000.github.io/2015/10/27/27/" data-id="g3a25ekzr0aabms3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/archives/">&laquo; Prev</a><a class="page-number" href="/archives/">1</a><span class="page-number current">2</span><a class="page-number" href="/archives/page/3/">3</a><a class="page-number" href="/archives/page/4/">4</a><a class="extend next" rel="next" href="/archives/page/3/">Next &raquo;</a>
    </nav>
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Pei Cheng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63703524-1', 'auto');
  ga('send', 'pageview');

</script>
  </div>
</body>
</html>