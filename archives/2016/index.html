<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2016 | CP WRITINGS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="CP WRITINGS">
<meta property="og:url" content="http://yoursite.com/archives/2016/">
<meta property="og:site_name" content="CP WRITINGS">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CP WRITINGS">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="CP WRITINGS" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">CP WRITINGS</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-home-icon" class="nav-icon" href="/"></a>
        
          <a id="nav-archives-icon" class="nav-icon" href="/archives"></a>
        
          <a id="nav-about-icon" class="nav-icon" href="/about/index.html"></a>
        
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-opengl-3d-matrix" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/12/18/opengl-3d-matrix/">OpenGL ES 2.0 3D基础（1）－矩阵</a>
  

      </header>
    
    <time class="article-date" datetime="2016-12-18T06:37:53.000Z" itemprop="datePublished">12-18-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Overview">Overview</h2>
<p>移动设备的屏幕是二维平面,要想把一个三维场景渲染在手机二维屏幕上，需要利用OpenGL中的矩阵投射，将三维空间中的点映射到二维平面上。三维矩阵的相关知识是学习OpenGL最重要的课程之一。</p>
<h2 id="线性代数">线性代数</h2>
<p>学习OpenGL三维投射知识之前，我们得事先了解下一些基础的线性代数知识，如向量运算，矩阵运算。</p>
<h3 id="向量运算">向量运算</h3>
<p><a href="https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F" target="_blank" rel="external">向量</a>: 指一个同时具有大小和方向的几何对象，因常常以箭头符号表示以区别于其它量而得名。</p>
<h4 id="向量加减">向量加减</h4>
<p>向量的加（减）法定义是分量的相加（减），即将一个向量中的每一个分量加上（减去）另一个向量的对应分量：</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_01.png" alt=""></p>
<h4 id="向量相乘">向量相乘</h4>
<h5 id="点乘">点乘</h5>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_02.png" alt=""></p>
<h4 id="叉乘">叉乘</h4>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_03.png" alt=""></p>
<h3 id="矩阵运算">矩阵运算</h3>
<h4 id="矩阵简介">矩阵简介</h4>
<p>数学上，一个  m x n 的矩阵是一个m行n列元素排列成的矩形阵列。以下是一个由6个数字元素构成的3行3列的矩阵：</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_04.png" alt=""></p>
<h4 id="矩阵运算规则">矩阵运算规则</h4>
<h5 id="矩阵的加减">矩阵的加减</h5>
<p>矩阵与标量之间的加减：</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_05.png" alt=""></p>
<p>矩阵与矩阵之间的加减：<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_06.png" alt=""></p>
<h5 id="矩阵乘法">矩阵乘法</h5>
<ul>
<li><p>矩阵数乘<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_07.png" alt=""></p>
</li>
<li><p>矩阵相乘<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_08.png" alt=""></p>
</li>
</ul>
<h4 id="单位矩阵">单位矩阵</h4>
<p>在OpenGL中，由于大部分的向量都是4分量 （x,y,z,w）,所以我们通常使用 4x4 的变换矩阵。当中最简单的变换矩阵是单位矩阵。单位矩阵是一个除了对角线以外都是0的NxN矩阵。</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_09.png" alt=""></p>
<p>单位矩阵通常是生成其他变换矩阵的起点。</p>
<h4 id="缩放矩阵">缩放矩阵</h4>
<p>对一个向量进行缩放指的是对向量的长度进行缩放，而保持它的方向不变。</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_11.png" alt=""></p>
<h4 id="位移矩阵">位移矩阵</h4>
<p>位移是在原始向量的基础上加上另一个向量从而获得一个在不同位置的新向量的过程，从而在位移向量基础上移动原始向量。<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_12.png" alt=""></p>
<h4 id="旋转矩阵">旋转矩阵</h4>
<p>（Rx,Ry,Rz）代表任意旋转轴，θ是角度：<br><img src="http://cp0000.github.io/assets/3d_matrix/matrix_16.png" alt=""></p>
<h5 id="累积变换">累积变换</h5>
<p>上面接受啊了如何旋转，平移和缩放向量。把这些矩阵相乘组合起来如下：</p>
<pre><code>TransformedVector = TranslationMatrix <span class="keyword">*</span> RotationMatrix <span class="keyword">*</span> ScaleMatrix <span class="keyword">*</span> OriginalVector;
</code></pre><p>这行代码首先执行缩放，接着旋转，最后才是平移</p>
<h2 id="坐标系统">坐标系统</h2>
<p>OpenGL在每次顶点着色器运行后，所有顶点都为标准化设备坐标，每个顶点（x,y,z）都应该在-1.0d到1.0之间。通常情况下，我们会根据画布（屏幕）的大小设定一个坐标范围，在顶点着色器中将这些坐标转换为标准化设备坐标。在项目中，物体坐标最终被转化为屏幕坐标之前会变换到多个坐标系统，因为在相应的过度坐标系中做特定运算会方便容易一些。对我们来讲，一般情况下需要用到5个不同的坐标系统：</p>
<ul>
<li>局部空间（Local Space）：物体起始坐标；如一个正方体a，原点是正方体的中心O1（0，0，0）。</li>
<li><p>世界空间（World Space）：物体在更大的空间范围的坐标；如我们构造了一个圆球来表示世界,圆心为世界坐标原点O2，把正方体放在圆球中t(x1,y1,z1)位置。那么正方体a的圆心O1在世界系统会转化为（x1,y1,z1）。物体的坐标从局部坐标变换到是世界坐标由模型矩阵（Model Matrix）负责实现。</p>
<blockquote>
<p>模型矩阵是一种变换矩阵，能对物体进行位移，缩放，旋转。</p>
</blockquote>
</li>
<li><p>观察空间（View Space）: 观察空间是将世界坐标转化为用户视野前方的坐标。一般用一个观察矩阵（View Matrix）来完成转换。</p>
</li>
<li><p>裁剪空间（Clip Space）：顶点着色器运行到最后，OpenGL期望所有的坐标落在一个特定的范围内，且任何在这个范围之外的点会被裁剪掉。为了将顶点坐标从观察变换成裁剪空间，需定义一个投影矩阵（Projection Matrix），它指定一个范围的坐标，比如每个维度上的 -100 到 100。投影矩阵会将在这个指定范围内的坐标变换为标准化设备坐标的范围（-1。0，1.0）。使用投影矩阵能将3D坐标投影到2D的标准化设备坐标系中。</p>
</li>
</ul>
<p>将观察坐标变换为裁剪坐标的投影矩阵分为两种不同的形式：正交投影矩阵（Orthographic Projection Matrix），透视投影矩阵（Perspective Projection Matrix）。</p>
<ul>
<li>屏幕空间（Screen Space）</li>
</ul>
<h3 id="正交投影（Orthographic_Projection）">正交投影（Orthographic Projection）</h3>
<p>正交投影矩阵定义一个立方体的平截头箱，在这个立方体之外的顶点都会被裁剪掉。</p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_18.png" alt=""></p>
<p>正交投影矩阵直接将坐标映射到2D平面上。不过正交投影没有透视效果，远处箱子和近处箱子投射到平面上是一样大的，这和我们日常生活中看东西时近大远小的视觉效果是不符的。要解决这个问题，我们需要用到透视投影。</p>
<h3 id="透视投影（Perspective_Projection）">透视投影（Perspective Projection）</h3>
<p>透视投影定义一个大平截头体。透视投影有两种表述方式：</p>
<ul>
<li>视锥体：</li>
</ul>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_19.png" alt=""></p>
<p>glFrustum (left, right, bottom, top, zNear, zFar);</p>
<p>left,right,bottom,top定义near裁剪面大小，zNear和zFar定义从观察点到远近两个裁剪面的距离。这六个参数定义出六个裁剪面构成的视锥体。</p>
<ul>
<li>透视图：</li>
</ul>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_20.png" alt=""></p>
<p>gluPerspective(fovy, aspect, zNear, zFar);</p>
<ul>
<li>fovy: camera 在 y 方向上的视线角度（0~180)</li>
<li>aspect定义近截面的宽高比 aspect=w/h</li>
<li><p>zNear, zFar: 观察点到远近两个裁剪面的距离</p>
<p>透视体参数转换车过视锥体参数：</p>
<pre><code>  tan(fovy<span class="regexp">/2) = (h /</span> <span class="number">2</span>)/zNear<span class="function"> -&gt;</span> h; 
  w =  h * aspect<span class="function"> -&gt;</span> w;
</code></pre></li>
</ul>
<h3 id="矩阵组合">矩阵组合</h3>
<p>基于前面介绍的4个变换矩阵：模型矩阵，世界矩阵，观察矩阵和投影矩阵。一个顶点坐标将会根据以下过程变换到裁剪坐标：</p>
<pre><code><span class="attribute">Vclip</span>=<span class="string">Mprojection⋅Mview⋅Mmodel⋅Vlocal</span>
</code></pre><blockquote>
<p>注意矩阵运算的顺序是从右往左阅读，最终计算出来的顶点赋值给<code>gl_Position</code></p>
</blockquote>
<h2 id="3D_Demo">3D Demo</h2>
<p>至此我们了解了OpenGL 3D渲染中需要知道的矩阵知识，运用这些知识，便可进行开发OpenGL3D程序了；苹果官方提供一个很好的GL demo <a href="https://developer.apple.com/library/content/samplecode/GLEssentials/Introduction/Intro.html" target="_blank" rel="external">GLEssentials</a></p>
<p><img src="http://cp0000.github.io/assets/3d_matrix/matrix_21.png" alt=""></p>
<h2 id="结束">结束</h2>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/18/opengl-3d-matrix/" data-id="ff1lvxa9k4zdj2l8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-summary" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/12/11/2016-summary/">2016年度总结</a>
  

      </header>
    
    <time class="article-date" datetime="2016-12-11T06:56:52.000Z" itemprop="datePublished">12-11-2016</time>
    
  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="娱乐">娱乐</h3>
<p><strong>年度电影</strong></p>
<p><a href="https://movie.douban.com/subject/25895901/" target="_blank" rel="external">海街日记</a><img src="https://img3.doubanio.com/view/photo/photo/public/p2283110641.jpg" style="width: 120px;"></p>
<p><strong>年度歌曲</strong> </p>
<p><a href="http://music.163.com/#/song?id=29724295" target="_blank" rel="external">热河</a></p>
<p><img src="
http://img.xiami.net/images/album/img94/7194/14157293421415729342_2.jpg" style="width: 120px;"></p>
<p><strong>年度美剧</strong></p>
<p><a href="https://movie.douban.com/subject/3016187/" target="_blank" rel="external">Game of Thrones</a></p>
<p><img src="https://img1.doubanio.com/view/movie_poster_cover/lpst/public/p896064368.jpg" style="width: 120px;"></p>
<p><strong>年度书籍</strong></p>
<p><a href="https://book.douban.com/subject/26576861/" target="_blank" rel="external">最好的告别</a></p>
<p><img src="https://img3.doubanio.com/lpic/s28355811.jpg" style="width: 120px;"></p>
<p><strong>年度Podcast</strong></p>
<p><a href="https://ipn.li/taiyilaile/" target="_blank" rel="external">太医来了</a></p>
<p><img src="https://pic4.zhimg.com/8746e3b32e6afbf06eda1a4d69d2bb5b_xl.jpg" style="width: 80px;"></p>
<p><strong>年度电视节目</strong></p>
<p><a href="http://www.iqiyi.com/a_19rrgifngp.html" target="_blank" rel="external">晓松奇谈</a></p>
<p><img src="http://pic0.qiyipic.com/common/lego/20160104/f6e30204caa345508edd843c182ad7c6.jpg" style="width: 240px;"></p>
<h3 id="体育">体育</h3>
<p><strong>年度NBA比赛</strong></p>
<p>15-16赛季，西部决赛第七场</p>
<p>金州勇士-俄克拉何马城雷霆</p>
<p><img src="https://upload.wikimedia.org/wikipedia/zh/0/0f/Golden_State_Warriors_logo.png" style="width: 120px;"> <img src="https://upload.wikimedia.org/wikipedia/zh/f/f6/OKC_Thunder.png" style="width: 120px;"></p>
<p><strong>年度足球比赛</strong></p>
<p>15欧锦赛 1/4 决赛：德国-意大利</p>
<p><img src="https://upload.wikimedia.org/wikipedia/zh/thumb/e/e3/DFBEagle.svg/400px-DFBEagle.svg.png" style="width: 120px;">  <img src="https://upload.wikimedia.org/wikipedia/zh/thumb/9/97/FIGC_logo.svg/207px-FIGC_logo.svg.png" style="width: 120px;"></p>
<h3 id="工作">工作</h3>
<p><strong>年度编程语言</strong></p>
<p><a href="https://zh.wikipedia.org/wiki/OpenGL" target="_blank" rel="external">OpenGL</a></p>
<p><img src="https://www.opengl.org/img/opengl_logo.png" style="width: 180px;"></p>
<p><strong>年度App</strong></p>
<p><a href="https://itunes.apple.com/us/app/msqrd-live-filters-face-swap/id1065249424?mt=8" target="_blank" rel="external">MSQRD</a></p>
<p><img src="http://is5.mzstatic.com/image/thumb/Purple71/v4/78/76/b3/7876b386-4821-5fb0-8e98-a524bd3dec14/source/630x630bf.jpg" style="width: 120px;"></p>
<p><strong>年度开源项目</strong></p>
<p><a href="https://github.com/BradLarson/GPUImage.git" target="_blank" rel="external">GPUImage</a></p>
<p><strong>年度工具</strong></p>
<p>macOS / iOS 备忘录</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/11/2016-summary/" data-id="90bn74z3ychxeamv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ffmpeg-command-example" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/11/07/ffmpeg-command-example/">ffmpeg 使用例程</a>
  

      </header>
    
    <time class="article-date" datetime="2016-11-07T13:03:47.000Z" itemprop="datePublished">11-07-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文介绍<a href="https://en.wikipedia.org/wiki/FFmpeg" target="_blank" rel="external">ffmpeg</a>命令行的一些使用方法；</p>
<h2 id="参数">参数</h2>
<h3 id="主要参数">主要参数</h3>
<ul>
<li>-i——设置输入档名。</li>
<li>-f——设置输出格式。</li>
<li>-y——若输出文件已存在时则覆盖文件。</li>
<li>-fs——超过指定的文件大小时则结束转换。</li>
<li>-ss——从指定时间开始转换。</li>
<li>-t从-ss时间开始转换（如-ss 00:00:01.00 -t 00:00:10.00即从00:00:01.00开始到00:00:11.00）。</li>
<li>-title——设置标题。</li>
<li>-timestamp——设置时间戳。</li>
<li>-vsync——增减Frame使影音同步。<h3 id="视频参数">视频参数</h3>
</li>
<li>-b:v——设置视频流量，默认为200Kbit/秒。（单位请引用下方注意事项）</li>
<li>-r——设置帧率值，默认为25。</li>
<li>-s——设置画面的宽与高。</li>
<li>-aspect——设置画面的比例。</li>
<li>-vn——不处理视频，于仅针对声音做处理时使用。</li>
<li>-vcodec( -c:v )——设置视频视频编解码器，未设置时则使用与输入文件相同之编解码器。<h3 id="声音参数">声音参数</h3>
</li>
<li>-b:a——设置每Channel（最近的SVN版为所有Channel的总合）的流量。（单位请引用下方注意事项）</li>
<li>-ar——设置采样率。</li>
<li>-ac——设置声音的Channel数。</li>
<li>-acodec ( -c:a ) ——设置声音编解码器，未设置时与视频相同，使用与输入文件相同之编解码器。</li>
<li>-an——不处理声音，于仅针对视频做处理时使用。</li>
<li>-vol——设置音量大小，256为标准音量。（要设置成两倍音量时则输入512，依此类推。）</li>
</ul>
<h2 id="例子">例子</h2>
<p>不过在使用中可能需要用一些不常用的命令行去做一些视频编辑的功能，如下几个例子：</p>
<h3 id="裁剪视频">裁剪视频</h3>
<p>比如有一个横向视频,分辨率是1280X720，如果指向保留中间的405*720部分，可以使用下面的命令：</p>
<pre><code><span class="attribute">ffmpeg -i input.mp4  -strict -2 -vf crop</span>=<span class="string">405:720:420:0  video_out.mp4</span>
</code></pre><p>其中的crop=405:720:420:0 裁剪参数，具体含义是：crop=width:height:x:y.其中 width和height便是裁剪后的尺寸，x:y  表示裁剪区域的左上角坐标。</p>
<h3 id="视频转换成图片">视频转换成图片</h3>
<pre><code> ffmpeg -i input.mp4 <span class="keyword">image</span><span class="variable">%3d</span>.png
</code></pre><p>也可以指定视频导出的图片的帧率，（1s的视频生成的图片的个数）</p>
<pre><code> ffmpeg -i input.mp4 -r <span class="number">30</span>  <span class="variable">$filename</span><span class="variable">%3d</span>.png  
</code></pre><p>其中 <code>-r 30</code> 是视频帧率，如何获取当前视频的帧率，请看如下命令：</p>
<pre><code>ffprobe <span class="string">"input.mp4"</span> -v <span class="number">0</span> -select_streams v  -print_format flat -show_entries <span class="variable">stream=</span>r_frame_rate 
</code></pre><h3 id="剪辑视频">剪辑视频</h3>
<p>一段长视频只需要保留其中一段，可用如下命令：</p>
<pre><code><span class="tag">ffmpeg</span> <span class="tag">-i</span> <span class="tag">input</span><span class="class">.mp4</span> <span class="tag">-ss</span> 00<span class="pseudo">:00</span><span class="pseudo">:21</span> <span class="tag">-t</span> 00<span class="pseudo">:00</span><span class="pseudo">:10</span> <span class="tag">-acodec</span> <span class="tag">aac</span> <span class="tag">-vcodec</span> <span class="tag">h264</span> <span class="tag">-strict</span> <span class="tag">-2</span> <span class="tag">out</span><span class="class">.mp4</span>
</code></pre><p>其中 <code>-ss 00:00:21</code> 表示开始剪辑的位置（时间点）， <code>-t 00:00:10</code> 表示剪辑的长度，即10秒钟。</p>
<h3 id="调整视频分辨率大小">调整视频分辨率大小</h3>
<p>一段视频尺寸是1080p（即1920*1080px， 16:9），使用下面命令转换成 480p：</p>
<pre><code><span class="attribute">ffmpeg -i input.mp4 -vf scale</span>=<span class="string">853:480 -acodec aac -vcodec h264 out.mp4</span>
</code></pre><ul>
<li><code>-vf scale=853:480</code> vf 参数用于指定视频滤镜，其中scale表示缩放，863*480是480p视频的在保持16:9宽高比下的分辨率</li>
<li><code>-vcodec h264</code> 指定视频使用 h264 编码。<blockquote>
<p>目前收集一般拍摄视频的格式为 mov 或 mp4,两者的音频编码都是 aac， 视频编码是 h264.</p>
</blockquote>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/07/ffmpeg-command-example/" data-id="p31srqc27f08ysk3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-28" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/10/26/28/">活到28</a>
  

      </header>
    
    <time class="article-date" datetime="2016-10-26T15:49:23.000Z" itemprop="datePublished">10-26-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Life/">Life</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>信则有，不信则无</code>-这句话带有非常强烈的主观臆断色彩。我不认同这句话中携带的<code>我思故我在</code>式的思维模式，但不可否认在特定条件下，这句话会对一个人起到良好的心理按摩作用。</p>
<p>就个人而言，学习OpenGL编程是一个难度相对大的技术。也许是因为没有学习过计算机图形学，在学习OpenGL编程期间，会遇到各种不懂的名词概念：<code>着色器</code>，<code>光栅化</code>，<code>纹理</code>，<code>帧缓存</code>；OpenGL本身的状态机也不是很好理解；加上不友好的开发工具链（无法打印GPU数据，OpenGL crash堆栈信息很少）。这三点导致学习OpenGL是一门入门难度比较大，学习曲线陡峭的技术。刚开始的时候，困难的确比较多，很容易失去信心；这个时候，如果对自己说一句<code>信则有</code>，相信这东西自己是可以学出来。坚持持续不断的看教程，动手试错，最终是可以学出来的。</p>
<p>同样，在学习蛙泳的时候，在升职答辩的时候，在健身的时候，在极限运动的时候；面对深水区的恐惧，主考官的质问，肌肉的酸痛，呼吸的急促，死亡的恐惧。我们需要鼓起勇气，运用我们一直练习的学习技巧，观察别人怎么做的，思考自己哪里做的不对，不停的模仿，不断的试错重来，不怕失败，自信每次都会有所进步，最终能够扛过这座山。</p>
<p>如果说在28岁生日这一天，回顾过去一年，我有什么收获的话，</p>
<blockquote>
<p>“立志不坚，终不济事。” —（宋）朱熹</p>
</blockquote>
<p>这句话是我最大的收获。</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=16148113&auto=1&height=66"></iframe>

<blockquote>
<p>对了，如果实在找不到信心的话，就这样想：”这么多人都行，我怎么可能不行”。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/26/28/" data-id="urc4qju0fyyv7wmi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-install-caffe-on-macosx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/10/22/install-caffe-on-macosx/">如何在Macosx上安装caffe</a>
  

      </header>
    
    <time class="article-date" datetime="2016-10-22T04:55:05.000Z" itemprop="datePublished">10-22-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p>在macosx上面安装深度学习框架<a href="http://caffe.berkeleyvision.org/" target="_blank" rel="external">caffe</a>是个相对比较麻烦的过程。如果根据caffe项目的install_osx文件指引去安装，会遇到一些问题。所以我决定把自己的安装过程记录下来。</p>
<p><strong>硬软件环境</strong><br>&gt;<br>    电脑：iMac<br>    系统：OX EI Caption 版本10.11.4</p>
<h2 id="Homebrew">Homebrew</h2>
<p>官方推荐使用<a href="http://brew.sh" target="_blank" rel="external">Homebrew</a>来管理依赖项的下载，安装。</p>
<h2 id="Anaconda_Python">Anaconda Python</h2>
<p>Anaconda是python的一个常用的科学计算发行版，自带包管理器conda。从 <a href="https://store.continuum.io/cshop/anaconda/" target="_blank" rel="external">https://store.continuum.io/cshop/anaconda/</a> 下载并安装Anaconda Python。安装成功之后,记得在PATH添加ananconda执行文件的路径：</p>
<pre><code><span class="keyword">export</span> PATH=~/anaconda/bin:<span class="variable">$PATH</span>
</code></pre><h2 id="CUDA">CUDA</h2>
<p>从 <a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="external">https://developer.nvidia.com/cuda-downloads</a> 下载并安装CUDA 8.0 (for OSX)<br>从 <a href="http://www.nvidia.com/object/mac-driver-archive.html" target="_blank" rel="external">http://www.nvidia.com/object/mac-driver-archive.html</a> 下载并安装最新的CUDA独立驱动。<br>同样我们把驱动的可执行文件路径添加到PATH环境变量中(注意下载安装的CUDA的版本号)：</p>
<pre><code><span class="keyword">export</span> PATH=/Developer/NVIDIA/CUDA-<span class="number">8.0</span>/bin/<span class="variable">$PATH</span>
<span class="keyword">export</span> DYLD_LIBRARY_PATH=/Developer/NVIDIA/CUDA-<span class="number">8.0</span>/lib:<span class="variable">$DYLD_LIBRARY_PATH</span>
</code></pre><h2 id="BLAS">BLAS</h2>
<p>网上搜索到的教程中都是使用<a href="https://software.intel.com/en-us/intel-mkl" target="_blank" rel="external">Intel MKL</a>，查看网站会发现intel-mkl收费很贵，所以我安装的时候选择了<a href="www.openblas.net/">OpenBLAS</a></p>
<pre><code>brew <span class="operator"><span class="keyword">install</span> openblas</span>
</code></pre><blockquote>
<p>关于 intel-mkl 和 openblas 的优劣，没有做过比较。在校大学生可通过学校邮箱在页面 <a href="https://software.intel.com/en-us/qualify-for-free-software/student" target="_blank" rel="external">https://software.intel.com/en-us/qualify-for-free-software/student</a> 申请安装包。</p>
</blockquote>
<h2 id="cuDNN">cuDNN</h2>
<p>从 <a href="https://developer.nvidia.com/cudnn" target="_blank" rel="external">https://developer.nvidia.com/cudnn</a> 页面下载并安装cuDNN库,安装过程如下：</p>
<pre><code>tar -xzvf cudnn-<span class="number">8.0</span>-osx-x64-v5.<span class="number">1</span>.tgz
cd cuda
sudo cp lib/* <span class="regexp">/usr/local</span><span class="regexp">/cuda/lib</span>
sudo cp <span class="keyword">include</span>/cudnn.h /usr/local/cuda/<span class="keyword">include</span>/
</code></pre><h2 id="安装依赖项_via_Homebrew">安装依赖项 via Homebrew</h2>
<p>首先我们需要修改下homebrew安装 opencv 时需要用到的opencv.rb文件</p>
<pre><code>brew <span class="keyword">edit</span> opencv
</code></pre><p>将下面两行：</p>
<pre><code>args &lt;&lt; "-DPYTHON_LIBRARY=#{<span class="ruby">py_lib}</span>/libpython2.7.#{<span class="ruby">dylib}</span>"
args &lt;&lt; "-DPYTHON_INCLUDE_DIR=#{<span class="ruby">py_prefix}</span>/include/python2.7"
</code></pre><p>替换为：</p>
<pre><code><span class="keyword">args</span> &lt;&lt; <span class="string">"-DPYTHON_LIBRARY=#{py_prefix}/lib/libpython2.7.dylib"</span>
<span class="keyword">args</span> &lt;&lt; <span class="string">"-DPYTHON_INCLUDE_DIR=#{py_prefix}/include/python2.7"</span>
</code></pre><p>然后开始安装依赖项：</p>
<pre><code>brew <span class="operator"><span class="keyword">install</span> <span class="comment">--fresh -vd snappy leveldb gflags glog szip lmdb homebrew/science/opencv</span>
brew <span class="keyword">install</span> <span class="comment">--build-from-source --with-python --fresh -vd protobuf</span>
brew <span class="keyword">install</span> <span class="comment">--build-from-source --fresh -vd boost boost-python</span>
brew <span class="keyword">install</span> hdf5</span>
</code></pre><blockquote>
<p>安装过程有点漫长，可能会出现一些错误，需要耐心的修复掉。<br>如果你把电脑升级到最新的 macOS Sierra 10.12，会由于新系统不内置QTKit导致opencv编译失败。</p>
</blockquote>
<h2 id="下载Caffe代码">下载Caffe代码</h2>
<pre><code>git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/BVLC/caff.git
<span class="keyword">cd</span> caffe
<span class="keyword">cp</span> Makefile.config.example Makefile.config
</code></pre><h2 id="Makefile-config">Makefile.config</h2>
<p>修改Makefile.config</p>
<pre><code>BLAS:=<span class="built_in">open</span>
BLAS_INCLUDE := $(<span class="built_in">shell</span> brew <span class="comment">--prefix openblas)/include</span>
BLAS_LIB := $(<span class="built_in">shell</span> brew <span class="comment">--prefix openblas)/lib</span>
</code></pre><p>取消CUDDNN的注释</p>
<pre><code><span class="attribute">USE_CUDNN :</span>=<span class="string"> 1</span>
</code></pre><p>检查设置Python路径</p>
<pre><code><span class="comment"># NOTE: this is required only if you will compile the python interface.</span>
<span class="comment"># We need to be able to find Python.h and numpy/arrayobject.h.</span>
<span class="comment"># PYTHON_INCLUDE := /usr/include/python2.7 \</span>
<span class="comment">#         /usr/lib/python2.7/dist-packages/numpy/core/include</span>
<span class="comment"># Anaconda Python distribution is quite popular. Include path:</span>
<span class="comment"># Verify anaconda location, sometimes it's in root.</span>
<span class="comment"># ANACONDA_HOME := $(HOME)/anaconda</span>
<span class="comment"># PYTHON_INCLUDE := $(ANACONDA_HOME)/include \</span>
        <span class="comment"># $(ANACONDA_HOME)/include/python2.7 \</span>
        <span class="comment"># $(ANACONDA_HOME)/lib/python2.7/site-packages/numpy/core/include \</span>

<span class="constant">ANACONDA_HOME </span><span class="symbol">:</span>= <span class="variable">$(</span><span class="constant">HOME)</span>/anaconda
<span class="constant">PYTHON_INCLUDE </span><span class="symbol">:</span>= <span class="variable">$(</span><span class="constant">ANACONDA_HOME)</span>/<span class="keyword">include</span> \
<span class="variable">$(</span><span class="constant">ANACONDA_HOME)</span>/<span class="keyword">include</span>/python2.<span class="number">7</span> \
<span class="variable">$(</span><span class="constant">ANACONDA_HOME)</span>/lib/python2.<span class="number">7</span>/site-packages/numpy/core/<span class="keyword">include</span> \


<span class="comment"># Uncomment to use Python 3 (default is Python 2)</span>
<span class="comment"># PYTHON_LIBRARIES := boost_python3 python3.5m</span>
<span class="comment"># PYTHON_INCLUDE := /usr/include/python3.5m \</span>
<span class="comment">#                 /usr/lib/python3.5/dist-packages/numpy/core/include</span>

<span class="comment"># We need to be able to find libpythonX.X.so or .dylib.</span>
<span class="comment"># PYTHON_LIB := /usr/lib</span>
<span class="constant">PYTHON_LIB </span><span class="symbol">:</span>= <span class="variable">$(</span><span class="constant">ANACONDA_HOME)</span>/lib

<span class="comment"># Homebrew installs numpy in a non standard path (keg only)</span>
<span class="constant">PYTHON_INCLUDE </span>+= <span class="variable">$(</span>dir <span class="variable">$(</span>shell python -c <span class="string">'import numpy.core; print(numpy.core.__file__)'</span>))/<span class="keyword">include</span>
<span class="constant">PYTHON_LIB </span>+= <span class="variable">$(</span>shell brew --prefix numpy)/lib
</code></pre><h2 id="环境变量">环境变量</h2>
<pre><code>export <span class="constant">DYLD_FALLBACK_LIBRARY_PATH</span>=<span class="regexp">/usr/local</span><span class="regexp">/cuda/lib</span><span class="symbol">:/Users/cp/anaconda/lib</span><span class="symbol">:/usr/local/lib</span><span class="symbol">:/usr/local/Cellar/</span><span class="symbol">:/usr/local/cuda/lib</span><span class="symbol">:~/anaconda/lib</span><span class="symbol">:/usr/local/lib</span><span class="symbol">:/usr/lib</span><span class="symbol">:</span><span class="variable">$DYLD_FALLBACK_LIBRARY_PATH</span>
</code></pre><h2 id="编译caffe">编译caffe</h2>
<pre><code><span class="keyword">make</span> clean
<span class="keyword">make</span> <span class="keyword">all</span> -j8
<span class="keyword">make</span> runtest
</code></pre><p>runtest 相对会花些时间</p>
<pre><code><span class="keyword">make</span> pycaffe
<span class="keyword">make</span> distribute
</code></pre><p>就大功告成了</p>
<h2 id="References:">References:</h2>
<ul>
<li><a href="http://caffe.berkeleyvision.org/installation.html" target="_blank" rel="external">http://caffe.berkeleyvision.org/installation.html</a></li>
<li><a href="https://github.com/BVLC/caffe/wiki/Installation-%28OSX%29" target="_blank" rel="external">https://github.com/BVLC/caffe/wiki/Installation-%28OSX%29</a></li>
<li><a href="http://hoondy.com/2015/04/03/how-to-install-caffe-on-mac-os-x-10-10-for-dummies-like-me/" target="_blank" rel="external">http://hoondy.com/2015/04/03/how-to-install-caffe-on-mac-os-x-10-10-for-dummies-like-me/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/22/install-caffe-on-macosx/" data-id="bnj4j9lgj9q84po8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-1st-half" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/09/25/2016-1st-half/">2016上半年电影，美剧，以及书 清单</a>
  

      </header>
    
    <time class="article-date" datetime="2016-09-25T15:05:21.000Z" itemprop="datePublished">09-25-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Movie/">Movie</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="电影">电影</h2>
<h3 id="中国">中国</h3>
<ul>
<li>饮食男女</li>
<li>喜宴</li>
<li><p>推手</p>
<blockquote>
<p>李安“父亲”三部曲；在三部电影里面，饰演男主角的郎雄，都给人一种很亲切的感觉，让人很喜爱这老头儿。最喜欢《饮食男女》中吴倩莲饰演的二姐，走在最先锋的人，却最终选择了守住传统。</p>
</blockquote>
</li>
<li><p>北京遇上西雅图之不二情书</p>
<blockquote>
<p>加分的是那对老夫妇，以及老爷子身上的文人气质</p>
</blockquote>
</li>
<li><p>寒战2</p>
<blockquote>
<p>梁sir还是那么棒</p>
</blockquote>
</li>
<li>使徒行者</li>
<li>火锅英雄</li>
<li>老炮儿</li>
</ul>
<h3 id="日本">日本</h3>
<ul>
<li><p>步伐不停</p>
<blockquote>
<p>平淡的，生活化的，舍不得结束的</p>
</blockquote>
</li>
<li><p>海街日记</p>
<blockquote>
<p>依旧是平淡的，生活化的，舍不得结束的</p>
</blockquote>
</li>
<li><p>怪物之子</p>
</li>
</ul>
<h3 id="美国">美国</h3>
<ul>
<li><p>谍影重重5</p>
<blockquote>
<p>熟悉的伯恩回来了，但感觉整个的电影的高潮部分是在希腊街头的那段追杀。</p>
</blockquote>
</li>
<li><p>火星救援</p>
<blockquote>
<p>最爱马特呆萌种土豆那一段</p>
</blockquote>
</li>
<li>十二怒汉<blockquote>
<p>剧情精彩，回味无穷 </p>
</blockquote>
</li>
<li>生为蓝调<blockquote>
<p>冲着伊桑霍克看的</p>
</blockquote>
</li>
<li>功夫熊猫3</li>
<li>疯狂动物城</li>
<li>蝙蝠侠大战超人：正义黎明</li>
<li>奇幻森林</li>
<li>美国队长3</li>
<li>泰山归来：险战丛林</li>
<li>九条命</li>
<li>X战警：天启</li>
<li>硬核亨利</li>
</ul>
<h3 id="韩国">韩国</h3>
<ul>
<li>哭声<blockquote>
<p>看完堵得慌</p>
</blockquote>
</li>
</ul>
<h2 id="美剧">美剧</h2>
<ul>
<li><p>毒枭第二季</p>
<blockquote>
<p>和第一季一样，还是那个魔幻的哥伦比亚</p>
</blockquote>
</li>
<li><p>权利的游戏第六季</p>
<blockquote>
<p>私生子之战，我看了三遍了</p>
</blockquote>
</li>
<li><p>绝命律师第二季</p>
<blockquote>
<p>好看，推荐</p>
</blockquote>
</li>
<li><p>黑客军团第二季</p>
<blockquote>
<p>强迫症让我看完了第二季，应该会看第三季</p>
</blockquote>
</li>
<li><p>怪奇物语</p>
<blockquote>
<p>为了拍第二季，第一季的结尾让人不适，不打算看第二季</p>
</blockquote>
</li>
</ul>
<h2 id="书">书</h2>
<ul>
<li>《你是一切的答案》</li>
<li>《程序员的思维锻炼》<blockquote>
<p><a href="http://cp0000.github.io/2016/06/11/pragmatic-thinking-and-learning/" target="_blank" rel="external">读书笔记</a></p>
</blockquote>
</li>
</ul>
<blockquote>
<p>没写评论的，在我看来是可看可不看的</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/25/2016-1st-half/" data-id="u9pjnrpfjc6fbf6p" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-shanghai-4-years" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/07/30/shanghai-4-years/">五年，四年</a>
  

      </header>
    
    <time class="article-date" datetime="2016-07-30T06:35:05.000Z" itemprop="datePublished">07-30-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Life/">Life</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://cp0000.github.io/assets/lights.jpg" alt="lights"></p>
<p>2012年端午节前的一个礼拜，我买了张从南宁到上海的火车票,只身一人来到上海。</p>
<p>两个礼拜前我从广州的一家公司辞职。这家广州公司在南宁有一个更小的办公室，我11年刚毕业的时候找不到很好的工作，就先去那个小办公室上班；那时我和大学室友在公司附近一起租了一套房子，房主是戒毒所医生，一个个子小小的，为人和蔼的南宁阿姨；同年10月份，我被派去广州出差，那是我第一次去发达省份，第一次坐地铁，也第一次感受到大城市竞争的残酷性。不过那时我以为自己年底还会回南宁继续上班，所以还留了一些杂物在南宁，租的房子也没有退。</p>
<p>没想到，再次回南宁的时候，已经是决定离开这座城市了。我在南宁大概呆了一个多礼拜，见了南宁办公室的同事，并和他们一起去了趟北海玩了两天，那是我第二次去北海。在北海的两天，我和蒙哥（南宁办公室的老大）一起住的一个标准间，夜里我们七七八八聊了一些；我只记得他跟我讲了他在IBM当销售的时候是怎么搞定客户的故事，和他对未来的一些打算，似乎有挽留之意，我含糊中转移了话题。从北海回南宁后，约了几个大学同学聚餐，地点在西大后面农院路的街头。尔后退了房子，收拾好行李，临走的前一天，我一个人去西大走了走，看了看。然后搭上火车，和这个呆了四年多的城市道别了。</p>
<p>刚来上海的头两个礼拜，我借住在朋友那里；朋友住在他自己租在桂林路地铁站附近的一间小屋子里；那个小格子间是我经历过的条件最艰苦的住宿环境，小小的隔间，只有四五平方米，屋子里还臭气一阵阵。那段时间，我疯狂的投简历，只要人家约我去面试，我都要跑去试试看，一心想把自己买一个好价钱。最终，我去到上家公司上班，公司叫 yeecco。找好工作之后，我从朋友的小隔间里面搬了出来。我无意冒犯这位朋友，只是觉得人应该对自己好一点，那样的住宿环境现在想起来我都会觉得难受。</p>
<p>新租的房子在淞虹路地铁站附近，隔壁住的是一对刚毕业的情侣。有了工作和住的地方，我稍微定心了些，没有刚来的时候那么惶恐。</p>
<p>那段日子，早上我从淞虹路坐地铁到静安寺上班。半个小时拥挤的地铁中，我会看一会书；印象中看的是稻盛和夫的《活法》。这本书可能会被现在的人诟病，但对一个初来乍到，在这个都市一个帮手都没有的人来讲，不失为一本很好的精神慰藉。它让我把所有的精力都放在新工作上，让我不要多想，做好眼前事，明日事明日议。</p>
<p>新工作并不容易，公司做的项目是 <a href="https://github.com/morningtec/StellaSDK" target="_blank" rel="external">StellaSDK</a>，对于当时的我来讲，项目中大多数知识是我没接触过的，很多东西无从下手。那段时间，我拼命学习，工作。经常会在地铁里面，思考到某个点，恨不能马上拿电脑验证一下；又会因为某个问题没思路解决不了，导致压力太大吃不下饭。但回过头来看，那段经历对自己编程技术的提升帮助很大，让我养成了很好的学习新技术的习惯和方法，不畏惧任何不懂的技术领域。我很感激老大wenqi，那时候他对我也很好（一个会夜里开车送你回家的老大不是那么的常见），我的技术，习惯，思考方式，以及保持勤奋全都是从他身上学得，非常感激他。</p>
<p>后来，由于一些原因我离开了上家公司，来到了腾讯。如今，算算我已经毕业五年，来到上海也已经四年；看起来情况在变好，至于未来，应该会变得更好一些吧。</p>
<p>后记：</p>
<p>不知道其它人会不会有这样一种感觉，在生活中的某个阶段，你会突然意识到自己生命中的一切都只能靠你自己。我有这种感觉是在我刚毕业的时候。在那段时间里的某一刻，我突然意识到接下来的一切，钱，工作，女人，以及所有的渴望都只有靠自己。你是你唯一的依靠。</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=3986326&auto=1&height=66"></iframe>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/07/30/shanghai-4-years/" data-id="kuxgdwsudt7p1cmh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-pragmatic-thinking-and-learning" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/06/11/pragmatic-thinking-and-learning/">《程序员的思维训练》读书笔记</a>
  

      </header>
    
    <time class="article-date" datetime="2016-06-11T08:21:36.000Z" itemprop="datePublished">06-11-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Reading-notes/">Reading notes</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://img1.doubanio.com/lpic/s4548399.jpg" style="width: 120px;"></p>
<h2 id="技术从业人员的五个级别">技术从业人员的五个级别</h2>
<p>书中开篇介绍一项技术领域的从业人员，大体可以分成五个级别：新手，高级新手，胜任者，精通者，专家。从名次表面就很好理解这五个级别所代表的意思。有意思的地方在于现在国内的大型互联网公司内部，技术人员的职级分类也是如此：初级工程师，工程师，高级工程师，资深工程师，专家。文中列举了一些各个级别的人的一些有意思的特征，如新手非常在乎他们是否成功，新手不是特别想要学习，他们只是想要一个立竿见影的效果，如果出错，他们非常容易慌乱。高级新手能够根据过去的经验，逐步在正确的情景中采纳建议，但他们不想要全局思维。胜任者是可以独立解决问题，并开始考虑如何解决新的问题，胜任者的工作更多的是基于谨慎的计划和过去的经验，如果没有更多的经验，在解决问题时，他们难以确定关注哪些细节。精通者能够纠正以往不好的工作表现，他们会反思以前是如何做的，并修改其做法，期望下一次表现得更好，如此，自我改进就会出现。专家根据直觉工作，而不需要理由，专家的数量很少，大概占总人数的1%～5%。</p>
<p>而要想而从新手一步一步升级成为专家，自身要发生如下三个重要变化才行：</p>
<ul>
<li>从依赖规则向依赖直觉转变</li>
<li>观念的改变，问题已不再是一个相关度等同的所有单元的集合体，而是一个完整和独特的真题，其中某些单元是相关的。</li>
<li>最后，从问题的旁观者转变为问题涉及的系统本身的一部分。</li>
</ul>
<p>然后，令人沮丧的是，研究表明，大多数人的大多数技能，在他们生命的大多数时间里，从没有高于第二阶段高级新手，这里的大多数指的是70%的人。</p>
<h2 id="大脑的两种思考模式（L_&amp;_R）">大脑的两种思考模式（L &amp; R）</h2>
<p>书中第二部分介绍了大脑两种思考模式，L模式－线性模式，R模式－富模式。R型对直觉。L型让你细致工作并实现目标。要想获得最佳性能，需要两种模式协同工作。</p>
<p>L型提供以下9种能力：</p>
<ul>
<li>语言能力</li>
<li>分析能力</li>
<li>符号能力</li>
<li>抽象能力</li>
<li>实践能力</li>
<li>推理能力</li>
<li>数字能力</li>
<li>逻辑能力</li>
<li>线性思维能力</li>
</ul>
<p>这些都是白领们，信息工作者和工程师们最渴望的本领。上学的时候测验也是这些能力。</p>
<p>R型提供的能力：</p>
<ul>
<li>非语言</li>
<li>非理性</li>
<li>综合</li>
<li>空间性</li>
<li>具体</li>
<li>直觉</li>
<li>分析</li>
<li>全面</li>
<li>非线性</li>
</ul>
<p>R型是非语言的，注重整体的，直觉的，跳跃的，这些特点似乎更适合艺术家。但R型的类比和整体思考方式对软件架构和设计非常有价值，好的设计就是由这些组成的。R型还负责综合，而综合是一项非常强大的学习技术。乃至于麻省理工学院媒体实验室创始人建议，真正想要了解一只青蛙，传统的解剖不是办法，更好的方式是构造一直青蛙。（联想到软件开发中，如果想真正搞透某个模块，重造轮子应该是最好的方式）。</p>
<p>接着书中谈到相对于L型，为何R型也如此重要。一家公司的产品是否能够成功，R型思维起到很重要因素。因为R型管理美学，而商品化意味着美学品味的竞争。<strong>作者强调产品的设计胜于功能，是否有吸引力很重要。</strong>好的设计，会给用户带来积极的情感，而积极的情感对学习和创造思维非常关键。处于“高兴”的状态可以扩展你的思维过程，激活更多的大脑物质（意味着用户从产品获取到快感，成就感，自然就会愿意使用产品）。</p>
<p>当然了，美学不仅仅指的是用户界面,产品的Logo，也包括代码和注释的布局，变量名的选择和桌面的整理，还有其他领域的方方面面。（此时，想起了乔布斯的那句“It’s all about the taste”）</p>
<h2 id="如何利用L型和R型协同工作">如何利用L型和R型协同工作</h2>
<p>然后书中第四章介绍了如何利用右脑，也就是如何促成R型到L型的转换。其中我觉得很有意思的是酒醉写作，酒醒修改。因为酒醉的时候，你拥有自由的创造空间，不受“常识”或者“实用”束缚，可以尽情发挥自己的创造力或随后抛掉那些荒诞的东西。</p>
<p>下面是举了几个关于 L 型和 R 型协调工作的其它几种方式：</p>
<ul>
<li>结对编程：工作时，一个人用L型，一个人用R型</li>
<li>隐喻相通：隐喻，语言和意像共同的地基，是在左右脑半球之间，在潜意识和意识之间来回游弋的途径。隐喻时一种激发创造力的强大技术。</li>
<li>并列参照系</li>
<li>幽默：幽默既不是浪费时间，也不是无害的消遣，而是反映了思维，学习和创造所必需的重要能力。他与联系有关。幽默产生于在不同的想法中制造新奇的联系。在任何情况下，幽默的能力都来自于发掘或扩展常规之外的关系，真正突破思维界限。</li>
</ul>
<p>文中还有一段关于外向和内向的人讨论。外向的人乐于与人交往并参加社会活动。内向的人则不是，他们具有领地意识，需要私人的精神和环境空间，内向的人从独立的活动中获得力量，厌倦社会活动。百分之七十五的人偏于外向型，剩下百分之二十五的人则希望单独呆着。</p>
<h2 id="学习">学习</h2>
<p>在当今技术和文化环境下，学习能力可能是成功的最重要因素。它决定了你是“大获全胜”还是“勉强通过”。</p>
<ul>
<li>技术本身不重要，持续学习才是最重要的。</li>
<li>学习不是强加于你的，而是需要你主动做的事情</li>
<li>仅仅掌握知识，而不去实践，没有用</li>
<li>随机的方法，没有目标和反馈，往往会导致随机的结果</li>
</ul>
<p>那如何在现实中使学习更有效率？需要使用SMART目标和实用投资计划管理目标和计划。</p>
<p>SMART 代表具体的，可度量的，可实现的，相关的和时间可控的（Specific，Measurable,Achievable,Relevant,and Time-boxed）。</p>
<ul>
<li>具体的：一个目标任务应该是具体的。也就是说，只说“我想学习swift”是不够的。应该把事情具体化，例如“我想要用Swift编写一个记账软件”</li>
<li>可度量的：如何知道你何时完成？为了努力实现目标任务，不管采用什么办法，你必须能够度量它。可度量的与具体的相辅相成。很难度量笼统抽象的事物，但是很容易度量具体和详细的事物，只要使用确切的数字即可。如果你认为无法度量自己的目标任务，那么可能它还不够具体。“写一部小说就像在黑夜里开车。你只能看到车灯照亮的部分，但是你却可以走完整个旅程”。你不必看清你去往何处。不必看清你的目的地和沿途的一切。你只需看清面前的一两米即可。</li>
<li>可实现的</li>
<li>相关的：目标需要相关，需要在你掌握之中</li>
<li>时间可控的：没有期限，目标会逐步衰退，永远被每天更紧急的事情所排挤。</li>
</ul>
<h2 id="管理知识投资">管理知识投资</h2>
<ul>
<li>制定具体计划：制定计划就是巨大的进步。计划要具体，要运用SMART目标理念，要为不同时间段设计不同层次的目标。记住艾森豪威尔将军对我们的建议：作计划比计划本身重要得多。</li>
<li>多样化：不要把所有的鸡蛋放在同一个篮子里，需要很好地组合语言，环境，技术，行业和非技术领域（管理，公共演讲，，人类学，音乐，艺术，等等）</li>
<li>主动投资：需要客观地按天来评估你的计划，如实地判断运行状况。</li>
<li>定期投资：需要定期投资最低限度的时间量，养成一种习惯。并非每期学习都同样富有成效，但是只要定期安排学习，长期来看一定会成功。</li>
</ul>
<h2 id="控制注意力">控制注意力</h2>
<p>在我们生活的这个信息丰富的时代，过多的信息导致了知识和注意力的匮乏。置身于应接不暇的信息中，很容易失去思考的重心。要更好地管理自己的思维需要从以下三个方面做起：</p>
<ul>
<li>提高注意力：可以通过冥想来提高自己的注意力。关于如何冥想，文中提到的是，打坐，然后所有事情就是注意自己的呼吸。详细的步骤需要自身对着书中的介绍去实践。</li>
<li>管理知识：使用wiki</li>
<li>优化当前情境：多任务处理对生产力会造成重大损失，记住，无论你做什么，请不要同时都做，避免分心。</li>
</ul>
<h2 id="改变">改变</h2>
<p>一些帮助我们管理有效改变的建议。</p>
<ul>
<li>制定计划</li>
<li>“不作为”是敌人，而“错误”不是</li>
<li>给新习惯适应的时间</li>
<li>信念是真实的</li>
<li>采取步步为营的细小步骤</li>
</ul>
<p>最后，选择开始做什么并不特别重要，重要的是主动尝试学习到的知识，做出改变。</p>
<blockquote>
<p>不管你能做什么，或者期望自己能做什么，现在就开始做。勇敢可以给人智慧，力量和神奇。现在就开始做吧。 －－歌德</p>
</blockquote>
<p>以上是我读书过程中做的一些书摘。作为一个软件从业人员，我对文中作者的很多观点都很是赞同，对这本书也有点相见恨晚的味道。读这本书的时候，最重要的环节就是尝试去做书中提到的种种实践；就像我们在研究一门新的技术的时候，重要的一环是用新技术去解决某个问题。这种学习方式是我从业以来一直惯用的方式。<br>很好的一本书，值得推荐给别人去看，不论这个人是不是程序员。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/06/11/pragmatic-thinking-and-learning/" data-id="7fd21v9vfo2l4o5o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iOS-reverse-engineering-03" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
      <header class="article-header">
        
  
    <a class="article-title" href="/2016/03/06/iOS-reverse-engineering-03/">iOS逆向工程-0x02－Hacking on B612</a>
  

      </header>
    
    <time class="article-date" datetime="2016-03-06T03:32:44.000Z" itemprop="datePublished">03-06-2016</time>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>

  </div>
  <div class="article-inner">
    <div class="article-entry" itemprop="articleBody">
      
        <p>前面两篇iOS逆向的文章（<a href="http://cp0000.github.io/2015/11/21/iOS-reverse-engineering-01/" target="_blank" rel="external">iOS逆向工程-0x00－用途以及准备工作</a>,<a href="http://cp0000.github.io/2015/11/30/iOS-reverse-engineering-02/" target="_blank" rel="external">iOS逆向工程-0x01－工具篇-Cycript</a>）主要是介绍iOS逆向的相关基础环境的搭建，工具的使用。有了这些知识之后，我们可以进行简单的逆向工作了。</p>
<p><a href="https://itunes.apple.com/us/app/b612-selfie-from-the-heart/id904209370?mt=8" target="_blank" rel="external">B612</a>是Line公司出品的一款非常棒的拍照软件。它的界面，交互，用起来非常顺手。app中的滤镜效果很赞，用户简单几步操作就可以生成一张很有质感的照片。本文我将会演示如何通过逆向来得知B612单个的滤镜的具体实现。</p>
<p>从AppStore上面下载B612的IPA文件，把文件的后缀名从 .IPA 修改成 .zip。解压zip文件之后，在Payload中有一个b612.app的文件，这里我们把.app的后缀去掉，让它变成一个文件夹，方便后面查阅。经过以上几步操作我们就拿到了 B612 app的 bundle 文件信息。</p>
<p>在使用B612的过程中，app会展列一个滤镜列表给用户进行选择（如下图）：</p>
<p><img src="http://cp0000.github.io/assets/b612_filter_list.png" alt="B612_filter_list" style="width: 400px;"></p>
<p>使用的过程发现一个叫 China 的滤镜，China，中国？还是瓷器？叫China的滤镜会呈现出什么样子的效果，根据效果我们是否能推测出这里的China是要翻译成中国，还是瓷器咧？很有意思的样子。我们就拿这个滤镜当做目标吧。</p>
<p>一般情况下，我的常用做法是在先前解压的文件夹中搜索一下相关的信息，碰碰运气。</p>
<pre><code><span class="keyword">find</span> . -name <span class="string">"*china*"</span>                 
.<span class="regexp">/FilterThumb.bundle/</span>filterthumb_china.jpg
.<span class="regexp">/ObfuscateImages.bundle/</span>lut<span class="regexp">/china.dat</span>
</code></pre><p>运气不错。在ObfuscateImages.bundle发现了一个叫china.dat的文件。不过尝试用各种编辑器都没法打开，使用修改后缀名等之类的方法也没能成功打开。看来要获取这个文件的内容没有那么简单，开发者对这个文件做了相关加密工作。要想解密该文件，我们可能需要到汇编代码中寻找答案了。</p>
<blockquote>
<p>这里考虑到程序在使用这个滤镜的时候，会加载该文件，并进行相关解密工作。所以下一步是要找到解密dat文件的地方，不过在此之前，我们还有一些工作要做。</p>
</blockquote>
<h2 id="解密可执行文件_-_clutch_演示">解密可执行文件 - clutch 演示</h2>
<p>接下来我们要去可执行文件中查询相关信息了。但是从苹果商店上面下载下来的IPA里面的可执行文件是被苹果加密过的,我们解谜它。我常用的工具是 <a href="https://github.com/KJCracks/Clutch" target="_blank" rel="external">clutch</a>,你可以clone一份repo到本地，然后编译得到一个clutch的程序，也可以直接下载release版本。然后把Clutch scp 到你的越狱机器上面就可以使用了。</p>
<ul>
<li><p>首先我们查找一下b612的bundle</p>
<p>  iPhone:/usr root# ./Clutch -i|grep b612<br>  28)<b612 bundleid:="" com.linecorp.b612=""></b612></p>
</li>
<li><p>然后进行dump工作</p>
<p>  iPhone:/usr root# ./Clutch -d com.linecorp.b612<br>  ….<br>  //程序输出相关log<br>  ….<br>  DONE: /private/var/mobile/Documents/Dumped/com.linecorp.b612-iOS7.0-(Clutch-2.0 RC2).ipa</p>
</li>
</ul>
<p>最后会生成一个解密了的ipa文件，我们把它scp到电脑上来，进行分析。</p>
<blockquote>
<p>还有另外一个解密苹果商店加密IPA的工具叫<a href="https://github.com/conradev/dumpdecrypted" target="_blank" rel="external">dumpdecrypted</a>。由于在使用Clutch解密app的时候，消耗内存比较大，导致运行时会出现解密失败的情况，这个时候可以尝试使用<a href="https://github.com/conradev/dumpdecrypted" target="_blank" rel="external">dumpdecrypted</a>。</p>
</blockquote>
<h2 id="分析可执行文件_-_class-dump_以及_IDA">分析可执行文件 - class-dump 以及 IDA</h2>
<p>要分析解密之后的文件，我们可以使用<a href="https://github.com/nygard/class-dump" target="_blank" rel="external">class-dump</a>来导出程序的头文件。有了头文件列表之后，我们可以利用它来了解app的架构，使用的类库，以及探索需要逆向的那一块功能所属的类名。</p>
<pre><code><span class="comment">class</span><span class="literal">-</span><span class="comment">dump</span><span class="literal">-</span><span class="comment">z/mac_x86/class</span><span class="literal">-</span><span class="comment">dump</span><span class="literal">-</span><span class="comment">z</span> <span class="comment">b612</span> <span class="literal">-</span><span class="comment">H</span> <span class="literal">-</span><span class="comment">o</span> <span class="comment">headers</span>
<span class="comment">cd</span> <span class="comment">headers</span>
<span class="comment">total</span> <span class="comment">10728</span>
<span class="comment">drwxr</span><span class="literal">-</span><span class="comment">xr</span><span class="literal">-</span><span class="comment">x</span>  <span class="comment">1295</span> <span class="comment">cp</span>  <span class="comment">wheel</span>  <span class="comment">44030</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="string">.</span>
<span class="comment">drwxr</span><span class="literal">-</span><span class="comment">xr</span><span class="literal">-</span><span class="comment">x</span>   <span class="comment">455</span> <span class="comment">cp</span>  <span class="comment">wheel</span>  <span class="comment">15470</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="string">.</span><span class="string">.</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>    <span class="comment">785</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTApplication</span><span class="string">.</span><span class="comment">h</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>    <span class="comment">370</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTAutomatedUsageReporter</span><span class="string">.</span><span class="comment">h</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>    <span class="comment">391</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTAutomatedUsageReporterPrivate</span><span class="string">.</span><span class="comment">h</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>    <span class="comment">264</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTAutomatedUsageReporting</span><span class="string">.</span><span class="comment">h</span>
<span class="literal">-</span><span class="comment">rw</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span>     <span class="comment">1</span> <span class="comment">cp</span>  <span class="comment">wheel</span>   <span class="comment">1830</span> <span class="comment">Apr</span>  <span class="comment">4</span> <span class="comment">12:46</span> <span class="comment">ACTAutomatedUsageTracker</span><span class="string">.</span><span class="comment">h</span>
</code></pre><p>要找到加密 .dat 文件的相关代码，我们需要使用另外一个非常强大的工具<a href="https://www.hex-rays.com/products/ida/index.shtml" target="_blank" rel="external">IDA</a>。IDA可以非常整洁的输出可执行文件的汇编代码，并且相互连接起来。不过这个软件非常之贵，但是它的免费版本已经够用了。</p>
<p>把B612的可执行文件加载到IDA之后，我们在IDA中执行一个搜索，关键字是dat;幸运的是，搜索结果指向了一下的代码。虽然是汇编代码，但是不难看出两点信息，（1）dat后缀的文件是一张Image （2）程序中需要把文件的数据字节进行反向操作，达到混淆的目的。</p>
<p><img src="http://cp0000.github.io/assets/b612-reversebyte.png" alt="reversebyte" style="width: 500px;"></p>
<p>接下来验证一下线索结果：</p>
<pre><code>- (<span class="keyword">void</span>)viewDidLoad {
    [<span class="keyword">super</span> viewDidLoad];
    NSData * data = [[NSData alloc] initWithContentsOfFile: [[<span class="built_in">NSBundle</span> mainBundle] pathForResource:<span class="string">@"china"</span> ofType:<span class="string">@"dat"</span>]];
    data = [<span class="keyword">self</span> reverseData: data];
    <span class="built_in">UIImage</span> * image  = [<span class="built_in">UIImage</span> imageWithData: data];
    <span class="built_in">UIImageView</span> * imageView = [[<span class="built_in">UIImageView</span> alloc] initWithImage: image];
    imageView<span class="variable">.frame</span> = <span class="keyword">self</span><span class="variable">.view</span><span class="variable">.bounds</span>;
    [<span class="keyword">self</span><span class="variable">.view</span> addSubview: imageView];
}
- (NSData *)reverseData:(NSData *)data {
    <span class="keyword">const</span> <span class="keyword">char</span> *bytes = [data bytes];
    <span class="keyword">int</span> idx = [data length] - <span class="number">1</span>;
    <span class="keyword">char</span> *reversedBytes = calloc(<span class="keyword">sizeof</span>(<span class="keyword">char</span>),[data length]);
    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; [data length]; i++) {
        reversedBytes[idx--] = bytes[i];
    }
    NSData *reversedData = [NSData dataWithBytes:reversedBytes length:[data length]];
    free(reversedBytes);
    <span class="keyword">return</span> reversedData;
}
</code></pre><p>上述代码让我们获得一张china的图片：</p>
<p><img src="http://cp0000.github.io/assets/china.png" alt="china" style="width: 300px;"></p>
<p>上述代码，请查阅<a href="https://github.com/cp0000/HackB612" target="_blank" rel="external">HackB612Image</a></p>
<p>OK，到此为止，我们解密了china.dat 这种类型的文件，它跟我们最终要挖掘的china滤镜是如何实现的之间肯定有着联系，但我们现在还不得知。</p>
<h2 id="关于滤镜">关于滤镜</h2>
<p>在iOS app 中给图片加滤镜是要通过OpenGL ES 去实现的，而现在app中普遍使用的是<a href="https://www.khronos.org/opengles/2_X/" target="_blank" rel="external">OpenGL ES 2.0</a>。这种情况下，滤镜一般都是通过OpenGL的shader来实现的。此时，前面dump出来的header就有用了，分析headers之后，我们发现了两个相关类 GPUImageFilter以及GLProgram。又由于shader在使用之前一定要进行link，compile操作。所以我们可以通过尝试hook这两个类的相关函数，来获得滤镜的shader。</p>
<blockquote>
<p>根据头文件我们能发现B612是通过使用<a href="https://github.com/BradLarson/GPUImage" target="_blank" rel="external">GPUImage</a>框架来实现滤镜功能的。</p>
</blockquote>
<h2 id="Theos">Theos</h2>
<p>关于如何hook app 在运行时的函数，我们需要使用工具<a href="http://iphonedevwiki.net/index.php/Theos" target="_blank" rel="external">Theos</a>.</p>
<ul>
<li>关于如何安装Theos，请阅读<a href="http://iphonedevwiki.net/index.php/Theos/Setup" target="_blank" rel="external">Theos Setup</a>。</li>
<li>Logos相关语法，请参考<a href="http://iphonedevwiki.net/index.php/Logos" target="_blank" rel="external">Theos Logos</a></li>
</ul>
<p>安装好Theos之后，我们为B612创建一个tweak;</p>
<pre><code>$THEOS/bin/nic.pl 
NIC <span class="number">2.0</span> - New Instance Creator
------------------------------
  [<span class="number">1.</span>] iphone/application
  [<span class="number">2.</span>] iphone/<span class="keyword">library</span>
  [<span class="number">3.</span>] iphone/preference_bundle
  [<span class="number">4.</span>] iphone/tool
  [<span class="number">5.</span>] iphone/tweak
Choose a Template (required): <span class="number">5</span>
Project Name (required): bsix
Package Name [com.yourcompany.bsix]: com.cp.bsix
Author/Maintainer Name [cp]: 
[iphone/tweak] MobileSubstrate Bundle filter [com.apple.springboard]: com.linecorp.b612            
[iphone/tweak] List of applications to terminate upon installation (space-separated, <span class="string">'-'</span> <span class="keyword">for</span> none) [SpringBoard]: b612
Instantiating iphone/tweak <span class="keyword">in</span> bsix/<span class="keyword">...</span>
Done.
</code></pre><p>然后在Tweak.xm文件中编辑需要hook的函数：</p>
<pre><code>%hook GLProgram
-(<span class="property">id</span>)initWithVertexShaderString:(<span class="property">id</span>)vertexShaderString fragmentShaderString:(<span class="property">id</span>)<span class="type">string</span>
{
    [Logger <span class="command">log</span>: [NSString stringWithFormat:@<span class="string">"%@ %@"</span>, NSStringFromClass([self <span class="type">class</span>]), NSStringFromSelector(_cmd)]];
    NSString * msg = [NSString stringWithFormat: @<span class="string">"vertexShaderString: %@ fragmentShaderString: %@ "</span>, vertexShaderString, <span class="type">string</span>];
    [Logger <span class="command">log</span>: msg];
<span class="command">    return</span> %orig;
}
%<span class="keyword">end</span>
</code></pre><p>B612 tweak 的项目地址<a href="https://github.com/cp0000/B612Tweak" target="_blank" rel="external">B612Tweak</a>.成功编译之后，把生成的.deb文件scp到越狱机器上，利用dpkg安装tweak；杀掉B612进程重启app之后，tweak就可以hook相关函数了。以下在点击China滤镜的时候，tweak打印出来的log信息：</p>
<pre><code>GLProgram initWithVertexShaderString:fragmentShaderString:
vertexShaderString: 
<span class="keyword">attribute</span> <span class="keyword">vec4</span> position; 
<span class="keyword">attribute</span> <span class="keyword">vec4</span> inputTextureCoordinate; 
<span class="keyword">attribute</span> <span class="keyword">vec4</span> inputTextureCoordinate2; 
<span class="keyword">varying</span> <span class="keyword">vec2</span> textureCoordinate; 
<span class="keyword">varying</span> <span class="keyword">vec2</span> textureCoordinate2; 
<span class="keyword">void</span> main() { 
    <span class="built_in">gl_Position</span> = position; 
    textureCoordinate = inputTextureCoordinate.xy; 
    textureCoordinate2 = inputTextureCoordinate2.xy; 
} 
fragmentShaderString: 
<span class="keyword">varying</span> <span class="keyword">highp</span> <span class="keyword">vec2</span> textureCoordinate; 
<span class="keyword">varying</span> <span class="keyword">highp</span> <span class="keyword">vec2</span> textureCoordinate2; 
<span class="keyword">uniform</span> <span class="keyword">sampler2D</span> inputImageTexture; 
<span class="keyword">uniform</span> <span class="keyword">sampler2D</span> inputImageTexture2; 
<span class="keyword">void</span> main() { 
    <span class="keyword">highp</span> <span class="keyword">vec4</span> textureColor = <span class="built_in">texture2D</span>(inputImageTexture, textureCoordinate); 
    <span class="keyword">highp</span> <span class="keyword">float</span> blueColor = textureColor.b * <span class="number">63.0</span>; 
    <span class="keyword">highp</span> <span class="keyword">vec2</span> quad1; 
    quad1.y = <span class="built_in">floor</span>(<span class="built_in">floor</span>(blueColor) / <span class="number">8.0</span>); 
    quad1.x = <span class="built_in">floor</span>(blueColor) - (quad1.y * <span class="number">8.0</span>); 
    <span class="keyword">highp</span> <span class="keyword">vec2</span> quad2; 
    quad2.y = <span class="built_in">floor</span>(<span class="built_in">ceil</span>(blueColor) / <span class="number">8.0</span>); 
    quad2.x = <span class="built_in">ceil</span>(blueColor) - (quad2.y * <span class="number">8.0</span>); 
    <span class="keyword">highp</span> <span class="keyword">vec2</span> texPos1; 
    texPos1.x = (quad1.x * <span class="number">0.125</span>) + <span class="number">0.5</span>/<span class="number">512.0</span> + ((<span class="number">0.125</span> - <span class="number">1.0</span>/<span class="number">512.0</span>) * textureColor.r); 
    texPos1.y = (quad1.y * <span class="number">0.125</span>) + <span class="number">0.5</span>/<span class="number">512.0</span> + ((<span class="number">0.125</span> - <span class="number">1.0</span>/<span class="number">512.0</span>) * textureColor.g); 
    <span class="keyword">highp</span> <span class="keyword">vec2</span> texPos2; 
    texPos2.x = (quad2.x * <span class="number">0.125</span>) + <span class="number">0.5</span>/<span class="number">512.0</span> + ((<span class="number">0.125</span> - <span class="number">1.0</span>/<span class="number">512.0</span>) * textureColor.r); 
    texPos2.y = (quad2.y * <span class="number">0.125</span>) + <span class="number">0.5</span>/<span class="number">512.0</span> + ((<span class="number">0.125</span> - <span class="number">1.0</span>/<span class="number">512.0</span>) * textureColor.g); 
    <span class="keyword">lowp</span> <span class="keyword">vec4</span> newColor1 = <span class="built_in">texture2D</span>(inputImageTexture2, texPos1); 
    <span class="keyword">lowp</span> <span class="keyword">vec4</span> newColor2 = <span class="built_in">texture2D</span>(inputImageTexture2, texPos2); 
    <span class="keyword">lowp</span> <span class="keyword">vec4</span> newColor = <span class="built_in">mix</span>(newColor1, newColor2, <span class="built_in">fract</span>(blueColor)); 
    <span class="built_in">gl_FragColor</span> = <span class="keyword">vec4</span>(newColor.rgb, textureColor.w); 
}
</code></pre><h2 id="关于使用OpenGL实现滤镜">关于使用OpenGL实现滤镜</h2>
<p>前文提到过，根据class-dump出来的头文件，得知B612使用了<a href="https://github.com/BradLarson/GPUImage" target="_blank" rel="external">GPUImage</a>。理论上我们下一步研究下GPUImage项目，应该就可以实现china滤镜的效果了，但GPUImage项目还是挺庞大，挺复杂的。</p>
<blockquote>
<p>GPUImage 提供了<code>GPUImageLookupFilter</code>类来实现颜色查找类的滤镜</p>
</blockquote>
<p>这里我们直接使用OpenGL来实现China滤镜。阅读前面的shader代码，得知需要传递给shader两个texture，可以想象出一个是需要原图片，一个是china.dat转换出来的图片，经过顶点着色器和片段着色器，最终给目标图片加上滤镜。下面第一张图是原图，第二张是我用OpenGL实现的Demo效果图片，第三张是B612加china滤镜出来的结果。对比第二张和第三章，效果非常相似。利用OpenGL实现滤镜的代码，请查阅<a href="https://github.com/cp0000/HackB612" target="_blank" rel="external">HackB612</a></p>
<p><img src="http://cp0000.github.io/assets/photo.jpg" alt="原图" style="width: 250px;"></p>
<p><img src="http://cp0000.github.io/assets/jingse.jpg" alt="Demo效果图" style="width: 250px;"><img src="http://cp0000.github.io/assets/jingse_b612.jpg" alt="B612效果图" style="width: 250px;"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/06/iOS-reverse-engineering-03/" data-id="c8jyixm49pz8yx5a" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iOS-Reverse-Engineering/">iOS Reverse Engineering</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Pei Cheng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63703524-1', 'auto');
  ga('send', 'pageview');

</script>
  </div>
</body>
</html>